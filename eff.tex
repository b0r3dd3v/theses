\documentclass[b]{subfiles}
\begin{document}

\chapter{$\dagger$ and~$\diamond$ in an effectus}

\begin{parsec}%
\begin{point}%
In the previous chapter and in \TODO{cite Bram}
    we have studied the categorical properties of von Neumann algebras.
In this chapter we change pace:
    we study categories which share part of the structure
    of the category of von Neumann algebras.
The goal of this line of study, is to identify
    axioms which uniquely pick out the category of von Neumann algebras.
We do not reach this ambitious goal ---
    instead we will build up to a characterization of
    the existence of a unique $\dagger$-structure
    on the pure maps of a von Neumann-like category.
\end{point}
\begin{point}%
As basic axiom we will require the categories we consider to be
    effectuses.
For us the definition of an effectus will play a similar role
    to that of a topological space for a geometer.
General topological spaces on their own are usually of little interest:
    the axioms are so weak that there are many pathological examples.
    These weak axioms, however, are very expressive in the sense
    that they allow for the definition of many useful notions.
    Herein lies the strength of topological spaces ---
    as a stepping stone:
    many important classes of mathematical spaces
    are just plain topological spaces with a few additional axioms.
Similarly, there will be many pathalogical effectuses.
Their use for us lies in their expressiveness.
After we have studied plain effectuses,
    we will study effectuses with various additional bits of structure.
\TODO{More intro}
\end{point}
\end{parsec}
\section{Effectus}
An effectus comes in two guises:
    axiomatizing either a category of total maps
    or a category of partial maps.
We will start of with the total form as it has the simplest axioms.
Later we will prefer to work with the partial form.
\begin{parsec}%
\begin{point}{Definition}%
A category $C$ is said to be an \Define{effectus in total form}
    if
\begin{enumerate}
\item $C$ has finite coproducts and a final object~$1$;
\item all diagrams of the following form are pullbacks
\begin{equation*}
\xymatrix{
    X+Y \ar[r]^{\id+!} \ar[d]_{!+\id} & X+1\ar[d]^{!+\id} \\
    1+Y\ar[r]_{\id+!} & 1+1
    }
    \qquad
\xymatrix{
    X \ar[r]^{!} \ar[d]_{\kappa_1} & 1 \ar[d]^{\kappa_1} \\
    X+Y\ar[r]_{!+!} & 1+1
    }
\end{equation*}
\item\label{eff-joint-monicity} and the following two arrows are jointly monic
    \begin{equation*}
        \xymatrix@C+2pc  {
            1+1+1  \ar@/^/[r]^{[\kappa_1,\kappa_2,\kappa_2]}
                    \ar@/_/[r]_{[\kappa_2,\kappa_1,\kappa_2]} & 1+1.
        }
    \end{equation*}
\end{enumerate}
An arrow~$X \to Y+1$ is called a \Define{partial map} $X \to Y$.
\begin{point}%
Our main example of an effectus in total form
    is the category~$\op{\W{NCPU}}$
    of von Neumann algebras with completely positive normal unital
    maps in the opposite direction.
The partial maps correspond to contractive maps.
We list more examples later.
Let~$C$ be an effectus in total form.
Given two arrows~$f\colon X \to Y+1$
and~$g \colon Y \to Z+1$ (i.e.~partial maps~$X \to Y$ and~$Y \to Z$)
    their composition as partial maps
    is defined as~$g \hafter f \equiv  [g, \kappa_2] \after f$.
Write~$\Define{\Par C}$ for the \Define{category of partial maps},
    which has the same objects
    as~$C$, but as arrows~$X \to Y$ in~$\Par C$
    we take arrows of the form~$X \to Y+1$ in~$C$,
    which we compose using~$\hafter$.
The identity on~$X$ in~$\Par C$ is given by~$\kappa_1 \colon X \to X+1$.
The category~$\Par C$ is not an effectus in total form --- instead it
    is an effectus \emph{in partial form}.
\end{point}
\end{point}
\begin{point}{Definition}%
A category~$C$ is called an \Define{effectus in partial form} if
\begin{enumerate}
\item
    $C$ is a finPAC \TODO{cite} --- that is: if
    \begin{enumerate}
        \item $C$ is PCM-enriched --- that is: if
            \begin{enumerate}
            \item
            every homset $C(X,Y)$ has a partial binary operation~$\ovee$
            (we write~$\Define{f \perp g}$ if~$f \ovee g$ exists)
                    and distinguished~$0 \in C(X,Y)$
                    that turns~$C(X,Y)$ into a partial commutative monoid
                    (PCM) and
            \item
            if $f \perp g$ then
                $(h \after f) \perp (h \after g)$,
                $(f \after k) \perp (g \after k)$ \emph{and}
            \begin{equation*}
                 h \after (f \ovee g) = 
                (h \after f) \ovee (h \ovee g)\qquad
                (f \ovee g) \after k = 
                (f \after k) \ovee (g \after k)
            \end{equation*}
                for any~$f,g \in X \to Y$,
                $h\colon Y \to Y'$
                and~$k \colon X'\to X$;
            \end{enumerate}
        \item 
            $C$ has finite coproducts $(+,0)$;
        \item
            (compatible sum)
            for any~$b\colon X \to Y + Y$ we have
            $\pproj_1 \after b \perp \pproj_2 \after b$,
            where~$\Define{\pproj_i}\colon Y + Y \to Y$
            are \Define{partial projectors} defined
            by~$\pproj_1 \equiv [\id, 0]$
            and~$\pproj_2 \equiv [0, \id]$ \emph{and}
        \item
            (untying) if~$f\perp g$,
            then~$\kappa_1\after f \perp \kappa_2 \after g$ \emph{and}
    \end{enumerate}
    \item it has effects --- that is: there is a distinguished object~$I$
            such that
    \begin{enumerate}
        \item for each object~$X$ the PCM~$C(X,I)$
                is an effect algebra --- that is:
        \begin{enumerate}
            \item
                for each~$f\colon X \to I$
                    there is a unique element~$f^\perp\colon X \to I$
                    such that~$f \ovee f^\perp = 1$,
                    where~$1 \equiv 0^\perp$ and
            \item
                if~$f\colon X \to I$ with~$f \perp 1$,
                    then~$f = 0$;
        \end{enumerate}
        \item if~$1 \after f \perp 1 \after g$,
            then~$f \perp g$ \emph{and}
        \item if~$1 \after f = 0$ then~$f = 0$.
    \end{enumerate}
\end{enumerate}
A map~$f\colon X \to Y$ is called \Define{total} if~$1 \after f = 1$.
\begin{point}%
At first glance an effectus in partial form seems
    to have a much richer structure than an effectus in total form.
This is not the case ---
    effectuses in total and partial form are two views
    on the same thing:
\end{point}
\end{point}
\begin{point}{Theorem}%
Let~$C$ be an effectus in total form
and~$D$ be an effectus in partial form.\TODO{cite kenta}
\begin{enumerate}
\item
The category~$\Par C$ is an effectus in partial form
        with~$I = 1$.
\item
The total maps of~$D$ form an effectus in total form~$\Tot D$.
\item
    Nothing is lost:
    $\Par \Tot D \cong D$ and~$\Tot \Par C \cong C$.
\end{enumerate}
\begin{point}{Proof}%
    \TODO{...}
\end{point}
\end{point}

\subsection{Predicates, states and scalars}
\begin{point}%
For the remainder of this text,
    we will work with effectuses in partial form.
We will write~$1$ instead of~$I$.
\end{point}
\begin{point}{Definition}%
Let~$C$ be an effectus (in partial form).
\begin{enumerate}
\item
A \Define{predicate} on~$X$ is a map~$X \to 1$.
The set of predicates $\Define{\Pred X}$ on~$X$ form an effect algebra.
\item
A \Define{scalar} is a predicate on~$1$, that is: a map~$1 \to 1$.
Write~$\Define{M} \equiv \Pred 1$ for the set of scalars.
We multiply two scalars~$\lambda,\mu \colon 1 \to 1$
    simply by composing~$\lambda \odot \mu \equiv \lambda \after \mu$.
As~$C$ is PCM-enriched, this turns~$M$ into an effect monoid.\TODO{ref}
\item
For a scalar~$\lambda\colon 1\to 1$ and a predicate~$p\colon X \to 1$
    we write~$\lambda \cdot p \equiv \lambda \after p$.
With this scalar multiplication,
    $\Pred X$ turns into a~$M$-effect module.
\item
A \Define{substate} on~$X$ is a map~$\omega\colon 1 \to X$.
A \Define{state} is a total substate.
We denote the set of states on~$X$ by~$\Stat X$.
\end{enumerate}
\end{point}
\end{parsec}

\section{Quotient}
\begin{parsec}%
\begin{point}{Definition}%
Let~$C$ be an effectus.
We say~$C$ is an \Define{effectus with quotients}
    if for each predicate~$p \colon X \to 1$,
    there exists a map~$\xi_p \colon X \to X/_p$
    with~$1 \after \xi_p \leq p^\perp$
    satisfying the following universal property:
\begin{quote}
    for any (other) map~$f\colon X \to Y$
        with~$1 \after f \leq p^\perp$,
        there is a unique map~$f' \colon X/_p \to Y$
        such that~$f' \after \xi_p = f$.
\end{quote}
Any  map with this universal property
    is called a \Define{quotient} for~$p$.
\end{point}
\begin{point}{Example}%
In~$\op{\W{NCPsU}}$ quotients are exactly the same thing
    as contractive filters, see \TODO{...}.
An example of a quotient-map for~$1-a \in \scrA$ is given
    by~$\xi\colon \ceil{a}\scrA \ceil{a} \to \scrA$
    with~$\xi(b) = \sqrt{a} b \sqrt{a}$.
\end{point}
\begin{point}[quotient-basics]{Exercise}%
Show the following basic properties of quotients.
\begin{enumerate}
    \item If~$\xi\colon X \to Y$ is a quotient for~$p$
                and~$\vartheta\colon Y \to Z$ is an isomorphism,
                then~$\vartheta \after \xi$ is a quotient for~$p$
                as well.
    \item Conversely, if~$\xi_1$ and~$\xi_2$
            are both quotients for~$p$,
            then there is unique a isomorphism~$\vartheta$
            with~$\xi_1 = \vartheta \after \xi_2$.
    \item Isomorphisms are quotients (for 0).
    \item Zero-maps are quotients (for 1).
    \item If~$\xi$ is a quotient for~$p$, then~$1\after \xi = p^\perp$
                (Hint: apply the universal property to $p^\perp$).
    \item Quotients are epi.
\end{enumerate}
\begin{point}%
The following proposition is easy to prove,
    but shows an important property of quotients:
    any map~$f$ factors as a total map after a quotient
    for~$(1\after f)^\perp$.
\end{point}
\end{point}
\begin{point}[quotient-total]{Proposition}%
Assume~$\xi_{p^\perp} \colon X \to X/_{p^\perp}$ is a quotient for~$p^\perp$.
For any~$f\colon X \to Z$
    with~$1 \after f = p$,
    there is a unique \emph{total} $g\colon X/_{p^\perp} \to Z$
    with~$f = g \after \xi_{p^\perp}$.
\begin{point}{Proof}%
By definition of quotient, there is a unique~$g\colon X/_{p^\perp} \to Z$
    with~$g \after \xi_{p^\perp} = f$.
Note~$1 \after g \after \xi_{p^\perp} = 1 \after f = p = 1 \after \xi_{p^\perp}$.
Thus, as~$\xi_{p^\perp}$ is epi (\sref{quotient-basics}),
    we conclude~$1 \after g = 1$.
That is: $g$ is total. \qed
\end{point}
\end{point}
\begin{point}[quotients-composition]{Proposition}%
In an effectus with quotients,
    quotients are closed under composition.
\begin{point}{Proof}%
Assume~$\xi_1\colon X \to Y$ is a quotient for~$p^\perp$
    and~$\xi_2\colon Y \to Z$ is a quotient for~$q^\perp$.
We will prove~$\xi_2 \after \xi_1$
    is a quotient for~$(q \after \xi_1)^\perp$.
As our effectus has quotients,
    we can pick a quotient~$\xi \colon X \to X/_{(q \after \xi_1)^\perp}$
        of~$(q \after \xi_1)^\perp$.
First, some preparation.
Note~$1 \after \xi = q \after \xi_1 \leq 1 \after \xi_1 = p$.
Thus by the universal property of~$\xi_1$,
there is a unique map~$h_1\colon Y \to X/_{(q \after \xi_1)^\perp}$
        with~$h_1 \after \xi_1 = \xi$.
As~$1 \after h_1 \after \xi_1 = 1 \after \xi = q \after \xi_1$
    and~$\xi_1$ is epi, we see~$1 \after h_1 = q$.
Thus by \sref{quotient-total},
there is a unique total map~$h_2 \colon Z \to X/_{(q \after \xi_1)^\perp}$
    with~$h_2 \after \xi_2 = h_1$.
Let~$g\colon X/_{(q \after \xi_1)^\perp} \to Z$
    be the unique map such that~$g \after \xi = \xi_2 \after \xi_1$.
We are in the following situation.
\begin{equation*}
    \xymatrix@C+2pc{
        X  \ar[r]^{\xi_1} \ar@/_/[rrd]_{\xi}
        & Y \ar[r]^{\xi_2} \ar@{.>}[rd]_{h_1}
        & Z \ar@{.>}@/^/[d]^{h_2} \\
        && X/_{(q \after \xi_1)^\perp} \ar@{.>}@/^/[u]^{g}
    }
\end{equation*}
We claim~$g$ is an isomorphism with inverse~$h_2$.
Indeed: from $g \after h_2 \after \xi_2 \after \xi_1= g \after \xi = \xi_2 \after \xi_1$
    we get~$g \after h_2 = \id$
    and from~$h_2 \after g \after \xi = h_2 \after \xi_2 \after \xi_1 = \xi$
    we find~$h_2 \after g = \id$.
Thus~$\xi_2 \after \xi_1 = g \after \xi$ for an isomorphism~$g$,
which shows~$\xi_2 \after \xi_1$ is a quotient, see \sref{quotient-basics}. \qed
\end{point}
\end{point}
\begin{point}{Exercise}
By \sref{quotient-total} we know that each
    map~$f$ factors as~$t \after \xi$
    for some total map~$t$ and quotient~$\xi$.
Show that this forms an orthogonal factorization system ---
    that is: prove that if~$t' \after \xi' = t \after \xi$
    for some (other) quotient~$\xi'$ and total map~$t'$,
    then there is a unique isomorphism~$\vartheta$
    with~$\xi' = \vartheta \after \xi$
    and~$t = t' \after \vartheta$.
\end{point}
\end{parsec}

\section{Comprehension and images}
\begin{parsec}%
\begin{point}{Definition}%
Let~$C$ be an effectus.
We say~$C$ has comprehension
    if for each predicate~$p \colon X \to 1$,
    there exists a map~$\pi_p \colon \cmpr{X}{p} \to X$
    with~$p \after \pi_p = 1 \after \pi_p$
    satisfying the following universal property:
\begin{quote}
    for any (other) map~$g\colon Z \to X$
        with~$p \after g = 1 \after g$,
        there is a unique map~$g' \colon Z \to \cmpr{X}{p}$
        such that~$\pi_p \after g' = g$.
\end{quote}
Any  map with this universal property
    is called a \Define{comprehension} for~$p$.
\begin{point}{Beware}%
    In this text we do not assume comprehensions are total
        (in contrast to \TODO{}).
\end{point}
\begin{point}[compr-not]{Notation}%
Unless otherwise specified~$\pi_p$ will be some
    comprehension of~$p$.
\end{point}
\end{point}
\begin{point}{Example}%
In~$\op{\W{NCPsU}}$ comprehensions are exactly the same thing
as corners, see \TODO{...}.
An example of a comprehension for~$a \in \scrA$
    is given by~$\pi\colon \scrA \to \floor{a}\scrA\floor{a}$
    with~$\pi(b) = \floor{a}b\floor{a}$.
\end{point}
\begin{point}[compr-basics]{Exercise}%
Show the following basic properties of comprehensions.
\begin{enumerate}
    \item If~$\pi\colon X \to Y$ is a comprehension for~$p$
                and~$\vartheta\colon Z \to X$ is an isomorphism,
                then~$\pi \after \vartheta$ is a comprehension for~$p$
                as well.
    \item Conversely, if~$\pi_1$ and~$\pi_2$
            are both comprehensions for~$p$,
            then there is unique a isomorphism~$\vartheta$
            with~$\pi_1 = \pi_2 \after \vartheta$.
    \item Isomorphisms are comprehensions (for 1).
    \item Zero-maps are comprehensions (for 0).
    \item Comprehensions are mono.
    \item $p^\perp \after \pi = 0$ if~$\pi$ is a comprehension of~$p$.
\end{enumerate}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}%
We are ready to define purity in effectuses.
\end{point}
\begin{point}{Definition}%
In an effectus a map~$f$ is called \Define{pure}
    if~$f = \pi \after \xi$
    for some comprehension~$\pi$
    and quotient~$\xi$.
\end{point}
\begin{point}{Example}%
In $\op{\W{NCPsU}}$
the pure maps~$\scrB(\scrH) \to \scrB(\scrK)$
    are exactly the maps of the form~$\ad_T$
    where~$T$ is a contractive map~$\scrK \to \scrH$. \TODO{ref}
\end{point}
\begin{point}%
We do not have a good handle on the structure of pure maps in
    an arbitrary effectus.  We will need a few additional assumptions.
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}{Definition}%
Let~$C$ be an effectus.
\begin{enumerate}
\item
We say~$C$ has \Define{images}
    if for each map~$f\colon X \to Y$,
    there is a least predicate~$\Define{\IM f}$ on~$Y$
        with the property~$(\IM f) \after f = 1 \after f$ ---
        that is, 
    for every (other) predicate~$p$ on~$Y$
    with~$p \after f = 1 \after f$,
    we must have~$\IM f \leq p$.
For brevity, write~$\Define{\IMperp f} \equiv (\IM f)^\perp$. 
Note~$\IMperp f$ is the greatest predicate
with the property~$(\IMperp f) \after f = 0$.
\item
We say a map~$f\colon X \to Y$ is \Define{faithful}
    if~$\IM f = 1$.
That is: $f$ is faithful if and only if
    $p \after f = 0$ implies~$f = 0$
    for every predicate~$p$.
\end{enumerate}
\begin{point}{Notation}%
The expression~$\IM f \after g$
    should be read as~$\IM (f \after g)$.
\end{point}
\begin{point}%
The predicate~$\IM f$ will play for comprehension the same role
    as~$1 \after f$ plays for quotients.
Similarly faithful is the analogue of total.
\end{point}
\end{point}
\begin{point}{Example}%
In $\op{\W{NCPsU}}$ the image of a map~$f\colon \scrA \to \scrB$
    is given by the least projection~$e \in \scrA$
    with the property~$f(1-e) = 0$.
This~$e$ is the complement of the projection onto the kernel of~$f$.
The map~$f$ is faithful if and only
    if~$f(a^*a)=0$ implies~$a^*a = 0$
    for all~$a\in \scrA$.
\end{point}
\begin{point}[im-ineq]{Exercise}%
Show~$\IM f \after g \leq \IM f$.
Conclude~$\IM f \after \alpha = \IM f$
    for any iso~$\alpha$.
\end{point}
\begin{point}%
In contrast to quotients,
    it is not clear at all whether (without additional assumptions)
    comprehensions are total;
    they are part of a factorization system
    or are closed under composition.
\end{point}
\begin{point}[compr-total]{Lemma}%
In an effectus with quotients, comprehensions are total.
\begin{point}{Proof}%
Assume~$\pi$ is some comprehension for~$p$.
Let~$\xi$ be a quotient for~$(1 \after \pi)^\perp$.
There is a total~$\pi_t$ with~$\pi = \pi_t \after \xi$.
As~$ 1 \after \pi_t \after \xi
        = 1 \after \pi
        = p \after \pi
        = p \after \pi_t \after \xi$
        and~$\xi$ is epi,
        we see~$1 \after \pi_t = p \after \pi_t$.
Thus, as~$\pi$ is a comprehension for~$p$,
    there exists an~$f$ with~$\pi_t = \pi \after f$.
Now~$\pi = \pi_t \after \xi = \pi \after f \after \xi$
    and so~$\id = f \after \xi$, since~$\pi$ is mono.
Hence~$1 = 1 \after \id =1 \after f \after \xi \leq 1 \after \xi = 1 \after \pi$
    and so~$\pi$ is total. \qed
\end{point}
\end{point}
\begin{point}{Proposition}%
Assume~$\pi_s\colon \cmpr{X}{s} \to X$ is a comprehension for~$s$.
For any~$f\colon Y \to X$ with~$\IM f = s$,
    there is a unique \emph{faithful}~$g\colon Y \to \cmpr{X}{s}$
    with~$\pi \after g = f$.
\begin{point}{Proof}
There is some~$g \colon Y \to \cmpr{X}{s}$ with~$\pi_s \after g = f$. \qed
\end{point}
\end{point}
\end{parsec}
\subsection{Sharp predicates}
\begin{parsec}%
\begin{point}{Definition}%
Let~$C$ be an effectus with comprehension and images.
\begin{enumerate}
\item
    We say a predicate~$p$ is (image) \Define{sharp}
        if~$p = \IM f$ for some map~$f$.
    Write~$\SPred X$ for the set of all sharp predicates on~$X$.
\item
We define~$\Define{\floor{p}} = \IM \pi_p$,
    where~$\pi_p$ is some comprehension for~$p$.
(Comprehensions for the same predicate have the same image
    by \sref{im-ineq}.)
Also write~$\Define{\ceil{p}} = \floor{p^\perp}^\perp$.
\end{enumerate}
\begin{point}{Beware}%
In \TODO{...} $p$ is called sharp whenever~$p \wedge p^\perp=0$.
In general this is weaker than image-sharpness, which we use in this text.
In~\sref{floor-basics}
    we will see~$\floor{p}$ is sharp.
It is unclear whether~$\ceil{p}$ is sharp (without additional
    assumptions).
\end{point}
\end{point}
\begin{point}{Example}%
In $\op{\W{NCPsU}}$ the sharp predicates are the projections.
For a predicate~$a \in \scrA$,
    the sharp predicate~$\ceil{a}$
    is the least projection above~$a$.
\end{point}
\begin{point}[floor-basics]{Lemma}%
In an effectus with comprehension and images, we have
\begin{multicols}{2}
\begin{enumerate}
\item
    $\floor{p} \leq p$
\item
    $\pi_p = \pi_{\floor{p}} \after \alpha$
        for some iso~$\alpha$;
\item
    $\floor{\floor{p}} = \floor{p}$;
\item
    $p \leq q$ $\implies$ $\floor{p} \leq \floor{q}$;
\item
    $\ceil{p} \after f \leq \ceil{p \after f}$ \emph{and}
\item
    $\ceil{p} \after f =0$ iff~$p \after f = 0$,
\end{enumerate}
\end{multicols}
\noindent for any map~$f\colon X \to Y$,
    predicates~$p,q$ on~$X$ and
$\pi_p$ and~$\pi_{\floor{p}}$
    comprehensions for~$p$ and~$\floor{p}$ respectively.
\begin{point}{Proof}%
We will prove the statements in listed order.
\begin{point}{Ad 1}%
    Let~$\pi$ be a comprehension for~$p$.
    By definition~$p \after \pi = 1 \after \pi$.
    Thus~$\floor{p} = \IM \pi \leq p$, as desired.
\end{point}
\begin{point}{Ad 2}%
It is sufficient to show~$\pi_p$ is a comprehension for~$\floor{p}$.
First, note~$\floor{p}\after \pi_p = (\IM \pi_p) \after \pi_p = 1 \after \pi_p$.
To show the universal property,
    assume~$g\colon Z \to X$
    is some map with~$\floor{p} \after g = 1 \after g$.
Then~$1 \after g = \floor{p} \after g \leq p \after g \leq 1 \after g$
    and so~$1 \after g = p \after g$.
As~$\pi_p$ is a comprehension for~$p$,
    there is a unique~$g'$ with~$\pi_p \after  g' = g$
    and so~$\pi_p$ is indeed a comprehension for~$\floor{p}$ as well.
\end{point}
\begin{point}{Ad 3}%
Follows from the previous and \sref{im-ineq}.
\end{point}
\begin{point}{Ad 4}%
Pick a comprehension~$\pi_p$ for~$p$ and~$\pi_q$ for~$q$.
Note~$1 \after \pi_p = p \after \pi_p
                \leq q \after \pi_p \leq 1 \after \pi_p $
so~$q \after \pi_p = 1 \after \pi_p$
and thus~$\pi_p = \pi_q \after f$ for some~$f$.
By~\sref{im-ineq}
    we see~$\floor{p} = \IM \pi_p = \IM \pi_q \after f \leq \IM \pi_q = \floor{q}$.
\end{point}
\begin{point}{Ad 5}%
Clearly~$p \after f \after \pi_{(p \after f)^\perp} = 0$.
(Recall our convention \sref{compr-basics} for $\pi$'s.)
Thus there is some~$h$
with~$f \after \pi_{(p \after f)^\perp} = \pi_{p^\perp}\after h$.
By point 2 there is some (isomorphism)~$\alpha$
    with~$\pi_{p^\perp} =\pi_{\floor{p^\perp}} \after \alpha$.
    We compute
\begin{equation*}
    \ceil{p} \after f \after \pi_{(p \after f)^\perp}
        = \ceil{p} \after \pi_{p^\perp}\after h
        = \ceil{p} \after \pi_{\floor{p^\perp}}\after \alpha\after h
    = \ceil{p} \after \pi_{\ceil{p}^\perp}\after \alpha\after h
    = 0.
\end{equation*}
Thus~$\ceil{p} \after f \leq \IMperp \pi_{(p \after f)^\perp}
= \lfloor(p \after f)^\perp\rfloor^\perp = \ceil{p \after f}$, as promised.
\end{point}
\begin{point}{Ad 6}%
Assume~$\ceil{p}\after f = 0$.
From~$p \leq \ceil{p}$
it follows~$p \after f \leq \ceil{p} \after f = 0$.
Thus~$p \after f = 0$.
For the converse, assume~$p \after f = 0$.
Then~$\ceil{p \after f} = \ceil{0} = (\IM \id)^\perp = 0$
    as~$\id$ is a comprehension for~$1$.
    Thus~$\ceil{p} \after f \leq \ceil{p \after f} = 0$. \qed
\end{point}
\end{point}
\end{point}
\begin{point}[img-of-compr]{Exercise}%
Let~$C$ be an effectus with comprehension and images.
Show that~$p$ is sharp if and only if~$\floor{p}= p$.
Conclude~$\IM \pi_s = s$ for sharp~$s$.
\end{point}
\begin{point}[ceiling-within-ceiling]{Exercise}%
Show that in an effectus with comprehension and images
    we have the equality
    $\ceil{\ceil{p}\after f} = \ceil{p \after f}$
    for any map~$f\colon X \to Y$ and predicate~$p$ on~$X$.
\end{point}
\begin{point}[compr-is-full]{Lemma}%
In an effectus with comprehension and images
    we have
\begin{equation*}
    s \leq t
    \quad \iff \quad
    \pi_s = \pi_t \after h
    \quad \text{for some $h$},
\end{equation*}
for all sharp predicates~$s,t$ on the same object.
\begin{point}{Proof}%
Assume~$\pi_s = \pi_t \after h$.
Then
\begin{equation*}
    s \ \overset{\sref{img-of-compr}}{=}\  \floor{s} \ =\  \IM \pi_s \  = \ \IM \pi_t \after h
    \ \overset{\sref{im-ineq}}{\leq} \ \IM \pi_t = \floor{t} 
            \ \overset{\sref{img-of-compr}}{=} \ t.
\end{equation*}
as desired.
Conversely assume~$s \leq t$.
Then~$t^\perp \after \pi_s \leq s^\perp \after \pi_s = 0$
    and so~$\pi_s = \pi_t \after h$
    for some~$h$ by the universal property of~$\pi_t$. \qed
\end{point}
\end{point}
\end{parsec}

\section{$\diamond$-effectus}
\begin{parsec}%
\begin{point}%
In quantum physics it is not uncommon to restrict one's attention
    to sharp predicates (i.e.~projections).
Does this restriction hurt the expressivity?
A partial answer is given by Gleason's famous theorem:
    it states that every (normal) state on~$\scrB(\scrH)$
    is determined by its values on projections
    (if~$\dim \scrH \geq 3$).
We take the idea of restricting oneself to projections
    one step further: we also want to restrict to projections
    for our outcomes.
It is rare for quantum processes to send projections to projections
    (see \TODO{mult}),
    so instead we consider the least projection above the outcome.
The simple idea of taking the restriction to sharp predicates
    seriously, leads to a host of interesting new notions.
We will give these right of the bat and study their relevance later on.
\end{point}
\begin{point}{Definition}%
A~\Define{$\diamond$-effectus}
    is an effectus with quotient, comprehension and images
    such that~$s^\perp$ is sharp for every sharp predicate~$s$.
In a~$\diamond$-effectus
    we define for any map~$f\colon X \to Y$
    the following restrictions to sharp predicates
    \begin{equation*}
        \xymatrix{
            \SPred X  \ar@/^/[r]^{f_\diamond}
            & \SPred Y \ar@/^/[l]^{f^\diamond}}
            \quad \text{by} \quad
            \Define{f^\diamond(s)} = \ceil{s \after f}
            \quad
            \text{and}
            \quad
            \Define{f_\diamond(s)} = \IM f \after \pi_s.
    \end{equation*}
    \begin{enumerate}
        \item
    We say maps~$f \colon X \leftrightarrows Y\colon g$
        are~\Define{$\diamond$-adjoint}
        if~$f^\diamond = g_\diamond$.
    \item
    An endomap~$f\colon X \to X$ is \Define{$\diamond$-self-adjoint}
        if~$f$ is $\diamond$-adjoint to itself.
    \item
    Two maps~$f,g\colon X \to Y$
        are~\Define{$\diamond$-equivalent}
        if~$f^\diamond = g^\diamond$.
    \item
        A pure endomap~$f$ is~\Define{$\diamond$-positive}
            if $f = g\after g$ for some~$\diamond$-self-adjoint~$g$.
    \end{enumerate}
For brevity, write $\Define{f^\BOX(s)} = f^\diamond(s^\perp)^\perp$.
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
Let's investigate the basic properties of~$(\ )^\diamond$, $(\ )_\diamond$
    and $(\ )^\BOX$.
\end{point}
\begin{point}{Exercise}%
Show that in a~$\diamond$-effectus
    both~$f^\diamond$ and~$f^\BOX$ are order preserving maps.
\end{point}
\begin{point}[diamond-adjunction]{Proposition}%
For~$f\colon X \to Y$ in a~$\diamond$-effectus we have
\begin{equation}
    f^\diamond(s) \ \leq\  t^\perp
    \quad \iff
    \quad f_\diamond(t) \ \leq\  s^\perp \label{diamond-main-lemma}
\end{equation}
for all sharp~$s,t$.
In other words: $f_\diamond$ is the left order-adjoint of~$f^\BOX$.
\begin{point}{Proof}%
To start, let's prove the order-adjunction reformulation
\begin{equation*}
    f_\diamond(s) \leq t
    \ \overset{\eqref{diamond-main-lemma}}{\iff} \ 
    f^\diamond(t^\perp) \equiv f^\BOX(t)^\perp \leq s^\perp
            \ \iff \
    s \leq f^\BOX(t).
\end{equation*}
To prove \eqref{diamond-main-lemma},
first assume~$f^\diamond(s) \leq t^\perp$.
Then~$s \after f \leq \ceil{s \after f} = f^\diamond(s) \leq t^\perp
= \IMperp \pi_t$, where the last equality is
due to \sref{img-of-compr}.
Thus~$s \after f \after \pi_t = 0$
    which is to say~$s \leq \IMperp f \after \pi_t$,
    so~$f_\diamond(t) = \IM f \after \pi_t \leq s^\perp$.

For the converse, assume
    $f_\diamond(t) \leq s^\perp$.
Then as before (but in the other direction)
    we find~$s \after f \after \pi_t = 0$
    and so~$s \after f \leq t^\perp$.
    Hence~$f^\diamond(s) =  \ceil{s \after f} \leq \lceil t^\perp\rceil
                = \floor{t}^\perp = t^\perp$, as desired. \qed
\end{point}
\end{point}
\begin{point}[order-adj-basics]{Exercise}%
Use the fact that there is an
order adjunction between~$f_\diamond$ and $f^\BOX$
to show that in a~$\diamond$-effectus
\begin{multicols}{2}
\begin{enumerate}
    \item $f_\diamond$ is order-preserving;
    \item $f_\diamond$ preserves suprema;
    \item $f^\BOX$ preserves infima;
    \item $f^\diamond$ preserves suprema;
    \item $f_\diamond \after f^\BOX \after f_\diamond = f_\diamond$ \emph{and}
    \item $f^\BOX \after f_\diamond \after f^\BOX = f^\BOX$.
\end{enumerate}
\end{multicols}
\end{point}
\begin{point}{Lemma}%
In a~$\diamond$-effectus,
we have
\begin{multicols}{3}
\begin{enumerate}
\item
$(\id)^\diamond = \id$,
\item
$(f\after g)^\diamond
            =   g^\diamond \after f^\diamond$,
\item
$(\id)^\BOX = \id$,
\item
$(f\after g)^\BOX
            =   g^\BOX \after f^\BOX$,
\item
$(\id)_\diamond= \id$ and
\item
            $(f \after g)_\diamond = f_\diamond \after g_\diamond$.
\end{enumerate}
\end{multicols}
\begin{point}{Proof}%
We get~$(\id)^\diamond = \id$
directly from~\sref{img-of-compr}.
For 2 we only need a single line:
\begin{equation*}
(f\after g)^\diamond(s)
    \ =\  \ceil{s \after f \after g}
    \ \overset{\sref{ceiling-within-ceiling}}{=}\ 
    \ceil{\ceil{s \after f} \after g}
    \ =\  g^\diamond(f^\diamond(s)).
\end{equation*}
Note that we used that ceilings are sharp.
Point 3 and 4 follow easily from~1 and 2 respectively.
The identity~$(\id)_\diamond = \id$ is again~\sref{img-of-compr}.
We claim~$f_\diamond \after g_\diamond$
    is left order-adjoint to~$(f\after g)^\BOX$,
     indeed
\begin{equation*}
    f_\diamond (g_\diamond(s)) \leq t
        \ \iff\  g_\diamond(s) \leq f^\BOX (t)
        \ \iff\  s \leq g^\BOX (f^\BOX (t)) = (f \after g)^\BOX(t).
\end{equation*}
Thus by uniqueness of order adjoints, we find
$(f\after g)_\diamond = f_\diamond \after g_\diamond$. \qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}{Theorem}%
\TODO{attribution for this thm}
In a~$\diamond$-effectus,
the poset~$\SPred X$ of sharp predicates on~$X$,
    is an orthomodular lattice.
\begin{point}{Proof}%
Let~$C$ be a~$\diamond$-effectus with some object~$X$.
\begin{point}[spred-infimum]{Infima}%
Let~$s,t$ be sharp predicates on~$X$.    
We will show~$(\pi_s)_\diamond (\pi_s^\BOX (t))$
is the infimum of~$s$ and~$t$.
It is easy to see
$(\pi_s)_\diamond (\pi_s^\BOX (t))$ is a lower bound:
$(\pi_s)_\diamond (\pi_s^\BOX (t)) \leq t$
and~$(\pi_s)_\diamond (\pi_s^\BOX (t)) \leq (\pi_s)_\diamond(1)
    = \IM \pi_s = s$.
We have to show $(\pi_s)_\diamond (\pi_s^\BOX (t))$ is the greatest lower bound.
Let~$r$ be any sharp predicate with~$r \leq s$ and~$r \leq t$.
By~\sref{compr-is-full}
    we have~$\pi_r = \pi_s \after h$ for some~$h$.
Thus
\begin{equation*}
    (\pi_r)_\diamond
        \ = \  (\pi_s)_\diamond \after h_\diamond
        \ =\  (\pi_s)_\diamond \after \pi_s^\BOX  
            \after (\pi_s)_\diamond \after h_\diamond
        \ =\  (\pi_s)_\diamond \after \pi_s^\BOX \after (\pi_r)_\diamond.
\end{equation*}
Hence~$r = (\pi_r)_\diamond(1)  
=((\pi_s)_\diamond \after \pi_s^\BOX \after (\pi_r)_\diamond )(1)
=  (\pi_s)_\diamond ( \pi_s^\BOX (r))
\leq  (\pi_s)_\diamond ( \pi_s^\BOX (t))$.
\end{point}
\begin{point}[spred-ortholattice]{Ortholattice}%
Thanks to the order anti-isomorphism~$(\ )^\perp$
suprema (satisfying De Morgan's laws) come for free:
    $s \vee t = (s^\perp \wedge t^\perp)^\perp$.
Now note
\begin{equation*}
\pi_s^\BOX(s^\perp) \ =
    \  (s \after \pi_s)^\perp 
    \ =\  (1 \after \pi_s)^\perp 
    \ \overset{\sref{compr-total}}{=}\ 1^\perp \ =\   0
\end{equation*}
and so~$s\wedge s^\perp = 0$.
We have shown~$\SPred X$ with~$(\ )^\perp$ is an ortholattice.
\end{point}
\begin{point}{Orthomodular law}%
Assume~$s \leq  t$.
We have to show~$s \vee (s^\perp \wedge t) = t$.
Indeed
\begin{alignat*}{2}
s \vee (s^\perp \wedge t) 
&\  =\  (s \wedge t) \vee (s^\perp \wedge t) &\qquad& \text{as $s \leq t$}\\
&\  =\ 
        ((\pi_s)_\diamond \after \pi_s^\BOX)
        (t) \vee
        ((\pi_s)_\diamond \after \pi_s^\BOX)
        (t^\perp)
        &\qquad& \text{by \sref{spred-infimum}}\\
&\  =\ 
        (\pi_s)_\diamond ( \pi_s^\BOX(t) \vee 
                            \pi_s^\BOX(t^\perp))
                            &\qquad& \text{by \sref{order-adj-basics}} \\
&\  =\ 
        (\pi_s)_\diamond ( \pi_s^\diamond(t) \vee 
                            \pi_s^\diamond(t)^\perp)
                            &\qquad& \text{as $\pi_s$ total,~\sref{compr-total}}\\
&\  =\ 
                            (\pi_s)_\diamond (1)
                            &\qquad& \text{by \sref{spred-ortholattice}} \\
& \ =\  \IM \pi_s \ = \ s && \text{by \sref{img-of-compr}}.
\end{alignat*}
We have shown~$\SPred X$ is an orthomodular lattice. \qed
\end{point}
\end{point}
\begin{point}{Corollary}%
In a $\diamond$-effectus~$C$
the assignment~$X\mapsto \SPred X$, ~$f \mapsto (f_\diamond,f^\BOX)$
    yields a functor from~$C$
    to~$\mathsf{OMLatGal}$,
    the category of orthomodular lattices
    with galois connection between them,
    as defined in~\cite{jacobs2009orthomodular}.
\end{point}
\end{point}
\begin{point}[image-sharp-is-order-sharp]{Lemma}%
In a $\diamond$-effectus,
sharp predicates are \Define{order sharp} ---
    that is:
    for any predicate~$p$
    and sharp predicate~$s$
    with~$p \leq s$ and~$p \leq s^\perp$,
    we must have~$p = 0$.
\begin{point}{Proof}%
Note~$\ceil{p} \leq \ceil{s} = s$
    and~$\ceil{p} \leq \lceil s^\perp\rceil = s^\perp$.
So by~\sref{compr-is-full},
there is an~$h$ with~$\pi_{\ceil{p}} = \pi_s \after h$.
We compute
\begin{equation*}
    1 \after \pi_{\ceil{p}} \ =\  \ceil{p} \after \pi_{\ceil{p}}  \ = \
    \ceil{p} \after \pi_s \after h \ \leq \ 
        s^\perp \after \pi_s \after h \ = \ 0.
\end{equation*}
Thus~$\pi_{\ceil{p}} = 0$
and so~$p \leq \ceil{p} = \IM\pi_{\ceil{p}} = 0$, as desired.\qed
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}%
We turn to~$\diamond$-adjointness.
\end{point}
\begin{point}{Exercise}%
Show the following basic properties of~$\diamond$-adjointness
\begin{enumerate}
    \item
$f^\diamond = g_\diamond$
    ($f$ is $\diamond$-adjoint to~$g$)
    if and only if~$f_\diamond = g^\diamond$.
    \item
If~$f$ and~$g$ are~$\diamond$-adjoint,
    then~$\IM f = \ceil{1 \after g}$.
\end{enumerate}
\end{point}
\begin{point}[diamond-squares]{Exercise}%
Show in order:
\begin{enumerate}
\item
If~$f$ is~$\diamond$-self-adjoint,
    then~$f \after f$ is~$\diamond$-self-adjoint.
\item
If~$f$ is~$\diamond$-positive,
    then~$f$ is~$\diamond$-self-adjoint.
\item
If~$f$ is~$\diamond$-positive,
    then~$f \after f$ is~$\diamond$-positive.
\end{enumerate}
\end{point}
\end{parsec}

\section{Unique $\diamond$-positive maps}
\begin{parsec}%
\begin{point}%
In a~$\diamond$-effectus
    quotient and comprehension are not tied together by its axioms.
    With two additional axioms, we will see quotient and comprehension
    become tightly interwoven. \TODO{contrast old attempts}
\end{point}
\begin{point}{Definition}%
We say a $\diamond$-effectus
has \Define{unique $\diamond$-positive maps} (\Define{UPM}) if
\begin{enumerate}
\item
    for each object~$X$
    and each predicate on~$p$,
    there is a unique $\diamond$-positive map~$\Define{\asrt_p}\colon X \to X$
    with~$1 \after \asrt_p = p$ \emph{and}
\item
    for every quotient~$\xi \colon X \to Y$
    and comprehension~$\pi \colon Y \to Z$
    the composite~$\pi \after \xi$ is pure.
\end{enumerate}
In an $\diamond$-effectus with UPM,
we define~$\Define{\andthen{p}{q}} = q \after \asrt_p$
    and~$\Define{p^2} = \andthen{p}{p}$.
\end{point}
\begin{point}{Example}%
The effectus $\op{\W{NCPsU}}$ has UPM
with~$\asrt_a (b) = \sqrt{a}b\sqrt{a}$. \TODO{ref}
\end{point}
\begin{point}[upm-basics]{Proposition}%
In an $\diamond$-effectus with UPM
    the following holds.
\begin{enumerate}
\item
For a predicate~$p$,
the following are equivalent
\begin{inparaenum}
\item $p$ is sharp,
\item $\andthen{p}{p}=p$ and
\item $\asrt_p \after \asrt_p = \asrt_p$.
\end{inparaenum}
\item
Let~$s$ be any sharp predicate.
There exist comprehension~$\pi_s$ of~$s$
        and quotient~$\zeta_s$ of~$s^\perp$
        such that~$\zeta_s \after \pi_s = \id$
        and~$\pi_s \after \zeta_s = \asrt_s$.

In fact, for every comprehension~$\pi$ of~$s$,
    we can find a quotient~$\xi$ of~$s^\perp$
    with~$\xi \after \pi = \id$ and~$\pi \after \xi = \asrt_s$
    \emph{and} conversely for every quotient~$\xi$ of~$s^\perp$
    there exists a comprehension~$\pi$ of~$s$
    with~$\xi \after \pi = \id$ and~$\pi \after \xi = \asrt_s$.
\item Comprehensions are closed under composition.
\item Pure maps are closed under composition.
\end{enumerate}
\begin{point}{Proof}%
We prove the points in order.
\begin{point}{Ad 1}%
First we prove that~$p$ is sharp if and only if~$\andthen{p}{p}=p.$
So, assume~$p$ is sharp.
As $\diamond$-positive maps are~$\diamond$-self-adjoint
    we have~$\IM \asrt_p = \ceil{1 \after \asrt_p} = \ceil{p} = p$.
Thus~$\andthen{p}{p} = p \after \asrt_p = 1 \after \asrt_p = p$.
For the converse, assume~$\andthen{p}{p}=p$.
From~$\IM \asrt_p = \ceil{1 \after \asrt_p} = \ceil{p}$,
we get~$\ceil{p} \after \asrt_p = \andthen{p}{\ceil{p}} = 1 \after \asrt_p = p$.
By assumption~$\andthen{p}{p}=p$.
So~$\andthen{p}{(\ceil{p} \ominus p)} = 0$.
Hence~$\ceil{p}\ominus p \leq \IMperp \asrt_p = \ceil{p}^\perp$.
However $\ceil{p}\ominus p \leq \ceil{p}$.
Thus by~\sref{image-sharp-is-order-sharp}
    get~$\ceil{p} \ominus p = 0$. So~$p$ is indeed sharp.

Clearly, if~$\asrt_p \after \asrt_p = \asrt_p$,
then~$p = 1 \after \asrt_p = 1\after\asrt_p\after\asrt_p = \andthen{p}{p}$.
It only remains to be shown~$\asrt_p \after \asrt_p = \asrt_p$
    whenever~$p$ is sharp.
So assume~$p$ is sharp.
By definition~$\asrt_p$ is pure: $\asrt_p = \pi \after \xi$
    for some quotient~$\xi$ and comprehension~$\pi$.
By assumption~$\xi \after \pi$ is pure as well,
    so there is a quotient~$\xi'$ and comprehension~$\pi'$
    with~$\xi \after \pi = \pi' \after \xi'$.
Note~$1 \after \xi = 1 \after \asrt_p = p$
and~$1 \after \asrt_p \after \asrt_p = \andthen{p}{p} = p = 1 \after \xi$,
hence
\begin{equation*}
 1\after \xi  
    \ =\  1 \after \asrt_p \after \asrt_p 
    \ =\  1 \after \pi \after \xi \after \pi \after \xi 
    \ =\  1 \after \pi \after \pi' \after \xi' \after \xi 
    \ =\  1 \after \xi' \after \xi,
\end{equation*}
so~$1 \after \xi' = 1$. Thus~$\xi'$ is an iso.
Also~$
    (\IM \pi') \after \xi \after \pi
    = (\IM \pi') \after \pi' \after \xi'
    = 1 \after \xi' = 1 $
    from which it follows~$p = \IM \pi \leq  (\IM \pi') \after \xi 
            \leq 1 \after \xi = p$.
Thus~$(\IM \pi') \after \xi = p = 1\after \xi$.
Hence~$\IM \pi' = 1$ and so~$\pi'$ is an isomorphism.
Now we know~$\pi \after \pi'$
    is a comprehension and~$\xi' \after \xi$ is a quotient,
    we see~$\asrt_p\after\asrt_p$ is pure.
As~$\asrt_p$ is $\diamond$-self-adjoint,
    we see~$\asrt_p\after\asrt_p$ is $\diamond$-positive.
By uniqueness of positive maps~$\asrt_p \after \asrt_p = \asrt_p$,
    as desired.
\end{point}
\begin{point}{Ad 2}%
Pick quotient~$\xi$ and comprehension~$\pi$
    with~$\pi \after \xi = \asrt_s$.
By point 1:
\begin{equation*}
   \pi \after \xi \ =\  \asrt_s \ =\  \asrt_s\after\asrt_s \ =\  \pi \after \xi \after \pi \after \xi.
\end{equation*}
Thus~$\xi \after \pi = \id$.
We compute~$s = 1 \after \asrt_s = 1 \after \xi$
and so
\begin{alignat*}{2}
    \IM \pi &\ = \ 
    \IM \pi \after \xi \after \pi &\qquad& \text{as $\xi \after \pi=\id$}\\
                  &\ = \ \IM \asrt_s \after \pi &&\text{by dfn.~$\xi$ and~$\pi$}\\
                  &\ = \ (\asrt_s)_{\diamond}(\IM \pi)&& \text{by dfn.~$(\ )_\diamond$} \\
                  & \ = \ (\asrt_s)^{\diamond}(\IM \pi)&&
        \text{by $\diamond$-s.a.~$\asrt_s$}\\
        &\ = \ \ceil{(\IM \pi) \after \pi \after \xi} && \text{by dfn.~$(\ )^\diamond$} \\
&\ = \ \ceil{1 \after \xi} \\
    & \ = \ s.
\end{alignat*}
Thus~$\pi$ is a comprehension of~$s$
and~$\xi$ is a quotient of~$s^\perp$.
We have proven the first part.

For the second part,
let~$\pi'$ be any (other) comprehension of~$s$.
Then~$\pi' = \pi \after \alpha$ for some iso~$\alpha$.
Define~$\xi' = \alpha^{-1} \after \xi$.
It is easy to see~$\pi' \after \xi' = \asrt_s$
and~$\xi' \after \pi' = \id$.
The other statement is proven in a similar way.
\end{point}
\begin{point}{Ad 3}%
Assume~$\pi_1 \colon X \to Y$
    and~$\pi_2 \colon Y \to Z$
    are comprehensions with~$s = \IM \pi_1$
    and~$t = \IM \pi_2$.
We will show~$\pi_2 \after \pi_1$
    is a comprehension for~$\IM \pi_2 \after \pi_1$.
To this end, let~$f\colon V\colon Z$ be any map
with~$(\IM \pi_2 \after \pi_1)^\perp \after f = 0$.
As~$\IM \pi_2 \after \pi_1 \leq \IM \pi_2 = t$
    we get~$t^\perp \after f = 0$,
    so~$f = \pi_2 \after g_2$ for a unique~$g_2\colon V \to Y$.
Let~$\zeta_2$ be a quotient for~$t^\perp$
such that~$\zeta_2 \after \pi_2$,
which exists by the previous point.
Then~$s \after \zeta_2 \after \pi_2 \after \pi_1
            = s \after \pi_1 = 1$
            so~$s \after \zeta_2 \geq \IM \pi_2 \after \pi_1$.
Consequently
\begin{equation*}
    s \after g_2 \ =\  s \after \zeta_2 \after \pi_2 \after g_2
        \ =\  s \after \zeta_2 \after f
        \ \geq\   (\IM \pi_2 \after \pi_1) \after f \ =\  1 \after f
                \ =\  1 \after g_2.
\end{equation*}
Hence there exists a unique~$g_1\colon V \to X$
    with~$\pi_1 \after g_1 = g_2$
    and so~$\pi_2 \after \pi_1 \after g_1 = f$.
By monicity of~$\pi_2 \after \pi_1$,
    this~$g_1$ is unique and so~$\pi_2 \after \pi_1$
    is indeed a comprehension.
\end{point}
\begin{point}{Ad 4}%
Assume~$g\colon X \to Y$ and~$f\colon Y \to Z$ are pure maps.
Say~$f = \pi_1 \after \xi_1$
    and~$g = \pi_2 \after \xi_2$
    for some comprehensions~$\pi_1$, $\pi_2$
        and quotients~$\xi_1$, $\xi_2$.
By definition of $\diamond$-effectus with UPM,
    there is a comprehension~$\pi'$ and quotient~$\xi'$
    such that~$\xi_1 \after \pi_2$.
By the previous point~$\pi_1 \after \pi'$
    is a comprehension
    and~$\xi' \after \xi_2$ is a quotient by \sref{quotients-composition}.
Thus
$f \after g 
=\pi_1 \after \pi' \after \xi' \after \xi_2$
is pure. \qed
\end{point}
\end{point}
\begin{point}{Notation}%
In a~$\diamond$-effectus with UPM
    together with chosen comprehension~$\pi_s$ for~$s$,
    we will write~$\zeta_s$
    for the corresponding quotient for~$s^\perp$
    satisfying~$\zeta_s \after \pi_s = \id$
    and~$\pi_s \after \zeta_s = \asrt_s$.
\end{point}
\end{point}
\begin{point}{Exercise}%
Show that in a~$\diamond$-effectus with UMP,
    we have~$\asrt_p \after \asrt_p = \asrt_{\andthen{p}{p}}$.
\end{point}
\begin{point}{Exercise}%
    Show that in a~$\diamond$-effectus with UMP,
    we have
    \begin{align*}
        \IM f \leq s \quad&\iff\quad  \asrt_s \after f = f \\
        1 \after f \leq t \quad&\iff\quad  f \after \asrt_t = f
    \end{align*}
for any sharp predicates~$s$ and~$t$.
\end{point}
\begin{point}{Definition}%
Suppose~$C$ is a~$\diamond$-effectus with UPM.
In \sref{upm-basics} we saw pure maps are closed under composition.
Write~$\Define{\Pure C}$ for the subcategory
    of pure map.
\end{point}
\end{parsec}

\section{$\dagger$-effectus}
\begin{parsec}%
\begin{point}{Definition}%
A \Define{$\dagger$-category} \TODO{refs}
is category~$C$ together with an involutive identity-on-objects
    functor~$(\ )^\dagger \colon C \to \op{C}$;
    that is, for all objects~$X$ and maps~$f,g$ in~$C$
\begin{multicols}{2}
\begin{enumerate}
    \item $(f \after g)^\dagger = g^\dagger \after f^\dagger$
    \item $\id^\dagger = \id$
    \item $f^{\dagger\dagger} = f$ \emph{and}
    \item $X^\dagger = X$.
\end{enumerate}
\end{multicols}
\noindent
In aby~$\dagger$-category we may define the following.
\begin{enumerate}
\item
    An endomap~$f$ is called \Define{$\dagger$-self-adjoint}
    if~$f^\dagger = f$.
\item
    An endomap~$f$ is \Define{$\dagger$-positive}
    if~$f = g^\dagger \after g$ for some other map~$g$.
\item
    An isomorphism~$\alpha$ is called~\Define{unitary}
        whenever~$\alpha^{-1} = \alpha^\dagger$.
\end{enumerate}
\end{point}
\begin{point}{Example}%
The category~$\mathsf{Hilb}$
    of Hilbert spaces with bouned linear maps
    is a~$\dagger$-category
    with the familiar adjoint as~$\dagger$.
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}{Definition}%
We call a~$\diamond$-effectus~$C$ with UPM,
    a~\Define{$\dagger$-effectus} provided
\begin{enumerate}
\item
    $\Pure C$ is a  $\dagger$-category
     satisfying~$\asrt_p^\dagger = \asrt_p$
        and~$f$ is $\diamond$-adjoint to~$f^\dagger$;
\item
    for every~$\dagger$-positive~$f$,
        there is a unique~$\dagger$-positive~$g$
        with~$g \after g = f$ \emph{and}
\item
    $\diamond$-positive maps are $\dagger$-positive.
\end{enumerate}
\end{point}
\begin{point}[dagger-theorem]{Theorem}%
    A $\diamond$-effectus~$C$ with UPM
        is a~$\dagger$-effectus if and only if
\begin{enumerate}
\item
for every predicate~$p$ there is a predicate~$q$
    with~$\andthen{q}{q} = p$;
\item
    $\andthen{p}{(\andthen{q^2}{(\andthen{p}{r})})}
    = \andthen{(\andthen{p}{q})^2}{r}
    $ for all predicates~$p,q,r$ \emph{and}
\item
    $t \after \zeta$ is sharp for any sharp~$t$
            and quotient~$\zeta$
            with sharp~$1 \after \zeta$.
\end{enumerate}
\begin{point}%
The proof will require quite some preparation and
is postponed until \TODO{}.
For convenience, call~$C$ a \Define{$\dagger'$-effectus}
    if~$C$ is a~$\diamond$-effectus with UPM
    satisfying axioms 1, 2 and 3 from the Theorem above.
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}[quotcompr-diamond-adjoint]{Lemma}%
In a~$\dagger'$-effectus,
$\pi_s$ is~$\diamond$-adjoint to~$\zeta_s$.
\begin{point}{Proof}%
    Pick any sharp~$t,u$.
We have to
    show~$t \after \zeta_s \leq u^\perp$
    if and only if~$u \after \pi_s \leq t^\perp$.
So assume~$t \after \zeta_s \leq u^\perp$.
Then~$t =  t\after \zeta_s \after \pi_s  \leq  u^\perp \after \pi_s
                 =  (u \after \pi_s)^\perp$
    so~$u \after \pi_s \leq t^\perp$.
For the converse, assume~$u \after \pi_s \leq t^\perp$.
Then~$u \after \asrt_s = u \after \pi_s \after \zeta_s \leq t^\perp \after \zeta_s$.
From this,
    the
    $\diamond$-self-adjointness of~$\asrt_s$
    and the fact that~$t^\perp \after \zeta_s$ is sharp,
    we find~$(t^\perp \after \zeta_s)^\perp \after \pi_s \after \zeta_s \leq
        u^\perp$
    and so
\begin{alignat*}{2}
    t \after \zeta_s
    &\ =\  (t^\perp \after \id)^\perp \after \zeta_s \\
    &\ =\  (t^\perp \after \zeta_s \after \pi_s)^\perp \after \zeta_s \\
    &\ =\  (t^\perp \after \zeta_s)^\perp \after \pi_s \after \zeta_s \\
    &\ \leq \ u^\perp,
\end{alignat*}
as desired. \qed
\end{point}
\end{point}
\begin{point}{Proposition}%
In a~$\dagger'$-effectus
we have
\begin{equation*}
    \asrt_p \after \alpha
        \ =\  \alpha \after \asrt_{p\after \alpha} \qquad
        \text{and} \qquad
    \asrt_p \after \zeta
        \ =\  \zeta \after \asrt_{p\after \zeta}
\end{equation*}
for every isomorphism~$\alpha$
and quotient~$\zeta$ for a sharp predicate.
\begin{point}{Proof}%
There is some~$q$ with~$\andthen{q}{q}=p$.
The map~$\alpha^{-1} \after \asrt_q \after \alpha$
    is~$\diamond$-self-adjoint:
\begin{alignat*}{2}
    (\alpha^{-1} \after \asrt_q \after \alpha)_\diamond
    &\ = \ \alpha^{-1}_\diamond \after (\asrt_q)_\diamond \after \alpha_\diamond \\
    &\ = \ \alpha^\diamond \after (\asrt_q)^\diamond \after (\alpha^{-1})^\diamond\\
    &\ = \ (\alpha^{-1} \after \asrt_q \after \alpha)^\diamond.
\end{alignat*}
Thus~$
\alpha^{-1} \after \asrt_q \after \alpha \after
\alpha^{-1} \after \asrt_q \after \alpha
= \alpha^{-1} \after \asrt_p \after \alpha
$ is~$\diamond$-positive.  By UPM
we get~$\alpha^{-1} \after \asrt_p \after \alpha
    = \asrt_{1 \after \alpha^{-1}\after\asrt_p \after \alpha}
    = \asrt_{p \after \alpha} $.
Postcomposing~$\alpha$, we find~$\asrt_p\after\alpha = 
        \alpha \after \asrt_{p \after \alpha}$, as desired.

For the second part, pick comprehension~$\pi$ of~$1\after \zeta$
    with~$\zeta \after \pi = \id$.
Then in a similar fashion as before, using \sref{quotcompr-diamond-adjoint}
    and~$\zeta \after \pi = \id$,
    we see~$\pi \after\asrt_p \after \zeta$
    is~$\diamond$-positive
    and so with UPM
    we find~$\pi \after \asrt_p \after \zeta =  \asrt_{p \after \zeta}$.
    Postcomposing~$\zeta$,
    we find~$\asrt_p \after \zeta = \zeta \after \asrt_{p \after \zeta}$.\qed
\end{point}
\end{point}
    
\end{parsec}

\end{document}

% vim: ft=tex.latex
