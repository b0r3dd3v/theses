\documentclass[b]{subfiles}
\begin{document}

% TODO which supremum with projections (in proj or in effects)
%      define orthonormal set

\chapter{Dilations}

\begin{parsec}[dils-intro]%
\begin{point}%
In this chapter we will study various dilation theorems.
The common theme is that a complicated map
    is actually the composition of a simpler map
    after a representation into a larger algebra.
We already saw a dilation theorem in disguise:
    using the Gel'fand--Naimark--Segal construction (see \sref{gns})
    one shows every state is a vector state on a larger algebra:
\end{point}
\begin{point}[dils-gns]{Exercise (GNS')}%
    Show that
    for each pu-map~$\omega\colon \scrA \to \C$
        from a~C$^*$-algebra~$\scrA$
    there is a Hilbert space~$\scrH$,
    a miu-map~$\varrho\colon \scrA \to \scrB(\scrH)$
    and vector~$x \in \scrH$
    such that~$\omega = h \after \varrho$
    where~$h \colon \scrB(\scrH) \to \C$
    is given by~$h(T) = \left<x,Tx\right>$.
\end{point}

\begin{point}%
Probably the most famous dilation theorem is that
of Stinespring\cite[Thm.~1]{stinespring}.
\end{point}

\begin{point}[stinespring-theorem]{Theorem (Stinespring)}
    For every cp-map~$\varphi\colon \scrA \to \scrB (\scrH)$
    there is a Hilbert space~$\scrK$,
        miu-map~$\varrho\colon \scrA \to \scrB(\scrK)$
        and bounded operator~$V\colon \scrH \to \scrK$
        such that~$\varphi = \ad_V \after \varrho$,
        where~$\Define{\ad_V} \colon \scrB(\scrK) \to \scrB(\scrH)$
        is given by~$\ad_V(T)\equiv V^*TV$.

Furthermore:
\begin{inparaenum}
\item
    if~$\varphi$ is normal, then~$\varrho$ is also normal \emph{and}
\item
    if~$\varphi$ is unital, then~$V$ is an isometry
        (or equivalently~$\ad_V$ is unital).
\end{inparaenum}
\end{point}

\begin{point}%
(We will see a detailed proof later in \sref{dils-proof-stinespring}.)
Stinespring's theorem
is fundamental in the study
of quantum information and quantum computing:
it is used to prove entropy inequalities (e.g.~\cite{lindblad}),
bounds on optimal cloners (e.g.~\cite{werner}),
full completeness of quantum programming languages (e.g.~\cite{staton}),
security of quantum key distribution (e.g.~\cite{werner2}),
analyze quantum alternation (e.g.~\cite{prakash}),
to categorify quantum processes (e.g.~\cite{selinger}) \emph{and}
as an axiom to single out
quantum theory among information processing theories.\cite{chiribella}
A fair overview of all uses of Stinespring's theorem and its consequences
is a formidable task out of scope of this text.

Stinespring's theorem only applies
to maps of the form~$\scrA \to \scrB(\scrH)$
    and so do most of its usefull consequences.
One wonders:
    is there an extension of Stinespring's theorem
    to arbitrary np-maps~$\scrA \to \scrB$?
A different and less common question might be:
    is Stinespring's dilation categorical in some way.
That is: does it have a defining universal property?
Both questions turn out to be true:
Paschke's generalization of GNS for Hilbert C$^*$-modules\cite{paschke}
    turns out to have the same universal property
        as Stinespring's dilation and so it extends Stinespring
        to arbitrary np-maps.

We start of this chapter with a detailed proof of Stinespring's theorem.
We continue to show it obeys a universal property.
Before we move on to Paschke's GNS
    we need to develop Paschke's theory of self-dual Hilbert C$^*$-modules.
Paschke's work builds on Sakai's characterization of von Neumann algebras,
    which would take considerable effort to develop in detail.
Thus to be as complete as possible
we avoid Sakai's characterization (in contrast to our
    article \cite{wwpaschke})
    and give new proofs
    of Paschke's results where required.
One major difference is that we will use
    a completion (see \sref{dils-completion}) of a uniform space
    instead of considering the dual space of a Hilbert C$^*$-module.
We finish the first part of this chapter
    by constructing Paschke's dilation
    and establishing it indeed extends Stinespring's dilation.
In the second part of this chaper
    we prove several results about Paschke's dilations.
\TODO{more intro}
\end{point}
\end{parsec}

\section{Stinespring's theorem}
\begin{parsec}[dils-completion-to-hilb]%
\begin{point}%
For the GNS-construction
it was necessary to ``complete''\footnote{Note that
        we do not require an inner product to be definite.
    The inner product on a Hilbert space \emph{is} definite.
    Thus the completion will quotient out those vectors with
        zero norm with respect to the inner product.}
    a complex vector space with inner product into a Hilbert space.
This completion was only sketched in \sref{completion-inner-product-space}.
Here we will work through the details
    as the corresponding completion required
    in Paschke's dilation
    is more complex and its exposition will benefit
    from this familiar analogon.
\end{point}

\begin{point}[prop-complete-into-hilbert-space]{Proposition}%
    Let~$V$ be a complex vector space with inner
        product~$[\,\cdot\,,\,\cdot\,]$.
    There is a Hilbert space~$\scrH$
        together with bounded linear map~$\eta\colon V \to \scrH$
            such that
        \begin{inparaenum}
        \item
        $[v,w] = \left<\eta(v), \eta(w)\right>$
            for all~$v,w \in V$ and
        \item
        the image of~$\eta$ is dense in~$\scrH$.
        \end{inparaenum}
\begin{point}{Proof}%
We will form~$\scrH$ from the set of Cauchy sequences in~$V$
    with a little twist.
Recall two Cauchy
    sequences~$(v_n)_n$ and~$(w_n)_n$ in~$V$
    are said to be equivalent
    if for every~$\varepsilon > 0$
    there is a~$n_0$
    such that~$\| v_n - w_n \| \leq \varepsilon$
    for all~$n \geq n_0$,
    where $\|v\| \equiv \sqrt{[v,v]}$.
Call a Cauchy sequence~$(v_n)_n$ \Define{fast}
    if for each~$n_0$
    we have~$\| v_n - v_m\| \leq \frac{1}{2^{n_0}}$
    for all~$n,m \geq n_0$.
Clearly every Cauchy sequence has a fast subsequence
    which is (as are all subsequences) equivalent with it.
\begin{point}%
    Define~$\scrH$ to be the set of fast Cauchy sequences modulo
        equivalence.
For brevity we will denote an element of~$\scrH$,
    which is an equivalence class of Cauchy sequences, simply by
    a single representative.
Also, we often tersely write~$v$ for the Cauchy sequence~$(v_n)_n$.
The set~$\scrH$ is a metric space with the standard
    distance~$d(v, w) \equiv \lim_{n\to\infty} \| v_n - w_n\|$.
To show it's complete, assume
$v^1, v^2, \ldots$
is a fast Cauchy sequence of fast Cauchy sequences.
Assume~$n,m,k \geq N$.  We have
\begin{equation*}
    \| v^n_n - v^m_m \|
        \leq
    \| v^n_n - v^n_k \| +
    \| v^n_k - v^m_k \| +
    \| v^m_k - v^m_m \| \leq
    \| v^n_k - v^m_k \|+ \frac{2}{2^N}.
\end{equation*}
Because~$\lim_{k\to\infty} \|v_k^n-v_k^m \| =d(v^n,v^m) \leq 2^{-N}$
    we can find a~$k \geq N$
    such that~$\| v^n_k - v^m_k \| \leq \frac{2}{2^N}$
    and so~$\|v^n_n - v^m_m\| \leq \frac{4}{2^N}$.
    Thus~$(v^n_n)_n$ is a Cauchy sequence.
It's easily checked~$v^1, v^2, \ldots$
converges to~$(v^n_n)_n$ with respect to~$d$.
The sequence~$(v^n_n)_n$ might not be fast
    and so, might not be in~$\scrH$,
    but like any other Cauchy sequence,
    it has a fast subsequence.
The equivalence class
of this subsequence is the limit of~$v^1, v^2, \ldots$ in~$\scrH$.
We have shown~$\scrH$ is complete.
\end{point}
\begin{point}[prop-hilbert-space-completion-extension]%
Define~$\eta\colon V \to \scrH$
    to be the map which sends~$v$ to the equivalence class of the
    constant sequence~$(v)_n$.
By construction of~$\eta$ and~$\scrH$,
    the image of~$\eta$ is dense in~$\scrH$.
Let~$f\colon V \to X$
    be any uniformly continuous map to a complete metric space~$X$.
We will show there is a unique continuous~$g\colon \scrH \to X$
    such that~$g \after \eta = f$.
From the uniform continuity it easily follows
    that~$f$ maps Cauchy sequences to Cauchy sequences
    and preserves equivalence between them.
Together with the completeness of ~$X$
    there is a unique~$g\colon \scrH \to X$
    fixed by~$g((v_n)_n) = \lim_{n\to\infty}f(v_n)$.
Clearly~$g \after \eta = f$.
Finally, $g$ is unique as it's fixed on the image of~$\eta$, which is dense.
\end{point}
\begin{point}[completion-to-hilb-vect]%
Thus we directly get a scalar multiplication
    on~$\scrH$ by extending~$\eta \after r_z \colon V \to \scrH$
    where~$r_z(v) = zv$ is scalar multiplication by~$z \in C$,
    which is uniformly continuous.
In fact~$z (v_n)_n \equiv (z v_n)_n$.
Extending addition is less direct, but straight-forward:
    given representatives~$v,w \in \scrH$
    we know~$(v_n+w_n)_n$ is Cauchy in~$V$
    by uniform continuity of addition and so
    picking a fast subsequence~$v+w$ of $(v_n+w_n)_n$
        fixes an addition on~$\scrH$.
With this expression for addition and the similar one for
    scalar multiplication it is easy to see
    they turn~$\scrH$ into a complex vector space with zero~$\eta(0)$
    for which~$\eta$ is linear.
Extending the inner product is bit trickier.
\end{point}
\begin{point}%
To define the inner product on~$\scrH$,
first note that for Cauchy sequences~$v$ and~$w$ in~$V$
we have (using Cauchy--Schwarz, \sref{chilb-cs}, on the second line):
\begin{align*}
    \bigl|[v_n,w_n] - [v_m,w_m]\bigr|
    & \ =\  \bigl|[v_n,w_n-w_m] + [v_n - v_m,w_m]\bigr| \\
    & \ \leq\  \|v_n\| \|w_n - w_m\| + \|v_n-v_m\|\|w_m\|.
\end{align*}
Thus as~$(\|v_n\|)_n$ and~$(\|w_n\|)_n$ are bounded
we see~$([v_n,w_n])_n$ is Cauchy.
In a similar fashion we see~$\bigl|[v_n,w_n] - [v'_n,w'_n]\bigr|
    \leq \|v_n\| \|w_n - w_n'\| + \|v_n-v_n'\|\|w'_n\|\to 0$ as~$n\to \infty$
    for~$v'$ and~$w'$ Cauchy sequences equivalent
to~$v$ respectively~$w$.
Thus
$([v_n,w_n])_n$ is equivalent to
$([v'_n,w'_n])_n$
    and so
    we define~$\left<v,w\right>
        \equiv \lim_{n\to \infty} [v_n,w_n]$ on~$\scrH$.
With vector space structure from~\sref{completion-to-hilb-vect}
we easily see this is an inner product~$\scrH$.
The metric induced by the inner product coincides with~$d$:
\begin{equation*}
    \left<v-w,v-w\right>
   =\lim_{n}[v_n-w_n,v_n-w_n]
    =\lim_{n}\|v_n-w_n\|^2
    = d(v,w)^2.
\end{equation*}
And so~$\scrH$ is a Hilbert space.
Finally, $\left<\eta(v),\eta(w)\right>=[v,w]$ is direct.\qed
\end{point}
\end{point}
\end{point}
\end{parsec}

\begin{parsec}[dils-stinespring]%
\begin{point}%
We are ready to prove Stinespring's dilation theorem.
\begin{point}[dils-proof-stinespring]{%
    Proof of Stinespring's theorem \sref{stinespring-theorem}}%
Let~$\varphi\colon \scrA \to \scrB(\scrH)$
    be a cp-map.
Write~$\scrA \odot \scrH$ for the tensor product of~$\scrA$ and~$\scrH$
    as vector spaces.
By linear extension,
the following fixes a sesquilinear form on~$\scrA \odot \scrH$:
\begin{equation*}
    [a\otimes x, b \otimes y] = \left<x, \varphi(a^*b)y\right>_{\scrH}.
\end{equation*}
As~$\varphi$ preserves involution as a positive map,
see \sref{cstar-p-implies-i}, this is also a symmetric form, i.e.: $[t,s]=\overline{[s,t]}$.
    Assume~$\sum^n_{i=1} a_i\otimes x_i$
is an arbitrary element of~$A \odot \scrH$.
To see $[\,\cdot\,,\,\cdot\,]$ is positive,
we need to show
\begin{equation*}
    0 \leq \bigl[\sum_i a_i\otimes x_i, \sum_j a_j\otimes x_j\bigr]
        = \sum_{i,j} [a_i\otimes x_i, a_j\otimes x_j]
        = \sum_{i,j} \left< x_i, \varphi(a_i^*a_j) x_j \right>.
\end{equation*}
The matrix algebra~$M_n\scrB(\scrH)$
acts on~$\scrH^{\oplus n}$
as~$(A (x_1,\ldots,x_n)^\T)_i = \sum_j A_{ij} x_j$.
(In fact, this gives an
    isomorphism~$M_n\scrB(\scrH) \cong \scrB(\scrH^{\oplus n})$.)
Writing~$x$ for the vector~$(x_1,\ldots,x_n)^\T$ in~$\scrH^{\oplus n}$,
    we get
\begin{equation}\label{eq-stinespring-norm-tensor}
    \sum_{i,j} \left< x_i, \varphi(a_i^*a_j) x_j \right>
    = \bigl<
    x,
    (M_n\varphi) \bigl(\, (a_i^*a_j)_{ij} \, \bigr)\,
    x \bigr>_{\scrH^{\oplus n}}.
\end{equation}
The matrix~$(a_i^*a_j)_{ij}$
is positive as~$(C^*C)_{ij} = a_i^*a_j$
    with~$C_{ij} \equiv \frac{1}{\sqrt{n}} a_j$.
    By complete positivity~$M_n\varphi(\,(a_i^*a_j)_{ij}\,)$ is positive
    and so is~\eqref{eq-stinespring-norm-tensor},
    hence~$[\,\cdot\,,\,\cdot\,]$ is an inner product.
Write~$\eta\colon A\odot \scrH \to \scrK$ for the Hilbert space completion
    described in~\sref{prop-complete-into-hilbert-space}.
\begin{point}[stinespring-extend-operator]%
Let~$T\colon A \odot \scrH \to A \odot \scrH$
be a bouned linear map.
We show there is an extension~$\hat{T} \colon \scrK \to \scrK$.
The operator $T$
uniformly continuous and so is~$\eta\after T \colon A\odot\scrH \to\scrK$.
Thus by \sref{prop-hilbert-space-completion-extension}
there is a unique continuous extension~$\hat{T} \colon \scrK \to \scrK$
with~$\hat{T}(\eta(t)) = \eta(T(t))$
    for all~$t \in \scrA\odot\scrH$.
Clearly~$\hat{T}$ is linear on the image of~$\eta$,
    which is dense and so~$\hat{T}$ is linear everwhere.
Hence~$\hat{T}$ is bounded, so~$\hat{T} \in \scrB(\scrK)$.
It is easy to see~$\widehat{T+S}=\hat{T}+\hat{S}$ and
    $\widehat{\lambda T} = \lambda \hat{T}$
    for operators~$S,T$ on~$\scrA \odot \scrH$ and~$\lambda \in \C$.
Also~$\widehat{TS} = \hat{T}\hat{S}$:
indeed~$\hat{T}\hat{S} \eta(t)
            = \hat{T} \eta(St)
            = \eta(TSt)$
    and so by uniqueness~$\hat{T}\hat{S} = \widehat{TS}$.
\end{point}
\begin{point}%
    Assume~$b\in \scrA$.
    Let~$\varrho_0(b)$ be the operator on~$\scrA \otimes \scrH$
    fixed by~$\varrho_0(b) a\otimes x = (b a) \otimes x$.
Clearly $\varrho_0$ is linear, unital and multiplicative.
We want to show~$\varrho_0(b)$ is bounded for fixed~$b \in \scrA$.
To show this, we claim that in~$M_n\scrB(\scrH)$
we have~$(a_i^*b^*ba_j)_{ij} \leq \|b\|^2 (a_i^*a_j)_{ij}$.
Indeed, as~$b^*b \leq \|b\|^2$,
    there is some~$c$ with~$c^*c = \|b\|^2 - b^*b$.
Define~$C_{ij} \equiv \frac{1}{\sqrt{n}} ca_j$.
We compute:
$ (C^*C)_{ij} = a_i^*c^*ca_j = a_i^* (\|b\|^2 - b^*b) a_j$
and get the claimed inequality with which
\begin{equation*}
    \begin{split}
    \bigl\| \sum_i (ba_i) \otimes x_i \bigr\|^2
    & = \bigl< x, (M_n\varphi)(\, (a_i^* b^*b a_j)_{ij}\,)x\bigr> \\
    &\leq \|b\|^2 \bigl< x, (M_n\varphi)(\, (a_i^* a_j)_{ij}\,)x\bigr>
    = \|b\|^2 \bigl\| \sum_i a_i \otimes x_i \bigr\|^2
    \end{split}
\end{equation*}
and so~$\varrho_0(b)$ is bounded.
Now define~$\varrho(b) \colon \scrA \to \scrB(\scrH)$
    by~$\varrho(b) \equiv \widehat{\varrho_0(b)}$.
\end{point}
\begin{point}%
We already know~$\varrho$ is a~mu-map.
We want to show it preserves involution: $\varrho(c^*) = \varrho(c)^*$
for all~$c \in \scrA$.
Indeed, for every~$a,b \in \scrA$ and~$x,y \in \scrH$
    we have
    \begin{equation*}
        [\varrho_0(c^*) \, a\otimes x,b \otimes y]
        = [(c^* a)\otimes x,b \otimes y]
        = \left<x, \varphi(a^*cb) y \right>
        = [a\otimes x,\varrho_0(c)\, b \otimes y].
    \end{equation*}
Hence~$
    \left<\varrho(c^*) \eta(a\otimes x), \eta(b\otimes y)\right>=
    \left< \eta(a\otimes x), \varrho(c)\eta(b\otimes y)\right>$.
    As the linear span of~$\eta(a\otimes x)$ is dense in~$\scrK$,
        we find~$\varrho(c^*) = \varrho(c)^*$, as desired.
\end{point}
\begin{point}%
    Let~$V_0 \colon \scrH \to \scrA \odot \scrH$
        be given by~$V_0 x = 1 \otimes x$.
        It's bounded: $\| V_0 x\| = \left<x, \varphi(1^*1) x\right>^{\frac{1}{2}}
        = \|\sqrt{\varphi(1)} x\| \leq \|\sqrt{\varphi(1)}\| \|x\|$.
    Define~$V \equiv \eta \after V_0$.
    For all~$a \in \scrA$ and~$x,y \in \scrH$ we have
            $[a \otimes x, V_0 y]
            = \left<x, \varphi(a^*)y\right>
            = \left<x, \varphi(a)^*y\right>
            = \left<\varphi(a) x, y\right>$.
    Thus~$V^*$ satisfies~$V^* \eta(a \otimes x) = \varphi(a)x$.
    Hence for all~$a \in \scrA$ and~$x \in \scrH$:
    $V^* \varrho(a) V x = V^* \varrho(a) \eta(1 \otimes x)
        = V^* \eta(a\otimes x)
        = \varphi(a)x$.
        So~$\ad_V \after \varrho = \varphi$.

    If~$\varphi$ is unital,
    then~$V^*Vx = V^* (1\otimes x) = \varphi(1)x=x$
        for all~$x \in \scrH$ and so~$V$ is an isometry.
    (Or equivalently~$\ad_V$ is unital.)
\end{point}
\begin{point}%
    It remains to be shown that~$\varrho$
        is normal when~$\varphi$ is.
    Assume~$D \subseteq \scrA$ is a bounded directed
    set of self adjoint elements.
    We need to show~$\sup_{d \in D} \varrho (d) = \varrho(\sup D)$.
    Let~$t$ be in the image of~$\eta$.
    It is sufficient to show~$\left<t, \varrho(\sup D) t\right>
        = \left<t, \sup_{d \in D} \varrho(d)t\right>$.
    We have~$t = \sum_{i=1}^n a_i \otimes x_i$
        for some~$n \in \N$, $a_1, \ldots, a_n \in \scrA$
            and~$x_1,\ldots, x_n \in \scrH$.
    Write~$x$ for the vector~$(x_1, \ldots, x_n)^\T$
        in~$\scrH^{\oplus n}$.
    Then
    \begin{align*}
        \left<t, \varrho(\sup D) t\right>
        &= \bigl< x, (M_n\varphi)\bigl(\, ( a_i^* (\sup D) a_j)_{ij} \,\bigr) x \bigr>_{\scrH^{\oplus n}} \\
        &= \sup_{d\in D} \bigl< x, (M_n\varphi)\bigl(\, ( a_i^* d a_j)_{ij} \,\bigr) x \bigr>_{\scrH^{\oplus n}}\\
        & = \sup_{d\in D} \left<t, \varrho(d)t\right>
            = \bigl<t, \sup_{d \in D} \varrho(d) t\bigr>.
    \end{align*}
    Here we used that~$\left<x, (\,\cdot\,)x\right>$,
        $M_n\varphi$ and 
    $d \mapsto (a_i^*da_j)_{ij}$ are normal.
    The first is normal by~\sref{hilb-suprema}.
    \TODO{}
    At the moment it will be a bit tricky to show~$(a_i^*da_j)_{ij}$
    is normal.  Later (\TODO{}) we will have a simpler argument.
    Define~$C_{ij} = \frac{1}{\sqrt{n}} a_j$
        and~$\Delta\colon \scrA \to M_n \scrA$
        by~$(\Delta(d))_{ij} = \delta_{ij} d$.
    Then~$(C^*\Delta(d)C)_{ij} = a_i^* d a_j$.
    As~$C^*(\,\cdot\,)C$ is normal by~\sref{ad-normal},
        it is sufficient to show~$\Delta$ is normal.
    Without loss of generality, we may assume~$\scrA$
        is an algebra of operators on a Hilbert spaces~$\scrL$.
        By~\sref{vna-supremum-uslimit}
        $(d)_{d \in D}$ converges ultrastrongly to~$\sup D$.
    In particular it converges in the WOT.
    Similarly
    $(\Delta(d))_{d \in D}$
        converges in the WOT
        to~$\sup_{d \in D} \Delta(d)$.
        Let~$x \equiv (x_1, \ldots, x_n)^\T$ be a vector in~$\scrL^{\oplus n}$.
        Then~$
        (\left<x,  \Delta(d)x\right>)_{d \in D}
        = (\sum_i \left<x_i,  dx_i \right>)_{d \in D}$
        converges to
        $ \sum_i \left<x_i,  (\sup D )x_i \right>
            = \left<x,  \Delta(\sup D )x \right>$
    and so~$(\Delta(d))_{d \in D}$
    also converges in the WOT to $\Delta(\sup D)$.
    Hence~$\Delta(\sup D) = \sup_{d \in D} \Delta(D)$
        and so~$\Delta$ is normal.\qed
\end{point}
\end{point}
\begin{point}%
Stinespring's theorem generalizes GNS.
It seems tempting to directly prove Stinespring instead of GNS ---
however, we used GNS in the proof of Stinespring theorem to show
that~$\varrho$ is normal, when~$\varphi$ is.
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}%
In the following series of exercises we will develop
    a few consequences of Stinespring's theorem
    which are in some fields more well-known than
    the Stinespring theorem itself.
As preparation we study the nmiu-maps between type I von Neumann algebras.
\end{point}
\begin{point}[nmiu-between-type-I]{Exercise}%
Let~$\varrho\colon \scrB(\scrH) \to \scrB(\scrK)$    
be a non-zero nmiu-map for non-trivial Hilbert spaces~$\scrH$ and~$\scrK$.
In this exercise we will show
    there is a Hilbert space~$\scrK'$
    and a unitary~$U\colon \scrK \to \scrH \otimes \scrK'$
    such that~$\varrho(a) = U^* (a\otimes 1) U $.

Show the kernel of~$\varrho$
    is a ultraweakly-closed two-sided ideal.
Use \sref{prop:weakly-closed-ideal}
    to conclude~$\varrho$ is injective.

Pick an orthonormal basis~$(e_i)_{i\in I}$
    of~$\scrH$.
Write~$p_i$ for the projection onto~$e_i$;
i.e.~ $p_i = \ket{e_i}\!\bra{e_i}$.
Choose any~$i_0 \in I$.
Also pick an orthonormal basis~$(f_i)_{i \in J}$
    for the subspace~$\varrho(p_{i_0})$ projects onto.

Write~$u_i$
    for the partial isometry fixed by~$u_i e_i = e_{i_0}$
    and~$u_i e_j = 0$ if~$j \neq i$; viz.~$u_i = \ket{e_{i_0}}\!\bra{e_i}$.
For~$i\in I$ and~$j \in J$,
    define~$r_{i,j} = \varrho(u^*_i) f_j$.
Show~$r_{i,j}$ is an orthonormal basis of~$\scrK$.
Define~$\scrK' = \varrho(p_{i_0}) \scrK$.
Conclude~$U^* e_i \otimes f_j = r_{i,j}$
    fixes a unitary
    $U\colon \scrK \to \scrH \otimes \scrK'$
    with~$\varrho(a) = U^* (a\otimes 1) U $.
\end{point}
\begin{point}[physics-stinespring]{Exercise}%
Use \sref{nmiu-between-type-I} and~\sref{stinespring-theorem} to show
    that for every ncp-map~$\varphi\colon \scrB(\scrH) \to \scrB(\scrK)$
    there is a Hilbert space~$\scrK'$
    and a bounded operator~$V\colon \scrK \to \scrH \otimes \scrK'$
    such that~$\varphi(a) = V^* (a \otimes 1)V$.

Conclude using \TODO{CPTP notation}
that~$\Phi(\varrho) = \TR_{\scrK'} [U^* \varrho \otimes \ketbra{v_0}{v_0} U]$.
\end{point}
\begin{point}{Exercise (Kraus' decomposition)}%
Assume~$\varphi \colon \scrB(\scrH) \to \scrB(\scrK)$
    is an ncp-map.
By~\sref{physics-stinespring}
    there is a Hilbert space~$\scrK'$
    and bounded operator~$V\colon \scrK \to \scrH \otimes \scrK'$
    such that~$\varphi(a) = V^* (a \otimes 1) V$.
Choose an orthonormal basis~$(e_i)_{i \in I}$ of~$\scrK'$.
Show~$\varphi(a) = \sum_{i \in I} V^* (a \otimes \ketbra{e_i}{e_i}) V$,
where the sum converges ultraweakly.
Deduce there are projectors~$P_i \colon \scrH \otimes \scrK' \to \scrH$
with~$\varphi(a) = \sum_{i \in I} V^*P_i^* a P_iV$.
Conclude all ncp-maps
are of the form~$\varphi(a) = \sum_{i \in I} V_i^* a V_i$
where~$V_i\colon \scrK \to \scrH$ are bounded operators
such that the partial sums of~$\sum_i V_i^*V_i$ are bounded.
These~$V_i$ are called \Define{Kraus operators} for~$\varphi$.

Now assume~$\scrH$ and~$\scrK$ are finite dimensional,
    say~$\dim \scrH = n$ and~$\dim \scrK = m$.
Show that in this case~$\dim \scrK' = nm$ Kraus operators suffice.
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}{Definition}%
Let~$\varphi\colon \scrA \to \scrB(\scrH)$
    be any ncp-map.
A \Define{normal Stinespring dilation}
    is a triplet~$(\scrK,\varrho, V)$
    with~$\scrK$ a Hilbert space,
    $\varrho\colon \scrA \to \scrB(\scrK)$ a nmiu-map
        (i.e.~normal representation)
        and~$V\colon \scrH \to \scrK$ a bounded linear map
        with~$\varphi = \ad_V \after \varrho$.
We just saw every~$\varphi$ has a normal Stinespring dilation.
If the linear span of~$\{ \varrho(a) Vx; \ a \in \scrA,\ x\in \scrH\}$
is dense in~$\scrK$
then the Stinespring dilation $(\scrK,\varrho,V)$ is said to be \Define{minimal}.
Every Stinespring dilation of~$\varphi$ can be restricted to a minimal one
    for~$\varphi$.
\end{point}
\begin{point}%
It is a well-known fact that all minimal normal Stinespring dilations
    for a fixed~$\varphi$ are unitarily equivalent,
    see for instance~\cite[Proposition 4.2]{paulsen}.
We will adapt its proof to show that a minimal normal Stinespring
    dilation admits a universal property.
Later we will use this to prove a second universal property \sref{stinespring-is-paschke}
    that allows us to generalize Stinespring's dilation to
    arbitrary ncp-maps.
The modification of the familiar argument
    is mostly straight-forward, except for the following lemma.
\end{point}
\parpic[r]{
$\xymatrix{\mathscr{A} \ar[r]^\varrho \ar[rd]_{\varrho'}&
\mathscr{B} \\
& \mathscr{C} \ar[u]_\sigma}$}
\begin{point}[dils-univlemma]{Lemma}%
Let~$\varrho\colon \scrA \to \scrB$ and~$\varrho'\colon \scrA \to \scrC$
    be nmiu-maps between von Neumann algebras,
        and let~$\sigma \colon \scrC \to \scrB$ be a ncp-map
        such that~$\sigma \after \varrho' = \varrho$.\\
Then~$\sigma(\varrho'(a_1)c \varrho'(a_2)) =  \varrho(a_1) \sigma(c) \varrho(a_2)$
    for all~$a_1,a_2 \in \scrA$ and~$c \in \scrC$.

\begin{point}{Proof}%
By Theorem 3.1 of \cite{choi} (see \sref{choi}),
we know that for all~$c,d\in\scrC$:
\begin{equation}
    \sigma(d^*d) = \sigma(d)^*\sigma(d) \quad \implies \quad
    \sigma(cd) = \sigma(c)\sigma(d).\label{dils-eq-choi}
\end{equation}
Let~$a \in \scrA$.
We have~$\sigma(\varrho'(a)^* \varrho'(a))
    = \sigma(\varrho'(a^*a))
    = \varrho(a^*a)
    = \varrho(a)^*\varrho(a)
    = \sigma(\varrho'(a))^*\sigma(\varrho'(a))$.
By \eqref{dils-eq-choi},
    we have~$\sigma(c\varrho'(a)))
        = \sigma(c)\sigma(\varrho'(a)) = \sigma(c)\varrho(a)$
        for all~$c \in \scrC$.
Thus also (taking adjoints):
$\sigma(\varrho'(a)c) = \varrho(a)\sigma(c)$ for all~$c \in \scrC$.
Hence~$\sigma(\varrho'(a_1)c\varrho'(a_2))
            = \varrho(a_1)\sigma(c \varrho'(a_2))
            = \varrho(a_1) \sigma(c) \varrho(a_2)$
    for all~$a_1,a_2 \in \scrA$ and~$c\in \scrC$ as desired.\qed
\end{point}
\end{point}
\begin{point}[dils-univ-stinespring]{Proposition}%
    Assume~$\varphi\colon \scrA \to \scrB(\scrH)$
        is any ncp-map with normal
        Stinespring dilations~$(\scrK, \varrho, V)$
    and~$(\scrK', \varrho', V')$.
        If~$(\scrK,\varrho,V)$ is minimal,
        then there is a unique isometry~$S\colon \scrK \to \scrK'$
        such that~$SV=V'$ and~$\varrho = \ad_S\after \varrho'$.
\begin{point}{Proof}
First we will deal with a pathalogical case.
If~$V = 0$, then~$\varphi = 0$, $V' = 0$, $\scrK = \{0\}$
and~$\varrho = 0$.  Thus the unique linear map~$S\colon \{0\} \to \scrK'$
satisfies the requirements.  Assume~$V \neq 0$.
\begin{point}{Uniqueness}%
Let~$S_1,S_2\colon \scrK \to \scrK'$
be any isometries with~$S_k V = V'$ and~$\ad_{S_k} \after \varrho' = \varrho$
for~$k \in \{1,2\}$.
We want to show~$S_1=S_2$.
For all finite tuples~$(a_i)_i$, $(\alpha_i)_i$ from~$\scrA$;
    $(x_i)_i$, $(y_i)_i$ from~$\scrH$ \emph{and} $c \in \scrB(\scrK')$
    we have
\begin{align*}
    \bigl< \ad_{S_k}(c)
        \sum_i \varrho(a_i) V x_i,
        \sum_j \varrho(a_j) V x_j \bigr>
    &\ = \ \sum_{i,j}
        \bigl< V^* \varrho(\alpha_j^*) \ad_{S_k}(c) \varrho(a_i) V x_i, y_i
            \bigr> \\
            & \ \stackrel{\sref{dils-univlemma}}{=} \ \sum_{i,j}
        \bigl< V^* \ad_{S_k} \bigl(\varrho'(\alpha_j^*) c
            \varrho'(a_i)\bigr) V x_i, y_j\bigr> \\
    & \ =\  \sum_{i,j}
        \bigl< (V')^* \varrho'(\alpha_j^*) c \varrho'(a_i) V' x_i, y_j
            \bigr>.
\end{align*}
As the linear span of~$\varrho(\scrA) V\scrH$ is dense in~$\scrK$
    we see~$\ad_{S_1} = \ad_{S_2}$.
Thus $\lambda S_1= S_2$ for some~$\lambda \in \C$ by \TODO{}.
As~$V \neq 0$, there is an~$x \in \scrH$ with~$Vx \neq 0$.
Then~$S_1 V x = V'x = S_2Vx = \lambda S_1 Vx$, so~$\lambda=1$.
Hence~$S_1=S_2$, as desired.
\end{point}
\begin{point}{Existence}%
For any tuple~$(a_i)_i$ in~$\scrA$ and~$(x_i)_i \in \scrH$, we have
\begin{align*}
\bigl\| \sum_i \varrho(a_i)Vx_i \bigr\|^2
&\ =\  \sum_{i,j} \bigl< V^* \varrho(a_j^*a_i) Vx_i, x_j\bigr> \\
&\ =\  \sum_{i,j} \bigl< \varphi(a_j^* a_i)x_i, x_j \bigr> \\
&\ =\  \bigl\| \sum_i \varrho'(a_i) V'x_i \bigr\|^2.
\end{align*}
Thus there is a unique isometry~$S\colon \scrK \to \scrK'$
    such that~$S\varrho(a) Vx = \varrho'(a)V' x$
        for all~$a\in \scrA$ and~$x \in\scrH$.
As~$SVx = S\varrho(1)Vx=\varrho'(1)V'x = V'x$ for all~$x\in \scrH$
    we have~$SV = V'$.
Furthermore, for all~$(x_i)_i$ in~$\scrH$;
    $(a_i)_i$ and~$a$ in~$\scrA$
we have
\begin{align*}
    S \varrho(a) \sum_i \varrho(a_i)Vx_i
    &= \sum_i S \varrho(aa_i) Vx_i \\
    &= \sum_i \varrho'(aa_i) V'x_i \\
    & = \varrho'(a) \sum_i \varrho'(a_i)V'x_i\\
    & = \varrho'(a) S \sum_i \varrho(a_i)V x_i.
\end{align*}
Again as the linear span of~$\varrho(\scrA)V\scrH$
    is dense in~$\scrK$
    we find~$S \varrho(a) = \varrho'(a)S$.
Thus $S^* \varrho'(a) S = S^*S\varrho(a) = \varrho(a)$
    and so~$\ad_S \after \varrho' = \varrho$. \qed
\end{point}
\end{point}
\end{point}
\begin{point}{Exercise}%
    The statement of the universal property
        \sref{dils-univ-stinespring}
        for Stinespring
        was proposed by Chris Heunen in an unpublished note.
    In this note he shows it is equivalent to the existence
        of a left-adjoint, as we will see in this exercise.
    
    Let~$\mathsf{Rep}_{\mathrm{cp}}$
        denote the category with as objects
            ncpu-maps~$\varphi\colon \scrA \to \scrB(\scrH)$
            and as arrows between~$\varphi\colon \scrA \to \scrB(\scrH)$
            and~$\varphi'\colon \scrA' \to \scrB(\scrH')$
            pairs~$(m, S)$
            where~$m\colon \scrA \to \scrA'$ is a nmiu-map
            and~$S\colon \scrH \to \scrH'$ is an isometry
            such that~$\varphi = \ad_S \after \varphi' \after m$.
    Write~$\mathsf{Rep}$
        for the full subcategory of~$\mathsf{Rep}_{\mathrm{cp}}$
        consisting of objects~$\varphi\colon \scrA \to \scrB(\scrH)$
            that are nmiu.

Show using~\sref{dils-univ-stinespring}
    that the inclusion functor~$U \colon \mathsf{Rep}
    \to \mathsf{Rep}_{\mathrm{cp}}$ has a left adjoint.
\par % XXX wtf?
\end{point}
\begin{point}{Exercise (Essential uniqueness of purification)}
    Let~$\varphi \colon \scrB(\scrH) \to \scrB(\scrK)$
        be any ncp-map.
    By~\sref{physics-stinespring}
    here is a Hilbert~$\scrK'$
        and bounded operators~$V\colon \scrK \to \scrH \otimes \scrK'$
        such that~$V^* (a\otimes 1) V = \varphi(a)$.
    Assume there is another bounded operator
        $W\colon \scrK \to \scrH \otimes \scrK'$
        with~$W^* (a \otimes 1) W = \varphi(a)$.
    We will show there is a unitary~$U \colon \scrK' \to \scrK'$
    such that~$V = (1 \otimes U) W$.

    First show that in the special case the dilations are minimal
    (i.e.~the linear span of~$\{(a \otimes 1) V x;\  a \in \scrB(\scrH), x \in \scrK\}$ is dense
            in $\scrH \otimes \scrK'$),
        that there is a (unique) unitary~$U_0$ on $\scrH \otimes \scrK'$
        with~$V = U_0 W$ and~$(a \otimes 1) U_0 = U_0 (a \otimes 1)$
            for all~$a \in \scrB(\scrH)$.
    Derive from the latter
    that for each~$y \in \scrK'$ and rank-one projector~$e \in \scrH$
        there is a~$y' \in \scrK'$
        with~$U_0 (e \otimes y) = e \otimes y'$.
    Conclude~$U_0 = 1 \otimes U$ for some unitary~$U$ on~$\scrK'$.
    Show the general case follows from when the dilations are minimal.
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
    We are ready to state the universal
        property that Stinepspring's dilation satisfies,
        which we will use to generalize it to arbitrary maps ncp-maps.
\end{point}
\parpic[r]{
$\xymatrix@C=2.5em@R=2em{
\mathscr{A} 
\ar[rr]^\varphi
\ar[rd]_{\varrho}
\ar@/_1.5em/[rdd]_{\varrho'}
& & \mathscr{B} 
\\ &
\mathscr{P}
\ar[ru]_{h}
& \\ &
\mathscr{P}'
\ar@/_1.5em/[ruu]_{h'}
\ar@{..>}[u]_-{\sigma}
}$}
\begin{point}[def-paschke]{Definition}%
    Let~$\varphi\colon \scrA \to \scrB$
        be any ncp-map.
    A \Define{Paschke dilation} of~$\varphi$
    is a triplet~$(\scrP, \varrho, h)$
    with a von Neumann algebra~$\scrP$;
    an nmiu-map $\varrho \colon \scrA \to \scrP$
    and ncp-map~$h \colon \scrP \to \scrB$
    with~$\varphi = h \after \varrho$
    such that for every other
    such triplet~$(\scrP', \varrho', h')$
    with a von Neumann algebra~$\scrP'$;
    an nmiu-map $\varrho'\colon \scrA \to \scrP'$
    and ncp-map~$h' \colon \scrP' \to \scrB$,
    there is a unique~$\sigma \colon \scrP' \to \scrP$
    with~$\sigma \after \varrho' = \varrho$
    and~$h \after \sigma = h'$.
    \par % XXX hack to get parpic to work
\end{point}
\begin{point}[stinespring-is-paschke]{Theorem}%
Let~$\varphi\colon \scrA \to \scrB(\scrH)$
    be any ncp-map
    together with a minimal normal Stinespring dilation~$(\scrK,\varrho,V)$.
    Then $(\scrB(\scrK), \varrho, \ad_V)$
        is a Paschke dilation of~$\varphi$.
\parpic[r]{
\xymatrix{
\mathscr{A} \ar@/_/[rdd]_{\varrho'}\ar[rd]^\varrho \ar[rr]^\varphi
&& \scrB(\mathscr{H}) \\
& \scrB(\mathscr{K}) \ar[ru]^{\ad_V} \\
& \mathscr{P}' \ar[ruu]|{h'} \ar[r]_{\tilde\varrho}
& \scrB(\tilde{\mathscr{K}}) \ar[uu]_{\ad_{\tilde V}} \ar[lu]|{\ad_S}
}
}

\begin{point}{Proof}%
Let~$\scrP'$ be any von Neumann algebra
    together with nmiu-map~$\varrho'\colon \scrA \to \scrP'$
    and ncp-map~$h'\colon \scrP' \to \scrB(\scrH)$
    such that~$h' \after \varrho' = \varphi$.
We must show that there is a unique
    ncp-map~$\sigma\colon \scrP' \to \scrB(\scrK)$
    with~$\sigma \after \varrho' = \varrho$
    and~$\ad_V \after \sigma = h'$.

\begin{point}{Uniqueness}%
    Let~$\sigma_1,\sigma_2\colon \scrP' \to \scrB(\scrH)$
        be two such ncp-maps.
    Similar to the uniqueness argument in \sref{dils-univ-stinespring}
    we compute
        that for all finite tuples~$(a_i)_i$, $(\alpha_i)_i$ from~$\scrA$;
    $(x_i)_i$, $(y_i)_i$ from~$\scrH$ \emph{and} $c \in \scrP'$
    we have
\begin{align*}
    \bigl< \sigma_k(c)
        \sum_i \varrho(a_i) V x_i,
        \sum_j \varrho(a_j) V x_j \bigr>
    &\ = \ \sum_{i,j}
        \bigl< V^* \varrho(\alpha_j^*) \sigma_k(c) \varrho(a_i) V x_i, y_i
            \bigr> \\
            & \ \stackrel{\mathclap{\sref{dils-univlemma}}}{=} \ \sum_{i,j}
        \bigl< V^* \sigma_k \bigl(\varrho'(\alpha_j^*) c
            \varrho'(a_i)\bigr) V x_i, y_j\bigr> \\
    & \ =\  \sum_{i,j}
            \bigl< h'(\varrho'(\alpha_j^*) c \varrho'(a_i) )x_i, y_j
            \bigr>.
\end{align*}
By definition of minimality of a Stinespring dilation
such $\sum_i \varrho(a_i) Vx_i$
    are norm dense in~$\scrK$
    and so~$\sigma_1(c)=\sigma_2(c)$ as desired.
\end{point}

\begin{point}{Existence}%
Let~$(\tilde\scrK, \tilde\varrho, \tilde V)$
be a minimal normal Stinespring dilation of~$h'$.
The triplet~$(\tilde\scrK, \tilde\varrho \after \varrho', \tilde V)$
is a normal Stinespring dilation of~$\varphi$.
Thus by \sref{dils-univ-stinespring}
    there is a (unique) isometry~$S \colon \scrK \to \tilde\scrK$
    with~$SV = \tilde V$
    and~$\ad_S \after \tilde\varrho \after \varrho' = \varrho$.
Define~$\sigma = \ad_S \after \tilde\varrho$.
Clearly~$\sigma \after \varrho' = \ad_S \after \tilde\varrho \after \varrho'
    = \varrho$
    and~$\ad_V \after \sigma =
        \ad_V \after \ad_S \after \tilde\varrho
        = \ad_{SV} \after \tilde\varrho
        = \ad_{\tilde V} \after \tilde\varrho = h'$
        as desired. \qed
\end{point}
\par
\end{point}

\begin{point}%
The converse holds as well:
    by \sref{paschke-unique-up-to-iso}
    every Paschke dilation of a map~$\varphi \colon \scrA \to \scrB(\scrH)$
    is up to a unique nmiu-isomorphism a minimal Stinespring dilation.
Later we will show that
    every ncp-map~$\varphi\colon \scrA \to \scrB$
    has a Paschke dilation:
    it turns out that Paschke's generalization of
    GNS to Hilbert C$^*$-modules fits the bill.
Before we show this,
    we look at some other examples and basic properties
        of Paschke dilations.
First, Paschke dilations are unique up to a unique nmiu-isomorphism:
\par
\end{point}
\end{point}
\begin{point}[paschke-unique-up-to-iso]{Lemma}%
If $(\scrP_1, \varrho_1, h_1)$
and $(\scrP_2, \varrho_2, h_2)$
    are two Paschke dilations for 
    the same ncp-map $\varphi\colon \scrA \to \scrB$,
    then there is a unique (nmiu)
    isomorphism~$\vartheta \colon \scrP_1 \to \scrP_2$
    with~$\vartheta \after \varrho_1 = \varrho_2$
    and~$h_2 \after \vartheta = h_1$.
\begin{point}{Proof}%
There are unique mediating maps~$\sigma_1\colon \scrP_1 \to \scrP_2$
and~$\sigma_2 \colon \scrP_2 \to \scrP_1$.
It is easy to see~$\sigma_1 \after \sigma_2$
satisfies the same defining property
as the unique mediating map~$\id\colon \scrP_1 \to \scrP_1$
and so~$\sigma_1 \after \sigma_2 = \id$.
Similarly~$\sigma_2 \after \sigma_1 = \id$.
Define~$\vartheta = \sigma_1$.
We just saw~$\vartheta$ is an ncp-isomorphism.
Note~$\vartheta(1) = \vartheta(\varrho_1(1)) = \varrho_2(1) = 1$
and so~$\vartheta$ is unital.
But then by \TODO{} $\vartheta$ is an nmiu-isomorphism. \qed
\par
\end{point}
\end{point}
\begin{point}{Exercise}%
The following can be shown using only the defining universal property.
\begin{enumerate}
\item
Show~$(\scrA,\varrho,\id)$ is a Paschke dilation of
    an nmiu-map~$\varrho\colon \scrA \to \scrB$.
\item
Let~$(\scrP, \varrho, h)$ be any Paschke dilation.
Prove~$(\scrP, \id, h)$ is a Paschke dilation for~$h$.
(Hint: use~$\id\colon \scrP \to \scrP$
is the unique ncp-map with~$\id \after \varrho = \varrho$
and~$h \after \id = h$.)
\item
    Let~$ \left(\begin{smallmatrix} \varphi_1 \\ \varphi_2
    \end{smallmatrix}\right) \colon \scrA \to \scrB_1 \oplus \scrB_2$
    be an ncp-map.
Show~$(\scrP_1 \oplus \scrP_2,
        \left(\begin{smallmatrix} \varrho_1 \\ \varrho_2 \end{smallmatrix}\right),
        h_1 \oplus h_2)$
        is a Paschke dilation of~$\left(\begin{smallmatrix} \varphi_1 \\ \varphi_2 
        \end{smallmatrix}\right)$
    if~$(\scrP_i, \varrho_i, h_i)$
    is a Paschke dilation of~$\varphi_i$ for~$i=1,2$.
\item
Let~$\varphi\colon \scrA \to \scrB$
    be any ncp-map with Paschke dilation~$(\scrP, \varrho, h)$
    and~$\lambda \in \R$ with $\lambda > 0$.
Prove~$(\scrP, \varrho, \lambda h)$
    is a Paschke dilation of~$\lambda \varphi$.
\end{enumerate}
\end{point}
\end{parsec}

\section{Hilbert C$^*$-modules}
\begin{parsec}%
\begin{point}%
Recall that by GNS
    every state (pu-map)~$\omega\colon \scrA \to \C$
    splits as~$h \after \varrho$
    for some nmiu-map~$\varrho\colon \scrA \to \scrB(\scrH)$,
        Hilbert space~$\scrH$
        and vector state~$h (T) =  \left<x, T x\right>$.
It is easy to see~$(\scrH, \varrho, h)$ is a Paschke dilation of~$\omega$.


Paschke showed that GNS can be generalized by replacing the scalars~$\C$
    with an arbitrary von Neumann algebra~$\scrB$:
    every `state'~ncp-map $\varphi\colon \scrA \to \scrB$
    splits as~$h \after \varrho$
    for some nmiu-map~$\varrho\colon \scrA \to \scrB^a (X)$,
    and `vector state' $h(T) = \left<x, Tx\right>$,
    where~$X$ is a self-dual Hilbert C$^*$-module over~$\scrB$, $x \in X$
     and~$\scrB^a(X)$ are the~$\scrB$-linear bounded operators on~$X$.
It turns out~$(\scrB^a(X), \varrho, h)$
    is a Paschke dilation of~$\varphi$.
Before we will prove this
    we first develop the theory of self-dual Hilbert C$^*$-modules.
\end{point}
\begin{point}{Definition}%
    Let~$\scrB$ be a C$^*$-algebra and~$X$
        be a right $\scrB$-module.
        A \Define{$\scrB$-valued inner product} on~$X$
        is a map~$\left<\,\cdot\,,\,\cdot\,\right>\colon X \times X \to \scrB$
        such that
        \begin{enumerate}
            \item $\left<x, \,\cdot\,\right> \colon X \to  \scrB$
                    is~$\scrB$-linear for all~$x \in X$;
            \item $\left<x,y\right>^* = \left<y,x\right>$
                for all~$x,y\in X$ \emph{and}
            \item $\left<x,x\right> \geq 0$ for all~$x \in X$.
        \end{enumerate}
    A $\scrB$-valued inner product is called \Define{definite}
        provided~$x = 0$ whenever~$\left<x,x\right>=0$.
    A \Define{pre-Hilbert $\scrB$-module} $X$
        is a right $\scrB$-module $X$
        together with a definite~$\scrB$-valued inner product.

It will turn out~$\Define{\| x \|} = \| \left<x,x\right> \|^{\frac{1}{2}}$
        defines a norm on a pre-Hilbert~$\scrB$-module $X$.
A \Define{Hilbert $\scrB$-module}
    (also called a Hilbert C$^*$-module over~$\scrB$)
    is a pre-Hilbert~$\scrB$-module
    which is complete in this norm.
\end{point}
\begin{point}{Examples}%
Hilbert $\C$-modules are the same as Hilbert spaces.

Any C$^*$-algebra~$\scrB$ is a Hilbert C$^*$-module over itself
    with $\scrB$-valued inner product~$\left<a,b\right> = a^*b$.
By the C$^*$-identity, the Hilbert~$\scrB$-module
    norm on~$\scrB$ coincides with
    the usual C$^*$-norm.

More generally: if~$J \subseteq \scrB$
    is any right ideal of~$\scrB$,
    then~$J$ is a pre-Hilbert~$\scrB$-module
    with~$\left<a,b\right> = a^*b$.
If~$J$ is norm closed, then~$J$ is a Hilbert~$\scrB$-module.

In particular, the right ideal~$e \scrB$ for projection~$e \in \scrB$
    is a Hilbert~$\scrB$-module with~$\left<ea,eb\right> = a^*eb$.
Later we will see that every so-called self-dual
    Hilbert~$\scrB$-module is build up from such~$e \scrB$
    if~$\scrB$ is a von Neumann algebra.
    
If~$X$ and~$Y$ are (pre-)Hilbert~$\scrB$-modules,
    then its direct sum~$X \oplus Y$
    is a (pre-)Hilbert~$\scrB$-module
    with inner product~$\left<(x,y), (x',y')\right>
                = \left<x,x'\right>+\left<y,y'\right>$.
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}{Definition}%
Let~$X$ be a right~$\scrB$-module with~$\scrB$-valued inner
    product~$\left<\,\cdot\,,\,\cdot\,\right>$.
For any state (pu-map)~$f\colon \scrB \to \C$
    write~$\Define{\left<x,y\right>_f} = f(\left<x,y\right>)$
    and~$\Define{\|x\|_f} = \left<x,x\right>^{\frac{1}{2}}_f$.
This~$\left<\,\cdot\,,\,\cdot\,\right>_f$
    is a complex-valued inner product
    and so~$\|\,\cdot\,\|_f$ is a seminorm.
\end{point}
\begin{point}[module-CS]{Proposition (Cauchy--Schwarz)}%
Let~$X$ be a right~$\scrB$-module
    with~$\scrB$-valued inner product~$\left<\,\cdot\,,\,\cdot\,\right>$
    for some~C$^*$-algebra~$\scrB$.
Then~$\left<x,y\right>\left<y,x\right> \leq \|\left<y,y\right>\| \left<x,x\right>$.
\begin{point}{Proof}%
Let~$f\colon \scrB \to \C$ be any state (pu-map).
Since the states on~$\scrB$ are order separating,
see \sref{states-order-separating},
it suffices to show~$f(\left<x,y\right>\left<y,x\right>)
\leq \|\left<y,y\right>\| f(\left<x,x\right>)$.
If~$f(\left<x,y\right>\left<y,x\right>) = 0$
the inequality holds trivially,
so assume~$f(\left<x,y\right>\left<y,x\right>) \neq 0$.
Using Cauchy--Schwarz for~$\left<\,\cdot\,,\,\cdot\,\right>_f$,
    we derive
\begin{align*}
    f(\left<x,y\right>\left<y,x\right>)^2
        &\  =\  \left<x,y\left<y,x\right>\right>_f^2 \\
        &\  \leq\  \|x\|_f^2 \, \|y \left<y,x\right>\|_f^2 \\
    & \ =\  \|x\|_f^2\, f(\left<x,y\right>\left<y,y\right>\left<y,x\right>)\\
    & \ \leq\  \|x\|_f^2 \,
    \|\left<y,y\right>\| \,
    f(\left<x,y\right>\left<y,x\right>),
\end{align*}
    which yields the inequaltiy by dividing by
$f(\left<x,y\right>\left<y,x\right>)$. \qed
\end{point}
\end{point}
\begin{point}[module-seminorm]{Exercise}
Let~$X$ be a right $\scrB$-module
    with~$\scrB$-valued inner product~$\left<\,\cdot\,,\,\cdot\,\right>$.
First use Cauchy--Schwarz (\sref{module-CS})
    to show~$\|\left<x,y\right>\| \leq \|x\|\|y\|$.
With this, derive $\|x\| =\|\left<x,x\right>\|^{\frac{1}{2}}$ is a seminorm on~$X$ with
    $\|x \cdot b \| \leq \|x\|\|b\|$
    for all~$b \in \scrB$.
\begin{point}%
From this, it follows easily that
that the addition and the module action
are jointly uniformly continuous
    and that the inner product is uniformly continuous in each argument
    separately.
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}{Definition}%
Let~$V$ be a right $\scrB$-module.
A~\Define{$\scrB$-sesquilinear form} on~$V$
    is a map~$B\colon V\times V \to \scrB$
    such that for each~$y\in V$
    the maps~$x \mapsto B(y, x)$
        and~$x \mapsto B(x,y)^*$ are~$\scrB$-linear.
\end{point}
\begin{point}{Example}%
Let~$X$ be a pre-Hilbert~$\scrB$-module.
For every~$\scrB$-linear~$T\colon X \to X$
    the map~$\left<(\,\cdot\,), T (\,\cdot\,)\right>$
    is a~$\scrB$-sesquilinear form.
\end{point}
\begin{point}[hilbmod-polarization]{Exercise}
Let~$B$ be a sesquilinear form.
Show the \Define{polarization identity} holds:
\begin{equation*}
    B(x,y) \ =\  \frac{1}{4} \sum_{k=0}^3 i^k B(i^k x + y, i^k x + y).
\end{equation*}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}{Definition}%
Let~$X,Y$ be pre-Hilbert~$\scrB$-modules.
A linear map~$T\colon X \to Y$
    is said to be \Define{adjointable}
    if there is a linear map~$S \colon Y \to X$
    such that~$\left<y, Tx\right>_Y = \left<Sy, x\right>_X$
    for all~$x \in X$ and~$y \in Y$.
Adjoints are unique:
    if~$S$ and~$S'$ are both adjoints of~$T$
    an easy computation shows~$\left<(S-S')y,(S-S)'y\right>=0$
    for all~$y \in Y$.
We write \Define{$T^*$} for the adjoint of~$T$ (if it exists)
    and~$\Define{\scrB^a(X)}$
    for the subset of bounded operators on~$X$
    which are adjointable.
\end{point}
\begin{point}[adjointable-cstar-identity]{Lemma}%
For a linear map~$T \colon X \to Y$
between pre-Hilbert~$\scrB$-modules~$X$,~$Y$ \emph{and}
real number~$B > 0$
the following are equivalent.
\begin{enumerate}
    \item $\|T x\| \leq B \|x\|$ for all~$x \in X$.
    \item $\|\left<y,Tx\right>\| \leq B \|y\|\|x\|$
            for all~$x \in X$ and~$y \in Y$.
\end{enumerate}
If~$T$ is bounded and adjointable, then 
    ~$\|T^*\| = \|T\|$ and~$\|T^*T\|=\|T\|^2$.
\begin{point}{Proof}%
   Assume~$\|Tx\| \leq B \|x\|$ for~$x \in X$.
   Then by \sref{module-seminorm}
   we find that for all~$y \in X$ we have~$\|\left<y, Tx\right>\|
            \leq \|y\|\|Tx\|
            \leq B \|y\|\|x\|$, as desired.

For the converse, pick~$x\in X$
    and assume~$\|\left<y,Tx\right>\| \leq B \|y\|\|x\|$
            for all~$y \in Y$.
Then~$\|Tx \|^2 = \|\left<Tx,Tx\right>\|
                \leq B\|Tx\|\|x\|$.
So~$\|Tx\| \leq B\|Tx\|\|x\|$
    by dividing~$\|Tx\|$ if~$\|Tx\|\neq0$
    and trivially otherwise.

Now assume~$T$ is adjointable and bounded.
Then~$\|\left<x,T^*y\right>\| = \|\left<y, Tx\right>\| \leq \|T\|\|y\|\|x\|$
    for all~$x \in X$, $y\in Y$
    and so by the previous~$\| T^*\| \leq \|T\|$.
As adjoints are unique and~$T$ is an adjoint of~$T^*$
    we get~$T^{**}=T$
    and so~$\|T\| = \|T^{**}\| \leq \|T^*\| \leq \|T\|$, as desired.

For the final identity, note that for any~$x \in X$ we have
\begin{equation*}
\|Tx\|^2 = \|\left<Tx,Tx\right>\| 
            = \| \left<x, T^*Tx\right>\|
            \leq \|x \| \|T^*Tx \|
            \leq \|x\|^2 \|T^*T\|
\end{equation*}
and so~$\|T\| \leq \|T^*T\|^{\frac{1}{2}}$.
Hence~$\|T\|^2 \leq \|T^*T\| \leq \|T^*\|\|T\| = \|T\|^2$.
    \qed
\end{point}
\end{point}
\begin{point}[hilbmod-cstar]{Proposition}%
Let $X$ be a Hilbert~$\scrB$-module.
With composition as multiplication,
    adjoint as involution
    and operator norm,
     $\scrB^a(X)$ is a C$^*$-algebra.
\begin{point}{Proof}
It is easy to see~$T^*+S^*$ is an adjoint of~$T+S$
    for~$T,S \in \scrB^a(X)$
    and so~$T+S$ is adjointable with~$(T+S)^* = T^*+ S^*$.
    Similarly it is easy to see~$\scrB^a(X)$
        is closed under scalar multiplication, composition and involution
        with~$(\lambda T)^* = \overline{\lambda} T^* $,
            $(TS)^* = S^*T^*$ and
            $T^{**} =T$.
Thus it is a~$*$-algebra.
By \sref{adjointable-cstar-identity} 
    the C$^*$-identity holds.
It only remains to be shown that~$\scrB^a(X)$ is complete.
Let~$T_1,T_2,\ldots$ be a Cauchy sequence in~$\scrB^a(X)$.
As~$X$ is a Banach space $\scrB(X)$ is complete
    and so~$T_n \to T$ for some~$T \in \scrB(X)$.
We have to show~$T$ is adjointable.
For any~$n,m \in \N$ we have~$\|T_n^* - T_m^*\|
= \|(T_n - T_m)^*\| = \|T_n - T_m\|$
and so~$T^*_1, T^*_2,\ldots$
is also Cauchy
and converges to, say, $S \in \scrB(X)$.
So
\begin{equation*}
\left<S x, y\right> =
\langle\lim_{n} T^*_n x, y\rangle = \lim_n \left<T_n^* x, y\right>
                = \lim_n \left<x, T_n y\right>
                =  \left<x, T y\right>,
\end{equation*}
for any~$x \in X$ and~$y \in Y$.
Thus~$S = T^*$ and~$T \in \scrB^a(X)$ as desired. \qed
\end{point}
\end{point}
\begin{point}[hilbmod-ordersep]{Proposition}%
Let~$X$ be a Hilbert~$\scrB$-module.
The vector states on~$\scrB^a(X)$ are order separating;
that is: $T \geq 0$ if and only if~$\left<x,Tx\right> \geq 0$
for all~$x \in X$.
\begin{point}{Proof}%
(Proof from \cite[Lemma 4.1]{lance}.)
Assume~$T \in \scrB^a(X)$ with~$T \geq 0$.
Then~$T = S^*S$ for some~$S \in \scrB^a(X)$
    and so~$\left<x, Tx\right> = \left<Sx,Sx\right> \geq 0$
    for all~$x \in X$.

For the converse, assume~$\left<x, Tx\right> \geq 0$
    for all~$x \in X$.
We claim $T$ is self-adjoint.
By the polarization identity
$\left<x, Ty\right>
    = \frac{1}{4} \sum^3_{k=0} i^k \left< i^k x+y, T(i^k x+y)\right>$,
    see \sref{hilbmod-polarization},
    we have~$\left<x,Ty \right> = \left<Tx, y\right>$ for all~$x,y \in X$
    and so~$T^*=T$.
There are positive~$T_+,T_- \in \scrB^a(X)$
with~$T = T_+ - T_-$ and~$T_+T_- = 0$, see \sref{cstar-pos-neg-part}.
By assumption~$0 \leq \left<T_-x,TT_-x\right>$
    from which~$-\left<x,T_-^3x\right> \geq 0$,
    but~$T_-^3 \geq 0$ so~$T_-^3 = 0$.
    Thus~$T_- = 0$ and so~$T \geq 0$. \qed
\end{point}
\end{point}
\begin{point}{Lemma}%
Let~$T\colon X \to Y$
    be an adjointable linear map between pre-Hilbert $\scrB$-modules~$X,Y$.
Then~$T$ is~$\scrB$-linear.
\begin{point}{Proof}%
We have
    $\left<y, (Tx)b\right>
    =\left<T^*y, x\right>b
    =\left<y, T(xb)\right>$.
for any~$x \in X$, $y \in Y$ and~$b \in \scrB$.
In particular we
get~$\left<(Tx)b-T(xb), (Tx)b-T(xb)\right>=0$
for~$y = (Tx)b-T(xb)$
    and so~$T(x)b=T(xb)$. \qed
\end{point}
\end{point}
\begin{point}[blinear-inprod-inequality]{Proposition}%
Let~$X$ and~$Y$ be right~$\scrB$-modules with~$\scrB$-valued
    inner products.
If~$T \colon X \to Y$ is a bounded~$\scrB$-linear map,
    then $\left<Tx,Tx\right>\leq \|T\|^2 \left<x,x\right>$
    for~$x \in X$.
\begin{point}{Proof}
(The proof is a slight variation on the first part
of \cite[Thm.~2.8]{paschke}.)
Pick~$\varepsilon > 0$.
By \TODO{}
    $\left<x,x\right> + \varepsilon$ is invertible.
Define~$h = (\left<x,x\right> + \varepsilon)^{-\frac{1}{2}}$.
Clearly
\begin{equation*}
0 \ \leq\  \left<xh,xh\right>
    \ =\  h (\left<x,x\right> + \varepsilon)h - h^2 \varepsilon
    \ =\  1 - h^2 \varepsilon \ \leq\  1.
\end{equation*}
Thus~$\|xh\| \leq 1$
and so~$\|h\left<Tx, Tx\right>h\| = \|T(xh)\|^2 \leq \|T\|^2$.
From this and~$0 \leq h\left<Tx,Tx\right>h$
we get~$h\left<Tx,Tx\right>h \leq \|T\|^2$. Hence
\begin{equation*}
\left<Tx,Tx\right> \ \leq \ \|T\| h^{-2}\  =
    \  \|T\|^2(\left<x,x\right> + \varepsilon)
\end{equation*}
for all~$\varepsilon > 0$
and so~$\left<Tx,Tx\right> \leq \|T\|^2 \left<x,x\right>$ as desired. \qed
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}[hilbmod-vectstates-cp]{Proposition}%
Let~$\scrB$ be a von Neumann algebra,
    $X$ be a pre-Hilbert~$\scrB$-module
    and~$x \in X$.
Then the map~$h\colon \scrB^a(X )\to \scrB$
defined by~$h(T) = \left<x,Tx\right>$
is completely positive.
\begin{point}{Proof}%
Pick any~$n \in \N$, ~$T_1, \ldots, T_n \in \scrB^a(X)$
    and~$b_1, \ldots, b_n \in \scrB$
    and compute
\begin{align*}
\sum_{i,j} b_i^* h(T_i^*T_j)b_j
&\ =\ \sum_{i,j} b_i^* \left<x,T_i^*T_j x\right> b_j\\
&\ =\ \sum_{i,j} \left<T_i x b_i,T_j x b_j\right>  \\
&\ =\ \bigl\langle\sum_i T_i x b_i, \sum_i T_i x b_i\bigr\rangle \ \geq\  0,
\end{align*}
which shows~$h$ is indeed completely positive. \qed
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}%
In \sref{prop-complete-into-hilbert-space}
    we saw how to complete a complex vector space with inner product
    to a Hilbert space.
Now we will see how to complete a right-$\scrB$-module
    with $\scrB$-valued inner product
    to a self-dual Hilbert~$\scrB$-module
    under the assumption~$\scrB$ is a von Neumann algebra.
We will use a different construction than Paschke.
He shows that for a pre-Hilbert $\scrB$-module~$X$
    the set of functionals~$X'$
        (i.e.~$\scrB$-module homomorphisms into~$\scrB$)
    turns out to  be a self-dual Hilbert~$\scrB$-module,
    which he uses as the completion of~$X$.
A considerable part of his paper \cite{paschke}
    is devoted to this construction.
It requires Sakai's characterization of von Neumann algebras,
    which we have not covered.
To avoid developing Sakai's theory,
    we give a different construction.
Instead of embedding~$X$ into a dual space,
    we will stay closer to the similar fact for Hilbert spaces
    and use a topological completion.
A simple metric completion will not do,
    we will need to complete $X$ as a \emph{uniform space}.
Uniformities are structures that sit between topological spaces
and metric spaces.
\end{point}
\begin{point}[dils-dfn-uniformity]{Definition}%
    A \Define{uniform space} is a set~$X$
    together with a family of relations
    $\Phi \subseteq \wp (X\times X)$ called \Define{entourages}
        satisfying the following conditions.
    \begin{enumerate}
    \item
        The set of entourages~$\Phi$ is a filter.
        That is:
        \begin{inparaenum}
        \item
        if~$\varepsilon,\delta \in \Phi$,
            then~$\varepsilon \cap \delta \in \Phi$
        \emph{and}
        \item
        if~$\varepsilon \subseteq \delta$ and~$\varepsilon \in \Phi$,
            then~$\varepsilon \in \Phi$.
        \end{inparaenum}
    \item
        For every~$\varepsilon \in \Phi$
            and~$x \in X$ we have~$x \mathrel\varepsilon x$.
    \item
        For each~$\varepsilon \in \Phi$,
            there is a~$\delta \in \Phi$
            such that~$\delta^2 \subseteq \varepsilon$.
        Thus, if~$x \mathrel\delta y$ and~$y \mathrel\delta z$
            then~$x \mathrel\varepsilon z$ for any $x,y,z \in X$.
    \item
        For every~$\varepsilon \in \Phi$,
            there is a~$\delta \in \Phi$
                with~$\delta^{-1}\subseteq \varepsilon$.
        Thus, if~$x \mathrel\delta y$ then~$y \mathrel\varepsilon x$
            for any~$x,y \in X$.
    \end{enumerate}
    A uniform space is \Define{Hausdorff}
        whenever~$x \mathrel\varepsilon y$
            for all~$\varepsilon \in \Phi$
            imlies~$x=y$.
\begin{point}%
The elements of~$X$ are the points of the uniform space.
The entourages~$\varepsilon \in \Phi$
    are generalized distances:
one reads~$x \mathrel\varepsilon y$ as
    `the point $x$ is~$\varepsilon$-close to~$y$'.
With this in mind, the second axiom states every point is arbitrarily close
    to itself.
The third axiom requires that for every entourage~$\varepsilon$
    there is an entourage which acts like~$\nicefrac{\varepsilon}{2}$.
There might be several~$\nicefrac{\varepsilon}{2}$
    which fit the bill.
Whenever we write~$\nicefrac{\varepsilon}{2}$
    we implicitly pick some entourage that
    satisfies~$(\nicefrac{\varepsilon}{2})^2 \subseteq \varepsilon$.
Also we will use the obvious shorthand~$\nicefrac{\varepsilon}{2}
=   \nicefrac{(\nicefrac{\varepsilon}{2})}{2}$.
\end{point}
\end{point}
\begin{point}{Exercise}%
Let~$X$ be a set together with
    a family of relations~$B \subseteq \wp (X \times X)$
    such that it satisfies axioms 2, 3 and 4
    of \sref{dils-dfn-uniformity}.
Write~$\Phi$ for the filter generated by~$B$
    (that is: $\delta \in \Phi$
        iff~$\varepsilon_1 \cap \ldots \cap \varepsilon_n \subseteq \delta$
            for some~$\varepsilon_1, \ldots, \varepsilon_n \in B$).
Show~$(X,\Phi)$ is a uniform space.
We call~$B$ a \Define{subbase} for~$X$.
\end{point}
\begin{point}[dils-uniformity-examples]{Examples}%
Using the previous exercise, it's easy
to describe the entourages of some common uniformities.
    \begin{enumerate}
        \item
    Let~$(X,d)$ be a metric space.
Define~$\hat\varepsilon \equiv \{(x,y);\ d(x,y) \leq \varepsilon\}$
for any $\varepsilon > 0$.
The set~$B \equiv \{ \hat\varepsilon; \ \varepsilon > 0\}$
is a subbase and so fixes a uniformity~$\Phi$ for~$X$.
        \item
    Let~$X$ be a set together with a (infinite)
            family~$(d_{\alpha})_{\alpha\in I}$
        of pseudometrics.
    Define~$E_{\alpha,\varepsilon} = \{ (x,y); \ d_\alpha(x,y)
            \leq \varepsilon\}$.
            Then~$B \equiv \{ E_{\alpha,\varepsilon}; \ \varepsilon > 0, \ 
                    \alpha \in I\}$
                    is a subbase and fixes
                    a uniformity~$\Phi$ on~$X$.
(Every uniform space is of this form, see e.g.~\cite[Thm.~39.11]{willard}.)
\item
Let~$V$ be a vector space with a
    family of seminorms~$(\|\  \|_\alpha)_{\alpha \in I}$.
    (That is: a locally convex space.)
As a special case of the previous,
 $V$ has a uniformity fixed by
    pseudometrics~$d_\alpha(x,y) = \|x-y\|_\alpha$.

\item
Assume~$\scrB$ is a von Neumann algebra.
There are several different uniformities on~$\scrB$ --- two of which
    are of particular interest to us.
The \Define{ultrastrong uniformity} on~$\scrB$
    is fixed by the seminorms~$\|x\|_f = f(x^*x)$
        where~$f\colon \scrB \to \C$ is an np-map.
The \Define{ultraweak uniformity} on~$\scrB$
    is given by the seminorms~$|f(x)|$
        for np-maps~$f\colon \scrB \to \C$.

    \end{enumerate}
\begin{point}%
We are ready to define a uniformity for Hilbert $\scrB$-modules.
\end{point}
\end{point}
\begin{point}[dils-ultranorm]{Definition}%
Let~$\scrB$ be a von Neumann algebra.
Assume~$X$ is a right $\scrB$-module
    with~$\scrB$-valued inner product~$[\,\cdot\,,\,\cdot\,]$.
We call the uniformity on~$X$
    given by seminorms~$\|x\|_f = f([x,x])^{\frac{1}{2}}$
    for np-maps~$f\colon \scrB \to \C$
    the \Define{ultranorm uniformity}.
\begin{point}%
The ultranorm uniformity will play a very similar r\^ole
    to the norm for Hilbert spaces.
If~$\scrB=\C$, then the ultranorm uniformity is
    the same as the uniformity induced by the norm.
If~$X=\scrB$ with~$[a,b]=a^*b$,
    then the ultranorm uniformity coincides with the ultrastrong uniformity.
\end{point}
\begin{point}{Beware}%
    The ultranorm uniformity is (in general) not given by a single norm.
    Furthermore the ultranorm uniformity is weaker than the norm uniformity,
        even though on von Neumann algebras the ultraweak uniformity
        is stronger than the weak uniformity.
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}{Definition}%
Let~$X$ be a uniform space with entourages~$\Phi$.
It is easy to translate the familiar notions for
    metric spaces to uniform spaces.
\begin{enumerate}
    \item A net~$(x_\alpha)_\alpha$ is said to
            \Define{converge} to~$x$
            if for each~$\varepsilon \in \Phi$
            there is an~$\alpha_0$
            such that for all~$\alpha > \alpha_0$
                we have~$x \mathrel\varepsilon x_\alpha$.
Note that a net can converge to two different points.
Indeed, if we start of with a non-trivial pseudometric,
this will be the case.
\item A net~$(x_\alpha)_\alpha$ is called \Define{Cauchy}
        if for each~$\varepsilon \in \Phi$
            there is an~$\alpha_0$
            such that for all~$\alpha,\beta > \alpha_0$
            we have~$x_\alpha \mathrel\varepsilon x_\beta$.
The uniform space $X$ is \Define{complete}
    when every Cauchy net converges.
\item
Let~$(Y,\Psi)$ be another uniform space.
A map~$f\colon X \to X'$
is said to be \Define{uniformly continuous}
if for each~$\varepsilon \in \Psi$
there is a~$\delta \in \Phi$
such that for all~$x \mathrel\delta y$
we have~$f(x) \mathrel\varepsilon f(y)$.
The map~$f$ is merely \Define{continuous}
if for each~$x$ and~$\varepsilon\in\Psi$,
there is a~$\delta \in \Phi$
such that for all~$x \mathrel{\delta} y$
we know~$f(x) \mathrel\varepsilon f(y)$.
\item
We say two Cauchy nets
$(x_\alpha)_{\alpha\in I}$
and$(y_\beta)_{\beta\in J}$ are \Define{equivalent},
in symbols: $(x_\alpha)_\alpha \sim (y_\beta)_\beta$,
when for every~$\varepsilon \in \Phi$
there are~$\alpha_0 \in I$ and~$\beta_0 \in J$
such that for all~$\alpha \leq \alpha_0$ and~$\beta \leq \beta_0$
we have~$x_\alpha \mathrel\varepsilon x_\beta$.

\item
A subset~$D \subseteq X$ is said to be \Define{dense}
    if for each~$\varepsilon \in \Phi$ and~$x \in X$,
    there is a~$y \in D$
    with~$x \mathrel\varepsilon y$.
\end{enumerate}
\end{point}
\begin{point}[dils-uniform-spaces-basics]{Exercise}%
    In the same setting as the previous definition.
    \begin{enumerate}
\item
    Show that equivalence of Cauchy nets is an equivalence relation.
    Show that if~$(x_\alpha)_\alpha$ is a subnet of~$(y_\alpha)_\alpha$,
        that~$(x_\alpha)_\alpha$ is equivalent to~$(y_\alpha)_\alpha$.
\item
    Prove that if~$(x_\alpha)_\alpha$ and~$(y_\alpha)_\alpha$
        are equivalent Cauchy nets and~$x_\alpha \to x$,
        then also~$y_\alpha \to x$.
\item
    Assume~$(x_\alpha)_\alpha$ is a Cauchy net with~$x_\alpha \to x$
        and~$x_\alpha \to y$.  Prove~$x = y$ whenever~$X$ is Hausdorff.
\item\label{ex-continuous-preserves-lims}
    Show that if~$f\colon X \to Y$ is a continuous
    between uniform spaces
        and we have~$x_\alpha \to x$ in~$X$,
        then~$f(x_\alpha) \to f(x)$ in~$Y$.
\item
    Assume~$f$ is a uniformly continuous map between uniform spaces.
    Show that $f$ maps Cauchy nets to Cauchy nets
    and furthermore that~$f$ maps equivalent Cauchy nets to equivalent
        Cauchy nets.
\item\label{ex-cauchy-from-dense-subset}
    Suppose~$D \subseteq X$ is a dense subset.
    Show that for each~$x \in X$
    there is a Cauchy net~$(d_\alpha)_{\alpha \in \Phi}$
    in~$D$ with~$d_\alpha \to x$ in~$X$.
\item
    Assume~$f,g\colon X \to Y$ are continuous maps between uniform spaces
        where~$Y$ is Hausdorff.
Conclude from \ref{ex-continuous-preserves-lims} and
    \ref{ex-cauchy-from-dense-subset}
    that~$f=g$ whenever they agree on a dense subset of~$X$.
    \end{enumerate}
\end{point}
\begin{point}[dils-product-uniformity]{Exercise}%
    Let~$(X_i)_{i \in I}$ be a family of sets with
        uniformities~$(\Phi_i)_{i \in I}$.
    For each~$i_0 \in I$
    and~$\varepsilon \in \Phi_{i_0}$,
    define a relation on
    $\Pi_{i \in I} X_i$ by
    $(x_i)_{i \in I} \mathrel{\hat\varepsilon} (y_i)_{i \in I}
    \iff x_{i_0} \mathrel\varepsilon y_{i_0}$.
    Show~$\{ \hat\varepsilon;\ \varepsilon \in \Phi_i, \ i\in I \}$
    is a subbase for $\Pi_{i \in I} X_i$;
    that the projections~$\pi_i \colon \Pi_{i \in I} X_i \to X_i$
    are uniformly continuous with respect to them
    \emph{and} that they make~$\Pi_{i \in I} X_i$
    into the product of~$(X_i)_{i \in I}$
    in the category of uniform spaces with uniformly continuous maps.
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}[blinear-bounded-is-ultranorm]{Proposition}%
Let~$X$ and~$Y$ be right $\scrB$-modules
    with~$\scrB$-valued inner products.
A bounded $\scrB$-linear map~$T\colon X \to Y$
    is ultranorm uniformly continuous.
\begin{point}{Proof}%
Let~$f\colon \scrB \to \C$ be an np-map
    and~$\varepsilon > 0$.
Assume~$\|x-y\|_f \leq \frac{\varepsilon}{\|T\|}$.
By \sref{blinear-inprod-inequality}
we have~$\left<T(x-y), T(x-y)\right> \leq \|T\|^2\left<x-y,x-y\right>$
and so
\begin{equation*}
    \|Tx - Ty\|_f \  =\  f(\left<T(x-y),T(x-y)\right>)^{\frac{1}{2}}
\ \leq\  \|T\| \|x-y\|_f \leq \varepsilon.
\end{equation*}
Thus~$T$ is uniformly continuous in the ultranorm uniformity. \qed
\end{point}
\end{point}
\begin{point}[ultranormcontstruct]{Corollary}%
Let~$\scrB$ be a von Neumann algebra
    and~$X$ a right~$\scrB$-module
    with~$\scrB$-valued inner product.
For~$x_0 \in X$ the maps
\begin{align*}
    (x,y) &\mapsto x+y & x &\mapsto \left<x_0, x\right>
    & b &\mapsto x_0 b \\
    X\times X &\to X & X &\to \scrB & \scrB & \to X
\end{align*}
are all uniformly continuous in the ultranorm uniformity.
\end{point}
\begin{point}[innerprod-ultraweak]{Proposition}%
Let~$X$ be a right~$\scrB$-module
    with~$\scrB$-valued inner product~$[\,\cdot\,,\,\cdot\,]$
    for some von Neumann algebra~$\scrB$.
If~$x_\alpha \to x$ and~$y_\alpha \to y$
    in the ultranorm uniformity,
    then~$[x_\alpha,y_\alpha] \to [x,y]$ ultraweakly.
\begin{point}{Proof}%
Let~$\varepsilon > 0$ and np-map~$f\colon \scrB \to \C$ be given.
Note~$\|y_\alpha\|_f \to \|y\|_f$;
    indeed by the reverse triangle inequaliy 
    $|\|y_\alpha\|_f - \|y\|_f| \leq \| y_\alpha - y\|_f \to 0$.
Thus we can find~$\alpha_1$ such that~$\|y_\alpha\|_f \leq \|y\|_f + 1$
    for~$\alpha \geq \alpha_1$.

We can find~$\alpha_2$
    such that for all~$\alpha \geq \alpha_2$
    we have $\|x-x_\alpha\|_f \leq \frac{1}{2}\varepsilon (\|y\|_f + 1)^{-1}$
    and
    $\|y-y_\alpha\|_f \leq \frac{1}{2}\varepsilon (\|x\|_f + 1)^{-1}$.
Pick~$\alpha_0 \geq \alpha_1,\alpha_2$.
Then for~$\alpha \geq \alpha_0$ we have
\begin{align*}
    |f([x_\alpha,y_\alpha] - [x,y])| 
    & \ = \ |[x_\alpha - x, y_\alpha]_f + [x,y_\alpha - y]_f| \\
    & \ \leq \ 
         \|x_\alpha - x\|_f \| y_\alpha\|_f + \|x\|_f\|y_\alpha - y\|_f
                && \text{ by \sref{module-CS}}\\
    & \ \leq \ 
         \|x_\alpha - x\|_f (\|y\|_f+1) + (\|x\|_f+1)\|y_\alpha - y\|_f \\
    & \ \leq \ 
         \varepsilon.
\end{align*}
Thus~$[x_\alpha,y_\alpha] \to [x,y]$ ultraweakly. \qed
\end{point}
\end{point}
\begin{point}[hilbmod-denseordersep]{Corollary}%
Let~$X$ be a Hilbert~$\scrB$-module
    together with an ultranorm dense subset~$D \subseteq X$.
Vector states from~$D$ are order separating:
for each~$T \in \scrB^a(X)$ we have
$T \geq 0$ if and only if~$\left<x,Tx\right> \geq 0$
for all~$x \in D$.
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}[dfn-selfdual-basis]{Definition}
    Let~$X$ be pre-Hilbert $\scrB$-module
        for a von Neumann algebra~$\scrB$.
    Let~$E \subseteq X$ be some subset.
    \begin{enumerate}
        \item $E$ is \Define{orthogonal} if~$\left<e,d\right> = 0$
            for~$e,d \in E$ with~$e \neq d$.
        \item $E$ is \Define{orthonormal} if additionally
                    $\left<e,e\right>$ is a non-zero projection
                    for~$e \in E$.
        \item We say a sequence $(b)_{e \in E}$ in~$\scrB$
                is \Define{$\ell^2$-summable}
                if the partial sums of~$\sum_{e \in E} b_e^*b_e$
                are bounded.
        \item $E$ is an \Define{(orthonormal) basis} if
                it is orthonormal and additionally
            \begin{enumerate}
                \item for each~$x \in X$ we have
                    \begin{equation*}
                        x = \sum_{e \in E} e\left<e,x\right>,
                    \end{equation*}
                    where the sum converges in the ultranorm uniformity
                    \emph{and}
                \item  the sum~$\sum_{e \in E} b_e$
                        converges in the ultranorm uniformity
                    for any~$\ell^2$-summable $(b_e)_{e \in E}$
                        in~$\scrB$.
            \end{enumerate}
    \end{enumerate}
\end{point}
\begin{point}[dils-selfdual]{Theorem}%
    Assume~$\scrB$ is a von Neumann algebra.
    For any pre-Hilbert~$\scrB$-module~$X$,
        the following conditions are equivalent.
        \begin{enumerate}
            \item $X$ is \Define{self dual} ---
                that is: for each~$\scrB$-linear~$\tau\colon X \to \scrB$
                there is an~$t \in X$ such that~$\tau(x) = \left<t,x\right>$
                    for all~$x \in X$.
            \item $X$ is ultranorm complete.
            \item Every norm-bounded ultranorm-Cauchy net in~$X$ converges.
            \item $X$ has an orthonormal basis.
        \end{enumerate}
\begin{point}{Proof}%
We will prove $1 \Rightarrow 3 \Rightarrow 4 \Rightarrow 2 \Rightarrow 4 \Rightarrow 1$.
The equivalence~$1 \Leftrightarrow 4$
    was already shown by Paschke in \cite[Thm.~3.12]{paschke},
    but we give a different proof. The other equivalences are new.
\begin{point}{1 $\Rightarrow$ 3, self-dual~$X$ are bounded complete}%
    Assume~$X$ is self-dual and~$(x_\alpha)_\alpha$
        is a norm-bounded ultranorm-Cauchy net.
     For the moment pick an~$y \in X$.
By \sref{module-CS} we
    have~$f(\left<x_\alpha,y\right>\left<y,x_\alpha\right>) \leq \|y\|^2
        f(\left<x_\alpha,x_\alpha\right>)$ for any~np-map~$f\colon \scrB \to \C$
        and so~$\left<y,x_\alpha\right>$ is an ultrastrong-Cauchy net in~$\scrB$.
Von Neumann algebras are ultrastrongly complete, see \sref{vn-complete},
so we may define~$\tau(y) = (\uslim_\alpha \left<y, x_\alpha\right>)^*$.
As addition and multiplication by a fixed element
are ultrastrongly continuous (see \sref{mult-uws-cont})
    $\tau$ is~$\scrB$-linear.
We will show~$\tau$ is bounded.
Let~$f\colon \scrB \to \C$ be an np-map.
\TODO{$\tau$ bounded}.
Thus~$\tau$ is bounded.
By self-duality, there is a~$t \in X$ such that~$\tau(y) = \left<t,y\right>$
for all~$y \in X$.
And so for each np-map~$f\colon \scrB \to \C$ we have
\begin{equation*}
    \|\left<y, t-x_\alpha\right>\|_f=
    \|\left<y, t\right>-\left<y,x_\alpha\right>\|_f=
    \|\tau(y)^*-\left<y,x_\alpha\right>\|_f \rightarrow 0.
\end{equation*}
Write~$\left<x,y\right>_f=f(\left<x,y\right>)$.
As~$f$ is positive $\left<\,\cdot\,,\,\cdot\,\right>_f$ is an inner product.
From Kadison's inequality \sref{omega-norm-basic}
it follows~$|f(a)|^2 \leq f(a^*a)f(1)$
and so
\begin{equation*}
    |\left<y,t-x_\alpha\right>_f|^2
    \leq f( \left<t-x_\alpha,y\right> \left<y,t-x_\alpha\right>) f(1)
    = \| \left<y,t-x_\alpha\right> \|_f^2 f(1).
\end{equation*}
Combining both, we see~$|\left<y,t-x_\alpha\right>_f| \rightarrow 0$.
Let~$\varepsilon > 0$ be given.
As~$\|x_\alpha\|_f$ is norm bounded
we can find~$B > 0$ such that~$\|x_\alpha\|_f \leq B$
for all~$\alpha$.
As~$(x_\alpha)_\alpha$ is ultranorm Cauchy,
we can pick~$\alpha$ such that~$\|x_\beta - x_\alpha\|_f \leq (\|t\|_f + B)^{-1}
\frac{\varepsilon}{2}$ for all~$\beta \geq \alpha$.
Find~$\beta$ such that~$|\left<t-x_\alpha,t-x_\beta\right>_f|
    \leq \frac{\varepsilon}{2}$.
Putting it all together:
\begin{align*}
    \left<t-x_\alpha,t-x_\alpha\right>_f
    & \leq |\left<t-x_\alpha,t-x_\beta\right>_f|
    + |\left<t-x_\alpha,x_\beta-x_\alpha\right>_f| \\
    & \leq \frac{\varepsilon}{2}
    + \| t- x_\alpha \|_f \|x_\beta - x_\alpha\|_f\\
    & \leq \frac{\varepsilon}{2}
    + (\| t\|_f + B) \|x_\beta - x_\alpha\|_f \leq \varepsilon.
\end{align*}
Thus~$x_\alpha$ converges ultranorm to~$t$.
So~$X$ is ultranorm bounded complete.
\end{point}
\begin{point}[selfdual-bcompl-then-basis]{3
    $\Rightarrow$ 4, bounded complete~$X$ has an orthonormal basis}
    Assume norm-bounded ultranorm-Cauchy nets converge in~$X$.
By Zorn's lemma there is a maximal subset~$E \subseteq X$
    with the property that~$\left<e,e\right>$ is a non-zero projection
    for all~$e\in E$
    and~$\left<e,d\right>=0$ whenever~$e,d \in E$ with~$e \neq d$.

Assume~$(b_e)_{e \in E}$ is an~$E$-tuple in~$\scrB$
such that the partials sums of~$\sum_{e \in E} b_e^*b_e$ are bounded.
We want to show~$\sum_{e \in E} e b_e$ converges in the ultranorm
    uniformity.
As the summands of~$\sum_{e \in E}b_e^*b_e$ are positive,
    the partial sums form a directed bounded net
    that converges ultrastrongly
    to its supremum~$\sum_{e \in E} b_e^*b_e$.
Note that for each~$e \in E$
we have
$\left<e-e\left<e,e\right>,e-e\left<e,e\right>\right> = 0$
and so~$e \left<e,e\right> = e$
and~$\left<x,e\right>\left<e,e\right> = \left<x,e\right>$
for every~$x \in X$.
Thus for any finite subset~$S \subseteq E$
we have
\begin{equation*}
    \Bigl<\sum_{e \in S} eb_e, \sum_{e \in S} eb_e\Bigr>
    = \sum_{e \in S} b_e^* \left<e,e\right>b_e \leq \sum_{e \in S} b_e^*b_e.
\end{equation*}
As~$\sum_{e \in E} b^*_eb_e$ converges ultraweakly,
we have~$\sum_{e \in E} f(b^*_eb_e) < \infty$.
Thus the tails~$\sum_{e \in E - S} f(b_e^*b_e)$ tend to zero, hence for finite~$S,T\subseteq E$ we know
\begin{equation*}
    \bigl\| \sum_{e \in S} eb_e - \sum_{e\in T} eb_e \bigr\|_f^2
        = \bigl\| \sum_{e \in S\Delta T} eb_e  \bigr\|_f^2
        \leq \sum_{e \in S\Delta T} f(b_e^*b_e)
\end{equation*}
vanishes as~$S \cap T$ grows.
Thus the partial sums of ~$\sum_{e \in E} eb_e$ are ultranorm Cauchy
and norm-bounded by~$\| \sum_{e \in E} b_e^*b_e \|$,
so~$\sum_{e \in E} eb_e$ converges in the ultranorm uniformity.

Pick~$x \in X$.
We have to show~$\sum_{e \in E} x\left<e,x\right>$
converges in the ultranorm uniformity to~$x$.
For any finite subset~$S \subseteq E$ we have
\begin{equation*}
    0 \leq \Bigl< x - \sum_{e \in S} e\left<e,x\right>,
        x - \sum_{e \in S} e\left<e,x\right> \Bigr>
        = \left<x,x\right> - \sum_{e \in S} \left<x,e\right>\left<e,x\right>.
\end{equation*}
Rearranging we find Bessel's inequality:
$ \sum_{e \in S} \left<x,e\right>\left<e,x\right>
    \leq \left<x,x\right>$.
Hence the $E$-tuple~$(\left<e,x\right>)_e$
is a $\ell^2$-summable
and so~$\sum_{e \in E} e \left<e,x\right>$
converges in the ultranorm uniformity.
Consider~$x' = x - \sum_{e \in E} e\left<e,x\right>$.
We are done if we can show~$x' = 0$.

To see~$x'=0$, we
first show that~$X$ has polar decomposition:
    for each~$y \in X$ there is an~$u\in X$
    with~$\left<u,u\right> = \ceil{\left<y,y\right>}$
        and~$y=u\left<y,y\right>^{\frac{1}{2}}$.
Let~$e_1, e_2, \ldots$ be orthogonal projections in~$\scrB$ \TODO{ref}
    such that~$\sum_n e_n = \ceil{\left<y,y\right>}$
    and~$e_n \leq n\left<y,y\right>^{\frac{1}{2}}$.
    Clearly $e_n \left<y,y\right>^{\frac{1}{2}}$ is invertible
        in~$e_n \scrB e_n$.
    Thus there is an~$h_n \in \scrB$
        such that $h_n \left<y,y\right>^{\frac{1}{2}} =
             \left<y,y\right>^{\frac{1}{2}} h_n = e_n$.
Then
\begin{equation*}
    \left<yh_n,yh_m\right> =
        (h_n \left<y,y\right>^{\frac{1}{2}})
        (\left<y,y\right>^{\frac{1}{2}} h_m) = e_ne_m.
\end{equation*}
So~$\left< \sum_{n=1}^N y h_n, \sum_{n=1}^N y h_n \right> 
        = \sum_{n=1}^N e_n \leq \ceil{\left<y,y\right>}$.
Thus~$( \sum_{n=1}^N y h_n)_N$ form an ultranorm-Cauchy net
    norm bounded by~$1$.
By assumption this bounded net converges:
    write~$u = \sum_n yh_n$.
We derive \TODO{computation rules and~$\left<u,u\right>$}
\begin{equation*}
u \left<y,y\right>^{\frac{1}{2}}
= \sum_n yh_n \left<y,y\right>^{\frac{1}{2}}
= \sum_n y e_n
= \unlim_n y (e_1 + \cdots + e_n)
= y \ceil{\left<y,y\right>}
= y.
\end{equation*}

Recall we want to
show~$x' \equiv x - \sum_{e \in E} e\left<e,x\right>= 0$.
Reasoning towards contradiction, assume~$x' \neq 0$.
By polar decomposition~$x' = u\left<x',x'\right>^{\frac{1}{2}}$
for some~$u \in X$ with~$\left<u,u\right> = \ceil{\left<x',x'\right>}$,
which is a non-zero projection.
Note that by \TODO{} $\left<e,x'\right> =0$
for all~$e \in E$.
Thus~\TODO{} $\left<e,u\right> = 0$.
So~$u$ contradicts the maximality of~$E$.
Hence~$x'=0$. Thus~$x = \sum_{e \in E} e\left<e,x\right>$ as desired.
\end{point}
\begin{point}{4 $\Rightarrow$ 2, basis implies completeness}%
    Assume~$X$ has an orthonormal basis~$E$.
    Let~$(x_\alpha)_\alpha$ be an ultranorm-Cauchy net.
    Pick~$e \in E$.
    By \sref{ultranormcontstruct}
    $(\left<e, x_\alpha\right>)_\alpha$ is an ultrastrong-Cauchy net.
    As von Neumann algebras are ultrastrongly complete
    (see \sref{vn-complete})
        there is a~$b_e \in \scrB$
            to which~$\left<e,x_\alpha\right>$ converges ultrastrongly.
    We will show~$x_\alpha$ converges in the ultranorm uniformity
        to~$\sum_{e \in E} e b_e$.

    First we will show~$\sum_{e \in E} e b_e$ converges to
        begin with.
    As ultraweakly-bounded nets are norm bounded,
    see \sref{ultraweakly-bounded-implies-bounded},
        it is sufficient to show~$\sum_{e\in E} f( b_e^*b_e ) $ is bounded
        for each np-map~$f\colon \scrB \to \C$.
    For any~$e \in E$
    we have~$\|b_e\|_f = \lim_\alpha \|\left<e,x_\alpha\right>\|_f$
    and so~$f(b_e^*b_e) =\lim_\alpha f(\left<x_\alpha,e\right> \left<e, x_\alpha\right>)$.
    Pick a finite subset~$S \subseteq E$. Then we have
 \begin{align*}
    f\bigl(\sum_{e \in S} b_e^*b_e\bigr)
    &= \sum_{e \in S} \lim_\alpha 
     f(\left<x_\alpha,e\right> \left<e, x_\alpha\right>) \\
     & = \lim_\alpha 
            f\bigl(\sum_{e \in S}\left<x_\alpha,e\right>
                \left<e, x_\alpha\right>\bigr) \\
            &\leq f(\left<x_\alpha,x_\alpha\right>).
 \end{align*}
As~$x_\alpha$ is ultranorm Cauchy,
the sequence~$f(\left<x_\alpha,x_\alpha\right>)$
    must be Cauchy and so bounded.
Hence~$\sum_{e \in E} e b_e$ converges in the ultranorm uniformity.

To prove~$x_\alpha$ converges to~$\sum_{e \in E} e b_e$,
    pick any~$\varepsilon > 0$
        and np-map $f\colon \scrB \to \C$.
We want to find~$\alpha_0$
    such that~$\| x_\alpha - \sum_{e \in E} e b_e\|_f \leq \varepsilon$
        for all~$\alpha \geq \alpha_0$.
As~$(x_\alpha)_\alpha$ is ultranorm Cauchy,
we can pick an~$\alpha_0$
such that~$\| x_\alpha - x_\beta \|_f \leq \frac{1}{2\sqrt{2}} \varepsilon$
for all~$\alpha,\beta \geq \alpha_0$.
As~$x_\alpha = \sum_{e \in E} e \left<e,x_\alpha\right>$
we find with Parseval's identity
\begin{equation*}
    \bigl\| x_\alpha - \sum_{e \in E} eb_e \bigr\|_f^2
    = \bigl\| \sum_{e \in E} e(\left<e, x_\alpha\right> - b_e) \bigr\|_f^2
    = \sum_{e \in E}\| \left<e, x_\alpha\right> - b_e \|_f^2.
\end{equation*}
Take a finite subset~$S \subseteq E$
such that
    $\sum_{e \in E - S}\| \left<e, x_\alpha\right> - b_e \|_f^2 \leq
        \frac{1}{2}\varepsilon^2$.
If we can also show
    $\sum_{e \in  S}\| \left<e, x_\alpha\right> - b_e \|_f^2 \leq
        \frac{1}{2}\varepsilon^2$,
        then we are done.
For any~$\beta \geq \alpha$
    we have using the triangle inequality of~$\|\,\cdot\,\|_f$
        on~$X$
\begin{align*}
    \Bigl(\sum_{e \in S}\| \left<e, x_\alpha\right>
        - b_e \|_f^2\Bigr)^{\frac{1}{2}}
        &= \bigl\|\sum_{e \in S} e\left<e, x_\alpha\right> - eb_e \bigr\|_f\\
        &\leq \bigl\|\sum_{e \in S} e\left<e, x_\alpha-x_\beta\right> \bigr\|_f\
        +\bigl\|\sum_{e \in S} e\left<e, x_\beta\right> - eb_e \bigr\|_f\\
        &= \Bigl( \sum_{e \in S}\|\left<e, x_\alpha-x_\beta\right> \|_f^2 \Bigr)^{\frac{1}{2}}
        +\Bigl(\sum_{e \in S}\| \left<e, x_\beta\right> - b_e \|_f^2
        \Bigr)^{\frac{1}{2}}.
\end{align*}
We want to show the previous is bounded by~$\frac{1}{\sqrt{2}}\varepsilon$.
We bound the two terms separately.
For the first term using Bessel's
inequality and our choice of~$\alpha_0$
we have
$\sum_{e \in S}\|\left<e, x_\alpha-x_\beta\right> \|_f^2 
\leq \|x_\alpha - x_\beta\|^2_f \leq \bigl(\frac{1}{2\sqrt{2}}\varepsilon\bigr)^2.$
As~$\|\left<e,x_\beta\right> - b_e\|_f$
vanishes for each~$e \in S$ and~$S$ is finite,
we can find sufficiently large~$\beta$
such that the right term is also bounded by~$\frac{1}{2\sqrt{2}}\varepsilon$.
Thus~$x_\alpha$ converges in the ultranorm uniformity
to~$\sum_{e \in E} e b_e$, as desired.
\end{point}
\begin{point}{2 $\Rightarrow$ 4, completeness implies basis}%
    Follows from~3 $\Rightarrow$ 4.
\end{point}
\begin{point}{4 $\Rightarrow$ 1, basis implies self-duality}%
    Assume~$X$ has an orthonormal basis~$E$.
    Suppose~$\tau\colon X \to \scrB$ is a bounded $\scrB$-linear map.
    We want to show there is some~$t \in X$
    such that~$\tau(x) = \left<t,x\right>$ for all~$x \in X$.
    Pick any~$x \in X$.
    By assumption~$\sum_{e \in E} e  \left<e,x\right>$
        converges in the ultranorm uniformity to~$x$.
As by \sref{blinear-bounded-is-ultranorm} $\tau$ is ultranorm continuous
        we see
        \begin{equation*}
            \tau(x) = \sum_{e \in E} \tau(e) \left<e,x\right>
                = \sum_{e \in E} \left<e \tau(e)^*,x\right>.
        \end{equation*}
    Thus if we can show~$\sum_e e \tau(e)^*$ converges in the ultranorm,
        we are done. By assumption this is
            the case if~$(\tau(e)^*)_{e \in E} $ is $\ell^2$-summable
            --- that is: the partial sums of~$\sum_{e \in E} \tau(e)\tau(e)^*$
                must be bounded.
        We will show
        that for finite~$S \subseteq E$
        we have
        $\|\sum_{e \in S} e \tau(e)^* \|\leq \|\tau\|$,
        which is sufficient as then~$ \| \sum_{e \in S}  \tau(e)\tau(e)^* \|
        =\|\sum_{e \in S} e \tau(e)^* \|^2  \leq \|\tau\|^2$.
For the moment pick an arbitrary~$x \in X$.
By Bessel's inequality
we have~$
\| \sum_{e\in S} e \left<e,x\right>\|^2
    = \sum_{e\in S} \|\left<x,e\right>\left<e,x\right>\|
    \leq \|x\|^2$.
Thus
    \begin{equation*}
        \bigl\|\bigl< \sum_{e \in S} e \tau(e)^*,x\bigr>\bigr\|
        = \bigl\| \tau \bigl(\sum_{e \in S} e\left<e,x\right>\bigr) \bigr\|
        \leq \|\tau\| \|x\|.
    \end{equation*}
Substituting~$x = \sum_{e \in S} e \tau(e)^*$ we find
\begin{equation*}
    \| \sum_{e\in S}e \tau(e)^*\|^2 =
    \bigl\|\bigl< \sum_{e \in S} e \tau(e)^*,\sum_{e \in S} e\tau(e)^*\bigr>\bigr\|
    \leq \|\tau\| \bigl\| \sum_{e\in S}e \tau(e)^*\bigr\|.
\end{equation*}
If~$ \| \sum_{e\in S}e \tau(e)^*\| = 0$,
then we are done.
Otherwise, divide both sides of the previous equation
by~$ \| \sum_{e\in S}e \tau(e)^*\|$
to find~$ \| \sum_{e\in S}e \tau(e)^*\| \leq \|\tau\|$ as desired. \qed
\end{point}
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}%
We continue with a generalization of
\sref{prop-complete-into-hilbert-space}
to~Hilbert C$^*$-modules,

\end{point}
\begin{point}[dils-completion]{Theorem}%
Let~$\scrB$ be a von Neumann algebra
and~$V$ a right~$\scrB$-module with~$\scrB$-valued
    inner product~$[\,\cdot\,,\,\cdot\,]$.
There is a self-dual Hilbert $\scrB$-module~$X$
    together with a bounded~$\scrB$-linear~$\eta\colon V \to X$
    such that \begin{inparaenum}
    \item $[v,w] = \left<\eta (v),\eta(w)\right>$
    and \item the image of~$\eta$ is ultranorm dense in~$X$.
    \end{inparaenum}
\begin{point}{Proof}%
Before we start the proof proper,
    we give an overview.
\begin{point}{Overview}
By~\sref{dils-selfdual} and~\sref{innerprod-ultraweak}
    one would expect that
    one can simply extend the inner product of~$V$
    to its ultranorm completion~$\overline{V}$
    by
    \begin{equation}
        [(x_\alpha)_\alpha, (y_\alpha)_\alpha] \ =\  \uwlim_\alpha [x_\alpha,y_\alpha], \label{eq-definition-inprod-on-completion}
    \end{equation}
    which will turn $\overline{V}$ into a self-dual Hilbert~$\scrB$-module.
It will turn out that~$\overline{V}$
    is indeed a self-dual Hilbert $\scrB$-module
    with this inner product,
    but it isn't clear at all  how to show directly that the ultraweak limit
    in \eqref{eq-definition-inprod-on-completion} converges.

We will sketch the indirect construction,
    before delving into the details.
As with a metric completion,
    $\overline{V}$ consists of equivalence classes of Cauchy nets in~$V$.
Let~$V_0\subseteq \overline{V}$
    denote the equivalence classes of constant Cauchy nets.
$V_0$ is a right-$\scrB$-module with~$\scrB$-valued inner product
    using the operations of~$V$.
Let~$V_1\subseteq \overline{V}$ denote
    the limits of norm-bounded Cauchy nets over~$V_0$.
Using the norm boundedness we can extend
    the module structure and inner product of~$V_0$ to~$V_1$.
If all norm-bounded Cauchy-nets over~$V_1$ would
    converge in~$V_1$,
    then~$V_1$ would be a self-dual Hilbert~$\scrB$-module
    and~$V_1$ would even be ultranorm complete.
Unfortunately it's also not clear if~$V_1$ is ultranorm complete.
Instead, we repeat: let~$V_2 \subseteq \overline{V}$
    denote the limits of norm-bounded Cauchy nets over~$V_1$.
We have to go further:
    for any~$n \in \N$
    define~$V_{n+1} = \sigma(V_n)$
    where $\sigma(U)\subseteq \overline{V}$
    denotes the limits of norm-bounded Cauchy over~$U$.
\begin{equation*}
   V_0 \ \subseteq \ V_1 \ \subseteq\  V_2\  \subseteq\  V_3 \ \subseteq \ \cdots\ \subseteq \ \bigcup_{n \in \N} V_n.
\end{equation*}
Will~$\bigcup_n V_n$ finally be complete?
It's not clear.
We have to go even further.
Define~$V_\omega = \sigma(\bigcup_{n \in \N} V_n)$,
$V_{\omega+1} = \sigma(V_\omega)$
and so on:
for any non-zero ordinal number~$\alpha$
    define~$V_\alpha = \sigma(\bigcup_{\beta < \alpha} V_\beta)$.
Now~$V_\alpha$
    is an ascending sequence of subsets of~$\overline{V}$.
    Thus~$V_{\alpha_0} = V_{{\alpha_0}+1}$
for some~$\alpha_0 \leq |2^{\overline{V}}|$
(for otherwise~$|2^{\overline{V}}| \leq |\overline{V}|$).
Thus norm-bounded Cauchy nets in~$V_{\alpha_0}$
    must converge.
We will see that at each step we can extend the module structure
    and inner product and with those~$V_{\alpha_0}$ is self-dual.
    Thus~$V_{\alpha_0}$ is ultranorm complete
    and actually~$V_{\alpha_0} = \overline{V}$.
\begin{equation*}
   V_0 \subseteq V_1 \subseteq \cdots \subseteq V_\omega \subseteq
   V_{\omega+1} \subseteq \cdots \subseteq V_{2\omega} \subseteq
       \ \cdots\ 
       \ \cdots\  \subseteq
   V_{\alpha_0} = \overline{V}
\end{equation*}
To avoid requiring familiary with transfinite induction,
    we will phrase the proof using Zorn's lemma instead.
\end{point}
\begin{point}{$\overline{V}$: fast nets}%
As we need some details in its construction,
    we will explicitly define~$\overline{V}$,
    the completion of~$V$ in the ultranorm uniformity
    using Cauchy nets.
There are other ways to construct a completion of a uniform space,
    see for instance~\cite[Thm.~39.12]{willard}.

Let~$\Phi$ denote the set of entourages of the ultranorm
    uniformity on~$V$, for its definition see~\sref{dils-ultranorm}.
$\Phi$ is a filter and thus can be used as index set for a net
    using reverse inclusion as order.
    (Thus~$\varepsilon \geq \delta
    \ \Leftrightarrow\ \varepsilon \subseteq \delta$.)
We say a net~$(x_\alpha)_{\alpha \in \Phi}$  indexed by entourages
    is \Define{fast} if for every~$\varepsilon \in \Phi$
        and~$\alpha,\beta \geq \varepsilon$
        we have~$x_\alpha \mathrel{\varepsilon^2} x_\beta$.

Every Cauchy net is equivalent to a fast one, but this is not as
        easy as in the metric case.
Let~$(x_\alpha)_{\alpha \in I}$
    be an arbitrary Cauchy net in~$V$.
By definition we can find~$\alpha_\varepsilon \in I$
    such that for each~$\varepsilon \in \Phi$
    and~$\alpha,\beta \geq \alpha_\varepsilon$
    we have~$x_\alpha \mathrel{\varepsilon} x_\beta$.
Unfortunately~$\alpha_{(\,\cdot\,)}$ need not be order preserving
    and so~$(x_{\alpha_{\varepsilon}})_{\varepsilon\in\Phi}$
    need not be a subnet of~$(x_\alpha)_{\alpha \in I}$.
However, we claim the net~$(x_{\alpha_{\varepsilon}})_{\varepsilon\in\Phi}$
    is Cauchy, fast and equivalent to~$(x_{\alpha})_{\alpha\in I}$.
To show it's Cauchy and fast, assume~$\varepsilon \in \Phi$
    and~$\zeta,\xi \geq \varepsilon$
    (that is: $\zeta,\xi \subseteq \varepsilon$).
As~$I$ is a net, we can find~$\beta\in I$
    with~$\beta \geq \alpha_\zeta, \alpha_\xi$.
By definition of~$\alpha_{(\,\cdot\,)}$
    we have~$x_{\alpha_\zeta} \mathrel\zeta x_{\beta}
        \mathrel\xi x_{\alpha_\xi}$
        and so~$x_{\alpha_\zeta} \mathrel{\varepsilon^2}
                x_{\alpha_\xi}$, as desired.
To show equivalence, assume~$\varepsilon \in \Phi$ is given.
Assume~$\delta \geq \nicefrac{\varepsilon}{2}$
and~$\beta \geq \alpha_{\nicefrac{\varepsilon}{2}}$.
There is a~$\gamma \in I$ with~$\gamma \geq \alpha_\delta,\beta$.
Then~$x_\beta \mathrel{\nicefrac{\varepsilon}{2}}
x_{\gamma} \mathrel{\delta} x_{\alpha_{\delta}}$
and so as~$\delta\subseteq \nicefrac{\varepsilon}{2}$
we get~$x_\beta \mathrel\varepsilon x_{\alpha_\delta}$.

If fast Cauchy nets~$(x_\alpha)_{\alpha \in \Phi}$
    and~$(y_\alpha)_{\alpha \in \Phi}$ are equivalent,
    we can find for every~$\varepsilon \in \Phi$
    some~$\beta \in \Phi$
    such that for all~$\gamma \geq \beta$
    we have~$x_\gamma \mathrel{\varepsilon} y_\gamma$.
\end{point}
\begin{point}{$\overline{V}$: the uniform space~$N$}%
Write~$N$ for the set of norm-bounded fast Cauchy nets over~$V$.
Later we will define~$\overline{V}$ as~$N$ modulo equivalence.
Because of a subtlety with the definition of the uniformity
    on~$\overline{V}$ later,
    it is helpful to consider~$N$ separately.
Let~$\varepsilon \in \Phi$.
For nets~$(x_\alpha)_{\alpha}$
    and~$(y_\alpha)_{\alpha}$ in~$N$,
    define
    \begin{equation*}
        (x_\alpha)_\alpha \mathrel{\Define{\hat\varepsilon}}
            (y_\alpha)_\alpha
            \quad\Leftrightarrow\quad
        \exists \beta \in \Phi \, \forall \gamma \geq \beta. \ 
        x_\gamma \mathrel{\varepsilon} y_\gamma.
    \end{equation*}
If~$\varepsilon \subseteq \delta$,
then $\hat\varepsilon \subseteq \hat\delta$
and
$\hat\varepsilon_1 \after \hat\varepsilon_2 
\subseteq\widehat{\varepsilon_1 \after \varepsilon_2}$.
So~$
\widehat{\nicefrac{\varepsilon}{2}} \after
\widehat{\nicefrac{\varepsilon}{2}} \subseteq
\widehat{\nicefrac{\varepsilon}{2} \after
\nicefrac{\varepsilon}{2}} \subseteq \widehat{\varepsilon}$,
which is one requirement for~$\{ \hat\varepsilon; \ \varepsilon \in \Phi\}$
to be a subbase for~$N$.
The others are easy as well. 
Also~$\widehat{\varepsilon_1 \cap \varepsilon_2} = \hat{\varepsilon}_1
    \cap \hat{\varepsilon}_2$
    and so each entourage of~$N$ has some~$\hat\varepsilon$ as subset.
Note~$(x_\alpha)_\alpha$ and~$(y_\alpha)_\alpha$
are equivalent if and only if~$(x_\alpha)_\alpha \mathrel{\hat\varepsilon}
    (y_\alpha)_\alpha$ for all~$\varepsilon \in \Phi$.
\end{point}
\begin{point}{$\overline{V}$: $N$ is complete}%
As every Cauchy net is equivalent to a fast one,
it is sufficient to show convergence of fast Cauchy nets.
Thus let~$((x^\gamma_\alpha)_\alpha)_\gamma$
    be a fast Cauchy net in~$N$.
First we will show~$(x^{\hat\alpha}_\alpha)_\alpha$
    is a Cauchy net.
It might not be fast, so
    formally~$((x^\gamma_\alpha)_\alpha)_\gamma$
    cannot converge to it,
    but it will converge to an equivalent fast Cauchy net.
As~$((x^\gamma_\alpha)_\alpha)_\gamma$
    is fast Cauchy,
    we know that for every~$\gamma_1,\gamma_2 \geq \hat\varepsilon$
we have~$
(x^{\gamma_1}_\alpha)_\alpha \mathrel{\hat\varepsilon^2}
        (x^{\gamma_2}_\alpha)_\alpha$.
So there is a~$\zeta_{\gamma_1,\gamma_2} \in \Phi$
such that for~$\alpha \geq \zeta_{\gamma_1,\gamma_2}$
    we have~$x^{\gamma_1}_\alpha
        \mathrel{\varepsilon^2}
        x^{\gamma_2}_\alpha$.
Assume~$\alpha,\beta \geq \varepsilon$.
Pick~$\xi \geq \alpha,\beta,\zeta_{\hat\alpha,\hat\beta}$.
Then we have $ x^{\hat{\alpha}}_\alpha
            \mathrel{\varepsilon^2}
        x^{\hat{\alpha}}_\xi
            \mathrel{\varepsilon^2}
        x^{\hat{\beta}}_\xi
            \mathrel{\varepsilon^2}
            x^{\hat{\beta}}_\beta$ and so~$(x_\alpha^{\hat\alpha})_\alpha$
            is Cauchy.
Let~$(y_\alpha)_\alpha$ be a fast Cauchy net equivalent
to~$(x^{\hat\alpha}_\alpha)_\alpha$.
We want to prove~$(x^\gamma_\alpha)_\alpha \to (y_\alpha)_\alpha$.
As~$(y_\alpha)_\alpha$ is equivalent to~$(x^{\hat\alpha}_\alpha)_\alpha$
    we can find~$\alpha_0$
    such that~$y_\alpha \mathrel{\nicefrac{\varepsilon}{4}} x^{\hat\alpha}_\alpha$
    whenever~$\alpha \geq \alpha_0$.
As~$((x^\gamma_\alpha)_\alpha)_\gamma$
is fast Cauchy,
we know that~$(x^{\hat\alpha}_\beta)_\beta
\mathrel{\widehat{\nicefrac{\varepsilon}{4}}}
(x^\gamma_\beta)_\beta $
if~$\hat{\alpha}, \gamma \geq \widehat{\nicefrac{\varepsilon}{8}}$.
Thus there is some~$\beta_0$ such
that~$x^{\hat\alpha}_\beta
\mathrel{\nicefrac{\varepsilon}{4}}
x^\gamma_\beta $
for~$\beta \geq \beta_0$
and~$\hat{\alpha}, \gamma \geq \widehat{\nicefrac{\varepsilon}{8}}$.
Thus for~$\beta \geq \beta_0 \cap \nicefrac{\varepsilon}{8}$,
$\alpha \geq \alpha_0 \cap \nicefrac{\varepsilon}{8}$
and~$\gamma \geq \widehat{\nicefrac{\varepsilon}{8}}$
we get~$y_\alpha
\mathrel{\nicefrac{\varepsilon}{4}}
x^{\hat{\alpha}}_\alpha
\mathrel{\nicefrac{\varepsilon}{4}}
x^{\hat{\alpha}}_\beta
\mathrel{\nicefrac{\varepsilon}{4}}
x^\gamma_\beta
\mathrel{\nicefrac{\varepsilon}{4}}
x^\gamma_\alpha$.
Thus~$(y_\alpha)_\alpha \mathrel{\hat\varepsilon} (x^\gamma_\alpha)_\alpha$
whenever~$\gamma \geq \widehat{\nicefrac{\varepsilon}{8}}$,
so~$(x^\gamma_\alpha)_\alpha \to (y_\alpha)_\alpha$.
\end{point}
\begin{point}[dils-uniformity-completion]{$\overline{V}$: uniformity}%
Let~$\overline{V}$ be the set of fast Cauchy nets over~$V$
    modulo equivalence.
Write~$\eta\colon V \to \overline{V}$
for the map that sends~$x \in V$
to the equivalence class of the constant Cauchy net~$(x)_{\alpha \in \Phi}$.
For brevity, we may write~$\hat{x} = \eta(x)$.
Define~$V_0 = \eta(V)$.

What uniformity to put on~$\overline{V}$?
Unfortunately the relations~$\hat\varepsilon$ do not necessarily preserve
    equivalence of Cauchy nets:
    there might be~$(x_\alpha)_\alpha \sim (x'_\alpha)_\alpha$
    and~$(y_\alpha)_\alpha \sim (y'_\alpha)_\alpha$ in~$N$
such that~$(x_\alpha)_\alpha \mathrel{\hat\varepsilon} (y_\alpha)_\alpha$,
but not~$(x'_\alpha)_\alpha \mathrel{\hat\varepsilon} (y'_\alpha)_\alpha$
for some~$\varepsilon \in \Phi$.
Instead we define for any~$\varepsilon \in \Phi$
the followowing entourages on~$\overline{V}$:
\begin{equation*}
    (x_\alpha)_\alpha \mathrel{\Define{\tilde\varepsilon}}
    (y_\alpha)_\alpha \quad\Leftrightarrow\quad
    (x'_\alpha)_\alpha \mathrel{\hat\varepsilon}
    (y'_\alpha)_\alpha \quad
    \text{for all
        $(x'_\alpha)_\alpha \sim (x_\alpha)_\alpha$ 
    and $(y'_\alpha)_\alpha \sim (y_\alpha)_\alpha$.}
\end{equation*}
By definition~$\tilde\varepsilon$
respects equivalence and so is also a relation on~$\overline{V}$.
It is not hard to verify~$\{ \tilde\varepsilon ;\ \varepsilon \in \Phi\}$
is a subbase for~$\overline{V}$
and~$\widetilde{\varepsilon_1 \cap \varepsilon_2} = \tilde{\varepsilon}_1
\cap \tilde{\varepsilon}_2$.
By construction~$\overline{V}$ is a Hausdorff uniform space.
Write~$\tilde\Phi$ for the generated set of entourages on~$\overline{V}$.
The entourages of~$\overline{V}$ are exactly those relations
    which have some~$\tilde\varepsilon$
    as a subset.

Furthermore, if~$(x_\alpha)_\alpha \mathrel{\hat\varepsilon}
(y_\alpha)_\alpha $,
then~$(x_\alpha)_\alpha \mathrel{\tilde\varepsilon^3} (y_\alpha)_\alpha$.
Thus if a net~$(x^\gamma_\alpha)_\alpha$
converges to~$(y_\alpha)_\alpha$ in~$N$,
then so do their equivalence classes in~$\overline{V}$.
Hence~$\overline{V}$ is complete.
(The inclusion~$\hat\varepsilon \subseteq \tilde\varepsilon^3 \subseteq
        \hat\varepsilon^3$
        implies the~$\hat\varepsilon$ and~$\tilde\varepsilon$
        generate the same uniformity on~$N$.)
\end{point}
\begin{point}{$\overline{V}$ is a right-$\scrB$-module}%
    First we will define an addition on~$\overline{V}$.
    The addition on~$V$ is uniformly continuous
        as the uniformity on~$V$ is given by seminorms.
    (See \sref{dils-product-uniformity} for the uniformity on~$V^2$.)
    Thus for any~$(x_\alpha)_\alpha$
    and~$(y_\alpha)_\alpha$ in~$N$,
    the net~$(x_\alpha+y_\alpha)_\alpha$ is again Cauchy,
        see \sref{dils-uniform-spaces-basics}.
    Also because of the uniform continuity of addition:
    if~$(x_\alpha)_\alpha \sim (x'_\alpha)_\alpha$
    and~$(y_\alpha)_\alpha \sim (y'_\alpha)_\alpha$,
    then~$(x_\alpha+y_\alpha)_\alpha \sim
            (x'_\alpha+y'_\alpha)_\alpha$.
    There is a net in~$N$ equivalent to $(x_\alpha+y_\alpha)_\alpha$.
    This fixes an addition on~$\overline{V}$,
        which turns it into an abelian group.
        By construction~$\eta(x+y) = \eta(x)+\eta(y)$.

Assume~$b \in \scrB$. We show the map~$r_b\colon V \to V$
given by~$r_b(x) = xb$ is also uniformly continuous,
which requires us to unfold the definitions further
than with addition.
Assume we are given an entourage in~$V$,
that is: np-maps~$f_1,\ldots,f_n\colon \scrB \to \C$
and~$\varepsilon > 0$.
For any np-map~$f\colon \scrB \to \C$,
    the map~$b*f$ given by~$(b * f)(x) \equiv f(b^* x b)$ is also an np-map,
    see \sref{bstaromega-basic}.
    Clearly~$\|xb\|_f = f([xb,xb])^{\frac{1}{2}}
    = f(b^* [x,x] b)^{\frac{1}{2}} = \|x\|_{b*f}$
    for any~$x \in V$.
Thus if~$\|x-y\|_{b*f_i} \leq \varepsilon$ for~$1 \leq i \leq n$,
then~$\|xb-yb\|_{f_i} = \|x-y\|_{b*f_i} \leq \varepsilon$
as well. Hence~$r_b$ is uniformly continuous.
As before, this uniform continuity
allows us to define a right~$\scrB$-action on~$\overline{V}$
by sending the equivalence class of~$(x_\alpha)_\alpha$
to~$(x_\alpha b)_\alpha$. By definition~$\eta(x)b = \eta(xb)$.
It is straight-forward to check this turns~$\overline{V}$
into a right-$\scrB$-module.
\end{point}
\begin{point}[dils-extending-norm-to-overlineV]{Extending $\|\,\cdot\,\|_f$ to~$\overline{V}$}%
Let~$(x_\alpha)_\alpha$ be a Cauchy net over~$V$
    and~$f\colon \scrB \to \C$ be any np-map.
From the reverse triangle inequality~$| \|x_\alpha \|_f - \|x_\beta\|_f |
        \leq \|x_\alpha - x_\beta \|_f$,
        it follows~$\| x_\alpha \|_f$ is Cauchy.
Define~$\|(x_\alpha)_\alpha\|_f = \lim_\alpha \|x_\alpha\|_f$.
Again using the reverse triangle
    inequality~$| \|x_\alpha \|_f - \|x'_\alpha\|_f |
        \leq \|x_\alpha - x'_\alpha \|_f$
        we see $\|(x_\alpha)_\alpha\|_f =
        \|(x'_\alpha)_\alpha\|_f$
        whenever $(x_\alpha)_\alpha \sim (x'_\alpha)_\alpha$.
Thus~$\|\,\cdot\,\|_f$ lifts to~$\overline{V}$.

These extended norms~$\|\,\cdot\,\|_f$ also induce a uniformity
    on~$\overline{V}$.  We will now show it is the same uniformity.
    Let~$((x_\alpha^\gamma)_\alpha)_\gamma$ be a net in~$\overline{V}$.
    It is sufficient to show that~$(x_\alpha^\gamma)_\alpha \to 0$
    in the original uniformity
    if and only if~$\|(x_\alpha^\gamma)_\alpha\|_f \to 0$
        for all np-maps~$f\colon \scrB \to \C$.

Assume~$(x^\gamma_\alpha)_\alpha \to 0$ in~$\overline{V}$.
That is: for each~$f\colon \scrB \to \C$ and~$\varepsilon > 0$
    there is a~$\gamma_0$
    such that for each~$\gamma \geq \gamma_0$
    there is an~$\alpha_0$
    such that~$\|x^\gamma_\alpha\|_f \leq \varepsilon$
    when~$\alpha \geq \alpha_0$.
Let any~$f\colon \scrB \to \C$ and~$\varepsilon > 0$ be given.
Find such~$\gamma_0$ for~$f$ and~$\varepsilon$.
Then~$\|(x^\gamma_\alpha)_\alpha \|_f
    = \lim_\alpha \|x^\gamma_\alpha\| \leq \varepsilon$
    whenever~$\gamma \geq \gamma_0$
    and so~$\|(x^\gamma_\alpha)_\alpha\|_f \to 0$ as desired.

For the converse, assume~$\|(x^\gamma_\alpha)_\alpha\|_f \to 0$
    for all np-maps~$f\colon \scrB \to \C$.
Let~$\varepsilon > 0$ and np-map~$f\colon \scrB \to \C$ be given.
There is some~$\gamma_0$ such that
$\lim_\alpha \|x^\gamma_\alpha \|_f = \|(x^\gamma_\alpha)_\alpha\|_f
\leq \frac{1}{2}\varepsilon$
for~$\gamma\geq\gamma_0$.
Hence~$\|x^\gamma_\alpha\|_f \leq \varepsilon$
    for sufficiently large~$\alpha$,
    which is to say~$(x^\gamma_\alpha)_\alpha \to 0$ in~$\overline{V}$.
\end{point}
\begin{point}[dils-completion-setup]{Induction set-up}%
The majority of the remaining work is to show
    we can define an inner product on~$\overline{V}$.
As sketched earlier,
    we will extend the inner product
    from~$V_0$ step-by-step.
Call a subset~$W \subseteq \overline{V}$
together with a~$\scrB$-valued inner product~$[\,\cdot\,,\,\cdot\,]$ a
    \Define{compatible extension} if
\begin{enumerate}
\item $V_0 \subseteq W$;
\item $W$ is a submodule of~$\overline{V}$;
\item the inner product turns~$W$ into a pre-Hilbert $\scrB$-module \emph{and}
\item $\|x\|_f^{\overline{V}} = \|x\|_f^W$
        for all~$x \in W$
        and np-maps~$f\colon \scrB \to \C$,
        where~$\|x\|_f^W = f([x,x]_W)^{\frac{1}{2}}$
        and~$\|\,\cdot\,\|^{\overline{V}}_f$
        is the extension of~$\|\,\cdot\,\|_f$
        on~$V$ to~$\overline{V}$
        as in \sref{dils-extending-norm-to-overlineV}.
\end{enumerate}
As~$\|\,\cdot\,\|^{\overline{V}}_f$ also
    generate the uniformity on~$\overline{V}$,
    the last requirements implies
    that on a compatible extension~$W$
    the ultranorm uniformity and
    the uniformity induced by~$\overline{V}$
    coincide.

For compatible extensions~$W_1,W_2 \subseteq \mathscr{V}$
        we say~$W_1 \leq W_2$
            iff~$W_1 \subseteq W_2$
            and~$[v,w]_{W_1} = [v,w]_{W_2}$
        for all~$v,w\in W_1$.
Later, we will apply Zorn's lemma to the compatible extensions
    ordered in this way.
\end{point}
\begin{point}{Induction base case}%
    The inner product of~$V$ lifts to~$V_0$.
    Indeed, $\eta(x) = 0$ if and only if~$\| x\| = 0$.
    So by Cauchy--Schwarz~$[x,y] = 0$ whenever~$\eta(x)=0$.
    Thus~$[x,y] = [x',y']$
        if~$\eta(x)=\eta(x')$
        and~$\eta(y)=\eta(y')$.
    Define~$[\eta(x),\eta(y)] = [x,y]$.
    It's easy to see~$V_0$ is a pre-Hilbert~$\scrB$-submodule of~$\overline{V}$.
    Finally, for any np-map~$f\colon \scrB\to \C$
    we have $\| \eta(x) \|_f^{\overline{V}}
    =   \| x\|_f^{V} = \| \eta(x) \|_f^{V_0}$, as desired.
\end{point}
\begin{point}{Induction step}%
Assume~$W\subseteq \overline{V}$ with~$[\,\cdot\,,\,\,\cdot\,]$
    is a compatible extension.
Let~$\Define{\sigma(W)}$ denote the limits of norm-bounded Cauchy nets over~$W$.
We will define a~$\scrB$-valued inner product on~$\sigma(W)$
    that turns it into a compatible extension.
In fact~$W \leq \sigma(W)$.
By assumption the induced uniformity on~$W$
    is the ultranorm uniformity
    and so addition and the~$\scrB$-action
    are uniformly continuous.
Hence~$\sigma(W)$ is again a submodule.

To define the inner product,
assume~$x,y \in \sigma(W)$.
There are~$\Phi$-indexed norm-bounded Cauchy
    nets~$(x_\alpha)_\alpha$ and~$(y_\alpha)_\alpha$
    over~$W$
    such that~$x_\alpha \to x$ and~$y_\alpha \to y$.
For any np-map $f\colon \scrB \to \C$ we have
    by Cauchy--Schwarz
\begin{align*}\label{eq-dils-V-inprod-cauchy}
    \bigl|f([x_\alpha, y_\alpha] - [x_\beta,y_\beta])\bigr|
    & \ =\  \bigl| [x_\alpha, y_\alpha - y_\beta]_f
        + [x_\alpha - x_\beta, y_\beta]_f\bigr| \\
    &\  \leq\  \|x_\alpha\|_f \|y_\alpha - y_\beta\|_f \numberthis
        + \|x_\alpha - x_\beta\|_f \| y_\beta \|_f.
\end{align*}
(If not otherwise specified $\|\,\cdot\,\|_f = \|\,\cdot\,\|_f^W$.)
As~$(x_\alpha)_\alpha$ is norm bounded and
$\|x_\alpha\|_f^2 = f([x_\alpha,x_\alpha]) \leq \|f\| \|x_\alpha\|^2$,
we see~$(\|x_\alpha\|_f)_\alpha$ is bounded.
Similarly~$(\|y_\beta\|_f)_\beta$ is bounded.
Thus from \eqref{eq-dils-V-inprod-cauchy}
it follows~$([x_\alpha,y_\alpha])_\alpha$
    is a Cauchy net in the ultraweak uniformity of~$\scrB$,
    see \sref{dils-uniformity-examples}.
As~$\|[x_\alpha,y_\alpha]\| \leq \|x_\alpha\| \|y_\alpha\|$,
see \sref{module-CS}, it is also a norm-bounded net.
By \sref{vn-complete} norm-bounded Cauchy net in the ultraweak uniformity
converge, so~$\uwlim_\alpha [x_\alpha,y_\alpha]$ exists.

Assume we are given other~$\Phi$-indexed
norm-bounded Cauchy nets~$(x')_\alpha$ and~$(y')_\alpha$ over~$W$
with~$ (x'_\alpha)_\alpha \to x$
and~$ (y'_\alpha)_\alpha \to y$.
Then, like \eqref{eq-dils-V-inprod-cauchy}:
\begin{align*}
    \bigl|f([x_\alpha, y_\alpha] - [x'_\alpha,y'_\alpha])\bigr|
    & \ =\  \bigl| [x_\alpha, y_\alpha - y'_\alpha]_f
        + [x_\alpha - x'_\alpha, y'_\alpha]_f\bigr| \\
    &\  \leq\  \|x_\alpha\|_f \|y_\alpha - y'_\alpha\|_f
        + \|x_\alpha - x'_\alpha\|_f \| y'_\alpha \|_f.
\end{align*}
From this it follows~$ \uwlim_\alpha [x_\alpha,y_\alpha]=
    \uwlim_\alpha [x'_\alpha,y'_\alpha]$.
We are justified to define
\begin{equation*}
    [x,y] \ \equiv\  \uwlim_{\alpha} \,[x_\alpha,y_\alpha].
\end{equation*}

Assume~$x,y,z \in \sigma(W)$.
Pick $\Phi$-indexed
norm-bounded Cauchy nets
$(x_\alpha)_\alpha$, $(y_\alpha)_\alpha$ and $(z_\alpha)_\alpha$ over~$W$
with~$x_\alpha \to x$, $y_\alpha \to y$ and~$z_\alpha \to z$ in~$\overline{V}$.
So~$x_\alpha+ y_\alpha \to x + y.$
With ultraweak continuity of addition
\begin{equation*}
    [x+y,z] = \uwlim_\alpha [x_\alpha +y_\alpha, z_\alpha]
        = \uwlim_\alpha [x_\alpha, z_\alpha] +
                \uwlim_\alpha [y_\alpha, z_\alpha]
                = [x,z] + [y,z].
\end{equation*}
In a similar fashion one proves the other axioms of
    a~$\scrB$-valued inner product:
    $[x,y]=[y,x]^*$ follows from the ultraweak continuity of~$(\cdot)^*$;
    $\scrB$-homogeinity follows from
        ultraweak continuity of~$c \mapsto cb$ (see \sref{mult-uws-cont})
        \emph{and}~$[x,x]\geq 0$ follows from ultraweak-closedness of the
        positive cone of~$\scrB$.

To prove definiteness, assume~$[x,x]=0$.
    Pick some $\Phi$-indexed norm-bounded
        Cauchy net~$(x_\alpha)_\alpha$ over~$W$
        with~$x_\alpha \to x$.
For any np-map~$f\colon \scrB \to \C$
we have
\begin{equation*}
        \lim_\alpha f([x_\alpha,x_\alpha])
        = f(\uwlim_\alpha [x_\alpha,x_\alpha])
        = f([x,x]) = 0.
\end{equation*}
Thus~$x_\alpha$ converges in the ultranorm uniformity on~$W$ to~$0$.
Hence~$x=0$.

Thus~$\sigma(W)$ is a pre-Hilbert~$\scrB$-module.
It remains to be shown~$\|\,\cdot\,\|_f^{\sigma(W)}$
    and $\|\,\cdot\,\|_f^{\overline{V}}$
    agree.
Pick any~$x \in \sigma(X)$ and~$f\colon \scrB \to \C$.
By definition there is a norm-bounded Cauchy net~$x_\alpha$ over~$W$
    for which~$x_\alpha \to x$ in~$\overline{V}$.
Then
\begin{equation*}
    \|x\|^{\sigma(W)}_f
        = f(\uwlim_\alpha [x_\alpha,x_\alpha])^{\frac{1}{2}}
        = \lim_\alpha \|x_\alpha\|_f^W
        = \lim_\alpha \|x_\alpha\|_f^{\overline{V}}
        = \|x\|_f^{\overline{V}},
\end{equation*}
as desired.
We have shown~$\sigma(W)$ is a compatible extension.
\end{point}
\begin{point}{Induction limit step}%
    Assume~$\mathscr{V}$
        is a chain of compatible extensions.
        See \sref{dils-completion-setup} for the order on compatible extensions.
    Write~$W = \bigcup \mathscr{V}$.
    We will turn~$W$ into a compatible extension.
    Clearly~$W$ is a submodule of~$\overline{V}$.
    As~$\mathscr{V}$ is not empty, $V_0 \subseteq W$.
    For any~$v,w \in W$
    there is some~$W' \in \mathscr{V}$ with~$v,w \in W'$.
    Define~$[v,w]_W = [v,w]_{W'}$.
    This turns~$W$ into a pre-Hilbert~$\mathscr{B}$-module
        as all its axioms only involve finitely many elements,
        which are contained in some single compatible extension far enough up
        in the chain.
    Finally, to see the norms agree,
        pick any np-map~$f\colon \scrB \to \C$
        and~$x \in W$.
    Then~$x \in W'$ for some~$W' \in \mathscr{V}$.
    Consequently
    \begin{equation*}
        \|x\|^{\overline{V}}_f
        = \|x\|^{W'}_f
        = f([x,x]_{W'})^{\frac{1}{2}}
        = f([x,x]_{W})^{\frac{1}{2}}
        = \|x\|^{W}_f,
    \end{equation*}
    as desired.  We have shown~$W$ is a compatible extension.
\end{point}
\begin{point}{Self-duality}
    We have seen
        that every chain of compatible extensions
        has an upper bound.
    Thus by Zorn's lemma there is a maximal compatible
        extension~$W\subseteq \overline{V}$.
    By maximality~$\sigma(W) = W$
        and so in~$W$ norm-bounded ultranorm-Cauchy nets converge.
    Thus by~\sref{dils-selfdual}
        $W$ must be self-dual and ultranorm complete.
    By completeness~$W = \overline{V}$.
    Define~$X = \overline{V}$
        and~$\left<x,y\right> = [x,y]_{W}$.
    Clearly~$[v,w] = \left<\eta(v),\eta(w)\right>$
        and the image of~$\eta$ is norm dense. \qed
\end{point}
\end{point}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}[selfdual-completion-univ]{Lemma}%
Assume~$\scrB$ is a von Neumann algebra
    and~$V$ is a right $\scrB$-module
    with~$\scrB$-valued inner product.
Let~$X$ be any self-dual Hilbert~$\scrB$-module
    together with inner product preserving
    $\scrB$-linear map~$\eta\colon V \to X$
    such that the image of~$\eta$ is ultranorm dense in~$X$.
(E.g.~the completion into a self-dual Hilbert~$\scrB$-module
from \sref{dils-completion}.)
Assume~$Y$ is self-dual Hilbert~$\scrB$-module.
For each bounded~$\scrB$-linear
    map~$T\colon V \to Y$,
    there is a unique bounded~$\scrB$-linear
    map~$\hat{T} \colon X \to Y$
    such that~$\hat{T} \after \eta = T$.
\begin{point}{Proof}%
By \sref{blinear-bounded-is-ultranorm} bounded~$\scrB$-linear
    maps are ultranorm uniformly continuous.
As~$\eta(V)$ is ultranorm dense in~$X$,
    the extension~$\hat{T}$ is unique if it exists.
Pick any~$x \in X$.
There is a net~$x_\alpha$ in~$V$ such
    that~$\eta(x_\alpha) \to x$ ultranorm.
So~$\eta(x_\alpha)$ is ultranorm Cauchy.
As~$\eta$ preserves inner product,
    $x_\alpha$ is ultranorm Cauchy as well.
As~$T$ is ultranorm uniformly continouous
    $T(x_\alpha)$ is ultranorm Cauchy.
With the same motions we see~$T(x_\alpha) \sim T(x'_\alpha)$
    when~$x_\alpha \sim x'_\alpha$.
So using this and that~$Y$ is ultranorm complete, see \sref{dils-selfdual},
    we may define~$\hat{T} x = \unlim_\alpha x_\alpha$.
Clearly~$\hat{T}\after\eta=T$.
It is straight-forward to check
    that $\scrB$-linearity
    of~$\hat{T}$
    follows from~$\scrB$-linearity of~$T$
    and ultranorm continuity of addition and
        the~$\scrB$-module action.

It remains to be shown~$\hat{T}$ is bounded.
By \sref{blinear-inprod-inequality}  we have
\begin{equation*}
\left<T x_\alpha,T x_\alpha\right>
\leq \| T\|^2 [x_\alpha,x_\alpha]
= \|T\|^2 \left<\eta(x_\alpha),\eta(x_\alpha)\right>
\end{equation*}
and so using \sref{innerprod-ultraweak} we see
\begin{equation*}
\langle\hat{T} x, \hat{T} x\rangle =
\uwlim_\alpha \left<T x_\alpha, T x_\alpha\right>
            \leq \|T\|^2 \uwlim_\alpha \left<\eta(x_\alpha), \eta(x_\alpha)\right>
            = \|T\|^2 \left<x,x\right>,
\end{equation*}
which implies~$\|\hat{T}\| \leq \|T\|$ as desired.
(In fact~$\|\hat{T}\| = \|T\|$.) \qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
    Before we show every ncp-map has a Paschke dilation
        we study~$\scrB^a(X)$ a bit more for self dual~$X$.
\end{point}
\begin{point}{Definition}%
Let~$V$ be a normed right $\scrB$-module.
A sesquilinear form~$B\colon V\times V \to \scrB$
    is said to be \Define{bounded}
    if there is an~$r \geq 0$ such that
$\|B(x,y)\| \leq r \|x\|\|y\|$
for all~$x,y \in V$.
\end{point}
\begin{point}{Example}%
Let~$X$ be a pre-Hilbert~$\scrB$-module.
For every~$T \in \scrB^a(X)$
    the map~$\left<(\,\cdot\,), T (\,\cdot\,)\right>$
    is a bounded~$\scrB$-sesquilinear form.
\begin{point}%
    For self dual~$X$ the converse is true.
\end{point}
\end{point}
\begin{point}[hilbmod-sesquilinear-forms]{Proposition}%
Let~$X$ be a self-dual Hilbert~$\scrB$-module.
For every bounded $\scrB$-linear form~$B$ on~$X$,
    there is a unique~$T \in \scrB^a(X)$
    with~$B(x,y) = \left<x,Ty\right>$
    for all~$x,y \in X$.
\begin{point}{Proof}
For each~$y \in X$
    the map~$B(x,y)^*$ is~$\scrB$-linear and bounded.
Thus by self duality of~$X$
there is a unique~$t_y$
    for each~$y \in X$
    such that~$\left<t_y, x\right> = B(x,y)^*$
    for all~$x \in X$.
It is easy to see~$\left<t_{y+y'},x\right>
                = \left<t_y + t_{y'}, x\right>$
                and~$\left<t_{yb},x\right>
                = \left<t_y b, x\right>$,
    and so by uniqueness~$y \mapsto t_y$ is~$\scrB$-linear.
Define~$Ty = t_y$.
Clearly~$\left<x,Ty\right> = \left<t_y,x\right>^* = B(x,y)$
    and~$T$ must be the unique such~$\scrB$-linear map.
It remains to be shown~$T$ is bounded.
There is an~$r \geq 0$ such that for all~$x \in X$:
\begin{equation*}
    \| Tx\|^2 
    \ =\  \|\left<Tx,Tx\right>\|
            \ =\  \| B (Tx, x) \|
            \ \leq\  r \|Tx\|\|x\|.
\end{equation*}
So $T$ is bounded by~$r$ trivially if~$\|Tx\|=0$
    and by dividing otherwise. \qed
\end{point}
\end{point}
\begin{point}[hilmod-fixed-on-V]{Exercise}%
Let~$V$ be a right $\scrB$-module with~$\scrB$-valued inner product;
    $\eta\colon V \to X$ be its ultranorm completion
    from~\sref{dils-completion} and~$S,T \in \scrB^a(X)$ arbitrary.
Show that if for all~$x\in V$ we
have~$\left<\eta(x), T\eta(x)\right> = \left<\eta(x), S\eta(x)\right>$,
    then~$S=T$.
\end{point}
\begin{point}{Theorem}%
Suppose~$X$ is a self dual Hilbert~$\scrB$-module
    for a von Neumann algebra~$\scrB$.
Then~$\scrB^a(X)$ is a von Neumann algebra.
\begin{point}{Proof}%
The theorem is due to Paschke \cite[Prop.~3.10]{paschke};
    we give a new proof.
We already know~$\scrB^a(X)$ is a C$^*$-algebra, see \sref{hilbmod-cstar}.
\begin{point}{bounded order completeness}%
Let~$(T_\alpha)_\alpha$ be a norm-bounded net of self adjoint elements
    of~$\scrB^a(X)$.  We have to show it has a supremum.
Pick~$x\in X$ and  $r\in \R$, $r\geq0 $
such that~$\|T_\alpha\| \leq r$ for all~$\alpha$.
By \sref{hilbmod-ordersep}~$(\left<x,T_\alpha x\right>)_\alpha$
    is a norm-bounded net of self adjoint elements of~$\scrB$
    and so it has a supremum to which
    it converges ultraweakly by~\sref{vna-supremum-uwlimit}.
In particular
\begin{equation*}
\frac{1}{4} \sum^3_{k=0} i^k \left< i^kx+y, T_\alpha(i^k x+y)\right>
    \ =\  \left<x, T_\alpha y\right>
\end{equation*}
converges ultraweakly for all~$x,y \in X$.
Define~$B(x,y) = \uwlim_\alpha \left<x,T_\alpha y\right>$.
As addition and multiplication by a fixed element are
    ultraweakly continuous (see \sref{mult-uws-cont}),
    we see~$B$ is a~$\scrB$-sesquilinear form.
Clearly~$\|\left<x,T_\alpha y\right>\| \leq r\|x\|\|y\|$
and so by \TODO{norm reasonable uwlim}~$ B(x,y) \leq r \|x\|\|y\|$,
thus~$B$ is a bounded~$\scrB$-sesquilinear form.
Thus by \sref{hilbmod-sesquilinear-forms}
    there is a unique~$T \in \scrB^a(X)$
    with~$\left<x,Ty\right> = B(x,y) = \uwlim_\alpha \left<x,T_\alpha y\right>$.
Clearly~$T$ is self adjoint.
Using \sref{hilbmod-ordersep} again and ultraweak limits respecting the order
    \TODO{reference?}
    we see~$\left<x,T_\alpha\right> \leq \left<x,T x\right>$
    for all~$x \in X$ and so~$T_\alpha \leq T$.
Now suppose we are given a self adjoint~$S \in \scrB^a(X)$
    with~$T_\alpha \leq S$ for all~$\alpha$.
With a similar argument we see~$T \leq S$ and so~$S$ is
    the supremum of~$(T_\alpha)_\alpha$.
\end{point}
\begin{point}[hilbmod-vecstates-normal]{separating normal states}%
By~\sref{hilbmod-ordersep}
    the states~$\left<x,(\,\cdot\,)x\right>$
    are separating.
We are done if we can show~$\left<x,(\,\cdot\,)x\right>$
    is normal, i.e.~preserves suprema of self adjoint elements.
To this end, pick~$x \in X$ and let~$(T_\alpha)_\alpha$
    be a net with suprema~$T$.
As before~$(\left<x,T_\alpha x\right>)_\alpha)$
    is a norm bounded net which converges ultraweakly to its
    suprema.
Now, we just saw
\begin{equation*}
    \left<x,Tx\right> = \uwlim_\alpha \left<x, T_\alpha x\right>
                = \sup_\alpha \left<x, T_\alpha x\right>
\end{equation*}
and so indeed~$\left<x, (\,\cdot\,)x\right>$ is normal;
the normal states are separating
and~$\scrB^a(X)$ is a von Neumann algebra. \qed
\end{point}
\end{point}
\end{point}
\end{parsec}

\section{Paschke dilations}
\begin{parsec}%
\begin{point}%
    We are ready to show every ncp-map has a Paschke dilation.
\end{point}
\begin{point}{Definition}%
    Let~$\varphi\colon \scrA \to \scrB$ be any ncp-map between
        von Neumann algebras.
    A complex bilinear map~$B \colon \scrA \times \scrB \to X$,
        where~$X$ is a self-dual Hilbert~$\scrB$-module is
        called \Define{$\varphi$-compatible}
        if there is a~$r > 0$
        such that for all~$n\in \N$, $a_1, \ldots, a_n \in \scrA$
        and~$b_1, \ldots, b_n \in \scrB$ we have
        \begin{equation}
            \bigl\| \sum_i B(a_i,b_i)\bigr\|^2
                \leq r \cdot \bigl\| \sum_{i,j} b_i^* \varphi(a_i^*a_j)b_j
                \bigr\| \label{phi-compatible}
        \end{equation}
        and~$B(a,b_1)b_2 = B(a,b_1b_2)$
        for all~$a \in \scrA$ and~$b_1,b_2 \in \scrB$.
\end{point}
\begin{point}[existence-paschke]{Theorem}%
    Let~$\varphi\colon \scrA \to \scrB$ be any ncp-map between
        von Neumann algebras.
\begin{enumerate}
    \item There is a self-dual Hilbert~$\scrB$-module~$\scrA \otimes_\varphi
            \scrB$ and~$\varphi$-compatible bilinear
    \begin{equation*}
        \otimes \colon \scrA \times \scrB \to \scrA \otimes_\varphi \scrB
    \end{equation*}
    such that for every~$\varphi$-compatible bilinear
    map~$B \colon \scrA \times \scrB \to Y$
    there is a unique bounded
    module map~$T\colon \scrA \otimes_\varphi \scrB \to Y$
    such that~$T(a \otimes b) = B(a,b)$ for all~$a \in \scrA$ and~$b \in \scrB$.
\item
    There is a unique bounded module
        map~$\varrho(a_0)$ on~$\scrA \otimes_\varphi \scrB$
            fixed by
            \begin{equation*}
                \varrho(a_0)(a\otimes b) = (a_0 a)\otimes b,
            \end{equation*}
        for~$a_0 \in \scrA$
    and~$a \mapsto \varrho(a)$
        yields a
        nmiu-map~$\varrho\colon \scrA \to \scrB^a(\scrA\otimes_\varphi \scrB)$.
\item
    The map
    $h\colon \scrB^a(\scrA\otimes_\varphi\scrB) \to \scrB$
    given by~$h(T) =\left<1 \otimes 1, T(1 \otimes 1)\right>$
    is ncp.
\item
Let $X$ be any  self-dual Hilbert$\scrB$-module~$X$ with $e \in X$ and
        nmiu-map~$\varrho'\colon \scrA \to \scrB^a(X)$
        such that~$\varphi  = h' \after \varrho'$
        with~$h'(T) = \left<e,T e\right>$.
There is a unique
        inner product preserving~$\scrB$-linear
        map~$S \colon \scrA\otimes_\varphi\scrB \to X$
        such that~$\ad_S \after \varrho' = \varrho$
        and~$S( 1\otimes 1) = e$.
\item
$(\scrB^a(\scrA \otimes_\varphi \scrB), \varrho, h)$
    is a Paschke dilation of~$\varphi$.
\end{enumerate}
\begin{point}{Proof}%
The Hilbert~$\scrB$-module~$\scrA \otimes_\varphi \scrB$
    will be isomorphic to the self-dual completion of the space~$X$
    constructed by Paschke in~\cite[Thm.~5.2]{pashcke}.
\begin{point}{1: $\scrA \otimes_\varphi \scrB$}%
The algebraic tensor product~$\scrA \odot \scrB$
    is a right $\scrB$-module
with the action~$(\sum_i a_i \otimes b_i)\beta = \sum_i a_i \otimes(b_i\beta)$.
On~$\scrA \odot \scrB$, define
\begin{equation*}
    \bigl[\sum_i a_i \otimes b_i, \sum_j \alpha_j \otimes \beta_j\bigr]
    = \sum_{i,j} b_i^* \varphi(a_i^*\alpha_j)\beta_j.
\end{equation*}
By complete positivity of~$\varphi$
this is a~$\scrB$-valued inner product on~$\scrA \otimes \scrB$.
By \sref{dils-completion}
    there is a self-dual Hilbert~$\scrB$-module~$\scrA\otimes_\varphi \scrB$
    and~$\scrB$-linear inner product-preserving
    $\eta\colon \scrA \odot \scrB \to \scrA \otimes_\varphi \scrB$
    with ultranorm dense range.
Define~$\otimes \colon \scrA \times \scrB \to \scrA \otimes_\varphi \scrB$
    by~$a \otimes b = \eta(a \otimes b)$.
By definition we have
\begin{equation*}
\bigl\| \sum_i a_i \otimes b_i \bigr\|^2
    = \bigl\|\bigl[ \sum_i a_i\otimes b_i, \sum_j a_j \otimes b_j \bigr]\bigr\|
    = \bigl\|\sum_{i,j} b_i^* \varphi(a_i^*a_j) b_j\bigr\|
\end{equation*}
and so~$\otimes$ is a~$\varphi$-compatible bilinear map.

Let~$B \colon \scrA \times \scrB \to Y$
    be a~$\varphi$-compatible
    bilinear map to some self-dual Hilbert~$\scrB$-module~$Y$.
We must show that there is a unique bounded module
    map~$T \colon \scrA \otimes_\varphi \scrB \to Y$
    such that~$T(a\otimes b) = B(a,b)$.
By the defining property of the algebraic
    tensor product, there is a unique linear
    map~$T_0\colon \scrA \odot \scrB \to Y$
    such that~$T_0(a\otimes b) = B(a,b)$.
By definition of~$\varphi$-compatible
    and the inner product on~$\scrA\odot \scrB$,
    the map~$T_0$ is in fact bounded and~$\scrB$-linear.
By \sref{selfdual-completion-univ}
    this map extents uniquely
    to a bounded module map~$T \colon \scrA \otimes_\varphi \scrB \to Y$
    with~$T(a\otimes b) = B(a,b)$, as desired.
\end{point}
\begin{point}{2: $\varrho \colon \scrA \to \scrB^a(\scrA \otimes_\varphi \scrB)$}%
Assume~$a_0 \in \scrA$.
To show the module map~$\varrho(a_0)$ exists,
    it is sufficient to show the bilinear
    map~$B\colon \scrA \times \scrB \to \scrA \otimes_\varphi \scrB$
    given by~$B(a,b) = (a_0a)\otimes b$ is $\varphi$-compatible.
Clearly~$B(a,b \beta) = B(a,b)\beta$.
To show \eqref{phi-compatible},
    let~$n \in \N$, $a_1, \ldots, a_n \in \scrA$
    and~$b_1, \ldots, b_n \in \scrB$
    be given.
The row vector
    $(a_1\ \cdots \ a_n)$
    is an~$\scrA$-linear map~$a\colon \scrA^{\oplus n} \to \scrA$
    in the usual way:~$a(\alpha_1, \ldots, \alpha_n) = a_1\alpha_1 + \cdots + a_n \alpha_n$.
    Similarly the column vector~$b \equiv (b_1\  \ldots\ b_n)^\T$
    is a~$\scrB$-linear map~$\scrB \to \scrB^{\oplus n}$
    with~$b(\beta) = (b_1 \beta, \ldots, b_n \beta)$.
    We compute
\begin{align*}
    \bigl\| \sum_i B(a_i,b_i) \bigr\|^2
    & \ =\  \bigl\| \sum_i (a_0 a_i) \otimes b_i \bigr\|^2 \\
    & \ =\  \bigl\| \sum_{i,j} b_i^* \varphi(a_i^* a_0^* a_0 a_j)b_j\bigr\| \\
    & \ =\   \| b^* (M_n \varphi) (a^*a_0^*a_0a) b\| \\
    &\  \leq\  \|a_0^*a_0\| \|b^* (M_n \varphi) (a^*a) b\| \\
    & \ =\  \|a_0\|^2  \bigl\| \sum_{i,j} b_i^* \varphi(a_i^*a_j)b_j\bigr\|.
\end{align*}
Thus~$B$ is~$\varphi$-compatible
    and so there is a unique~$\scrB$-linear bounded module
    map~$\varrho(a_0)\colon \scrA \otimes_\varphi \scrB
            \to \scrA \otimes_\varphi \scrB$
            with~$\varrho(a_0) (a\otimes b) = (a_0 a) \otimes b$.
Clearly~$\varrho$ is a unital, multiplicative and involution preserving map.
It remains to be shown~$\varrho$ is normal.
Let~$D \subseteq \scrA$ be a bounded directed set of self-adjoint elements.
We need to show~$\sup_{d \in D} \varrho(d) = \varrho(\sup D)$.
By \sref{hilmod-fixed-on-V}
it suffices to show~$\left<\hat{x}, \varrho(\sup D)\hat{x}\right>
= \left<\hat{x},\sup_{d \in D} \varrho(d)\hat{x}\right>$
for all~$x \in \scrA \odot \scrB$.
Find~$n \in \N$,
row vector~$a \equiv(a_1\ \cdots\ a_n)$
and column~$b \equiv (b_1\ \cdots\ b_n)$
such that~$x = \sum_i a_i \otimes b_i$.
We derive
\begin{align*}
    \langle \hat{x}, \varrho(\sup D) \hat{x} \rangle
    & \ =\  \sum_{i,j} b_i^* \varphi(a_i^* (\sup D) a_j) b_j \\
        & \ =\  b^* (M_n \varphi) (a^* (\sup D) a) b\\
    & \ =\  \sup_{d \in D} b^* (M_n \varphi) (a^* d a) b \\
    & \ =\ \sup_{d \in D} \langle \hat{x}, \varrho(d) \hat{x} \rangle \\
    & \ =\ \langle \hat{x}, \sup_{d \in D} \varrho(d) \hat{x} \rangle.
\end{align*}
Thus~$\varrho$ is normal.
\end{point}
\begin{point}{3: $h \colon \scrB^a(\scrA \otimes_\varphi \scrB) \to \scrB)$}%
Define~$h(T) = \left<1\otimes 1, T 1\otimes 1 \right>$.
By \sref{hilbmod-vectstates-cp} it is completely positive
    and by \sref{hilbmod-vecstates-normal} it is normal.
\end{point}
\begin{point}[paschke-uniqueness]{Uniqueness~$\sigma$}%
Before we continue with 4 we will already prove the uniqueness property
    for point 5.
Note that~$(h \after \varrho)(a) = \left<1\otimes1, a \otimes 1\right>
    = \varphi(a)$ for all~$a \in \scrA$
    and so~$\varphi = h \after \varrho$.
Assume~$\varphi = h' \after \varrho'$
    for some nmiu-map~$\varrho'\colon \scrA \to \scrP'$,
        ncp-map~$h\colon \scrP' \to \scrB$
        and von Neumann algebra~$\scrP'$.
For point 5 we must show there is a
    unique ncp-map~$\sigma \colon \scrP' \to \scrB^a (\scrA \otimes_\varphi \scrB)$
    such that~$h \after \sigma = h'$ and~$\sigma \after \varrho' = \varrho$.
Let~$\sigma_1,\sigma_2\colon \scrP \to \scrB^a(\scrA\otimes_\varphi\scrB)$
    be ncp-maps with~$h \after \sigma_k = h'$ and~$\sigma_k \after \varrho'
        = \varrho$, $k=1,2$.
We must show~$\sigma_1=\sigma_2$.
Let~$c \in \scrP'$ and~$x \in \scrA \odot \scrB$ be given.
By \sref{hilmod-fixed-on-V} it suffices to prove
that~$\left<\hat{x}, \sigma_1(c) \hat{x} \right>= \left<\hat{x}, \sigma_2(c) \hat{x} \right>$.
Find~$n \in \N$, $a_1, \ldots, a_n\in \scrA$
    and~$b_1,\ldots,b_n \in \scrB$
    such that~$x = \sum_i a_i\otimes b_i$.
As~$a_i \otimes b_i = \varrho(a_i) (1 \otimes 1)b_i$, we get for~$k=1,2$
\begin{align*}\label{equation-sigma}
    \left<\hat{x}, \sigma_k(c) \hat{x}\right>
    &\ =\ \sum_{i,j} b_i^* h(\, \varrho(a_i^*) \sigma_k(c) \varrho(a_j)\,)b_j\\
    &\ =\ \sum_{i,j} b_i^* h(\sigma_i(\, \varrho'(a_i^*) c \varrho'(a_j)\,))b_j \\
    &\ =\ \sum_{i,j} b_i^* h'(\varrho'(a_i^*) c \varrho'(a_j)) b_j.\numberthis
\end{align*}
Thus~$\sigma_1=\sigma_2$ as desired.
\end{point}
\begin{point}[paschke-spatial]{4: spatial case}%
Let~$X$ be a self-dual Hilbert~$\scrB$-module
    together with~$e \in X$ and nmiu-map~$\scrA \to \scrB^a(X)$
    such that~$\varphi = h' \after \varrho'$
    with~$h'(T) = \left<e,Te\right>$.
We must show there is a unique inner product
    preserving~$S \colon \scrA \otimes_\varphi \scrB \to X$
    with~$\ad_S \after \varrho' = \varrho$ and~$S (1\otimes1) = e$.
As~$h \after \ad_S = h'$ and~$\ad_S$ is an ncp-map,
    we already know it is unique by the previous point.
There is a unique linear~$S_0\colon \scrA \odot \scrB \to X$
    fixed by~$S_0(a\otimes b) = \varrho'(a) e b$.
Clearly~$S_0$ is also~$\scrB$-linear.
For any~$x,y \in \scrA\odot \scrB$,
    say~$x = \sum_i a_i\otimes b_i$ and~$y = \sum_j \alpha_j \otimes \beta_j$,
    we have
\begin{align*}
    \left< S_0 x, S_0 y \right>
    & \ =\ \sum_{i,j} \left<\varrho'(a_i)e b_i, \varrho'(\alpha_j)e \beta_j \right> \\
    & \ =\ \sum_{i,j} b_i^*\left<e,  \varrho'(a_i^*\alpha_j)e \right>\beta_j \\
    & \ =\ \sum_{i,j} b_i^* \varphi(a_i^*\alpha_j) \beta_j \\
    & \ =\ [x,y].
\end{align*}
Thus~$S_0$ preserves inner product. In particular it's bounded
    and so there is a unique bounded~$\scrB$-linear
    $S \colon \scrA \otimes_\varphi \scrB \to X$
    with~$S \after \eta = S_0$.
By \sref{hilmod-fixed-on-V} $S$ also preserves inner product and so~$S^*S = 1$.
By definition~$S (1\otimes1) = \varrho'(1)e 1 = e$.
Pick any~$a \in \scrA$.
A straight-forward computation shows~$S \varrho(a) = \varrho'(a) S$
hence~$S^* \varrho'(a) = \varrho(a) S^*$
and~$S^* \varrho'(a) S = S^*S \varrho(a) = \varrho(a)$.
We have shown~$\ad_S \after \varrho' = \ad_S$.
\end{point}
\begin{point}{5, $\sigma$ existence}
Assume~$\varphi = h' \after \varrho'$
    for some nmiu-map~$\varrho'\colon \scrA \to \scrP'$,
        ncp-map~$h\colon \scrP' \to \scrB$
        and von Neumann algebra~$\scrP'$.
It remains to be shown there is a ~$\sigma\colon \scrP' \to \scrB^a(\scrA\otimes_\varphi\scrB)$
with~$\sigma\after\varrho'=\varrho$ and~$h \after \sigma = h'$.
To apply the previous point,
    we perform the whole construction for~$h'$ instead of~$\varphi$
    yielding
    $h' = h_{h'} \after \varrho_{h'}$
    with~$\varrho_{h'} \colon \scrP' \to \scrB^a (\scrP' \otimes_{h'} \scrB)$
    and~$h_{h'} \colon \scrB^a(\scrP' \otimes_{h'} \scrB) \to \scrB$.
By~\sref{paschke-spatial}
    there is a unique 
    $\scrB$-linear map~$S\colon \scrA \otimes_{\varphi} \scrB \to
                                \scrP' \otimes_{h'} \scrB$
with~$S^*S = 1$, $S 1\otimes1 = 1\otimes1$ and
$\ad_S \after \varrho_{h'}\after \varrho' = \varrho$.
Define~$\sigma = \ad_S \after \varrho_{h'}$.
This~$\sigma$ fits the bill:
$\sigma \after \varrho' = \ad_S \after \varrho_{h'} \after \varrho'
                                = \varrho$
and~$h \after \sigma = h \after \ad_S \after \varrho_{h'}
= h_{h'} \after \varrho_{h'} = h'$. \qed
\end{point}
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}%
In the remainder of this section we will study various property
    of Paschke dilations.
The first question we will answer is
    when the representation in a Paschke dilation is injective.
First we need parts of the comparison theory of projections.
\end{point}
\begin{point}{Definition}%
Let~$\scrA$ be a von Neumann algebra.
Two projections~$p,q \in \scrA$ are said to be
    \Define{Murray--von Neumann equivalent},
    in symbols~$p \sim q$,
    if there is an~$u \in \scrA$
    with~$p = uu^*$ and~$q = u^*u$.
Such~$u$ are called \Define{partial isometries}.
E.g.~in~$M_2$ we have~$\ketbra{0}{0} \sim \ketbra{1}{1}$
    via the partial isometry~$\ketbra{0}{1}$.
We will write~$p \lesssim q$
    if there is a projection~$r \leq q$
    such that~$p \sim r$.
\end{point}
\begin{point}[new-murray-lemma]{Lemma}%
Let~$\scrA$ be a von Neumann algebra
    and~$a,p \in \scrA$ with~$a$ self adjoint and~$p$ a projection.
We have~$p \lesssim \ceil{a}$
    if and only if~$p = \ceil{b^* a b}$ for some~$b \in \scrA$.
\begin{point}{Proof}%
Assume~$p \lesssim \ceil{a}$.
Then there is some partial isometry~$u$
    with~$u^*u = p$ and~$uu^* \leq \ceil{a}$.
Then~$p = u^*u= u^*uu^*u = u^*uu^*\ceil{a}u = u^*\ceil{a} u$.
Now by \TODO{ref} we have~$p = \ceil{p} = \ceil{u^*\ceil{a}u}=\ceil{u^*au}$.

For the converse, assume~$p = \ceil{b^*ab}$ for some~$b \in \scrA$.
By polar decomposition \TODO{ref}~$ab = u \sqrt{(ab)^*ab}$
    for some partial isometry~$u$
    with~$uu^* = \ceil{ab(ab)^*}$ and~$u^*u = \ceil{(ab)^*ab}$.
Now~$u^*u = \ceil{b^*a^2b} = \ceil{b^*\ceil{a^2} b} = \ceil{b^*ab}=p$
and~$uu^* = \ceil{abb^*a} \leq \ceil{a^2} = \ceil{a}$, as desired. \qed
\end{point}
\end{point}
\begin{point}[central-carrier-formula]{Proposition}%
Assume~$\scrA$ is a von Neumann algebra.
For any self adjoint~$a \in \scrA$
\begin{equation*}
    \cceil{a} \ =\  \sup \{p; p \text{ projection}; \ p \lesssim \ceil{a} \}
            \ = \ \sup \{ \ceil{b^*ab}; \ b\in \scrB \}.
\end{equation*}
\begin{point}{Proof}%
(This is a simplified proof of the result we published
earlier \cite[Thm.~28 sub 1]{wwpaschke}.)
Directly from \sref{new-murray-lemma}
    we get $\sup_{p \lesssim \ceil{a}} p = \sup_{b \in \scrB} \ceil{b^*ab}$.
For brevity we will write~$r = \sup_{p \lesssim \ceil{a}} p$.
Let~$u$ be a partial isometry with~$u^*u \leq \ceil{a}$.
Then~$uu^*\cceil{a} = uu^*u \cceil{a} u^*= u \ceil{a} \cceil{a} u^*
        = u \ceil{a} u^*  = uu^*$.
Thus~$uu^* \leq \cceil{a}$, so~$r \leq \cceil{a}$.

For the converse, note~$\ceil{a} \lesssim \ceil{a}$
    and so~$\ceil{a} \leq r$
    thus~$\cceil{a} \leq \cceil{r}$.
It is sufficient to show~$r$ is central, for
        then~$\cceil{a} \leq \cceil{r} = r$.
Pick any~$c \in \scrA$.
Note
\begin{equation*}
    c^*rc
    \ =\ c^* (\sup_{b \in \scrB} \ceil{b^*ab}) c
    \ =\ \sup_{b \in \scrB} c^* \ceil{b^*ab} c
\end{equation*}
and so~$c^*rc \leq \ceil{c^* r c} = \sup_{b \in \scrB} \ceil{c^*b^*abc} \leq r$
    by~\TODO{two refs}.
Thus~$(1-r)c^*rc(1-r) = 0$.
So~$rc(1-r)=0$.
Thus~$rc = rcr$.
As~$c$ was arbitrary, we also get~$rc^* rc^*r$.
So~$rc = rcr = (rc^*r)^* = (rc^*)^* = cr$.
Indeed~$r$ is central. \qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
We have all the tools to characterize neatly when
    the representation of a Paschke dilation is injective.
This is a generalization of our answer\cite{stineinj}
    to the same question for the Stinespring embedding.
\end{point}
\begin{point}{Theorem}%
Let~$\varphi\colon \scrA \to \scrB$ be any ncp-map
    with Paschke dilation~$(\scrP, \varrho, h)$.
Then $\ceil{\varrho} = \cceil{\varphi}$.
Thus~$\varrho$ is injective ($\ceil{\varrho}=1$) if and only if $\varphi$
maps no non-zero central projection to zero ($\cceil{\varphi}=1$).
\begin{point}{Proof}%
By~\sref{paschke-unique-up-to-iso}
    it is sufficient to prove the equivalence
    for the dilation constructed in \sref{existence-paschke}.
\begin{point}[injectivity-paschke-lemma]%
First we will prove that~$\varrho(\alpha) = 0$
    if and only if~$\varphi(a^*\alpha^*\alpha a) = 0$
    for all~$a \in \scrA$.
From left to right is easy:
$\varphi(a^*\alpha^*\alpha a) = h(\varrho(a^*\alpha^*) \varrho(\alpha) \varrho(a)) = 0$ whenever~$\varrho(\alpha) = 0$.
For the converse, assume~$\varphi(a^*\alpha^*\alpha a) = 0$
    for all~$a \in \scrA$.
By the polarization identity, see \sref{mult-polarization},
    we also have~$\varphi(a^* \alpha^* \alpha a') = 0$
    for all~$a,a' \in \scrA$.
Pick any~$x \in \scrA \otimes \scrB$, say~$x = \sum_i a_i \otimes b_i$.
Then
    $\left<\hat{x}, \varrho(\alpha) \hat{x}\right> = 
        \sum_{i,j} b_i^*\varphi(a_i^* \alpha^*\alpha a_j)b_j = 0$.
Hence~$\varrho(\alpha) = 0$, as claimed.
\end{point}
\begin{point}%
We will first show~$\ceil{\varrho} \leq \cceil{\varphi}$.
For any~$a \in \scrA$
we have
\begin{equation*}
    a^* (1 - \cceil{\varphi}) a = 
    (1 - \cceil{\varphi})a^* a (1 - \cceil{\varphi}) \leq
    \| a\|^2 (1 - \cceil{\varphi}) \leq \|a\|^2 (1 - \ceil{\varphi})
\end{equation*}
and so~$\varphi(a^* (1 - \cceil{\varphi}) a)
\leq \|a\|^2 \varphi(1-\ceil{\varphi}) = 0$.
Hence by \sref{injectivity-paschke-lemma}
we get~$\varrho(1-\cceil{\varphi}) = 0$
and so~$\ceil{\varrho} \leq \cceil{\varphi}$.
\end{point}
\begin{point}%
Now we show~$\cceil{\varphi} \leq \ceil{\varrho}$.
Pick any~$p \lesssim \ceil{\varphi}$.
Pick~$v$ with~$vv^* = p$ and~$v^*v \leq \ceil{\varphi}$.
By \sref{injectivity-paschke-lemma}
it follows from~$\varrho(1-\ceil{\varrho}) = 0$
that~$\varphi(v^* (1-\ceil{\varrho})v)=0$.
And so we have~$v^* (1-\ceil{\varrho})v \leq 1-\ceil{\varphi}$.
Consequently
\begin{equation*}
p (1-\ceil{\varrho}) p
    =    vv^* (1 - \ceil{\varrho}) vv^*
    \leq v (1- \ceil{\varphi}) v^*
    = vv^* - v \ceil{\varphi} v^* = 0.
\end{equation*}
This means~$p \leq \ceil{\varrho}$.
Thus by~\sref{central-carrier-formula}
we get~$\cceil{a} = \sup_{p \lesssim \ceil{a}} p \leq \ceil{\varrho}$,
as desired. \qed
\end{point}
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}%
We will now prove a useful connection between
    the ncp-maps ncp-below~$\varphi$
    and the commutant of the image of a Paschke embedding of~$\varphi$.
\end{point}
\begin{point}{Definition}%
For linear  maps~$\varphi, \psi\colon \scrA \to \scrB$,
    we say $\varphi$ is ncp-below~$\psi$
    (in symbols:~$\varphi \mathrel{\Define{\leq_\ncp}} \psi$)
    whenever~$\psi - \varphi$ is an ncp-map.
    Furthermore, write
    \begin{equation*}
    \Define{[0,\varphi]_\ncp} =\  
        \{\psi; \ \psi \colon \scrA \to \scrB;
            \ 0 \leq_\ncp\psi \leq_\ncp \varphi \}.
    \end{equation*}
\end{point}
\begin{point}{Definition}%
    Assume~$\varphi\colon \scrA \to \scrB$ is an ncp-map with Paschke
        dilation~$(\scrP, \varrho, h)$.
    For~$t \in \varrho(\scrA)^\square$
    define $\Define{\varphi_t} = h(t \varrho(a))$.
\end{point}
\begin{point}{Theorem}%
Assume~$\varphi\colon \scrA \to \scrB$ is an ncp-map.
Let $(\scrB^a(\scrA \otimes_\varphi \scrB),
    \varrho, h)$ be the Paschke dilation of~$\varphi$
    constructed in~\sref{existence-paschke}.
Then~$T \mapsto \varphi_T$ is an linear
order isomorphism~$[0,1]_{\varrho(\scrA)^\square} \to [0,\varphi]_\ncp$.
\begin{point}{Proof}
(The proof is a slight variation on \cite[Prop.~5.4]{paschke}.)
Clearly~$T \mapsto \varphi_T$ is linear.
Pick~$T \in \varrho(\scrA)^\square$.
As~$\sqrt{T} \in \varrho(\scrA)^\square$
    we have~$\varphi_T(a) = h(\sqrt{T} \varrho(a)\sqrt{T})$.
    Thus~$\varphi_T$ is ncp
    and~$\varphi_T \mathrel{\leq_\ncp} \varphi_S$
    whenever~$T\leq S$ for~$T,S \in \varrho(\scrA)^\square$.
In particular, if~$T\leq 1$ then $\varphi_T \leq \varphi_1 = \varphi$.
\begin{point}{Order embedding}%
Let~$T \in \varrho(\scrA)^\square$
    be given such that~$\varphi_T$ is ncp.
Assume~$n \in \N$, $a_1, \ldots, a_n \in \scrA$
and~$b_1, \ldots, b_n \in \scrB$.
Write~$x = \sum_{i} a_i \otimes b_i$.
Then
\begin{equation*}
    \left<x, T x \right>
    \ =\  \sum_{i,j} b_i^* \left< 1\otimes 1, T \varrho(a_i^*a_j) 1 \otimes 1\right> b_j
    \ = \ \sum_{i,j} b_i^* \varphi_T (a_i^*a_j) b_j \ \geq\  0.
\end{equation*}
By construction such~$x$ are ultranorm dense in~$\scrA\otimes_\varphi \scrB$
    and so~$T \geq 0$ by \sref{hilbmod-denseordersep}.
Thus~$T \mapsto \varphi_T$ is an order embedding
    and in particular an injection.
\end{point}
\begin{point}{Surjective}%
Only surjectivity remains.
Pick~$\psi \in [0,\varphi]_\ncp$.
We want to show there is a~$T \in \varrho(\scrA \otimes_\varphi \scrB)^\square$
    with~$\varphi_T = \psi$ and~$0 \leq T \leq 1$.
Let $(\scrB^a(\scrA \otimes_\psi \scrB),
    \varrho_\psi, h_\psi)$ denote the Paschke dilation of~$\psi$
    constructed in~\sref{existence-paschke}.
Define~$B\colon \scrA \times \scrB \to \scrA \otimes_\psi \scrB$
    by~$B(a,b) = a \otimes b$.
This~$B$ is $\varphi$-compatible
--- indeed, for any~$n \in \N$, $a_1, \ldots, a_n \in \scrA$
    and~$b_1, \ldots, b_n \in \scrB$ we have
\begin{equation*}
    \bigl\| \sum_i B(a_i, b_i) \bigr\|^2
     \ = \  \bigl\| \sum_{i,j}
                b_i^* \psi(a_i^*a_j) b_j \bigr\|
     \ \leq \  \bigl\| \sum_{i,j}
                b_i^* \varphi(a_i^*a_j) b_j \bigr\|.
\end{equation*}
Thus there is a unique bounded module \TODO{existence adjoint}
    map~$W \colon X \otimes_\varphi Y \to X \otimes_\psi Y$
    fixed by~$W x \otimes y = x \otimes y$.
For any~$a\in\scrA$, we have~$W \varrho(a) = \varrho_\psi(a) W$
and so~$\varrho(a) W^* = W^* \varrho_\psi(a)$
thus~$W^*W \varrho(a) = W^* \varrho_\psi(a) W = \varrho(a) W^*W$.
Apperently~$W^*W \in \varrho(\scrA)^\square$.
Define~$T = W^*W$. Clearly~$0\leq T$.
For each~$x = \sum^n_{i=0} a_i \otimes b_i$
    we have~$\left<x, Tx\right> = \left<Wx,Wx\right> = \left<x,x\right>$
    and so~$T \leq 1$.
For any~$a\in \scrA$ we have
\begin{align*}
    \varphi_T(a) &\ =\  \left<1\otimes 1, W^*W a \otimes 1\right> \\
    &  \ =\  \left<W 1\otimes 1, W a\otimes1\right> \\
    &  \ = \ \left<1\otimes1, a\otimes1\right> \\
    &  \ = \ \psi(a),
\end{align*}
as desired. \qed
\end{point}
\end{point}
\end{point}
\end{parsec}

\section{Self-dual Hilbert C$^*$-modules}
\begin{parsec}%
\begin{point}%
Before we continue our study of Paschke dilations,
    we have a second look at
    self-dual Hilbert C$^*$-modules and their orthonormal bases.
We start with some good news.
In~$\scrB(\scrH)$ the linear span of~$\ketbra{e_i}{e_j}$
    is ultraweakly dense for any orthonormal basis~$(e_i)_{i \in I}$
    of~$\scrH$.
For self dual Hilbert~$\scrB$-modules
    we have a similar result.
\end{point}
\begin{point}{Definition}%
Let~$X$ be a Hilbert~$\scrB$-module.
For any~$x, y \in X$,
define the bounded operator~$\ketbra{x}{y} \in \scrB^a(X)$
by~$\Define{\ketbra{x}{y}} z = x \left<y,z\right>$.
\begin{point}%
The following rules are easy to check.
For~$x,y,v,w \in X$ and~$b \in \scrB$
    we have
\begin{equation*}
\ketbra{x}{y}^* = \ketbra{y}{x} \qquad
\ketbra{xb}{y} = \ketbra{x}{yb^*} \qquad
\ketbra{x}{y} \ketbra{v}{w} = \ketbra{x\left<y,v\right>}{w}.
\end{equation*}
If~$\left<e,e\right>$ is a projection,
    then~$\ketbra{e}{e}$ is a projection.
For any~$T \in \scrB^a(X)$
    we have~$T \ketbra{x}{y} = \ketbra{Tx}{y}$
    and~$\ketbra{x}{y}T^* = \ketbra{x}{Ty}$.
\end{point}
\end{point}
\begin{point}[ketbra-ultraweakly-dense]{Proposition}%
Let~$X$ be a self-dual Hilbert~$\scrB$-module over a von Neumann algebra~$\scrB$.
If~$(e_i)_{i \in I}$ is an orthonormal basis of~$X$,
then the linear span of
    the operators~$\{ \ketbra{e_i b}{e_j}; i,j \in I, \ b \in \scrB\}$
    is ultraweakly dense in~$\scrB^a(X)$.
\begin{point}{Proof}%
We start with some preparation.
\begin{point}[ketbra-dense-pt1]%
For a finite subset~$S \subseteq I$,
    write~$p_S = \sum_{i \in S} \ketbra{e_i}{e_i}$.
The$(\ketbra{e_i}{e_i})_{i \in I}$ are pairwise orthogonal projections.
Thus~$p_S$ is a projection.
Also $p_S \leq p_{S'}$ when~$S \subseteq S'$.
Pick any~$x \in X$.
As~$p_S x = \sum_{i \in S} e_i \left<e_i, x\right>$
using
\begin{equation*}
\left<x, p_S x\right> \ =\ 
        \left<p_S x, p_S x\right> \ =\ 
        \sum_{i,j \in S}
            \left<x,e_i\right> \left<e_i,e_j\right> \left<e_j,x\right>
            \ =\ 
        \sum_{i\in S} \left<x,e_i\right>\left<e_i,x\right>,
\end{equation*}
we have by Parseval~$\sup_S \left<x, p_S x\right> = \left<x,x\right>$.
So by \sref{states-order-separating} $\sup_S p_S = 1$;
    further by \sref{vna-supremum-uslimit}
    $p_S$ converges ultraweakly to~$1$.
\end{point}
\begin{point}%
Pick any~$T \in \scrB^a(X)$.
For~$i,j \in I$ we have
\begin{equation*}
    \ketbra{e_i}{e_i} T \ketbra{e_j}{e_j}
    \ =\  \ketbra{e_i}{e_i} \ketbra{T e_j}{e_j}
    \ =\ \ketbra{e_i \left<e_i, T e_j\right>}{e_j}.
\end{equation*}
and so~$p_S T p_S$ is in the linear
    span of~$\{ \ketbra{e_i b}{e_j} \}$.
Thus it is sufficient to prove~$p_S T p_S$ converges ultraweakly to~$T$.
\end{point}
\begin{point}%
Pick any np-map~$f\colon \scrB \to \C$.
We want to show~$|f(T-p_S T p_S)| \to 0$. Clearly
\begin{equation*}
    |f(T - p_S T p_S)| \ \leq \  |f(\, (1-p_S) T | +| p_S T (1-p_S) \,)|.
\end{equation*}
Using Cauchy--Schwarz and \sref{ketbra-dense-pt1} we see the second term vanishes
\begin{equation*}
|f(p_S T (1-p_S))|^2 \ \leq \ f(T^*p_S T) f(1-p_S) \ \leq\ 
            f(T^*T) f(1-p_S) \ \to \ 0
\end{equation*}
Similarly the first term vanishes and
    so indeed~$p_S T p_S \to T$ ultraweakly. \qed
\end{point}
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}%
For a Hilbert space~$\scrH$
    with linear subspace~$V \subseteq \scrH$
    we have~$V \subseteq V^{\perp\perp} = \overline{V}$
    and~$\scrH \cong V^{\perp\perp} \oplus  V^\perp$.
We generalize this to self-dual Hilbert~$\scrB$-modules.
Let's introduce the cast:
\end{point}
\begin{point}{Exercise}%
Let~$\scrB$ be a von Neumann algebra.
Assume~$X$ and~$Y$ are self-dual Hilbert~$\scrB$-modules
    with orthonormal bases~$E \subseteq X$ and~$F \subseteq Y$.
Write~$\kappa_1\colon X \to X \oplus Y$
    and~$\kappa_2 \colon Y \to X \oplus Y$
    for the maps~$\kappa_1(x) = (x,0)$ and~$\kappa_2(y) = (0, y)$.
Show that~$\kappa_1(E) \cup \kappa_2(F)$
    is an orthonormal basis of~$X \oplus Y$.
    Conclude that~$X \oplus Y$ is self-dual.
\end{point}
\begin{point}{Definition}%
Let~$X$ be a Hilbert~$\scrB$-module
    with subset~$V \subseteq X$.
Write~$\Define{V^\perp}$ for the \Define{orthocomplement} of~$V$, defined by
\begin{equation*}
    V^\perp = \{ x; \ x \in X;\ \left<x,v\right>=0\text{ for all }v\in V\}.
\end{equation*}
\end{point}
\begin{point}[hilbmod-projthm]{Proposition}%
Assume~$X$ is a self-dual Hilbert $\scrB$-module
    for a von Neumann algebra~$\scrB$.
Suppose~$V \subseteq X$ is any subset. Then
\begin{enumerate}
\item
$V^\perp$ is a self-dual Hilbert~$\scrB$-submodule of~$X$
    (and so is~$V^{\perp\perp})$;
\item
    $V^{\perp\perp}$ is the ultranorm closure of the~$\scrB$-linear
    span of~$V$ \emph{and}
\item
    $V^{\perp\perp} \oplus V^\perp \cong X$
        via~$(x,y) \mapsto x+y$.
\end{enumerate}
\begin{point}{Proof}%
It is easy to see~$V^\perp$ is a submodule of~$X$
    and~$V \subseteq V^{\perp\perp}$.
To show~$V^\perp$ is ultranorm closed in~$X$,
    assume~$x_\alpha$ is a net in~$V^\perp$
    converging ultranorm to~$x \in X$.
For each~$v \in V$ we have
$ \left<v, \unlim_\alpha x_\alpha\right>
    \overset{\sref{ultranormcontstruct}}{=}
    \uslim_\alpha \left<v, x_\alpha\right>  = 0 $
    and so~$x \in V^\perp$ as well.
Thus~$V^\perp$ is ultranorm complete
    and so self-dual by \sref{dils-selfdual}.
\begin{point}%
Write~$W$ for the ultranorm closure of
    the~$\scrB$-linear span of~$V$ in~$X$.
By \sref{ultranormcontstruct} $W$ is a submodule.
Clearly the induced uniformity of~$X$
    on~$W$ is the same as its own ultranorm uniformity:
    thus~$W$ is ultranorm complete
        and~$W \subseteq V^{\perp\perp}$.
By \sref{dils-selfdual} there
    is an orthonormal basis~$(e_i)_{i \in I}$ of~$W$.
Going back to the construction of~$(e_i)_{i \in I}$
    (in \sref{selfdual-bcompl-then-basis}),
    we see that we can extend it to an orthonormal basis of the whole of~$X$:
    there are~$(d_j)_{j \in J} \in X$
    such that~$\{e_i\}_{i \in I} \cup \{d_j\}_{j \in J}$
    is an orthonormal basis of~$X$.
\end{point}
\begin{point}%
By construction~$d_j \in W^\perp \subseteq V^\perp$
    for every~$j \in J$.
For any~$x \in X$
    we have~$x = \sum_i e_i \left<e_i, x\right>
                + \sum_j d_j \left<d_j,x\right>$.
If~$x \in V^{\perp\perp}$
    then~$x = \sum_i e_i \left<e_i, x\right>$
    as~$\left<x, d_j\right>= 0$ for each~$j \in J$.
Thus~$V^{\perp\perp} \subseteq W$, so~$V^{\perp\perp} = W$.
In particular, as~$V^\perp$ is already an ultranorm closed submodule,
    we find~$W^\perp = (V^\perp)^{\perp\perp} = V^\perp$.
\end{point}
\begin{point}%
So~$(e_i)_i$ is a basis for~$W = V^{\perp\perp}$
    and~$(d_j)_j$ is a basis for~$W^\perp = V^\perp$.
For brevity write~$\vartheta\colon V^{\perp\perp} \oplus V^\perp \to X$
    for the map~$(y,y') \mapsto y+y'$.
Clearly~$\vartheta$ is bounded~$\scrB$-linear.
As~$\left<y,y'\right> = 0$ for~$(y,y') \in V^{\perp\perp} \oplus V^\perp$
    we see~$\vartheta$ is inner product preserving and thus injective.
As~$\{e_i\}_{i \in I} \cup \{d_j\}_{j \in J}$
    is an orthonormal basis of~$X$, $\vartheta$ is surjective.
As~$\vartheta$ is inner product preserving, its inverse is bounded
    --- hence~$\vartheta$ is an isomorphism.
    \qed
\end{point}
\end{point}
\end{point}
\begin{point}[selfdual-orthn-basis]{Exercise}%
Assume~$X$ is a self-dual Hilbert~$\scrB$-module for a von Neumann
    algebra~$\scrB$.
Suppose~$E \subseteq X$ is an orthonormal set. Show
\begin{enumerate}
\item
    $E$ is a basis of~$E^{\perp\perp}$ \emph{and}
\item
    $x \in E^{\perp\perp}$
    if and only if~$\left<x,x\right> = \sum_{e \in E} \left<x,e\right>
                \left<e,x\right>$.
\end{enumerate}

\end{point}
\begin{point}[selfdual-gramschmidt]{Exercise}%
Assume~$X$ is a self-dual Hilbert~$\scrB$-module for a von Neumann
    algebra~$\scrB$.
Suppose~$x_1, \ldots, x_n \in X$.
Show that there is a finite orthonormal basis
    of~$\{x_1, \ldots, x_n\}^{\perp\perp}$.
(Use the orthonormalization in the last part of \sref{selfdual-bcompl-then-basis}.)
\end{point}
\end{parsec}


\begin{parsec}%
\begin{point}%
Every Hilbert space~$\scrH$ is isomorphic to some~$\ell^2(I)$.
In fact, the cardinality of~$I$ is the only thing that matter
    --- if~$\ell^2(I) \cong \ell^2(J)$, then~$I$ and~$J$
    are the same cardinality.
What about Hilbert C$^*$-modules?
\end{point}
\begin{point}[hilbmod-el2]{Exercise}%
In this exercise we prove \cite[Thm.~3.12]{paschke}.
Let~$\scrB$ be a von Neumann algebra
    and~$(p_i)_{i \in I}$
    a sequence of projections from~$\scrB$.
Write~$\Define{\ell^2((p_i)_{i \in I})}$
    for the set of~$I$-tuples~$(b_i)_{i \in I}$
        from~$\scrB$
        that are~$\ell^2$-summable, see \sref{dfn-selfdual-basis}.
Show~$\ell^2((p_i)_{i \in I})$
    is a right $\scrB$-module
    with coordinatewise operations.
Prove that for any~$(b_i)_i$ and~$(c_i)_i$
    in~$\ell^2((p_i)_{i \in I})$
    the sum~$\sum_{i \in I} b_i^* c_i =: \left<(b_i)_i, (c_i)_i\right>$
    converges ultraweakly
    and turns it into a pre-Hilbert~$\scrB$-module.
Conclude it is self dual
and, in fact, that for every self dual Hilbert~$\scrB$-module~$X$
    with any orthonormal basis~$(e_i)_{i \in I}$
    we have~$X \cong \ell^2(\,(\left<e_i,e_i\right>)_{i \in I}\,)$.
\end{point}

\begin{point}%
    Let~$\scrB$ be a von Neumann algebra
        and~$(p_i)_{i \in I}$, $(q_j)_{j \in J}$
        sequences of projections from~$\scrB$.
    What can we say if~$\ell^2((p_i)_{i \in I}) 
            \cong \ell^2((q_i)_{j \in J})$?
    Let's start with some counter examples.
\begin{enumerate}
\item
Do all orthonormal bases have the same cardinality?
$\scrB$ is a self-dual Hilbert~$\scrB$-module over itself.
Clearly, the element~$1$ by itself is an orthonormal basis of~$\scrB$.
However, for every projection~$p \in \scrB$
    the pair~$(p,1-p)$ is also an orthonormal basis.
If~$\scrB = \scrR$ \TODO{ref},
then~
\begin{equation*}
(\ketbra{0}{0}, \ketbra{10}{10}, \ketbra{110}{110}, \ldots ).
\end{equation*}
is an orthonormal basis.

\item
Perhaps orthonormal bases have a common refinement?
Take~$\scrB = M_3$.
It might not be immediately obvious, but both
\begin{equation*}
    (\,\ketbra{0}{0} + \ketbra{2}{2}, \ketbra{+}{+}\,)
    \quad \text{and} \quad
    (\,\ketbra{0}{0}, \ketbra{2}{2}+ \ketbra{+}{+}\,)
\end{equation*}
are orthonormal bases of~$M_3$ over itself.
(Combine \sref{onb1} with~\sref{onb2}.)

\item
Maybe~$\sum_{i\in I} \left<e_i,e_i\right> = \sum_{j\in J} \left<d_i,d_i\right>$
    for finite orthonormal bases~$(e_i)_{i \in I}$ and~$(d_j)_{j \in J}$?
For commutative~$\scrB$ this indeed holds using Parseval's identity.
However, in general it fails:
both~$(\ketbra{0}{0}, \ketbra{1}{1})$ and
    $(\ketbra{0}{0}, \ketbra{1}{0})$ are orthonormal bases of~$M_2$ over itself,
    but~$\ketbra{0}{0}+ \ketbra{1}{1} \neq 2 \ketbra{0}{0}$.
\end{enumerate}
\end{point}
\begin{point}[onb1]{Exercise}%
Let~$(e_i)_{ i \in I}$ be some orthonormal basis of a Hilbert~$\scrB$-module~$X$.
Show that if~$(u_i)_{i \in I}$
    is a sequence of partial isometries from~$\scrB$
    such that~$u_iu_i^* = \left<e_i,e_i\right>$
    for all~$i \in I$,
    then~$(e_iu_i)_{i \in I}$
    is another basis of~$X$.

Conclude~$\ell^2((p_i)_{i \in I}) \cong \ell^2((q_i)_{i \in I})$
for any projections~$(p_i)_{i\in I}, (q_i)_{i\in I} $
from~$\scrB$
with~$p_i \sim q_i$ for~$i \in I$.
\end{point}

\begin{point}[onb2]{Exercise}%
Let~$(e_i)_{ i \in I}$ be some orthonormal basis of a Hilbert~$\scrB$-module~$X$
    with distinguished~$1,2 \in I$.
Show that if~$\left<e_1,e_1\right> + \left<e_2,e_2\right> \leq 1$,
    then we can make a new orthonormal basis of~$X$ by  replacing~$e_1$ and~$e_2$
        by~$e_1 + e_2$.

Conclude~$p \scrB \oplus q \scrB \cong (p+q) \scrB$
    for projections~$p,q \in \scrB$ with $p+q \leq 1$.
\end{point}
% \begin{point}[selfdual-limit-basispair]{Lemma}%
%     Assume~$X$ is a self dual Hilbert~$\scrB$-module.
%     Let~$(E_\alpha)_{\alpha \in \beta}$ 
%         and~$(D_\alpha)_{\alpha\in \beta}$
%         be an ascending and descending sequence of subsets of~$X$,
%         respectively.
%     If for each~$\alpha \in \beta$ we know
%     $E_\alpha \cap D_\alpha = \emptyset$ and $E_\alpha \cup D_\alpha$ is an orthonormal basis,
%     then~$\bigl(\bigcup_{\alpha} E_\alpha\bigr) \cup\bigl( \bigcap_{\alpha}D_\alpha\bigr)$
%         is also an orthonormal basis.
% \begin{point}{Proof}
% Write~$D = \bigcap_\alpha D_\alpha$. 
% Without loss of generality we may assume~$D = \emptyset$,
%     by switching to~$D'_\alpha = D - D_\alpha$
%     and~$E'_\alpha = E_\alpha \cup D$.
% Write~$E = \bigcup_\alpha E_\alpha$.
% By \sref{hilbmod-projthm} and \sref{selfdual-orthn-basis} it is sufficient
%     to show~$E^\perp = \{0\}$.
% Pick any~$x \in E^\perp$.  We want to show~$x = 0$.
% By definition~$\left<x, e\right> =0$ for~$e \in E$.
% As~$D_0 \cup E_0$ is an basis,
%     it is sufficient to show~$\left<x, d\right> = 0$
%         for~$d \in D_0$.
% Pick some~$d \in D_0$.
% As~$\bigcap_\alpha D_\alpha = \emptyset$
%     there is some~$\alpha$ such that~$d \notin D_\alpha$.
%     So~$d \in D_\alpha^\perp = E_\alpha^{\perp\perp} \subseteq E^{\perp\perp}$.
% Thus~$\left<x,d\right> = 0$, as desired. \qed
% \end{point}
% \end{point}

\begin{point}[selfdual-normalish-form]{Theorem}%
Let~$\scrB$ be a von Neumann algebra that is a factor (i.e.~with center~$\C 1$).
Suppose~$X$ is a self-dual Hilbert~$\scrB$-module.
Either there is a cardinal~$\kappa$
    such that~$X \cong \ell^2((1)_{\alpha \in \kappa})$,
    or there is a natural number~$n\in \N$
    and projection~$p \in \scrB$
    such that~$X \cong \ell^2((1, \ldots, 1, p))$,
    where~$1$ occurs~$n$ times.
\begin{point}{Proof}%
The case~$X = \{0\}$ is covered by~$\kappa=0$.
Assume~$X \neq \{0\}$.
\begin{point}[selfdual-normalish-form1]%
As a first step we will prove that
either
\begin{enumerate}
\item $X$ has an orthonormal basis~$E$
    such that~$\left<e,e\right>=1$ for some~$e \in E$ \emph{or}
\item there is a single vector~$e \in X$ such that~$\{e\}$ is an orthonormal basis.
\end{enumerate}
Pick any basis~$E_0$ of~$X$.
Let~$P$ denote the poset of subsets~$U \subseteq E_0 \times \scrB$
    satisfying
\begin{enumerate}
    \item
    $u$ is a partial isometry with $uu^* = \left<e,e\right>$
        for every~$(e,u) \in U$ \emph{and}
    \item
    the domains of the~$u$ are orthogonal:  $\sum_{(e,u) \in U} u^*u \leq 1$.
\end{enumerate}
For any chain~$C \subseteq P$
    it is easy to see~$\bigcup C \in P$
    and so by Zorn's lemma
    there is a maximal element~$U_0 \in P$.
Define
\begin{equation*}
e_0 \ =\  \sum_{(e,u) \in U_0} eu \qquad \qquad E_1 \ = \ E_0 - \{e;\ (e,u) \in U_0\}.
\end{equation*}
The set $\{e_0\} \cup E_1$ is a basis for~$X$ ---
    indeed if~$x = \sum_{e \in E_0} e \left<e,x\right>$,
    then
\begin{equation*}
    x \ =\  e_0 \Bigl(\sum_{(e,u) \in U_0} u^*\left<e,x\right>\Bigr)
            + \sum_{e \in E_1} e\left<e,x\right>.
\end{equation*}
If~$E_1 = \emptyset$, then~$\{e_0\}$ is an orthonormal basis of~$X$ and
    we have shown 1. 

For the other case, assume~$e_1 \in E_1$.
Write~$p_0 = \left<e_0,e_0\right>$
    and~$p_1 = \left<e_1,e_1\right>$.
Suppose~$p_1 \lesssim 1 - p_0$.
Then~$vv^* = p_1$ and~$v^*v \leq 1- p_0$ for some~$v \in \scrB$.
    Hence~$v^*v + p_0 \leq 1$.
    So~$U_0 \cup \{ (e_1, v) \} \in P$ contradicting maximality of~$U_0$.
Apparently~$p_1 \not\lesssim 1-p_0$.

In a factor~$\lesssim$ is total \TODO{ref},
    so~$1-p_0 \lesssim p_1$.
Let~$v \in \scrB$ be such that~$vv^*=1-p_0$
    and~$v^*v \leq p_1$.
Write~$p_0' = 1- v^*v$.
As~$1-p_0' \leq p_1 =1-(1-p_1)$
we have~$(1-p_0') + (1-p_1) \leq 1$.
Define~$q = 1- ((1-p_0') + (1-p_1))$.
Note~$q = p_0'+p_1 - 1$ and~$p_0', p_1 \leq q$.
Define
\begin{equation*}
    D \ = \ \{d_0, d_1\} \qquad \text{where} \quad
    d_0 \ =\   e_1 q \qquad
    d_1 \ = \ e_0 + e_1v^*.
\end{equation*}
From~$p_1q=q$ it follows~$D$ is orthogonal.
Clearly~$\left<d_0,d_0\right>=q$ and
\begin{equation*}
    \left<d_1, d_1\right>
        \ =\ \left<e_0, e_0\right> + vp_1v^*    
        \ =\ p_0 + vv^* \ =\ 1.
\end{equation*}
So~$D$ is an orthonormal set.
Using~$vv^*p_0 = 0$ and~$q+v^*v = p_1$, we see
that for any~$b_0 \in p_0\scrB$ and~$b_1 \in p_1 \scrB$
\begin{align*}
    d_0 b_1 + d_1(vb_1 + b_0)
    &\ = \ e_1 q b_1 + e_0 vb_1 + e_1v^*vb_1 + e_0 b_0 + e_1v^* b_0 \\
    &\ = \ e_1 q b_1 + e_0 p_0 vv^* vb_1 + e_1v^*vb_1 + e_0 b_0 + e_1v^* vv^* p_0 b_0 \\
    &\ = \ e_1 q b_1 + e_1v^*vb_1 + e_0 b_0  \\
    &\ = \ e_1 (q + v^*v) b_1 + e_0 b_0  \\
    &\ = \ e_1 b_1 + e_0 b_0.
\end{align*}
Thus~$D$ is an orthonormal basis of~$\{e_0, e_1\}^{\perp\perp}$.
Hence~$E \equiv D \cup (E_1 - \{e_1\})$ is an orthonormal basis of~$X$
with~$d_1 \in E$ such that~$\left<d_1,d_1\right>=1$.
\end{point}
\begin{point}%
For brevity, call~$X$ 1-dim if there is a one-element orthonormal basis of~$X$.
In~\sref{selfdual-normalish-form1} we saw
    how to create an orthonormal basis~$D$ of a non-1-dim~$X$
    with an~$e_0 \in D$ such that~$\left<e_0,e_0\right>=1$.
If~$\{e_0\}^\perp$ is not 1-dim,
    we can apply \sref{selfdual-normalish-form1}
    on~$\{e_0\}^\perp$ (instead of~$X$)
    to find an orthonormal basis~$D'$ of~$\{e_0\}^\perp$
    with~$e_1 \in D'$ such that~$\left<e_1,e_1\right>=1$.
This procedure can be continued using Zorn's lemma.
Let~$P$ denote the poset of subsets~$E \subseteq X$ satisfying
\begin{inparaenum}
\item $E$ is orthogonal \emph{and}
    \item $\left<e,e\right> = 1$ for all~$e \in E$.
\end{inparaenum}
Clearly~$\emptyset\in P$
and for any chain~$C \subseteq P$
    we have~$\bigcup C \in P$.
By Zorn's lemma there is a maximal~$E \in P$.
Suppose~$E^\perp \neq \{0\}$ and~$E^\perp$ is not 1-dim.
Then by \sref{selfdual-normalish-form1}
    we can find an orthonormal basis~$E'$ of~$E^\perp$
    together with~$e \in E'$ such that~$\left<e,e\right>=1$.
Now~$E' \cup \{e\} \in P$, contradicting maximality of~$E$.
Apparently~$E^\perp = \{0\}$ or~$E^\perp$ is 1-dim.
If~$E^\perp = \{0\}$
    then we are done
    taking~$\kappa$ the cardinality of~$E$.
For the other case, assume~$E^\perp = \{e\}^{\perp\perp}$
    for some~$e \in X$ with~$\left<e,e\right>$ a non-zero projection.
If~$E$ is finite, then we are done as well.
So, assume~$E$ is infinite.
Pick a sequence~$e_1, e_2, \ldots \in E$ of distinct elements.
Write~$p = \left<e,e\right>$
    and~$E_0 = \{e_n;\ n\in \N\}$.
Define
\begin{equation*}
    E_1 \ =\  \{e + e_1(1-p), \ e_1p + e_2(1-p),\  e_2p  +e_3(1-p),\  \ldots \}.
\end{equation*}
It is easy to see~$E_1$ is an orthogonal set
    with~$\left<d,d\right>=1$ for all~$d \in E_1$.
Furthermore~$E_1$ is an orthonormal basis for~$E_0 \cup \{e\}$,
    hence~$(E - E_0) \cup E_1$ is the desired orthonormal basis of~$X$. \qed
\end{point}
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}%
The ultranorm completion~\sref{dils-completion}
    is fixed by its universal property.
\end{point}
\begin{point}[selfdual-compl-defining]{Proposition}%
Let~$\scrB$ be a von Neumann algebra and~$V$ a right~$\scrB$-module
    with~$\scrB$-valued inner product~$[\,\cdot\,,\,\cdot\,]$.
There is an up-to-isomorphism unique
    self-dual Hilbert~$\scrB$-module~$X$
    together with inner product preserving $\scrB$-linear~$\eta \colon V \to X$
    with the following universal property
    \begin{quote}
    for every bounded~$\scrB$-linear map~$T\colon V \to Y$
    to some self-dual Hilbert~$\scrB$-module~$Y$,
    there is a unique bounded~$\scrB$-linear map~$\hat{T}\colon X \to Y$
    with~$\hat{T} \after \eta = T$.
    \end{quote}
For any such~$\eta\colon V \to X$,
    the image of~$V$ under~$\eta$ is ultranorm dense.
\begin{point}{Proof}%
We already know such a~$X$ and~$\eta\colon V \to X$
    exist by~\sref{dils-completion}
    and~\sref{selfdual-completion-univ}.
For this one~$\eta(V)$ is ultranorm dense in~$X$.
Assume there is another self-dual Hilbert~$\scrB$-module~$X_2$
    with inner product preserving~$\scrB$-linear~$\eta_2\colon V \to X_2$
    satisfying the universal property.
By the universal property of~$\eta$ applied to~$\eta_2$,
    there must exist a unique~$U \colon X  \to X_2$
    with~$U \after \eta  = \eta_2$.
Similarly, there is a~$V \colon X_2 \to X$
    with~$V \after \eta_2 = \eta$.
Clearly~$\id_{X} \after \eta = V \after \eta_2 = V \after U \after \eta$
    and so by the uniqueness~$\id = V\after U$.
    Similarly~$U \after V = \id$.
It remains to be shown~$U$ preserves the inner product.
As
\begin{equation*}
    \left<\eta(x),\eta(y)\right>
    = [x,y]
    = \left<\eta_2(x), \eta_2(y)\right>
    = \left<U \eta(x), U \eta(y)\right>
\end{equation*}
for all~$x,y \in X$;
$\eta(X)$ is ultranorm dense
and so by~\sref{innerprod-ultraweak}
    $U$ preserves the inner product.
\qed
\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}%
Suppose~$X$ is a Hilbert~$\scrA$-module
    and~$Y$ is a Hilbert~$\scrB$-module
    for some C$^*$-algebras~$\scrA$ and~$\scrB$.
The algebraic tensor product~$X \odot Y$
    is a right-$\scrA \odot \scrB$-module
    with~$(x\otimes y)\cdot (a\otimes b) = (xa) \otimes (yb)$.
It has an~$\scrA \odot \scrB$-valued inner
    product fixed by~$[x\otimes y, x'\otimes y']
        = \left<x,x'\right> \otimes \left<y,y'\right>$.
Write~$\scrA \otimes_\sigma \scrB$ for the minimal
    C$^*$-tensor product of~$\scrA$ and~$\scrB$.
The inner product on~$X \odot Y$ can be extended
    to an~$\scrA \otimes_\sigma \scrB$-valued inner product
    on the norm completion of~$X \odot Y$
    on which it is definite.
This is a Hilbert C$^*$-module,
    which is called the \emph{exterior tensor product} of~$X$ and~$Y$.
It is quite difficult to perform this construction:
    Lance discusses the difficulties in \cite[Ch.~4]{lance}.
If we assume~$\scrA$ and~$\scrB$ are von Neumann algebras
    \emph{and} that $X$ and~$Y$ are self-dual,
    it is rather easier.
\end{point}
\begin{point}{Theorem}%
Suppose~$\scrA$ and~$\scrB$ are von Neumanns algebras.
For any self-dual Hilbert $\scrA$-module $X$
    and self-dual Hilbert~$\scrB$-module $Y$,
    there is an up-to-isomorphism unique
    self-dual Hilbert~$\scrA\otimes \scrB$-module
    $X \otimes Y$, called the \Define{(self-dual exterior) tensor product},
    together with a~$\scrA \odot \scrB$-linear injective
    inner product preservering map~$\eta \colon X \odot Y \to X\otimes Y$
    with the following universal property:
    \begin{quote}
    for every self-dual~Hilbert~$\scrA\otimes\scrB$-module
    $Z$ with bounded~$\scrA \odot \scrB$-linear
        $T\colon X \odot Y \to Z$,
    there is a unique bounded~$\scrA \otimes \scrB$-linear
        map~$\hat{T}\colon X \otimes Y \to Z$
    with~$\hat{T} \after \eta= T$,
    \end{quote}
where we norm~$X \odot Y$ with~$\|t \| = \|[t,t]\|^{\frac{1}{2}}_{\scrA\otimes \scrB}$.
Write~$x \hotimes y = \eta(x\otimes y)$.
For any such~$X \otimes Y$ we have the following.
\begin{enumerate}
    \item The image of $X \odot Y$ is ultranorm dense in~$X \otimes Y$.
    \item If~$(e_i)_{i \in I}$ is an orthonormal basis of~$X$
                and~$(d_j)_{j \in J}$ is an orthonormal basis of~$Y$,
                then~$(e_i \hotimes d_j)_{i,j\in I\times J}$
                is an orthonormal basis of~$X \otimes Y$.
\end{enumerate}
\begin{point}{Proof}%
Pick orthonormal bases~$(e_i)_{i \in I}$ and~$(d_j)_{j \in J}$ of~$X$
    and~$Y$ respectively.
Write~$p_{ij} = \left<e_i, e_i\right>\otimes \left<d_j,d_j\right>
    \in \scrA \otimes \scrB$.
Define~$X \otimes Y = \ell^2((p_{ij})_{i,j \in I\times J})$,
    see \sref{hilbmod-el2}.
\begin{point}[ext-tensor-dfn-eta]{Definition~$\eta$}%
Pick~$x \in X$ and~$y \in Y$.
Write~$x_i = \left<e_i, x\right>$
and~$y_j = \left<d_j, y\right>$.
Then
\begin{align*}
    \left<x,x\right> \otimes \left<y,y\right>
    &\ = \ \bigl( \sum_i x_i^*x_i\bigr) \otimes\bigl(\sum_jy_j^*y_j\bigr)
            &\quad&\text{by Parseval}  \\
            &\ = \ \sum_{i,j}  x_i^*x_i  \otimes y_j^*y_j  &&\text{by \TODO{}}\\
            &\ = \ \sum_{i,j}  (x_i \otimes y_j)^* (x_i  \otimes y_j).
\end{align*}
Hence~$(x_i \otimes y_j)_{i,j}$ is~$\ell^2$-summable,
    and so there is a unique~$\scrA \odot\scrB$-linear map
    $\eta\colon X \odot Y \to X \otimes Y$ fixed
    by~$\eta(x \otimes y) = (x_i \otimes y_j)_{i,j}$.
\end{point}
\begin{point}[ext-tensor-preserves-inner-prod]{$\eta$ preserves inner product}%
Pick additional~$x' \in X$ and~$y' \in Y$.
Writing~$x'_i = \left<e_i,x'\right>$
    and~$y'_j = \left<d_j, y'\right>$,
we have
\begin{equation*}
    \left<\eta(x\otimes y), \eta(x' \otimes y')\right>
    \ = \ \sum_{i,j} (x_i\otimes y_j)^* \otimes (x_i' \otimes y_j')
    \ = \ \sum_{i,j} x_i^*x_i' \otimes y_j^* y_j'
\end{equation*}
and
\begin{equation*}
    \bigl(\sum_i x_i^*x_i'\bigr) \otimes \bigl( \sum_j y_j^* y_j' \bigr)
    \ = \ \left<x,x'\right> \otimes \left<y,y'\right>
    \ = \ \left<x\otimes y,x' \otimes y'\right> .
\end{equation*}
Thus it is sufficient to show
$\sum_{i,j} x_i^*x_i' \otimes y_j^* y_j'
    = \bigl(\sum_i x_i^*x_i'\bigr) \otimes \bigl( \sum_j y_j^* y_j' \bigr)$,
    which holds by \TODO{}.
Thus indeed~$\eta$ preserves the inner product.
\end{point}
\begin{point}{$\eta$ is injective}%
Let~$n \in \N$,~$x_1, \ldots, x_n \in X$
    and~$y_1,\ldots, y_n \in Y$
    be given such that~$\eta(\sum_l x_l \otimes y_l) = 0$
By~\sref{selfdual-gramschmidt}
    there are orthonormal~$e'_1,\ldots, e'_m \in X$
    such that~$x_l = \sum_i e'_i \langle e'_i, x_l\rangle$.
Similarly~$y_l = \sum_j d'_j \langle d'_j, y_l\rangle$
for some orthonormal~$d'_1, \ldots, d'_{m'} \in Y$.
As~$\eta$ preserves the inner product,
    the elements~$e_i'\hotimes d_j'$ are again orthonormal
    and so from
\begin{equation*}
    0 \ =\  \sum_l x_l \hotimes y_l
    \ =\  \sum_{i,j} (e'_i \hotimes d'_j) \bigl(\sum_l
         \langle e'_i, x_l\rangle \otimes \langle d'_j, y_l\rangle\bigr)
\end{equation*}
         it follows
         $\sum_l \langle e_i',x_l\rangle \otimes \langle d_j',y_l\rangle = 0$
         for all~$i,j$.
Consequently
\begin{equation*}
    \sum_l x_l \otimes y_l
        \ =\  \sum_{i,j} (e'_i \otimes d'_j) \bigl(\sum_l
        \langle e'_i, x_l \rangle \otimes \langle d'_j, y_l \rangle 
        \bigr) \ = \ 0,
\end{equation*}
which shows~$\eta$ is injective
    (and that the inner product on~$X \odot Y$ is definite).
\end{point}
\begin{point}{Image $\eta$ ultranorm dense}%
For brevity, write~$E = \{ e_i \hotimes d_j; \ i,j \in I\times J\}$.
By~\TODO{} $\scrA \odot \scrB$ is ultrastrongly dense in~$\scrA \otimes \scrB$.
So~$E (\scrA \odot \scrB)$
    is ultranorm dense in~$E (\scrA \otimes \scrB)$.
In turn the linear span of~$E (\scrA \otimes \scrB)$
    is (by construction) ultranorm dense in~$X \otimes Y$.
Thus the linear span of~$E (\scrA \odot \scrB)$
    is ultranorm dense in~$X \otimes Y$.
Hence the image of~$\eta$,
    which contains the linear span of~$E (\scrA \odot \scrB)$,
    is ultranorm dense in~$X \otimes Y$.
\end{point}
\begin{point}{Universal property}%
Let~$Z$ be a self-dual~Hilbert $\scrA \otimes \scrB$-module
 with bounded~$\scrA \odot \scrB$-linear $T\colon X \odot Y \to Z$.
If~$X \odot Y$ were an~$\scrA \otimes \scrB$-module
    \emph{and} both~$\eta$ and $T$ were~$\scrA \otimes \scrB$-linear,
    we could simply apply~\sref{selfdual-completion-univ}
    to get the desired~$\hat{T}$.
Instead, we will retrace the steps of its proof
    and modify it for the present situation.
Uniqueness of~$\hat{T}$ is the same:
    $\hat{T}$ is fixed by the ultranorm dense image of~$\eta$
    as it is bounded~$\scrA\otimes\scrB$-linear
    and so ultranorm continuous by \sref{blinear-bounded-is-ultranorm}.

The argument for existence of~$\hat{T}$ is more subtle.
We will show
\begin{equation}\label{eq:exttensorcontT}
    \left<T t, T t\right> \leq \|T\|^2 [t,t]
        \qquad \text{for all~$t \in X \odot Y$}.
\end{equation}
as a replacement for the ultranorm continuity of~$T$.
We cannot apply~\sref{blinear-inprod-inequality} directly:
    as~$\scrA \odot \scrB$ is not a C$^*$-algebra,
    we cannot construct~$(\left<t,t\right>+\varepsilon)^{-\frac{1}{2}}$
    required for its proof.
To prove \eqref{eq:exttensorcontT}, we will work in the norm completions.
Write~$\overline{\scrA \odot \scrB}$
    for the norm-closure of~$\scrA \odot \scrB$ in~$\scrA \otimes \scrB$.
Clearly~$\overline{\scrA \odot \scrB}$
    is a~C$^*$-algebra
    (in fact it is the spatial C$^*$-tensor product of~$\scrA$ and~$\scrB$).
Write~$\overline{X \odot Y}$
    for the norm-closure of the image of~$\eta$ in~$X \otimes Y$.
By norm continuity
    (see \sref{module-seminorm})
    the operations of~$X \otimes Y$
    restrict to turn~$X \odot Y$ into a
    Hilbert~$\overline{\scrA \odot \scrB}$-module.
As~$T$ uniformly continuous,
    there is a unique bounded~$\overline{\scrA\odot\scrB}$-linear
    $\overline{T}\colon \overline{X\odot Y} \to Z$
    with~$\overline{T} \after \eta = T$ and~$\|T\| = \|\overline{T}\|$.
Now we can apply the proof of~\sref{blinear-inprod-inequality}
    to~$\overline{T}$
    to find~$\langle \overline{T}s,\overline{T}s\rangle \leq
    \|\overline{T}\|^2\left<s,s\right>$
    for~$s \in \overline{X \odot Y}$.
Substituting~$s = \eta(t)$,
    we get \eqref{eq:exttensorcontT} as desired.

To define~$\hat{T}$, pick any~$t \in X \otimes Y$.
As the image of~$\eta$ is ultranorm dense,
there is a net~$(\eta(t_\alpha))_\alpha$ with~$\eta(t_\alpha) \to t$ ultranorm.
For any~np-map~$f\colon \scrA\otimes \scrB \to \C$
\begin{align*}
    \|T(t_\alpha) - T(t_\beta) \|_f^2 
        &\ =\ f(\langle T(t_\alpha - t_\beta), T(t_\alpha - t_\beta) \rangle) \\
        & \ = \ \|T\|^2 f([t_\alpha-t_\beta, t_\alpha - t_\beta]) \\
        & \ = \ \|T\|^2 f(\left<\eta (t_\alpha)-\eta(t_\beta), \eta(t_\alpha) - \eta(t_\beta)\right>) \ \to\  0.
\end{align*}
So~$(T t_\alpha)_\alpha$ is ultranorm Cauchy in~$Z$.
With a similar argument we see~$(Tt_\alpha)_\alpha \sim (T t'_\alpha)_\alpha$
whenever~$(\eta t_\alpha)_\alpha \sim (\eta t'_\alpha)_\alpha$.
So we may define
\begin{equation*}
\hat{T} t \ = \ \unlim_\alpha T t_\alpha.
\end{equation*}
Clearly~$\hat{T} \after \eta = T$.
With the same argument as in \sref{selfdual-completion-univ}
    we see~$\hat{T}$ is bounded and additive.
To show~$\hat{T}$ is~$\scrA\otimes \scrB$-linear,
    pick any~$b \in \scrA \otimes \scrB$.
There is a net~$b_\beta$ in~$\scrA \odot \scrB$
    with~$b_\beta \to b$ ultrastrongly.
If $\hat{T}$ is ultranorm continuous, we are done:
\begin{equation*}
    (\hat{T} t) b
    = \unlim_\beta (\unlim_\alpha T t_\alpha) b_\beta\\
     = \unlim_\beta \unlim_\alpha T (t_\alpha b_\beta) \\
     = \unlim_\beta \hat{T} (t b_\beta)\\
     = \hat{T} (tb).
\end{equation*}
To show~$\hat{T}$ is ultranorm continuous,
    assume~$t^\alpha \to 0$ ultranorm in~$X \otimes Y$.
It is sufficient to show~$\hat{T} t^\alpha \to 0$ ultranorm.
Let~$f\colon \scrA\otimes \scrB \to \C$ be any np-map.
Write~$\Phi$ for the set of entourages for ultranorm uniformity
    on~$X \otimes Y$.
As the image of~$\eta$ is ultranorm dense,
there are $t^\alpha_E \in \eta(X \odot Y)$
    such that~$t^\alpha_E \mathrel{E} t^\alpha$ for~$E \in \Phi$
    and so~$\hat{T} t^\alpha = \unlim_E T t^\alpha_E$.
There is some~$\alpha_0$
    such that for all~$\alpha \geq \alpha_0$
    we have~$\|t^\alpha \|_f \leq \varepsilon$.
There is also some~$\alpha_1$
    such that~$\|\hat{T} t^\alpha - \hat{T} t\|_f \leq \varepsilon$
    for~$\alpha \geq \alpha_11$.
Let~$\alpha_2$ be such that~$\alpha_2 \geq \alpha_1,\alpha_0$.
There is some~$E_0 \geq E_{f,\varepsilon}$
such that for all~$E \geq E_0$
we have~$\| \hat{T} t^{\alpha_2} -T t^{\alpha_2}_E \|_f \leq \varepsilon$.
For~$E \geq E_0$ we have~$E \geq E_{f,\varepsilon}$ and so
\begin{equation*}
 \|T t^{\alpha_2}_{E_0}\|_f
 \  \overset{\eqref{eq:exttensorcontT}}{\leq}\  \|T\| \|t^{\alpha_2}_{E_0}\|_f
  \  \leq\ \|T\|
    (\| t_{E_0} \|_f  +
            \|t_{E_0} - t^{\alpha_2}_{E_0}\|_f)
   \ \leq\  2 \|T\| \varepsilon.
\end{equation*}
    Consequently
\begin{equation*}
    \|\hat{T} t^{\alpha_2} \|_f \leq 
    \|\hat{T} t^{\alpha_2} - T t^{\alpha_2}_{E_0} \|_f
                + \|T t^{\alpha_2}_{E_0}\|_f
    \leq \varepsilon + 2\|T\|\varepsilon.
\end{equation*}
So~$\hat{T}t^\alpha \to 0$ ultranorm, as desired.
\end{point}
\begin{point}{Uniqueness}%
Assume there is a self-dual Hilbert~$\scrA\otimes\scrB$-module~$X \otimes_2 Y$
    together with a injective
    inner product-preserving~$\scrA\odot\scrB$-linear
    map~$\eta_2 \colon X \odot Y \to X \otimes_2 Y$
    also satisfying the universal property.
With the same reasoning as in \sref{selfdual-compl-defining}
    there is an invertible bounded~$\scrA\otimes\scrB$-linear
    $U\colon X \otimes Y \to X \otimes_2 Y$
    with~$U \after \eta = \eta_2$.
Clearly~$\left<Ux, U y\right> = \left<x,y\right>$
    for~$x,y \in E (\scrA\odot\scrB)$,
    where we defined~$E = \{e_i \hotimes d_j; \ i,j \in I\times J\}$.
As we saw the linear span of~$E (\scrA\odot\scrB)$
    is ultranorm dense in~$X \otimes Y$,
    we see~$U$ must preserve the inner product by \sref{innerprod-ultraweak}.
\end{point}
\begin{point}%
As we just have shown any exterior tensor is unique up to unique isomorphism,
    which respects the embeddings, property 1 from the statement
    of the theorem follows immediately.
Assume~$(e'_i)_{i \in I'}$ is a basis of~$X$
    and~$(d'_j)_{j \in J'}$ is a basis of~$Y$.
Using the unique isomorphism, it is sufficient to show
$E_2 =\{ e'_i \hotimes d'_j; \ i,j \in I'\times J'\}$
is a basis of~$X \hotimes Y$.
Clearly~$E_2$ is orthonormal.
By \sref{selfdual-orthn-basis} and \sref{hilbmod-projthm}
    it is sufficient to show~$e_{i_0} \hotimes d_{j_0} \in E_2^{\perp\perp}$
    for~$i_0 \in I$ and $j_0 \in J$.
Write~$a_i = \left<e_i',e_{i_0}\right>$
    and~$b_j = \left<d_j',d_{j_0}\right>$.
By \sref{selfdual-orthn-basis} and \sref{ext-tensor-preserves-inner-prod}
it is sufficient to show the right equality in
    \begin{equation*}
        \bigl(\sum_i a_i^*a_i\bigr) \otimes \bigl(\sum_j b_j^*b_j\bigr) \ = \ 
    \langle e_{i_0}\hotimes d_{j_0}, e_{i_0}\hotimes d_{j_0}\rangle
    \ =\  \sum_{i,j} a_i^*a_i \otimes b_j^*b_j,
    \end{equation*}
    which indeed holds by~\TODO{prod states sep}. \qed
\end{point}
\end{point}
\end{point}

\begin{point}{Examples}%
For the moment write~$\otimes_{\text{ext}}$ for the self-dual exterior
    tensor product.
\begin{enumerate}
\item
Any Hilbert space is a self-dual Hilbert~$\C$ module.
For Hilbert spaces~$\scrH$ and~$\scrK$
    we have~$\scrH \otimes_{\text{Hilb}} \scrK
        \cong \scrH \otimes_{\text{ext}} \scrK$,
    where~$\otimes_{\text{Hilb}}$ denotes the regular tensor product of
    Hilbert spaces.
\item
Every von Neumann algebra is a self-dual Hilbert C$^*$-module
    over itself.
For any von Neumann algebras~$\scrA$ and~$\scrB$
    we have~$\scrA\otimes_{\text{vN}} \scrB
        \cong \scrA \otimes_{\text{ext}} \scrB$
        as Hilbert~$\scrA\otimes_{\text{vN}} \scrB$-modules,
        where~$\scrA\otimes_{\text{vN}}\scrB$ denotes the regular
        tensor product of von Neumann algebras.
\end{enumerate}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
Let~$X$ be a self-dual Hilbert~$\scrA$-module
    and~$Y$ be a self-dual Hilbert~$\scrB$-module
    for von Neumann algebras~$\scrA$ and~$\scrB$.
\end{point}
\begin{point}{Definition}%
Assume~$S \in \scrB^a(X)$ and~$T \in \scrB^a(Y)$.
We write~$\Define{S \otimes T} \in \scrB^a(X\otimes Y)$
    for the unique bounded module map
    such that~$(S \otimes T) (x \otimes y) = (S x) \otimes (T y)$
    for all~$x\in X$ and~$y \in Y$.
\end{point}
\begin{point}[hilbmod-tensor-ketbra]{Exercise}%
    Show~$\ketbra{x_1}{x_2} \otimes \ketbra{y_1}{y_2}
            = \ketbra{x_1\otimes x_2}{y_1\otimes y_2}$.
\end{point}
\begin{point}{Theorem}%
There is an
    nmiu-isomorphism~$\vartheta\colon \scrB^a(X) \otimes \scrB^a(Y) \cong \scrB^a(X \otimes Y)$
    fixed by~$\vartheta(S\otimes T) = S \otimes T$.
\begin{point}{Proof}%
    \TODO{...}    
\begin{point}%
It remains to be shown~$\vartheta$ is surjective.
Pick an orthonormal bases~$(e_i)_{i \in I}$ for~$X$
    and~$(d_j)_{j \in J}$ for~$Y$.
Note~$(e_i \otimes d_j)_{i,j}$ is an orthonormal basis for~$X \otimes Y$.

By \sref{hilbmod-tensor-ketbra},
    we have for any~$a\in \scrA$, $b \in \scrB$,
    $i,i' \in I$ and~$j,j' \in J$ that
\begin{equation*}
    \ketbra{(e_i \otimes d_j) (a\otimes b)}{e_{i'} \otimes d_{j'}}
       \ =\ \ketbra{e_i a}{e_{i'}} \otimes\ketbra{d_j b}{d_{j'}}.
\end{equation*}
Thus~$\ketbra{(e_i \otimes d_j) (a\otimes b)}{e_{i'} \otimes d_{j'}}$
    is in the image of~$\vartheta$.
By \sref{ketbra-ultraweakly-dense} the operators of this form
    are ultraweakly dense and thus~$\vartheta$ is surjective.
    \TODO{fix}
\end{point}
\end{point}
\end{point}
\end{parsec}



\end{document}

% vim: ft=tex.latex
