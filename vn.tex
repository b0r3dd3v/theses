\documentclass[a]{subfiles}
\begin{document}
\chapter{Von Neumann Algebras}
\begin{parsec}%
We have arrived at the main subject of this thesis,
the special class of $C^*$-algebras
called von Neumann algebras (see definition~\sref{vna} below)
that are characterized by the existence
of certain directed suprema 
and an abundance  of functionals that preserve
these suprema.
While all $C^*$-algebras
and the cpsu-maps
between them
may perhaps serve as models for
quantum datatypes and processes, respectively,
for the purposes of this thesis
we focus our attention
the subcategory~$\W{cpsu}$ of von Neumann algebras
and the cpsu-maps between them that preserve aforementioned suprema
(which are called \emph{normal}, see~\sref{p-uwcont}),
because 
\begin{enumerate}
\item
we'll see that~$\W{cpsu}$
is a model of the quantum lambda calculus
(while~$\Cstar{cpsu}$ is not, \TODO{...}), and
\item
we were able to axiomatise
the sequential product ($b\mapsto \sqrt{a}b\sqrt{a}$)
in~$\W{cpsu}$ (but not in~$\Cstar{cpsu}$).
\end{enumerate}

The archetypal von Neumann algebra
is the $C^*$-algebra~$\scrB(\scrH)$
of bounded operators on a Hilbert space~$\scrH$,
and in fact 
the
original~\cite{vn1930,mvn1936}
and a common~\cite{kr,conway2000} 
definition of a von Neumann algebra
is a $C^*$-subalgebra~$\scrA$
of a~$\scrB(\scrH)$
that is closed in a ``suitable topology''
such as the strong or weak operator topology
(see~\sref{swot}).
Most authors make the distinction
between such rings of operators
(called von Neumann algebras)
and the $C^*$-algebras
miu-isomorphic to them
(called \emph{$W^*$-algebras}),
but we won't bother and call them all von Neumann algebras.
Partly because it seems difficult
to explain 
to a computer scientist
picturing a quantum data type
the meaning of the weak operator topology
and the Hilbert space~$\scrH$,
we'll use Kadison's characterization~\cite{kadison1956}
of von Neumann algebras
as $C^*$-algebras
with a certain dcpo-structure 
and sufficiently many Scott-continuous functionals
as our definition instead.

But we also use Kadison's definition
just to see to what extent
when errecting the basic theory of von Neumann algebras
we can do without representation
of a von Neumann algebras as a rings of operators
(\sref{ngns}, so liberally employed in the literature).
Instead we'll put the directed suprema and normal 
positive functionals
on center stage.
All the while
our treatment doesn't stray too far
from the beaten path,
and borrows
many arguments
from
the standard texts~\cite{sakai,kr};
nevertheless most of them had to be tweaked in places, and
some of them demanded a complete overhaul.


One technical advantage of von Neumann algebras
over $C^*$-algebras
is a greater availability of projections 
(elements~$p$ with~$p^*p=p$).
For example,
the existence of norm bounded directed suprema
in a von Neumann algebra~$\scrA$
allows us to show
that
there is a least projection~$\ceil{a}$
above any effect~$a$ from~$\scrA$
given by~$\ceil{a}=\bigvee_n a^{\nicefrac{1}{2}^n}$
(see~\sref{vna-ceil}).
We'll also see that any element of a von Neumann algebra
can be written as a norm limit
of linear combinations of projections (in~\sref{projections-norm-dense}),
so one can imagine that several theorems concerning elements
of a von Neumann algebra
are proven by first reducing the problem
to projections (see e.g.~\sref{vnsac}).

For more delicate constructions
in a von Neumann algebra~$\scrA$
two topologies
are instrumental to us:
the \emph{ultraweak topology}
induced by the normal positive functionals~$\omega\colon\scrA\to\C$,
and the \emph{ultrastrong topology}
induced by the associated seminorms~$\|\,\cdot\,\|_\omega$
(see~\sref{vna}).
Our first project of this chapter
is to show that a von Neumann algebra
is complete in the ultrastrong topology
and \emph{bounded} complete in the ultraweak topology
(see~\sref{vn-complete}).
This allows us to
define,
for example,
for any pair~$a$, $b$ of elements
from a von Neumann algebra~$\scrA$
with~$a^*a\leq b^*b$
an element $a/b$
with~$a=(a/b) \, b $
(see~\sref{division}).
Taking~$b=\sqrt{a^*a}$ we
obtain
the famous
polar decomposition~$a = (a/\sqrt{a^*a}) \, \sqrt{a^*a}$
(see~\sref{polar-decomposition},
which is usually proven 
for a bounded operator on a Hilbert space first).

We end the chapter by a detailed
study of the normal functionals
and show 
in~\sref{vn-center-separating-fundamental}
that any center separating collection (\sref{separating})
of normal positive functionals~$\Omega$
on a von Neumann algebra completely
determines the normal positive functionals,
which will be important for the definition of the tensor
product of von Neumann algebras in the next chapter.
\end{parsec}
\section{Definition and counterexamples}
\begin{parsec}[vna]%
\begin{point}{Definition}%
A $C^*$-algebra~$\scrA$
is a \Define{von Neumann algebra}
when
\begin{enumerate}
\item
every bounded directed subset~$D$
of self-adjoint elements of~$\scrA$ (so $D\subseteq \sa{\scrA}$) 
has a supremum $\bigvee D$ in $\sa{\scrA}$, and
\item
if $a$ is a positive element of~$\scrA$
with $\omega(a)=0$ for every \emph{normal} (see below) positive 
linear map $\omega\colon \scrA\to \C$,
then~$a=0$.
\end{enumerate}
\begin{point}%
A positive linear map $\omega\colon \scrA\to \C$
is called \Define{normal}
if $\omega(\bigvee D) = \bigvee_{d\in D} \omega(d)$
for every bounded directed subset of self-adjoint elements of~$D$
which has a supremum $\bigvee D$ in $\sa{\scrA}$.
\end{point}%
\begin{point}%
The \Define{ultraweak topology} on $\scrA$
is the least topology on~$\scrA$
that makes all normal positive linear maps $\omega\colon \scrA\to \C$
continuous.
The \Define{ultrastrong topology} on~$\scrA$
is the least topology on~$\scrA$
that makes $a\mapsto \omega(a^*a)$ continuous
for every np-map~$\omega\colon \scrA\to \C$.
\end{point}
\end{point}
\begin{point}{Remark}%
We work with the ultraweak and ultrastrong topology in tandem,
because neither is ideal, and they tend to be complementary:
for example, $a\mapsto a^*$ is ultraweakly continuous
but not ultrastrongly (see~\sref{vn-counterexamples},
point~\ref{vn-counterexamples-4}), 
while $a\mapsto \left|a\right|$
is ultrastrongly continuous (see~\sref{abs-us-cont})
but not ultraweakly (\sref{vn-counterexamples}, 
point~\ref{vn-counterexamples-6}).

When dealing with the ultrastrong topology
it is useful to recall that
every np-map gives rise
to an inner-product $[a,b]_\omega = \omega(a^*b)$
and semi-norm $\|a\|_\omega = \|[a,a]_\omega\|^{\nicefrac{1}{2}}
= \omega(a^*a)^{\nicefrac{1}{2}}$
(see~\sref{state-inner-product} and~\sref{omega-norm-basic}).
\end{point}
\begin{point}[von-neumann-examples]{Examples}%
\begin{enumerate}
\item
$\C$ and~$\{0\}$ are clearly von Neumann algebras.
\item
The $C^*$-algebra $\scrB(\scrH)$
of bounded operators on a Hilbert space~$\scrH$
is a von Neumann algebra:
$\scrB(\scrH)$ has bounded directed suprema
of self-adjoint elements
by~\sref{hilb-suprema},
and the vector states
(and thus all normal functionals)
are order separating
(and thus faithful)
by~\sref{hilb-vector-states-order-separating}.
\item
The direct product $\bigoplus_i \scrA_i$
(see~\sref{cstar-product})
of a family $(\scrA_i)_i$
of von Neumann algebras
is itself a von Neumann algebra.
\item
A $C^*$-subalgebra~$\scrB$
of a von Neumann algebra~$\scrA$
is called a \Define{von Neumann subalgebra}
(and is itself a von Neumann algebra)
if for every bounded directed subset~$D$
of self-adjoint elements from~$\scrB$
we have $\bigvee D\in\scrB$
(where the supremum is taken in~$\sa{\scrA}$).
\item
We'll see in~\sref{mn-vna}
that the $N\times N$-matrices over a von Neumann algebra~$\scrA$
form a von Neumann algebra.
\item
We'll see in~\sref{commutant-basic}
that given a subset~$S$ of a von Neumann algebra~$\scrA$
the set~$S^\square = \{\,a\in\scrA\colon\, \forall s\in S\,[\ as=sa\ ]\,\}$
called the \emph{commutant} of~$S$
is a von Neumann subalgebra of~$\scrA$
when~$S$ is closed under involution.
\end{enumerate}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}{Exercise}%
Let~$\scrA$ be a von Neumann algebra.
\begin{enumerate}
\item
Show that 
$\left|\omega(a)\right|\leq \|a\|_\omega \|\omega\|^{\nicefrac{1}{2}}$
for every np-map $\omega\colon \scrA\to\C$
and~$a\in\scrA$.
\item
Show that when a net $(a_\alpha)_\alpha$
in~$\scrA$ converges ultrastrongly to~$a\in \scrA$
it does so too ultraweakly.
\item
Show that an ultraweakly closed subset~$C$ of~$\scrA$
is also ultrastrongly closed.
\end{enumerate}
\end{point}
\begin{point}[vn-counterexamples]{Exercise}%
We give some counterexamples in $\scrB(\ell^2)$
to sharpen your understanding of the ultrastrong and ultraweak topologies,
and so that you may better appreciate
the strange maneuvers we'll need to pull off later on.
\begin{enumerate}
\item
Given~$n,m\in \N$,
we denote by $\ketbra{n}{m}$
the bounded operator on~$\ell^2$
given by $(\ketbra{n}{m})(f)(n)=f(m)$
and~$(\ketbra{n}{m})(f)(k)=0$ for $k\neq n$
and $f\in \ell^2$.

Verify the following computation rules,
where $k,\ell,m,n\in \N$.
\begin{equation*}
(\ketbra{n}{m})^*\ =\ \ketbra{m}{n},
\qquad
\ketbra{n}{m}\ketbra{\ell}{k}\ =\ 
\begin{cases}
\ \ \ketbra{n}{k} & \text{if $m=\ell$} \\
\ \ 0 & \text{otherwise}
\end{cases}
\end{equation*}
\item
Show that $\bigvee_N \sum_{n=0}^N \ketbra{n}{n}=1$.

Conclude that~$(\,\ketbra{n}{n}\,)_n$
converges ultrastrongly (and ultraweakly) to~$0$.

Thus ultrastrong (and ultraweak) convergence does not imply norm convergence,
as one might have expected.
But we also see that if a sequence~$(b_n)_n$ converges ultrastrongly
(or ultraweakly) to some~$b$,
then $(\|b_n\|)_n$ doesn't even have to converge to~$\|b\|$
(compare this with Lebesgue's dominated convergence
theorem, see~123C of~\cite{fremlin}).

(Note that~$(\ketbra{n}{n})_n$ resembles a moving bump, from measure theory.)
\item
Note that when a net $(a_\alpha)_\alpha$
(in, say, $\scrB(\ell_2)$)
converges ultrastrongly to~$a$,
then $(\,a_\alpha^*a_\alpha\,)_\alpha$
is norm-bounded and
converges ultraweakly to~$a^*a$.

The converse does not hold:
show that (already in~$\C$)
$e^{in}$
does not converge ultraweakly 
(nor ultrastrongly) as $n\to \infty$,
while $1\equiv e^{-in} e^{in}$
is norm-bounded and
converges ultraweakly to~$1$ as~$n\to\infty$.
\item
\label{vn-counterexamples-4}
Show that~$(\,\ketbra{0}{n}\,)_n$ converges ultrastrongly 
(and ultraweakly) to~$0$.

Deduce that $(\,\ketbra{n}{0}\,)_n$ converges ultraweakly to~$0$,
but doesn't converge ultrastrongly at all.

Conclude that~$a\mapsto a^*$ is not ultrastrongly continuous 
on~$\scrB(\ell^2)$.

(This has the annoying side-effect,
that it is not immediately clear that the ultrastrong
closure of a $C^*$-subalgebra of a von Neumann algebra 
is a von Neumann subalgebra; we'll deal with this
by showing that the ultrastrong closure coincides
with the ultraweak closure in~\sref{ultraclosed}.)
\item
Show that the unit ball~$(\,\scrB(\ell^2)\,)_1$
of~$\scrB(\ell^2)$ is not ultrastrongly compact
by proving that $(\,\ketbra{0}{n}\,)_n$
has no ultrastrongly-convergent subnet.

(But we'll see in~\sref{vn-ball-compact} that
the unit ball of a von Neumann algebra
is ultraweakly compact.)

\item
\label{vn-counterexamples-6}
Show that $\ketbra{n}{0}+\ketbra{0}{n}$
converges ultraweakly to~$0$ as $n\to \infty$,
while $(\ketbra{n}{0}+\ketbra{0}{n})^2\equiv \ketbra{0}{0}+\ketbra{n}{n}$
converges ultraweakly to~$\ketbra{0}{0}$.

Conclude that~$a\mapsto a^2$ is not ultraweakly continuous on~$\scrB(\ell^2)$.

Conclude that $a,b\mapsto ab$ is not jointly ultraweakly continuous
on~$\scrB(\ell^2)$.

Prove that~$\left|\, \ketbra{n}{0}+\ketbra{0}{n}\,\right|
= \ketbra{0}{0}+\ketbra{n}{n}$.

Conclude that~$a\mapsto \left|a\right|$
is not ultraweakly continuous on~$\sa{(\scrB(\ell^2))}$.

(We'll see in~\sref{proto-kaplansky} that $a\mapsto \left|a\right|$
is ultrastrongly continuous on self-adjoint elements.)

\item
Let us consider the two extensions of~$\left|\,\cdot\,\right|$
to arbitrary elements, namely
$a\mapsto \sqrt{a^*a}=:\Define{\left|a\right|_s}$ and 
$a\mapsto \sqrt{aa^*}=:\Define{\left|a\right|_r}$
(for \textbf{s}upport and \textbf{r}ange,
c.f.~\sref{hilb-ceil}).

Prove that $\ketbra{0}{0} + \ketbra{0}{n}$
converges ultrastrongly to~$\ketbra{0}{0}$ as $n\to \infty$.

Show that $\left|\,\ketbra{0}{0}+\ketbra{0}{n}\,\right|_s
= \ketbra{0}{0}
+\ketbra{0}{n}
+\ketbra{n}{0}
+\ketbra{n}{n}$
converges ultraweakly to~$\left|\,\ketbra{0}{0}\,\right|_s
\equiv \ketbra{0}{0}$
as $n\to \infty$,
but not ultrastrongly.

Show that $\left|\,\ketbra{0}{0}+\ketbra{0}{n}\,\right|_r
= \sqrt{2} \ketbra{0}{0}$.

Conclude that $\left|\,\cdot\,\right|_s$
and $\left|\,\cdot\,\right|_r$
are not ultrastrongly continuous on~$\scrB(\ell^2)$.

\item
Show that $1+\ketbra{n}{0}+\ketbra{0}{n}$
are positive,
and 
converge ultraweakly to~$1$,
while their squares
$1+\ketbra{n}{n}+\ketbra{0}{0}+2\ketbra{n}{0}+2\ketbra{0}{n}$
converge ultraweakly to $1+\ketbra{0}{0}$
(as $n\to\infty$).

Hence~$a\mapsto a^2$
and $a\mapsto \sqrt{a}$
are not ultraweakly continuous on $\pos{\scrB(\ell^2)}$.

\item
For the next counterexample,
we need a growing moving bump,
which still converges ultraweakly.
Sequences won't work here:

Show that $n\ketbra{n}{n}$ does not converge ultraweakly as~$n\to\infty$.

Show that $n \ketbra{f(n)}{f(n)}$ does not converge ultraweakly
as $n\to\infty$
for every strictly monotone map~$f\colon \N\to\N$.

So we'll resort to a net.
Let~$D$ be the directed set which consists of pairs $(n,f)$,
where $n\in \N\backslash\{0\}$ and $f\colon \N\to\N$
is monotone, ordered by $(n,f)\leq (m,g)$ iff $n\leq m$ and $f\leq g$.

Show that the net $(\, n\ketbra{f(n)}{f(n)}\,)_{n,f\in D}$
converges ultrastrongly to~$0$.

So a net which converges ultrastrongly need not be bounded!
(The cure for this pathology is Kaplansky's density theorem, 
see~\sref{kaplansky}.)

Show that $\frac{1}{n} \ketbra{f(n)}{0}$
converges ultrastrongly to~$0$ as $D\ni(n,f)\to \infty$.

Show that the product
$\ketbra{f(n)}{0} = (\,n\ketbra{f(n)}{f(n)}\,)\,(\,\frac{1}{n}
\ketbra{f(n)}{0}\,)$
does not converge ultrastrongly 
as $D\ni(n,f)\to\infty$.

Conclude that multiplication $a,b\mapsto ab$
is not jointly ultrastrongly continuous on~$\scrB(\ell^2)$,
even when~$b$ is restricted to a bounded set.

(Nevertheless we'll see that multiplication is ultrastrongly continuous
when~$a$ is restricted to a bounded set,
and that multiplication is ultrastrongly continuous
separately in both arguments.)

\item
Show that
$a_{n,f} = \frac{1}{n}(\ketbra{f(n)}{0}+\ketbra{0}{f(n)})
\,+\, n\ketbra{f(n)}{f(n)}$
converges ultrastrongly to~$0$
as $D\ni(n,f)\to\infty$,
while $a_{n,f}^2$ does not.

Hence~$a\mapsto a^2$ is not ultrastrongly continuous on~$\sa{\scrB(\ell^2)}$.

\item
Let us show that~$\scrB(\ell^2)$
is not ultraweakly complete.

Show that there is an unbounded linear map~$f\colon \ell^2\to\C$,
and that for each finite dimensional linear subspace~$S$ of~$\ell^2$,
there is a unique vector~$x_S\in S$ 
with
$f(x)=\left<x_S,y\right>$ for all~$y\in S$
(using~\sref{riesz-representation-theorem}).

Consider the net~$(\,\ketbra{e}{x_S}\,)_S$
where~$S$ ranges over the finite dimensional subspaces of~$\ell^2$
ordered by inclusion,
and~$e$ is some fixed vector in~$\ell^2$ with~$\|e\|=1$.

Let~$\omega\colon \scrB(\ell^2)\to\C$
be an np-map,
so $\omega\equiv \sum_n \left<y_n,(\,\cdot\,)y_n\right>$
for $y_1,y_2,\dotsc \in \ell^2$ with $\sum_n \|y_n\|^2 <\infty$,
see~\sref{bh-np}.

Show that $\omega(\,\ketbra{e}{x_S}-\ketbra{e}{x_T}\,)
= \left<\,x_S-x_T,\,\sum_n y_n\left<y_n,e\right>\,\right> = 0$
when $S$ and~$T$ are finite dimensional linear subspaces of~$\ell_2$
which contain the vector $\sum_n y_n\left<y_n,e\right>$.

Conclude that~$(\,\ketbra{e}{x_S}\,)_S$
is ultraweakly Cauchy.

Show that if~$(\,\ketbra{e}{x_S}\,)_S$
converges ultraweakly to some~$A$ in~$\scrB(\ell^2)$,
then we have~$\left<e,Ay\right>=f(y)$
for all~$y\in\ell^2$.

Conclude that~$(\,\ketbra{e}{x_S}\,)_S$
does not converge ultraweakly,
and that~$\scrB(\ell^2)$ is not ultraweakly complete.

(Nevertheless, we'll see that every von Neumann algebra
is ultrastrongly complete, and that
every norm-bounded ultraweakly-Cauchy net
in a von Neumann converges, in~\sref{vn-complete}.)
\end{enumerate}
\end{point}
\end{parsec}
\section{The basics}
%
% multiplication turns suprema into ultraweak limits
%
\begin{parsec}%
\begin{point}%
It is clear that translation and scaling
on a von Neumann algebra
are ultraweakly (and ultrastrongly) continuous.
We will see in this paragraph that multiplication
is also ultraweakly (and ultrastrongly) continuous
in each coordinate.
Quite surprisingly,
the problem reduces to the ultraweak continuity
of $b\mapsto a^*ba$ by the following identity
(cf.~\sref{inner-product-basic}).
\end{point}
\begin{point}[mult-polarization]{Exercise}%
Show that for elements~$a,b,c$ of a $C^*$-algebra,
\begin{equation*}
\textstyle
a^*\,c\,b\ =\ \frac{1}{4}\,\sum_{k=0}^3\ i^k\  (i^ka+b)^*\,c\,(i^ka+b).
\end{equation*}
\end{point}
\begin{point}[vanishing-effects]{Lemma}%
Let~$(x_\alpha)_{\alpha\in D}$ be 
a net of effects of a von Neumann algebra~$\scrA$,
which converges ultraweakly to~$0$.
Let~$(b_\alpha)_{\alpha\in D}$ be a 
net of elements with~$\|b_\alpha\| \leq 1$ for all~$\alpha$.
Then $(x_\alpha b_\alpha)_\alpha$ converges ultraweakly
to~$0$.
\begin{point}{Proof}%
Let~$\omega\colon \scrA\to \C$ be an np-map.
We have, for each~$\alpha$,
\begin{alignat*}{3}
\left|\,\omega(x_\alpha b_\alpha)\,\right|^2
\ &=\ 
\left|\, \omega(\,\sqrt{x_\alpha}\,\sqrt{x_\alpha}\,b_\alpha\,)\, \right|^2
\qquad&&\text{since $x_\alpha\geq 0$}\\
\ &\leq\ 
\omega(x_\alpha)\  \omega(\,b_\alpha^* x_\alpha b_\alpha\,) 
\qquad&&\text{by Kadison's inequality, \sref{omega-norm-basic}}\\
\ &\leq\ 
\omega(x_\alpha)\ \omega(b_\alpha^* b_\alpha)
\qquad&&\text{since $x_\alpha\leq 1$}\\
\ &\leq\ 
\omega(x_\alpha)\ \omega(1)
\qquad&&\text{since $b_\alpha^*b_\alpha\leq 1$}.
\end{alignat*}
Thus,
since $(\omega(x_\alpha))_\alpha$
converges to~$0$,
we see that $(\omega(x_\alpha b_\alpha))_\alpha$
converges to~$0$,
and so $(x_\alpha b_\alpha)_\alpha$ converges ultraweakly to~$0$.\qed
\end{point}
\end{point}
\begin{point}{Exercise}%
Let~$D$ be a bounded directed set of self-adjoint
elements of a von Neumann algebra~$\scrA$,
and let~$a\in \scrA$.
\begin{point}[vna-supremum-uwlimit]%
Show that the net~$(d)_{d\in D}$ converges ultraweakly to~$\bigvee D$.
\end{point}
\begin{point}[vna-supremum-mult]%
Use~\sref{vanishing-effects}
to show that $(da)_d$ converges ultraweakly to~$(\bigvee D)a$,
and that~$(a^*d)_d$ converges ultraweakly to~$a^* (\bigvee D)$.
\end{point}
\end{point}
%
%  ad is normal
%
\begin{point}[ad-normal]{Proposition}%
Let~$a$ be an element of a von Neumann algebra~$\scrA$.
Then~$\bigvee_{d\in D} a^*\,d\,a = a^*\,(\bigvee D)\, a$
for every bounded directed subset~$D$ of self-adjoint
elements of~$\scrA$.
\begin{point}[ad-normal-1]{Proof}%
If~$a$ is invertible,
then the (by~\sref{astara-pos-basic-consequences}) order preserving map $b\mapsto a^*ba$
has an order preserving inverse (namely $b\mapsto (a^{-1})^* b a^{-1}$),
and therefore preserves all suprema.
\begin{point}%
The general case reduces to the case that~$a$ 
is invertible
in the following way.
There is (by~\sref{spectrum-bounded})
 $\lambda>0$ such that $\lambda+a$ is invertible.
Then as $d$ increases 
\begin{equation*}
a^*\,d\,a \ \equiv\  (\lambda+a)^*\,d\,(\lambda+a) \,-\,
 \lambda^2d \,-\, \lambda a^*d \,-\, \lambda da
\end{equation*}
converges ultraweakly
to~$a^* \,(\bigvee D)\,a$,
because $(\ (\lambda+a)^*\,d\,(\lambda+a)\ )_d$
converges ultraweakly to $(\lambda+a)^*\,(\bigvee D)\,(\lambda+a)$
by~\sref{ad-normal-1} and~\sref{vna-supremum-uwlimit},
and $(a^*d+da)_d$ converges ultraweakly to $a^*(\bigvee D)+(\bigvee D)a$
by~\sref{vna-supremum-mult}.
Since~$(a^*da)_d$ converges to~$\bigvee_{d\in D} a^*d a$ too,
we could conclude that
$\bigvee_{d\in D} a^* \,d\, a = a^*\,(\bigvee D)\,a$
if we would already know that the ultraweak topology is Hausdorff.
At the moment, however,
we must content ourselves with
the conclusion that
$\omega(\,a^*\bigvee D a\,-\, \bigvee_{d\in D} a^* d a\,)=0$
for every np-functional~$\omega$ on~$\scrA$.
But since
$a^*\bigvee D a - 
\bigvee_{d\in D} a^* da$
happens to be positive,
we conclude that
$a^*\bigvee D a  
- \bigvee_{d\in D} a^* d a =0$
nonetheless.\qed
\end{point}
\end{point}
\end{point}
\begin{point}[vn-positive-basic]{Exercise}%
Show that the set of np-functionals
on a von Neumann algebra~$\scrA$
is not only faithful 
but also order separating
using~\sref{proto-gelfand-naimark}.
Deduce
\begin{enumerate}%
\item
that the ultraweak and ultrastrong topologies
are Hausdorff,
\item
that~$\scrA_+$, 
$\sa{\scrA}$ and~$[0,1]_\scrA$  are ultraweakly 
(and ultrastrongly) closed, 
\item
and that the unit ball
$(\scrA)_1$
is ultrastrongly closed.

(We'll see only later on, in~\sref{ultraclosed},
that~$(\scrA)_1$
is ultraweakly closed as well.)
\end{enumerate}
\end{point}
\begin{point}{Exercise}%
Let~$D$ be a directed subset of self-adjoint elements
of a von Neumann algebra~$\scrA$,
and let~$a\in\scrA$.
\begin{point}[vna-supremum-commutes]%
Show that if~$ad=da$ for all~$d\in D$,
then $a(\bigvee D) = (\bigvee D)a $.
\end{point}
\begin{point}[vna-supremum-uslimit]%
Use~\sref{vanishing-effects}
to show that $(\bigvee D-d)^2$ converges ultraweakly to~$0$.

Conclude that~$(d)_{d\in D}$ converges ultrastrongly to~$\bigvee D$.
\end{point}
\end{point}
\begin{point}[p-uwcont]{Exercise}%
Show that for a positive linear map $f\colon \scrA\to\scrB$
between von Neumann algebras,
the following are equivalent.
\begin{enumerate}
\item
$f$ is ultraweakly continuous;
\item
$f$ is ultraweakly continuous on~$[0,1]_\scrA$;
\item
$f(\bigvee D)=\bigvee_{d\in D}f(d)$ for each bounded 
directed~$D\subseteq\sa{\scrA}$;
\item 
$\omega\circ f\colon \scrA\to\C$ is normal 
for each np-map $\omega\colon \scrB\to\C$.
\end{enumerate}
In that case we say that~$f$ is \Define{\textbf{n}ormal}.

Conclude that $b\mapsto a^*ba,\,\scrA\to\scrA$
is ultraweakly
continuous for every element~$a$ of a von Neumann 
algebra~$\scrA$.
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}{Exercise}%
Show that if a positive linear map $f\colon \scrA\to\scrB$
between von Neumann algebras 
is ultrastrongly continuous (on~$[0,1]_\scrA$), 
then~$f$ is normal.
(Hint: use that a bounded directed set 
$D\subseteq \sa{\scrA}$ converges ultrastrongly to~$\bigvee D$.)

The converse does not hold: give an example of a map~$f$ 
which is normal, but 
not be ultrastrongly continuous. (Hint: transpose.)
\end{point}
\begin{point}[cp-uscont]{Proposition}%
An ncp-map $f\colon \scrA\to\scrB$
between von Neumann algebras is 
ultrastrongly continuous.
\begin{point}{Proof}%
To show that~$f$
is ultrastrongly continuous,
it suffices to show that~$f$ is ultrastrongly continuous at~$0$.
So let~$(b_\alpha)_\alpha$ be a net in~$\scrA$
which converges ultrastrongly to~$0$;
we must show that $(f(b_\alpha))_\alpha$
converges ultrastrongly to~$0$, c.q.~that
$(\,f(b_\alpha)^*f(b_\alpha)\,)_\alpha$ converges ultraweakly to~$0$.
Since
$f(b_\alpha)^*f(b_\alpha) \leq f(b_\alpha^*b_\alpha) \|f(1)\|$
by~\sref{cp-cs}, 
it suffices to show that~$(\,f(b_\alpha^*b_\alpha)\,)_\alpha$
converges ultraweakly to~$0$,
but this follows from the
fact that~$f$ is ultraweakly continuous,
and~$(b_\alpha^*b_\alpha)_\alpha$
converges ultraweakly to~$0$
(since~$(b_\alpha)_\alpha$ converges ultrastrongly to~$0$).\qed
\end{point}
\end{point}
\begin{point}[mult-uws-cont]{Exercise}%
Let~$\scrA$ be a von Neumann algebra.
Conclude (using~\sref{cp-uscont} and~\sref{ad-cp})
that the map $a\mapsto b^*ab,\,\scrA\to\scrA$
is ultrastrongly continuous for every
 element~$b\in\scrA$.

Use this,
and~\sref{mult-polarization},
to
show that $b\mapsto ab,\,ba\colon\ \scrA\to\scrA$
are ultraweakly and ultrastrongly continuous
for every element~$a$ of a von Neumann algebra~$\scrA$.
\end{point}
\begin{point}[usconv]{Exercise}%
Show that a net $(b_\alpha)_\alpha$ 
in a von Neumann algebra~$\scrA$
converges ultrastrongly to an element~$b$
of~$\scrA$
if and only if
both $b_\alpha^*b_\alpha\longrightarrow b^*b$
and~$b_\alpha\longrightarrow b$
ultraweakly as~$\alpha\to\infty$.
\end{point}
\begin{point}[npuws]{Exercise}%
Show that for a positive linear map $\omega \colon \scrA\to\C$
on a von Neumann algebra~$\scrA$
the following are equivalent
\begin{enumerate}
\item
	$\omega$ is normal;
\item
	$\omega$ is ultraweakly continuous;
\item
	$\omega$ is ultrastrongly continuous.
\end{enumerate}
(Hint: combine~\sref{p-uwcont} and \sref{cp-uscont}.)
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}{Definition}%
We denote 
the category of
\emph{normal} cpsu-maps
by~$\Define{\W{cpsu}}$,
and its subcategory of nmiu-maps
by~$\Define{\W{miu}}$.
\begin{point}%
This pair of categories plays a major role in the next
chapter, but for now we content ourselves
by only describing products and certain equalizers.
\end{point}
\end{point}
\begin{point}[vn-products]{Exercise}%
Show that
given a family $(\scrA_i)_i$
of von Neumann algebras
the direct product
$\bigoplus_i \scrA_i$
from~\sref{cstar-product}
is a von Neumann algebra
and  the projections
$\pi_j \colon \bigoplus_i \scrA_i\to\scrA_j$
are normal.
Moreover, show
that this makes~$\bigoplus_i \scrA_i$
into the  product of the~$\scrA_i$
in the categies~$\W{miu}$ and~$\W{cpsu}$
(see~\sref{cstar-product-2} and~\sref{cstar-product-4}).
\end{point}
\begin{point}[vn-equalizers]{Exercise}%
Show that given nmiu-maps $f,g\colon \scrA\to\scrB$
between von Neumann algebras
the set~$\scrE:=\{\,a\in\scrA\colon\, f(a)=g(a)\,\}$
is a von Neumann subalgebra of~$\scrA$,
and the inclusion~$e\colon \scrE\to\scrA$
is the equalizer of~$f$ and~$g$ in the 
categories~$\W{miu}$ and~$\W{cpsu}$
(see~\sref{cstar-equalizer-1} and~\sref{cstar-product-4}).
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
Let us quickly prove that every von Neumann algebra
is isomorphic to a von Neumann algebra of operators on a 
Hilbert space (see~\sref{ngns}).
\end{point}
\begin{point}[normal-faithful]{Exercise}%
Let~$\Omega$ be a collection of np-functionals
on a von Neumann algebra~$\scrB$
that is faithful (see~\sref{separating}).
Show that a positive linear map $f\colon \scrA\to\scrB$
is normal iff~$\omega\circ f$
is normal for all~$\omega\in\Omega$.
\end{point}
\begin{point}{Proposition}%
Given an np-map~$\omega\colon \scrA \to \C$
on a von Neumann algebra~$\scrA$,
the map $\varrho_\omega\colon \scrA\to\scrB(\scrH_\omega)$
from~\sref{gns} is normal.
\begin{point}{Proof}%
Since by definition of~$\scrH_\omega$
the vectors of the form~$\eta_\omega(a)$
where~$a\in\scrA$
are dense in~$\scrH_\omega$,
the vector functionals
$\left<\eta_\omega(a),(\,\cdot\,)\eta_\omega(a)\right>$
form a faithful collection
of np-functionals on~$\scrB(\scrH_\omega)$.
Thus by~\sref{normal-faithful}
it suffices to show given~$a\in\scrA$
that $\left<\eta_\omega(a),\varrho_\omega(\,\cdot\,)
\eta_\omega(a)\right>\equiv \omega(a^*(\,\cdot\,)a)$ is normal,
which it is, by~\sref{ad-normal}.\qed
\end{point}
\end{point}
\begin{point}[varrho-Omega-normal]{Exercise}%
Show that the map $\varrho_\Omega$ 
from~\sref{gelfand-naimark-representation}
is normal for every collection~$\Omega$ of np-maps $\scrA\to\C$
on a von Neumann algebra $\scrA$.
\end{point}
\begin{point}[injective-nmiu-iso-on-image]{Lemma}%
Let~$f\colon \scrA\to\scrB$ be an injective nmiu-map
between von Neumann algebras.
Then~$f(\scrA)$ is a von Neumann subalgebra of~$\scrB$,
and~$f$ restricts to a nmiu-isomorphism from~$\scrA$
to~$f(\scrA)$.
\begin{point}{Proof}%
We already know by~\sref{injective-miu-iso-on-image}
that~$f(\scrA)$ is a $C^*$-subalgebra of~$\scrA$,
and that~$f$ restricts to a miu-isomorphism~$f'\colon \scrA\to f(\scrA)$.
The only thing left to show is that~$f(\scrA)$
is a von Neumann subalgebra of~$\scrB$,
because a miu-isomorphism between von Neumann algebras
(being an order isomorphism)
will automatically be a nmiu-isomorphism.
Let~$D$ be a bounded directed subset of~$f(\scrA)$.
Note that~$S:=(f')^{-1}(D)$ is a bounded
directed subset of~$\scrA$,
and so~$\bigvee D\equiv  \bigvee f(\,S\,)
= f(\bigvee S)$, because~$f$ is normal.
Thus~$\bigvee f(D)\in f(\scrA)$,
and so $f(\scrA)$ is a von Neumann subalgebra of~$\scrB$.\qed
\end{point}
\end{point}
\begin{point}[ngns]{Theorem (normal Gelfand--Naimark)}%
Every von Neumann algebra~$\scrA$ is nmiu-isomorphic
to von Neumann algebra of operators on a Hilbert space.
\begin{point}[ngns-proof]{Proof}%
Recall that an element $a\in \scrA$ is zero iff $\omega(a)=0$
for all np-maps $\omega\colon \scrA\to\C$.
It follows that the collection~$\Omega$
of all np-maps $\scrA\to\C$
obeys the condition of~\sref{proto-gelfand-naimark},
and so the miu-map $\varrho_\Omega\colon \scrA\to\scrB(\scrH_\Omega)$
(from~\sref{gelfand-naimark-representation})
is injective.
Since~$\varrho_\Omega$
is also normal by~\sref{varrho-Omega-normal},
we see by~\sref{injective-nmiu-iso-on-image} that~$\varrho_\Omega$
restricts to a nmiu-isomorphism
from~$\scrA$ to the von Neumann subalgebra~$\varrho_\Omega(\scrA)$
of~$\scrB(\scrH_\Omega)$.\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
We end the section
by showing that the $C^*$-algebra
of $N\times N$-matrices~$M_N(\scrA)$
over a von Neumann algebra~$\scrA$
is itself a von Neumann algebra.
\end{point}
\begin{point}[bah-vn]{Theorem}%
Given a von Neumann algebra~$\scrA$,
the~$C^*$-algebra $\scrB^a(X)$ (\sref{bax-cstar})
of bounded adjoinable module maps on
a self-dual (\sref{self-dual}) Hilbert $\scrA$-module~$X$
is a  von Neumann algebra,
and
$\left<x,(\,\cdot\,)x\right>\colon \scrB^a(X)\to\scrA$
is normal for every~$x\in X$.
\begin{point}{Proof}%
We'll first show that
a  bounded directed subset~$\scrD$ of~$\Real{\scrB^a(X)}$
has a supremum (in~$\Real{\scrB^a(X)}$).
To obtain a candidate for this supremum,
we first define
a bounded form~$[\,\cdot\,,\,\cdot\,]\colon X\times X\to\scrA$
in the sense of~\sref{chilb-form}
and apply~\sref{chilb-form-representation}.
To this end note that given~$x\in X$
the subset~$\{\,\left<x,Tx\right>\colon \, T\in\scrD\,\}$
of~$\Real{\scrA}$
is bounded and directed,
and so 
(since~$\scrA$ is a von Neumann algebra)
has a supremum.
Since the 
the net $(\,\left<x,Tx\right>\,)_{T\in \scrD}$
converges ultraweakly to this supremum
by~\sref{vna-supremum-uwlimit},
we see that
$\left<y,Tz\right>\,= \,\frac{1}{4}
\sum_{k=0}^3
i^k\left<y+i^kz,\smash{T(y+i^kz)}\right>$
converges ultraweakly to 
some element~$[y,z]$ of~$\scrA$
as~$T\to\infty$ for all~$y,z\in X$,
giving us a form~$[\,\cdot\,,\,\cdot\,]$ on~$X$.
Since~$\left\|\left<y,T z \right>\right\|
\leq \sup_{T'\in \scrD} \|T'\| \|y\|\|z\|$
for all~$T\in\scrD$
by~\sref{chilb-form-bounded},
and thus~$\|[y,z]\|\leq \sup_{T'\in\scrD} \|T'\|\|y\|\|z\|$
for all~$y,z\in X$,
we see that the form~$[\,\cdot\,,\,\cdot\,]$
is bounded.
Since~$X$ is self dual,
there is
by~\sref{chilb-form-representation}
$S\in \scrB^a(X)$
with
$[y,z]=\left<y,Sz\right>$
for all~$y,z\in X$;
we'll show that~$S$ is the supremum of~$\scrD$.

To begin,
given~$T\in\scrD$
we have~$\left<x,Tx\right>\leq\bigvee_{T'\in\scrD} \left<x,T'x\right>
=[x,x]=\left<x,Sx\right>$
for all~$x\in X$,
and so~$T\leq S$
by~\sref{chilb-vector-states-order-separating},
that is, $S$ is an upper bound for~$\scrD$.
Given another upper bound~$S'\in\Real{\scrB^a(X)}$
of~$\scrD$
(so  $T\leq S'$ for all~$T\in\scrD$)
we have~$\left<x,Tx\right>\leq \left<x,S'x\right>$
and so~$\left<x,Sx\right>
=[x,x]=\bigvee_{T\in \scrD}\left<x,Tx\right>\leq \left<x,S'x\right>$
for all~$x\in X$
implying that~$S\leq S'$.
Hence~$S$ is the supremum of~$\scrD$
in $\Real{\scrB^a(X)}$.
Note that since~$\left<x,Sx\right>=\bigvee_{T\in\scrD} \left<x,Tx\right>$
we immediately see
that $\left<x,(\,\cdot\,)x\right>\colon \scrB^a(X)\to\scrA$
preserves bounded directed suprema
for every~$x\in X$.

It remains to be shown that
there are sufficiently many np-functionals on $\scrB^a(X)$
in the sense that~$T\in(\scrB^a(X))_+$ is zero
when~$\omega(T)=0$ for every np-functional $\omega\colon \scrB^a(X)\to\C$.
This is indeed
the case for such an operator~$T$,
because~$\xi(\left<x,(\,\cdot\,)x\right>)$
is an np-functional on~$\scrB^a(X)$
for every~$x\in X$
and an np-functional $\xi\colon \scrA\to\C$,
implying that~$\xi(\left<x,Tx\right>)=0$,
and~$\left<x,Tx\right>=0$,
and so~$T=0$.\qed
\end{point}
\end{point}
\begin{point}[mn-vna]{Exercise}%
Let~$\scrA$ be a von Neumann algebra,
and let~$N$ be a natural number.
\begin{enumerate}
\item
Show 
that the $C^*$-algebra
$M_N(\scrA)$ of $N\times N$-matrices over~$\scrA$ (see~\sref{cstar-matrices})
is a von Neumann algebra.
\item
Show that
the map $A\mapsto \sum_{ij} a_i^* A_{ij} a_j\colon\, M_N\scrA\to \scrA$
is normal and completely positive,
and that
the map $A\mapsto \sum_{ij} a_i^* A_{ij} b_j\colon\, M_N\scrA\to\scrA$
is ultrastrongly and ultraweakly continuous
for all~$a_1,\dotsc,a_N,b_1,\dotsc,b_N\in\scrA$.

In particular, $A\mapsto A_{ij}\colon\,M_N\scrA\to\scrA$
is ultraweakly and ultrastrongly continuous
for all~$i,j$.

Show that a net~$(A_\alpha)_\alpha$
in~$M_N\scrA$
converges ultraweakly (ultrastrongly)
to $B\in M_N\scrA$
iff $A_{ij}$ converges ultraweakly (ultrastrongly)
to~$B_{ij}$ for all~$i,j$.
\item
Given an ncp-map $f\colon \scrA\to\scrB$
between von Neumann algebras,
show that the cp-map $M_N f\colon M_N\scrA\to M_N\scrB$
from~\sref{mnf} is normal.
\end{enumerate}
\end{point}
\end{parsec}
\section{Commutative von Neumann algebras}
\begin{parsec}%
\begin{point}%
Another important source of examples of von 
Neumann algebras is measure theory:
we'll show that the bounded measurable
functions on a 
finite complete
measure space~$X$
form a commutative von Neumann algebra~$L^\infty(X)$
when functions that are equal almost everywhere are identified
(see~\TODO{...}).
In fact, 
we'll see in~\TODO{...}
that
every commutative von Neumann algebra is nmiu-isomorphic
to a direct sum of~$L^\infty(X)$s.
This is not only interesting in its own right,
but will also
be used in the next chapter
to show that the only von Neumann algebras
that can be endowed with a `duplicator'
are of the form~$\ell^\infty(X)$
for some set~$X$ (see~\TODO{...}).

We should probably mention that~$L^\infty(X)$
can be defined for any measure space~$X$,
and is precisely a von Neumann algebra
when~$X$ is \emph{localizable} (i.e.~isomorphic
to a sum of finite measure spaces).
This has the advantage that any commutative von Neumann algebra
is nmiu-isomorphic
to a single~$L^\infty(X)$
for some localizable measure space~$X$,
but since it has no other advantages relevant
to this text
we restrict ourselves to complete finite measure spaces.

We'll assume the reader is reasonably familiar with 
the basics of measure theory,
and we'll only show a selection of results
that we deemed important.
For the other details,
we refer to volumes~1 and~2 of~\cite{fremlin}.
Nevertheless,
we'll  recall
some basic definitions
to fix terminology,
which is sometimes simpler than in~\cite{fremlin}
(because we're dealing with finite complete measure spaces),
and sometimes modified to the complex-valued case;
the reader will have no problem adapting
the results from~\cite{fremlin} 
to our setting.
\end{point}
\end{parsec}%
\begin{parsec}%
\begin{point}%
Let~$X$ be a finite and complete measure space.
We'll denote the $\sigma$-algebra
of measurable subsets of~$X$ by~$\Define{\Sigma_X}$,
and the measure by~$\Define{\mu_X}\colon \Sigma_X\to[0,\infty]$ (or~$\mu$
when no confusion is expected).
That~$X$ is \Define{finite} means that~$\mu(X)<\infty$
(which doesn't mean that the set~$X$ is finite),
and that~$X$ is \Define{complete}
means that every subset~$A$
of a negligible subset~$B$ of~$X$
is itself negligible.
(Recall that~$N\subseteq X$
is \Define{negligible}
when~$N\in \Sigma_X$ and~$\mu(N)=0$.)
A function $f\colon X\to\C$ is \Define{measurable}
when the inverse image~$f^{-1}(U)$
of any open subset~$U$ of~$\C$
is measurable
(which happens precisely
when~$x\mapsto \Real{f(x)},\,x\mapsto\Imag{f(x)}\colon\,
X\to\R$
are measurable in the sense of~121C of~\cite{fremlin}).
An important example of a measurable function on~$X$
is the indicator function~$\mathbf{1}_A$
of a measurable subset~$A$ of~$X$
(which is equal to~$1$ on~$A$ and~$0$ elsewhere.)
\end{point}
\begin{point}%
The bounded measurable functions $f\colon X\to\C$
form a $C^*$-subalgebra of~$\C^X$ 
that we'll denote by~$\Define{\mathcal{L}^\infty(X)}$
that is closed under 
The space $\mathcal{L}^\infty(X)$
is not only closed with respect to the (supremum) norm
on~$\C^X$,
but also with respect to coordinatewise limits
of \emph{sequences}
(c.f.~121F of~\cite{fremlin}).
As a result,
the coordinatewise
supremum~$\bigvee_n f_n$
of a bounded ascending sequence $f_1\leq f_2\leq \dotsb$
in~$\Real{\mathcal{L}^\infty(X)}$
is again in~$\mathcal{L}^\infty(X)$,
and is fact the supremum of~$(f_n)_n$ in~$\mathcal{L}^\infty(X)$.
Still $\mathcal{L}^\infty(X)$
might still not be a von Neumann algebra
because not every bounded directed subset of~$\Real{\mathcal{L}^\infty(X)}$
might have a supremum
as we'll show presently; \TODO{show this}
this is why we'll move from~$\mathcal{L}^\infty(X)$
to~$L^\infty(X)$ in a moment.

\end{point}
\begin{point}%
To deal with~$L^\infty(X)$
we need to know a bit more about~$\mathcal{L}^\infty(X)$,
namely that the measure on~$X$ can be extended to a
an integral $\int\colon \mathcal{L}^\infty(X)\to \C$
(see~122M of~\cite{fremlin})%
\footnote{Note that every element of~$\mathcal{L}^\infty(X)$
being bounded is integrable by~122P of~\cite{fremlin}.}
with the following properties.
\begin{enumerate}
\item
$\int(\mathbf{1}_A) = \mu(A)$
for every measurable subset~$A$ of~$X$.
\item
$\int\colon \mathcal{L}^\infty(X)\to \C$
is a positive linear map
(see 122O of~\cite{fremlin}).
\item
$\int \bigvee_n f_n = \bigvee_n \int f_n$
for every bounded sequence
$f_1\leq f_2\leq \dotsb$
in~$\Real{\mathcal{L}^\infty(X)}$.
(This is a special case
of Levi's theorem, see 123A of~\cite{fremlin}.)
\end{enumerate}
Unsurprisingly the integral
interacts poorly
with the directed suprema
that do exist in~$\mathcal{L}^\infty(X)$:
for example, the set~$D:=\{\,f\in [0,1]_{\mathcal{L}^\infty(X)}\colon \,
\int f = 0\,\}$
is directed, bounded, and has supremum~$1$,
but~$\bigvee_{f\in D} \int f=0 < 1=\int \bigvee D$.
What \emph{is} suprising
is that the lifting of~$\int$
to~$L^\infty(X)$ will be normal.
\end{point}
\begin{point}%
But let us first define~$L^\infty(X)$.
We say that $f,g\in \mathcal{L}^\infty(X)$
are \Define{equal almost everywhere}
and write $\Define{f\approx g}$
when~$f(x)=g(x)$ for almost all~$x\in X$
(that is, $\{\,x\in X\colon\, f(x)\neq g(x)\,\}$
is negligible).
It is easily seen that~$\approx$ is an equivalence relation;
we denote the equivalence class
of an function~$f\in \mathcal{L}^\infty(X)$
by $\Define{f^\circ}$,
and
the set of equivalence classes by~$\Define{L^\infty(X)}
:= \{\, f^\circ\colon\, f\in \mathcal{L}^\infty(X)\,\}$,
which
becomes a commutative $C^*$-algebra
when
endowed with the same operations
as~$\mathcal{L}^\infty(X)$, but with
a slightly modified norm given by,
for~$\mathfrak{f}\equiv f^\circ \in L^\infty(X)$,
\begin{alignat*}{3}
	\|\mathfrak{f}\| \ &= \ 
\min\{\, \|g\|\colon \, g\in\mathcal{L}^\infty(X)\text{ and }
g^\circ = \mathfrak{f}\,\} \\
&=\ \min\{\ \lambda\geq 0\colon\,
		\left|f(x)\right|\,\leq\,\lambda
	\text{ for almost all~$x\in X$}\ \},
\end{alignat*}
which  is called the \Define{essential supremum norm}.
To see that~$L^\infty(X)$ is complete
one can use the fact that~$\mathcal{L}^\infty(X)$
is complete in a slightly more sense than discussed before:
when a bounded sequence $f_1,f_2,\dotsc$
in~$\mathcal{L}^\infty(X)$
converges coordinatewise for almost all~$x\in X$
to some bounded function~$f\colon X\to\C$,
this function~$f$ is itself measurable (and so~$f\in\mathcal{L}^\infty(X)$,
c.f.~121F of~\cite{fremlin}).

Another consequence of this
is that a bounded ascending sequence
$f_1^\circ \leq f_2^\circ \leq \dotsb$
in~$L^\infty(X)$
(so~$f_1,f_2,\dotsc\in\mathcal{L}^\infty(X)$,
and $f_1(x)\leq f_2(x)\leq\dotsb$ for almost all~$x\in X$)
has a supremum~$\bigvee_n f_n^\circ$ in~$\mathcal{L}^\infty(X)$.
Indeed, we'll have
$\bigvee_n f_n^\circ = g^\circ$
for any bounded map~$g\colon X\to\C$
with $g(x)=\bigvee_n f_n(x)$
for almost all~$x\in X$.
\end{point}%
\begin{point}%
Now, let us return to the integral.
Since~$\int f = \int g$
for all~$f,g\in \mathcal{L}^\infty(X)$
with $f\approx g$
we get a map
$\int \colon L^\infty(X)\to \C$
given
by~$\int  f^\circ = \int f$.
Clearly, $\int$ is positive and linear,
and by (a slightly less special case
of) Levi's theorem (123A of~\cite{fremlin})
we see that $\int \bigvee_n \mathfrak{f}_n
= \bigvee_n \int \mathfrak{f}_n$
for any bounded ascending sequence
$\mathfrak{f}_1\leq \mathfrak{f}_2\leq\dotsb$
in~$\Real{L^\infty(X)}$.
Note that~$\int\colon L^\infty(X)\to\C$
is also faithful,
because if~$\int f^\circ=\int f = 0$
for some $f\in \mathcal{L}^\infty(X)$,
then~$f(x)=0$ for almost all~$x\in X$,
and so~$f^\circ=0$.
Now,
the fact that~$L^\infty(X)$
is a von Neumann algebra follows from
the following general and rather surprising observation.
\end{point}
\begin{point}{Proposition}%
Let~$\scrA$ be a $C^*$-algebra,
and let~$\tau\colon \scrA\to\C$
be a faithful positive map.
If every bounded ascending sequence~$a_1\leq a_2\leq \dotsb$
of self-ajoint elements from~$\scrA$ has a supremum~$\bigvee_n a_n$
(in~$\Real{\scrA}$)
and
$\tau(\bigvee_n a_n)=\bigvee_n \tau (a_n)$,
then~$\scrA$ is a von Neumann algebra,
and~$\tau$ is normal.
\begin{point}{Proof}%
Our first task is to show that a bounded
directed subset~$D$ of self-adjoint elements of~$\scrA$
has a supremum~$\bigvee D$ in~$\Real{\scrA}$.
Since~$\bigvee_{d\in D} \tau(d)$
is a supremum in~$\R$
we can find~$a_1\leq a_2\leq \dotsb$ in~$D$
with~$\bigvee_n \tau(a_n) = \bigvee_{d\in D} \tau(d)$.
We'll show that~$\bigvee_n a_n$
is the supremum of~$D$.
Surely, any upper bound of~$D$ being also an upper bound 
for~$a_1\leq a_2\leq\dotsb$
is above~$\bigvee_n a_n$,
so the only thing that we need to show is that
$\bigvee_n a_n$ is an upper bound of~$D$.
So let~$b\in D$ be given.
The trick is to pick a sequence
$b_1\leq b_2\leq \dotsb$ in~$D$
with $b\leq b_1$ and~$a_n\leq b_n$ for all~$n$
(which exists on account that~$D$ is directed).
Then~$\bigvee_n a_n \leq \bigvee_n b_n$,
and~$\bigvee_{d\in D} \tau(d) =\bigvee_n \tau(a_n)
=\tau(\,\bigvee_n a_n\,)
\leq \tau(\,\bigvee_n b_n\,)
= \bigvee_n \tau(b_n) \leq \bigvee_{d\in D} \tau(d)$,
so~$\tau(\,\bigvee_n a_n\,) = \tau(\,\bigvee_n b_n\,)$,
which implies that~$\bigvee_n a_n = \bigvee_n b_n$
as~$\tau$ is faithful.
Since then $b\leq b_1\leq \bigvee_n b_n = \bigvee_n a_n$
we see that~$\bigvee_n a_n$ is an upper bound
(and thus the supremum) of~$D$.
Moreover,
since
$\bigvee_{d\in D} \tau(d) \leq
\tau(\bigvee D)
=\tau(\bigvee_n a_n)
=\bigvee_n\tau(a_n)
\leq \bigvee_{d\in D} \tau(d)$,
we see that~$\bigvee_{d\in D} \tau(d)
= \tau(\bigvee D)$,
and so~$\tau$ is normal.
Since~$\tau$ is faithful
and normal, $\scrA$ is a von Neumann algebra.\qed
\end{point}
\end{point}
\begin{point}[Linfty-vn]{Corollary}%
Given a finite complete measure space~$X$ 
the $C^*$-algebra $L^\infty(X)$
is a commutative von Neumann algebra,
and the assignment $f\mapsto \int f$
gives a faithful normal positive
map~$\int\colon L^\infty(X)\to\C$.
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
We'll show that any commutative von Neumann algebra~$\scrA$
that admits a faithful np-functional $\omega\colon \scrA\to \C$
is nmiu-isomorphic  to~$L^\infty(X)$
for some finite complete measure space~$X$.
It makes sense to regard this result
as a von Neumann algebra analogue
of Gelfand's theorem for commutative $C^*$-algebras,
(see~\sref{gelfand}---that any commutative $C^*$-algebra
is miu-isomorphic to~$C(Y)$ for some compact Hausdorff space~$Y$.)
But one should not take the
comparison too far too lightly:
while Gelfand's theorem readily
yields a clean equivalence 
between commutative $C^*$-algebras
and compact Hausdorff spaces
(see~\sref{gelfand-equivalence}),
the fact that  $L^\infty(X_1)\cong L^\infty(X_2)$
for finite complete measure spaces~$X_1$
and~$X_2$ does not even imply that~$X_1$ and~$X_2$ are 
isomorphic \TODO{Can this be made more dramatic?}
(in the category of measurable maps between finite complete
measure spaces).
Obtaining an equivalence is nonetheless
possible after a suitable non-trivial modification
of the category of measure spaces,
which would have appeared in~\TODO{cite robert}.

We obtain our finite complete measure space~$X$
from the commutative von Neumann algebra~$\scrA$
by putting a $\sigma$-algebra
on the ($C^*$-algebraic) spectrum~$\spec(\scrA)$
(a compact Hausdorff space
consisting of all miu-functionals on~$\scrA$)
by declaring that a subset~$A$ of~$\spec(X)$ 
is measurable when~$A$ is clopen up to
a \emph{meagre} subset
(defined below,~\sref{meagre}).
It takes some effort to show
that this yields a $\sigma$-algebra
in~$\spec(X)$,
and that the faithful np-functional $\omega\colon\scrA\to \C$
gives a finite complete measure on~$\spec(X)$,
but once this is achieved
it's easily seen that
$\scrA\cong C(\spec(\scrA))\cong L^\infty(\spec(\scrA))$.
\end{point}
\begin{point}[meagre]{Definition}%
Let~$X$ be a topological space.
\begin{enumerate}
\item
A subset~$A$ of~$X$
is called \Define{meagre} when~$A\subseteq \bigcup_n B_n$
for some closed subsets $B_1\subseteq B_2\subseteq \dotsb$
of~$X$ with empty interior (so  $B_n^\circ=\varnothing$
for all~$n$.)
\item
Given $A,B\subseteq X$ 
we write $\Define{A\approx B}$ when
$A\cup B\,\backslash\,A\cap B$
is meagre.
\item
We say that~$A\subseteq B$
is \Define{almost clopen}
when~$A\approx C$
for some clopen~$C\subseteq X$.
\end{enumerate}
\end{point}
\begin{point}[meagre-basic]{Exercise}%
Given a topological space~$X$,
verify the following facts.
\begin{enumerate}
\item
A countable union~$\bigcup_n A_n$
of meagre subsets $A_1,A_2,\dotsc\subseteq X $ is meagre.
\item
A subset of a meagre set is meagre.
\item
$\overline{U}\approx U$
for every open subset~$U$ of~$X$.

(Hint: show that $\overline{U}\backslash U$
is closed with empty interior.)
\item
$\bigcup_n A_n\approx \bigcup_n B_n$
for all~$A_1,A_2,\dotsc, B_1,B_2,\dotsc\subseteq X$
with $A_n\approx B_n$.
\item
$A\backslash B \approx A'\backslash B'$
for all $A,A',B,B'\subseteq X$
with~$A\approx A'$ and~$B\approx B'$.
\item
If~$A,B\subseteq X$ are almost clopen,
then~$A\cup B$ and~$A\backslash B$ 
are almost clopen.
\end{enumerate}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
The fact that the almost clopen subsets
of the spectrum~$\spec(\scrA)$
of a commutative von Neumann algebra~$\scrA$
are closed under countable unions
(and thus form a $\sigma$-algebra)
relies on the following special topological property of~$\spec(\scrA)$.
\end{point}
\begin{point}[ngelfand]{Exercise}%
Let~$\scrA$ be a commutative von Neumann algebra.
Using the fact that
the Gelfand representation~$\gamma_\scrA\colon \scrA\to C(\spec(\scrA))$
from~\sref{gelfand-representation}
is a miu-isomorphism 
by~\sref{gelfand}
and thus an order isomorphism,
show that~$C(\spec(\scrA))$
is a commutative von Neumann algebra
that is nmiu-isomorphic
to~$\scrA$ via~$\gamma_\scrA$.
\end{point}
\begin{point}[vn-spectrum-extremally-disconnected]{Proposition}%
The spectrum~$\spec(\scrA)$
of a commutative von Neumann algebra~$\scrA$
is \Define{extremally disconnected}:
the closure~$\overline{U}$
of an open subset~$U$ of~$\spec(\scrA)$
is open.
\begin{point}{Proof}%
(Based on \S6.1 of~\cite{riesz}.)

Let~$U$ be an open subset of~$\spec(\scrA)$,
and let~$\mathbf{1}_U$ be the indicator function
of~$U$.
The set $D=\{\,f\in C(\spec(\scrA))\colon\, f\leq \mathbf{1}_U\,\}$
is directed and bounded 
and so has a supremum~$\bigvee D$
in~$C(\spec(\scrA))$
(since~$C(\spec(\scrA))$ is a von Neumann algebra by~\sref{ngelfand}).
Note that~$0\leq \bigvee D\leq 1$.
We'll prove that~$\bigvee D = \mathbf{1}_{\overline{U}}$,
because this entails
that~$\mathbf{1}_{\overline{U}}$
is continuous,  so that~$\overline{U}$ is both open and closed.

Let~$x\in U$ be given.
By Urysohn's lemma (see~15.6 of~\cite{willard},
using here that~$\spec(\scrA)$ being a compact Hausdorff
space, \sref{spectrum-calg-compact-hausdorff}, 
is normal by~17.10 of~\cite{willard})
there is $f\in [0,1]_{C(\spec(\scrA))}$
with~$f(x)=1$ and~$f(y)=0$ for all~$y\in \spec(X)\backslash U$.
It follows that~$f\in D$,
and~$f\leq \bigvee D\leq 1$,
so that $1=f(x)\leq (\bigvee D)(x)\leq 1$,
and~$(\bigvee D)(x)=1$.
By continuity of~$\bigvee D$,
we get $(\bigvee D)(x)=1$ for all~$x\in \overline{U}$.

Let~$y\in \spec(\scrA)\backslash U$ be given.
Again by Urysohn's lemma
there is $f\in [0,1]_{C(\spec(\scrA))}$
with~$f(y)=0$ and~$f(x)=1$ for all~$x\in \overline{U}$.
Since $g\leq \mathbf{1}_U \leq f$
for every~$g\in D$,
we get $\bigvee D\leq f$,
and so~$0\leq (\bigvee D)(y)\leq f(y) =0$,
which implies that~$(\bigvee D)(y)=0$.
Hence~$(\bigvee D)(y)=0$ for all~$y\in \spec(\scrA)\backslash U$.

All in all we have $\bigvee D = \mathbf{1}_{\overline{U}}$,
and so~$\overline{U}$ is open.\qed
\end{point}
\end{point}
\begin{point}{Corollary}%
The almost clopen subsets
of an extremally disconnected topological
space~$X$ form a $\sigma$-algebra.
\begin{point}[almost-clopen-sigma-algebra-proof]{Proof}%
In light of~\sref{meagre-basic}
it remains only to be shown that
the union~$\bigcup_n A_n$
of almost clopen subsets~$A_1,A_2,\dotsc$
is almost clopen.
Let~$C_1,C_2,\dotsc\subseteq X$
be clopen with $A_n\approx C_n$ for each~$n$.
Then $\bigcup_n A_n \approx \bigcup_n C_n$,
and~$C:=\bigcup_n C_n$ is open
(but not necessarily closed).
Since~$C\approx \overline{C}$
(by~\sref{meagre-basic}),
and~$\overline{C}$ is clopen (as $X$ is extremally disconnected)
we get~$\bigcup_n A_n \approx \overline{C}$,
so~$\bigcup_n A_n$ is almost clopen.\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
The final ingredient
we need to prove the main result, \sref{cvn-faithful},
of this section
is the observation
that an almost clopen subset of a compact Hausdorff space
is equivalent to precisely one clopen,
which follows from the following famous theorem.
\end{point}
\begin{point}[baire-category-theorem]{Baire category theorem}%
A meagre subset of a compact Hausdorff space
has empty interior.
\begin{point}{Proof}%
Let~$A$ be a meagre subset of a compact Hausdorff space~$X$.
So there are closed $B_1\subseteq B_2\subseteq \dotsc$
with~$A\subseteq \bigcup_n B_n$
and~$B_n^\circ=\varnothing$ for all~$n$.
Then~$U_n:= X\backslash B_n$
is an open dense subset of~$X$
for each~$n$.
Since~$A^\circ \subseteq (\bigcup_n B_n)^\circ  =
X\backslash (\,\smash{\overline{\bigcap_n U_n}}\,)$
it suffices to show that
$\bigcap_n U_n$ is dense in~$X$.
That is, given a non-empty open subset~$V$
of~$X$ we must show that~$V\cap\bigcap_n U_n\neq \varnothing$.

Write~$V_1:=V$.
Since~$U_1$ is open and dense, and~$V_1$ is open and not empty,
we have $U_1\cap V_1\neq \varnothing$.
Since~$X$ is regular~\TODO{reference}
we can find an open and non-empty subset $V_2$ of~$X$
with~$\overline{V}_2\subseteq U_1\cap V_1$.
Continuing this process
we obtain non-empty open subsets $V\equiv V_1 \supseteq V_2\supseteq \dotsb$
of~$X$ with $\overline{V}_n \subseteq U_n\cap V_n$
for all~$n$,
and so~$
\overline{V}_1 \supseteq V_1 
\supseteq \overline{V}_2 \supseteq V_2 
\supseteq \dotsb$.
Since~$X$ is compact,
$\bigcap_n \overline{V}_n$
can not be empty,
and neither will be~$V\cap \bigcap_n U_n
\supseteq \bigcap_n \overline{V}_n$.\qed
\end{point}
\end{point}
\begin{point}[approx-closure]{Lemma}%
For open subsets~$U$ and~$V$ of a compact Hausdorff
space~$X$,
\begin{equation*}
U\approx V\quad\iff\quad
\overline{U}\approx \overline{V}
\quad\iff\quad
\overline{U}=\overline{V}.
\end{equation*}
\begin{point}{Proof}%
As~$U\approx \overline{U}$ by~\sref{meagre-basic}
the only thing that is not obvious
is that~$\overline{U}\approx \overline{V} \implies \overline{U}=\overline{V}$.
So suppose that~$\overline{U}\approx \overline{V}$.
Then~$U\backslash \overline{V}$
is empty, because it is an open subset of the
meagre set~$\overline{U}\cup\overline{V}\,\backslash\,
\overline{U}\cap\overline{V}$
(which has empty interior by~\sref{baire-category-theorem}.) In other words,
we have~$U\subseteq \overline{V}$, 
and thus~$\overline{U}\subseteq \overline{V}$.
Simlarly, $\overline{V}\subseteq\overline{U}$,
and so~$\overline{V}=\overline{U}$.\qed
\end{point}
\end{point}
\begin{point}{Corollary}%
Given an almost clopen subset~$A$ of a compact Hausdorff
space~$X$ there is precisely one clopen~$C$ with~$A\approx C$.
\begin{point}[almost-meagre-fundamental]{Proof}%
When~$C\approx A \approx C'$
for clopen subsets~$C,C'\subseteq X$,
we have~$C\approx C'$,
and so~$C=C'$ by~\sref{approx-closure}.\qed
\end{point}
\end{point}
\begin{point}%
Interestingly,
a compact Hausdorff space is extremally disconnected
iff each of its open subsets is ``measurable''
in the sense of being almost clopen:
\end{point}
\begin{point}[open-almost-clopen]{Proposition}%
A compact Hausdorff space~$X$
is extremally disconnected
iff every open subset of~$X$
is almost clopen.
\begin{point}{Proof}%
If~$X$ is extremally disconnected,
and~$U$ is open subset of~$X$,
then~$\overline{U}$ is clopen,
and~$\overline{U}\approx U$ by~\sref{meagre-basic}
giving us that~$U$ is almost clopen.

Conversely,
suppose that each open subset of~$X$ is almost clopen.
To show that~$X$ is extremally disconnected
we must show that~$\overline{U}$ is open given
an open subset~$U$ of~$X$.
Pick a clopen~$C$ with~$U\approx C$.
Then~$\overline{U}\approx U\approx C$
(by~\sref{meagre-basic}),
and so~$\overline{U}=C$ by~\sref{approx-closure}.


\end{point}
\end{point}
\begin{point}[cvn-faithful]{Theorem}%
Let~$\scrA$ be a commutative von Neumann algebra~$\scrA$.
Recall that
the Gelfand representation $\gamma_\scrA\colon 
\scrA\to C(\spec(\scrA))$
is a nmiu-isomorphism (by~\sref{ngelfand}),
$C(\spec(\scrA))$ is a von Neumann algebra,
and that the almost clopen subsets (see~\sref{meagre}) of~$\spec(\scrA)$
form a $\sigma$-algebra.

Given a faithful np-functional $\omega\colon \scrA\to\C$
there is a (unique) measure
$\mu$ on the almost clopen subsets of~$\spec(\scrA)$
such that~$\mu(A)=0$ iff $A$ is meagre,
and~$\mu(C)=\omega(\gamma_\scrA^{-1} (\mathbf{1}_{C}))$
for every clopen subset~$C$ of~$\spec(\scrA)$;
and this turns~$\spec(\scrA)$
into a finite complete measure space.

With respect to this measure space a function~$f\colon \spec(\scrA)\to\C$
is measurable iff~$f$ is continuous almost everywhere.
Moreover, 
$f\mapsto f^\circ\colon C(\spec(\scrA))\to L^\infty(\spec(\scrA))$
is a nmiu-isomorphism,
and~$\int f^\circ = \omega(\gamma_\scrA^{-1}(f))$ for all~$f\in C(X)$.
All in all,
we get the following commuting diagram.
\begin{equation*}
\xymatrix@C=3em@R=3em{
\scrA
\ar[r]^-{\gamma_\scrA}_-\cong
\ar[rd]_\omega
&
C(\spec(\scrA))
\ar[r]^-{f\mapsto f^\circ}_-\cong
&
L^\infty(\spec(\scrA))
\ar[ld]^\int
\\
&
\C
}
\end{equation*}
\begin{point}{Proof}%
By~\sref{almost-meagre-fundamental}
we know that given an almost meagre subset~$A$
of~$\spec(\scrA)$
there is a unique clopen~$C_A$
with~$A\approx C_A$,
and 
so we may define
$\mu(A):=\omega(\gamma_\scrA^{-1}(\mathbf{1}_{C_A}))$.
It is easily seen that~$\mu$
is finitely additive.
Further $\mu(A)=0$ for every meagre~$A\subseteq X$,
and so $\mu(A)=\mu(B)$ when~$A\approx B$.
Conversely, 
an almost clopen subset~$A$
of~$\scrA$
with~$\mu(A)=0$
is meagre,
because for the unique clopen~$C$ with~$A\approx C$,
we have~$\omega(\gamma_\scrA^{-1}(\mathbf{1}_C))=\mu(A)=0$,
so that~$\mathbf{1}_C=0$ and thus~$C=\varnothing$---using here
that~$\omega$ is faithful.

To show that~$\mu$
is a measure,
it suffices to prove
that~$\bigwedge_n \mu(A_n)=0$
given~$A_1\supseteq A_2\supseteq \dotsb$
with~$\bigcap_n A_n=\varnothing$.
To do this, pick clopen subsets~$C_1,C_2,\dotsc$
of~$\spec(\scrA)$
with~$A_n\approx C_n$ for all~$n$.
Then~$\bigwedge_n \mu(A_n)
=\bigwedge_n \mu(C_n)
= \omega(\gamma_\scrA^{-1}(\bigwedge_n \mathbf{1}_{C_n}))$---using 
here that~$\omega$ is normal.
So to prove that~$\bigwedge_n \mu(A_n)=0$
it suffices to show that~$\bigwedge_n \mathbf{1}_{C_n}=0$,
that is,
given a lower bound~$f$ of the~$\mathbf{1}_{C_n}$
in~$\Real{C(\spec(\scrA))}$
we must show that~$f\leq 0$.
Note that for such~$f$
we have~$f(x)\leq 0$
for all~$x\in X\backslash\bigcap_n C_n$.
Then~$f(x)\leq 0$ for all~$x\in X$
if we can show that~$X\backslash \bigcap_n C_n$ is dense in~$X$.
But this indeed the case
since~$\bigcap_n C_n\approx \bigcap_n A_n=\varnothing$
is meagre, and therefore has empty interior
(by~\sref{baire-category-theorem}).
Whence~$\mu$ is a measure.
Note that~$\mu$ is finite,
because~$\mu(\spec(\scrA))
= \omega(1)<\infty$,
and complete,
because a subset of a meagre set is meagre.

Let~$h\colon \spec(\scrA)\to\C$ be a function.
We'll show that~$h$ is continuous almost everywhere
iff~$h$ is measurable.
Surely,
if~$h$ is continuous (everywhere),
then~$h$ is measurable
(since every open subset~$U$ of~$\spec(\scrA)$
is almost clopen, \sref{open-almost-clopen}).
So if~$h$ is continuous almost everywhere,
then~$h$ is measurable too.
Conversely,
\TODO{finish---why is $f\mapsto f^\circ$ surjective?}
\end{point}
\begin{point}{Remark}%
	\TODO{make remarks on the spectal theorem
	and direct sums}
\end{point}
\end{point}

\end{parsec}%
\section{Projections}
\begin{parsec}%
\begin{point}%
One pertinant feature
of von Neumann algebras
is an abundance of projections:
above each effect~$a$ 
there is a least projection~$\ceil{a}$
called the ceiling of~$a$ (\sref{vna-ceil});
for every np-map $\omega\colon \scrA\to \scrB$
between von Neumann algebras
there is a least projection~$p$ with~$\omega(p^\perp)=0$
called the carrier of~$\omega$ (see~\sref{carrier});
the directed supremum of projections is again a projection
and
the partial order of projections forms a complete lattice
(see~\sref{ceil-floor-basic});
and each element of a von Neumann algebra is the norm limit
of linear combinations of projections
(see~\sref{projections-norm-dense}).
We'll prove all this and more in this section.
\end{point}
\begin{point}{Definition}%
An element~$p$ of a $C^*$-algebra
is a \Define{projection}
when~$p^*p=p$.
\end{point}
\begin{point}[projection-basic]{Exercise}%
Show that in a $C^*$-algebra:
\begin{enumerate}
\item
$0$ and~$1$ are projections.
\item
A projection~$p$ is an effect,
that is, $p^*=p$
and $0\leq p\leq 1$.
\item
An effect~$a$ is a projection iff $aa^\perp=0$.
\end{enumerate}
\end{point}
\begin{point}[ad-contraposed]{Lemma}%
Let~$a$ be an element of a $C^*$-algebra~$\scrA$
with $\|a\|\leq 1$,
and let~$p$ and~$q$ be projections on~$\scrA$.
Then 
$a^* p a \leq q^\perp$
iff $paq=0$
iff  $aqa^*\leq p^\perp$.
\begin{point}{Proof}%
Suppose that~$a^*pa\leq q^\perp$.
Then we have $q a^*pa q \leq qq^\perp q = 0$
(see \sref{astara-pos-basic-consequences})
and so $paq=0$,
because $\|paq\|^2=\|(paq)^*paq\|=0$
by the $C^*$-identity.
Applying $(\,\cdot\,)^*$,
we get $qa^*p=0$, and so both $qa^* = qa^*p^\perp$
and $aq = p^\perp aq$, giving
us $aqa^* = p^\perp a q a^* p^\perp 
\leq p^\perp$,
where we used that $aqa^*\leq aa^*\leq \|aa^*\|=\|a\|^2\leq 1$.
By a similar reasoning,
we get $aqa^*\leq p^\perp \implies paq=0\implies a^*pa\leq q^\perp$.\qed
\end{point}
\end{point}
\begin{point}{Exercise}%
Let~$a$ be an effect of a $C^*$-algebra~$\scrA$,
and~$p$ be a projection from~$\scrA$.
\begin{point}[projection-above-effect]%
Show that $a\leq p$
iff $p\sqrt{a} = \sqrt{a}$
iff $\sqrt{a}p = \sqrt{a}$
iff $p^\perp\sqrt{a} = 0$
iff $\sqrt{a}p^\perp = 0$
iff $a^2\leq p$
iff $p a  = a$
iff $ a p = a $
iff $p^\perp a  = 0$
iff $ap^\perp = 0$
iff $\sqrt{a}\leq p$.
\end{point}
\begin{point}[projection-below-effect]%
Show that $p\leq a$
iff $p \sqrt{a} = p$
iff $\sqrt{a} p = p$
iff $ p\sqrt{a}^\perp = 0$
iff $\sqrt{a}^\perp p = 0$
iff $p\leq a^2$
iff $ap=p$
iff $pa = p$
iff $pa^\perp =0$
iff $a^\perp p =0$
iff $p\leq \sqrt{a}$.
\end{point}
\end{point}
\begin{point}[projection-order-sharp]{Lemma}%
An effect~$a$ of a $C^*$-algebra~$\scrA$
is a projection iff the only effect
below~$a$ and~$a^\perp$ is~$0$.
\begin{point}{Proof}%
On the one hand,
if~$a$ is a projection,
and~$b$ is an effect with~$b\leq a$
and~$b\leq a^\perp$,
then~$a^\perp b=0$ and~$ab=0$ by~\sref{projection-above-effect},
and so~$b=ab+a^\perp b = 0$.
On the other hand,
if~$0$ is the only effect below both~$a$ and~$a^\perp$,
then~$aa^\perp\equiv \sqrt{a}a^\perp \sqrt{a}$
being an effect below~$a$, and below~$a^\perp$,
is zero, and so~$a$ is projection, by~\sref{projection-basic}.\qed
\end{point}
\end{point}
\begin{point}{Definition}%
We say that projections~$p$ and~$q$
from a $C^*$-algebra~$\scrA$ are \Define{orthogonal}
when~$pq=0$,
and we say that a subset of projections
from~$\scrA$ is \Define{orthogonal}
when all~$p$ and~$q$ from~$E$
are either equal or orthogonal.
\end{point}
\begin{point}[orthogonal-tuple-of-projections]{Exercise}%
Let~$\scrA$ be a $C^*$-algebra.
\begin{enumerate}
\item
Show that projections~$p$ and~$q$ from~$\scrA$
are orthogonal iff $pq=0$ iff $qp=0$ iff $pqp=0$
iff $p+q\leq 1$ iff $p\leq q^\perp$
iff $p+q$ is a projection.
\item
Show that a finite set of  projections $p_1,\dotsc,p_n$
from~$\scrA$ is orthogonal
iff~$\sum_i p_i \leq 1$
iff $\sum_i p_i$ is a projection.

Show that, in that case, $\sum_i p_i$ is the least projection
above~$p_1,\dotsc,p_n$.
\end{enumerate}
\end{point}
\begin{point}[projection-below-projection]{Exercise}%
Let~$p$ and~$q$ be projections from a $C^*$-algebra
with~$p\leq q$.\\
Show that~$q-p$ is a projection
(either directly, or using~\sref{orthogonal-tuple-of-projections}).
\end{point}
\end{parsec}
\subsection{Ceiling and floor}
\begin{parsec}%
\begin{point}[vna-ceil]{Proposition}%
Above every effect~$b$ of a von Neumann algebra~$\scrA$,
there is a smallest projection, \Define{$\ceil{b}$},
called the \Define{ceiling} of~$b$,
 given by $\ceil{b}=\bigvee_{n=0}^\infty b^{\nicefrac{1}{2^n}}$.\\
Moreover, if $a\in \scrA$ commutes with $b$,
then~$a$ commutes with~$\ceil{b}$.
\begin{point}{Proof}
Let~$p$ denote the supremum of~$0\leq b\leq b^{\nicefrac{1}{2}}\leq
b^{\nicefrac{1}{4}}\leq\dotsb\leq 1$.
\begin{point}[vna-ceil-point-1]%
To begin,
note that if~$a\in \scrA$
commutes with~$b$,
then~$a$ commutes with~$p$.
Indeed, for such~$a$ we have~$a\sqrt{b}=\sqrt{b}a$
by~\sref{sqrt},
and so $a b^{\nicefrac{1}{2^n}} = b^{\nicefrac{1}{2^n}} a$
for each~$n$
by induction.
Thus~$ap=pa$ by~\sref{vna-supremum-commutes}.
\end{point}
\begin{point}%
Let us prove that~$p$ is a projection, c.q.~$p^2=p$. 
Since~$p\leq 1$, we already have $p^2\equiv \sqrt{p}p\sqrt{p}\leq p$
by~\sref{astara-pos-basic-consequences},
and so we only need to show that $p\leq p^2$. We have:
\begin{alignat*}{3}
 p^2 \ &=\  \textstyle \bigvee_m \sqrt{p} \,b^{\nicefrac{1}{2^m}} \,\sqrt{p}
\qquad&&\text{by \sref{ad-normal}} \\
&=\ \textstyle\bigvee_m b^{\nicefrac{1}{2^{m+1}}}\, p\,
b^{\nicefrac{1}{2^{m+1}}} 
\qquad&&\text{by \sref{vna-ceil-point-1} and \sref{sqrt}} \\
&=\ \textstyle \bigvee_m \bigvee_n \, 
b^{\nicefrac{1}{2^{m+1}}}\, b^{\nicefrac{1}{2^n}}\,
b^{\nicefrac{1}{2^{m+1}}} \qquad && \text{by \sref{ad-normal}}
\end{alignat*}
Thus $p^2 \geq b^{\nicefrac{1}{2^k}}$
for each~$k$ (taking $n=m=k+1$,)
and so~$p^2 \geq p$.
\end{point}
\begin{point}%
It remains to be shown that~$p$ is the \emph{least} projection
above~$b$.
Let~$q$ be a projection in~$\scrA$ with $b\leq q$;
we must show that~$q\leq p$.
We have $b^{\nicefrac{1}{2}}\leq q$
by~\sref{projection-above-effect},
and so $b^{\nicefrac{1}{2^n}}\leq q$ for each~$n$ by induction.
Hence $p\leq q$.\qed
\end{point}
\end{point}
\end{point}
\begin{point}[vna-floor]{Proposition}%
Below every effect~$b$ of a von Neumann algebra~$\scrA$,
there is greatest projection, \Define{$\floor{b}$},
called the \Define{floor} of~$b$,
given by~$\floor{b} = \bigwedge_{n=0}^\infty b^{2^{n}}$.\\
Moreover, if~$a\in \scrA$ commutes with~$b$,
then~$b$ commutes with~$\floor{b}$.
\begin{point}{Proof}%
Let~$p$ denote the infimum of $1\geq b\geq b^2 \geq b^4 \geq  \dotsb \geq 0$.
\begin{point}[vna-floor-point-1]%
If~$a\in \scrA$ commutes with~$b$,
then~$a$ commutes with~$p$.
Indeed, such~$a$ commutes with~$b^2$ (because
$ab^2 = bab = b^2a$,)
and so~$a$ commutes with~$b^{2^n}$ for each~$n$ by induction.
Thus~$a$ commutes with~$p\equiv\bigwedge_n b^{2^n}$ 
(by a variation on~\sref{vna-supremum-commutes}.)
\end{point}
\begin{point}%
To see that~$p$ is a projection, c.q.~$p^2=p$,
we only need to show that~$p\leq p^2$,
because we get $p^2\equiv \sqrt{p}\,p\,\sqrt{p}\leq p$
from $p\leq 1$ (using~\sref{astara-pos-basic-consequences}.)
Now, since
\begin{alignat*}{3}
p^2 \ &=\ \textstyle \bigwedge_m\  \sqrt{p}\, b^{2^m} \sqrt{p}\qquad
&&\text{by a variation on~\sref{ad-normal}}\\
&=\ \textstyle \bigwedge_m \ b^{2^{m-1}} p\, b^{2^{m-1}}\qquad
&&\text{by~\sref{vna-floor-point-1} and~\sref{sqrt}}\\
&=\ \textstyle \bigwedge_m \bigwedge_n \ 
b^{2^{m-1}}\, b^{2^n}\, b^{2^{m-1}}\qquad
&&\text{by~\sref{ad-normal},}
\end{alignat*}
and $p\leq b^{2^{m-1}}\, b^{2^n}\,b^{2^{m-1}}$
for all~$n,m$, we get~$p\leq p^2$.
\end{point}
\begin{point}%
It remains to be shown that~$p$ is the greatest projection below~$b$.
Let~$q$ be a projection in~$\scrA$ with~$q\leq b$.
We must show that~$q\leq p$.
Since~$q\leq b$,
we have~$q\leq b^2$ (by~\sref{projection-below-effect}),
and so~$q\leq b^{2^n}$ for each~$n$ by induction.
Thus~$q\leq p\equiv\bigwedge_n b^{2^n}$.\qed
\end{point}
\end{point}
\end{point}
\begin{point}[ceil-floor-second-property]{Exercise}%
Show that given an effect~$a$ and a projection~$p$
in a von Neumann algebra~$\scrA$ we have
\begin{enumerate}
\item
$pa=a$ iff $ap=a$ iff $\ceil{a}\leq p$, and
\item
$pa=p$ iff $ap=p$ iff $p\leq \floor{a}$.
\end{enumerate}
Conclude that~$\ceil{a}$
is the least projection with $a=a\ceil{a}\equiv\ceil{a}a$,
and that $\floor{a}$
is the greatest projection with $\floor{a}=a\floor{a}\equiv \floor{a}a$.
\end{point}
\begin{point}[ceil-floor-basic]{Exercise}%
Let~$a,b$ be effects of a von Neumann algebra~$\scrA$,
and let~$\lambda\in [0,1]$.
\begin{enumerate}
\item
Show that $\ceil{a}^\perp = \floor{a^\perp}$
and $\floor{a}^\perp = \ceil{a^\perp}$.
\item
Show that~$\ceil{\lambda a} = \ceil{a}$
when~$\lambda\neq 0$.

Use this to prove that~$\ceil{\lambda a+\lambda^\perp b}$
is the supremum of~$\ceil{a}$ and~$\ceil{b}$
in the poset of projections of~$\scrA$
when~$\lambda\neq 0$ and~$\lambda\neq 1$.
\item
Show that $\floor{a}=\floor{a^2}$
and $\ceil{a}=\ceil{a^2}$.
\end{enumerate}
\end{point}
\begin{point}[vna-directed-supremum-projections]{Lemma}%
The supremum of a directed set~$D$ of projections
from a von Neumann algebra~$\scrA$ is a projection.
\begin{point}{Proof}%
Writing $p=\bigvee D$,
we must show that $p^2=p$.
Note that $dp=d$ for all~$d\in D$
(by~\sref{projection-below-effect} because~$d\leq p$.)
Now, on the one hand, $(d)_{d\in D}$
converges ultraweakly to~$p$.
On the other hand,
$(dp)_{d\in D}$
converges ultraweakly to~$p^2$ by~\sref{vna-supremum-mult}.
Hence~$p=p^2$ by uniqueness of ultraweak limits.
\end{point}
\end{point}
\begin{point}{Exercise}%
Deduce from this result
 that every set~$A$ of projections from~$\scrA$
has a supremum $\Define{\bigcup A}$
and an infimum $\Define{\bigcap A}$
\emph{in the poset of projections from~$\scrA$}.\\
(Hint: use~\sref{ceil-floor-basic},
and the fact that $p\mapsto p^\perp$ 
is an order anti-isomorphism on the poset of projections on~$\scrA$.)
\end{point}
\begin{point}[ceil-supremum]{Exercise}
Let~$\scrA$ be a von Neumann algebra.
\begin{enumerate}
\item
Show that $\ceil{\bigvee D}=\bigcup_{d\in D} \ceil{d}$
for every directed set~$D$ of effects from~$\scrA$.
\item
Show that $\floor{\bigwedge D} = \bigcap_{d\in D} \floor{d}$
for every filtered set~$D$ of effects from~$\scrA$.
\item
Show that $\ceil{\,\cdot\,}$
does not preserve filtered infima,
and~$\floor{\,\cdot\,}$
does not preserve directed suprema.
(Hint: $1,\frac{1}{2},\frac{1}{3},\dotsc$.)

Conclude that $\ceil{\,\cdot\,}$
and $\floor{\,\cdot\,}$
are neither ultraweakly, ultrastrongly nor norm  continuous
as maps from $[0,1]_\scrA$ to~$[0,1]_\scrA$.
\end{enumerate}
\end{point}
\begin{point}[sum-of-orthogonal-projections]{Exercise}%
Show that for a family~$(p_i)_{i\in I}$ 
of orthogonal projections
(with~$I$ potentially uncountable)
the series $\sum_i p_i$
converges ultrastrongly to~$\bigcup_i p_i$.

(Hint: 
use the fact that $\sum_{i\in F} p_i = \bigcup_{i \in F} p_i$
for finite subsets~$F$ of~$I$ by~\sref{orthogonal-tuple-of-projections}.)
\end{point}
\end{parsec}
\begin{parsec}[floor-sequential-product]%
\begin{point}{Lemma}%
Let~$a,b$ be effects of a von Neumann algebra~$\scrA$.
Then~$\floor{\sqrt{a}b\sqrt{a}}$ is the greatest projection
below~$a$ and~$b$, that is, 
$\floor{\sqrt{a}b\sqrt{a}}=\floor{a}\cap \floor{b}$.
\begin{point}{Proof}%
Surely, $\floor{\sqrt{a}b\sqrt{a}}\leq \sqrt{a}b\sqrt{a} \leq a$.
Let us prove that~$\floor{\sqrt{a}b\sqrt{a}}\leq b$.
To this end,
recall
that (by~\sref{projection-below-effect})
a projection~$e$ is below an effect~$c$
iff $ec=e$ iff $e\sqrt{c}=e$.
In particular,
since~$\floor{\sqrt{a}b\sqrt{a}}\leq \sqrt{a}b\sqrt{a}$ and 
$\floor{\sqrt{a}b\sqrt{a}}\leq a$,
we get
\begin{equation*}
\floor{\sqrt{a}b\sqrt{a}}
\ =\ \floor{\sqrt{a}b\sqrt{a}}\sqrt{a}b\sqrt{a}\floor{\sqrt{a}b\sqrt{a}} \ =\ 
\floor{\sqrt{a}b\sqrt{a}}b\floor{\sqrt{a}b\sqrt{a}},
\end{equation*}
and so $\floor{\sqrt{a}b\sqrt{a}}b^\perp\floor{\sqrt{a}b\sqrt{a}}=0$,
which implies that
$\floor{\sqrt{a}b\sqrt{a}}\leq b$ by~\sref{ad-contraposed}.
\begin{point}%
Now,
let~$e$ be a projection below~$a$ and~$b$,
that is, $e\sqrt{a}=e$ and~$eb=e$.
We must show that~$e\leq \floor{\sqrt{a}b\sqrt{a}}$,
or equivalently, $e\leq \sqrt{a}b\sqrt{a}$,
or put yet differently, $e\sqrt{a}b\sqrt{a}=e$.
But this is obvious: $e=e\sqrt{a}=eb\sqrt{a}=e\sqrt{a}b\sqrt{a}$.\qed
\end{point}
\end{point}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
Having seen that~$\floor{\sqrt{a}b\sqrt{a}} = \floor{a}\cap\floor{b}$
in~\sref{floor-sequential-product}
one might wonder whether
there is a similar expression for $\ceil{\sqrt{a}b\sqrt{a}}$,
but this doesn't seem to exist.
However,
for projections
$p$ and~$q$
we have
$\ceil{pqp}= p\cap (p^\perp \cup q)$
as we'll show below.
\end{point}
\begin{point}[floor-difference]{Lemma}%
Let~$p$ be a projection,
and let~$a$ be an effect of a von Neumann algebra
with $a\leq p$.
We have $p-\ceil{a}=\floor{p-a}$.
\begin{point}{Proof}%
We must show that $p-\ceil{a}$ is the greatest projection below $p-a$.
To begin, $p-\ceil{a}\leq p-a$,
because $a\leq \ceil{a}$.
Further, since~$a\leq p$, we have $\ceil{a}\leq p$,
and so~$p-\ceil{a}$ is a projection
(by~\sref{projection-below-projection}).

Let~$q$ be a projection below~$p-a$.
We must show that~$q\leq p-\ceil{a}$.
The trick is to note that~$a\leq p-q$.
Since~$p-q$ is a projection (by~\sref{projection-below-projection}
because $q\leq p-a\leq p$),
we have $\ceil{a}\leq p-q$,
and so $q\leq p-\ceil{a}$.\qed
\end{point}
\end{point}
\begin{point}[ceil-sequential-product]{Proposition}%
We have $\ceil{pqp}=p\cap (p^\perp \cup q)$
for all projections~$p$ and~$q$ from a von Neumann algebra.
\begin{point}[ceil-sequential-product-1]{Proof}%
Observe that $(\ p\cap (p^\perp \cup q)\ )^\perp 
= p^\perp \cup(p\cap q^\perp)$.
Since~$p^\perp$ and $p\cap q^\perp$ are disjoint,
we have $p^\perp \cup (p\cap q^\perp) = p^\perp + p\cap q^\perp$,
and so $p\cap (p^\perp \cup q) = p-p\cap q^\perp$.

By point~\sref{ceil-sequential-product-1}, 
it suffices to show that~$\ceil{pqp}=p- p\cap q^\perp$,
that is, $p-\ceil{pqp}=p\cap q^\perp$.
Since $p-\ceil{pqp} = \floor{p-pqp}$
by~\sref{floor-difference} and $\floor{pq^\perp p}=p\cap q^\perp$
by~\sref{floor-sequential-product} we are done.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Range and support}
\begin{parsec}%
\begin{point}{Notation}%
Let~$\scrA$ be a von Neumann algebra.
Because it will be very convenient
we extend the definition of~$\ceil{b}$
to all positive~$b$ from~$\scrA$
---
contrary to what the notation suggests,
$b\leq \ceil{b}$
---
by 
defining $\Define{\ceil{b}}=\ceil{\|b\|^{-1} b}$
when~$b\nleq 1$.

Now, given an arbitrary element~$b$ of~$\scrA$,
we'll call $\Define{\ceill{b}}:=\ceil{b^*b}$
the \Define{support} of~$b$,
and~$\Define{\ceilr{b}}:=\ceil{bb^*}$ the \Define{range} of~$b$.
\end{point}
\begin{point}{Remark}%
Some explaination is in order here.
We did not just introduce
the range
and support notation for its own sake,
but will use it extensively in~\S\ref{S:division}
thanks to calculus rules
such as $ab=0\iff \ceill{a}\ceilr{b}=0$
(see~\sref{mult-cancellation}).
The notation was chosen such 
that $\ceilr{b} b=b= b\ceill{b}$
(see~\sref{ceill-basic}).
Good examples are 
\begin{equation*}
	\ceill{\,\ketbra{x}{y}\,}
\,= \,\ketbra{y}{y}
\qquad\text{and}\qquad
\ceilr{\,\ketbra{x}{y}\,}
\,=\, \ketbra{x}{x}
\end{equation*}
for unit vectors~$x$ and~$y$ from a Hilbert space~$\scrH$.
\end{point}
\begin{point}[ceil-basic]{Exercise}%
Let~$a$ and~$b$ be positive elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Show that $pa=a$ iff $ap=a$ iff $\ceil{a}\leq p$
for every projection~$p$ of~$\scrA$.

(In particular, $\ceil{a}$ is the least projection of~$\scrA$
with $a\ceil{a}=a$.)

\item
Show that $\ceil{a}a=a\ceil{a}$,
and if fact, if $b\in\scrA$ commutes with~$a$
then~$b$ commutes with~$\ceil{a}$.

\item
Show that~$a=0$ iff $\ceil{a}=0$.

\item
Show that $\ceil{a}=\ceil{\lambda a}$
for every~$\lambda>0$.

Show that $\ceil{a+b}=\ceil{a}\cup\ceil{b}$.
\item
Show that $\ceil{a^2}=\ceil{a}$.
\end{enumerate}
\end{point}
\begin{point}[ceil-pos-part]{Exercise}%
Let~$a$ be a self-adjoint element of a von Neumann algebra.
\begin{enumerate}
\item
Show that~$\ceil{a_+}\ceil{a_-}= 0$.
(Hint: recall from~\sref{cstar-pos-neg-part} that~$a_+a_-=0$.)
\item
	Show that~$\ceil{a_+}a = a\ceil{a_+} = a_+$
	and~$\ceil{a_-}a=a\ceil{a_-} = -a_-$.
\end{enumerate}
\end{point}
\begin{point}[ceil-suprema]{Exercise}%
Show that $\ceil{\bigvee D} = \bigcup_{d\in D}\ceil{d}$
for every bounded directed set of \emph{positive}
elements of a von Neumann algebra~$\scrA$.
\end{point}
\begin{point}[ceill-basic]{Exercise}%
Let~$a$ and~$b$  be elements of a von Neumann algebra.
\begin{enumerate}
\item
Show that $\ceill{a}\equiv \ceil{a^*a}$
is the least projection of~$\scrA$
with $a\ceill{a}=a$.

\item
Show that $\ceilr{a}\equiv \ceil{aa^*}$
is the least projection of~$\scrA$
with $\ceilr{a}a=a$.

\item
Show that $\ceill{a^*}=\ceilr{a}$
and $\ceilr{a^*}=\ceill{a}$.

\item
Show that~$\ceill{ab}\leq\ceill{b}$
and~$\ceilr{ab}\leq\ceilr{a}$.
\end{enumerate}
\end{point}
\begin{point}[hilb-ceil]{Exercise}%
Let~$T$ be a bounded operator on a Hilbert space~$\scrH$.
\begin{enumerate}
\item
Show that $\ceilr{T}$
is the projection onto the closure
$\overline{\Ran(T)}$ of the range of~$T$.
\item
Show that $\ceill{T}$
is the projection onto the \emph{support}
of~$T$, i.e.~the orthocomplement
$\Ker(T)^\perp$ of the kernel of~$T$.
\item
Show that $\floor{T}$ is the projection
on $\{\,x\in\scrH\colon\, Tx=x\,\}$
when~$T$ is an effect.
\end{enumerate}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}[ceil-functionals-lemma]{Lemma}%
Given a positive element~$a$
of a von Neumann algebra~$\scrA$ and an
np-functional~$\omega\colon \scrA\to\C$
we have~$\omega(a)=0$ iff~$\omega(\ceil{a})=0$.
\begin{point}{Proof}%
Note that if~$a=0$,
the stated result is clearly correct,
and the other case, when~$\|a\| \neq 0$,
the problem reduces to the case
that $0\leq a\leq 1$
by replacing $a$ by~$\frac{a}{\|a\|}$.
So let us just assume that~$a\in [0,1]_\scrA$
to begin with.
For similar reasons, we may assume that $\omega (1)\leq 1$.

Now, since~$0\leq a\leq \ceil{a}$
we have $0\leq \omega(a)\leq \omega(\ceil{a})$,
so~$\omega(\ceil{a})=0\implies \omega(a)=0$
is obvious.
It remains to be shown that $\omega(\ceil{a})=0$
given~$\omega(a)=0$.
Since  $\ceil{a}=\bigvee_n a^{\nicefrac{1}{2^n}}$ 
(by~\sref{vna-ceil})
and~$\omega$ is normal,
we have $\omega(\ceil{a})=\bigvee_n \omega(a^{\nicefrac{1}{2^n}})$,
and so it suffices to show that~$\omega(a^{\nicefrac{1}{2^n}})=0$
for each~$n$.
As a result of Kadison's inequality
(see~\sref{omega-norm-basic})
we have~$\omega(\sqrt{a})^2\leq \omega(a)=0$,
and so~$\omega(\sqrt{a})=0$.
Since then~$\omega(\smash{\sqrt{\sqrt{a}}})=0$
by the same token, and so on,
we get $\omega(a^{\nicefrac{1}{2^n}})=0$
for all~$n$ by induction.\qed
\end{point}
\end{point}
\begin{point}[ceil-functionals]{Proposition}%
For positive elements~$a$ and~$b$ of a von Neumann algebra~$\scrA$,
\begin{equation*}
\ceil{a}\leq \ceil{b}
\qquad\iff\qquad
\forall \omega\,[\quad\omega(b)=0\  \implies  \ \omega(a)=0\quad ],
\end{equation*}
where~$\omega$ ranges over all np-functionals~$\omega\colon \scrA\to\C$.
\begin{point}{Proof}%
When~$\ceil{a}\leq\ceil{b}$
and~$\omega$ is an np-functional on~$\scrA$
with~$\omega(b)=0$,
then~$0\leq \omega(\ceil{a})\leq \omega(\ceil{b})=0$
(by~\sref{ceil-functionals-lemma}),
and so~$\omega(\ceil{a})=0$,
so that~$\omega(a)=0$
(again
by~\sref{ceil-functionals-lemma}).

For the other direction,
assume that~$\omega(b)=0\implies \omega(a)=0$
for every np-functional~$\omega$ on~$\scrA$;
we must show that~$\ceil{a}\leq \ceil{b}$,
or in other words, $\smash{\ceil{b}}^\perp \ceil{a}\smash{\ceil{b}}^\perp =0$.
Let~$\omega\colon \scrA\to\C$ be an arbitrary np-functional;
it suffices to show that 
$\omega(\,\smash{\ceil{b}}^\perp \ceil{a}\smash{\ceil{b}}^\perp \,)=0$.
Since~$\smash{\ceil{b}}^\perp b \smash{\ceil{b}}^\perp =0$
we have~$\omega(\smash{\ceil{b}}^\perp b\smash{\ceil{b}}^\perp)=0$
and so~$\omega(\smash{\ceil{b}}^\perp a \smash{\ceil{b}}^\perp)=0$
(by assumption, because
$\omega(\smash{\ceil{b}}^\perp(\,\cdot\,)\smash{\ceil{b}}^\perp)$
is an np-functional on~$\scrA$ as well),
which implies that
$\omega(\smash{\ceil{b}}^\perp\ceil{a}\smash{\ceil{b}}^\perp)=0$
by~\sref{ceil-functionals-lemma}.\qed
\end{point}
\end{point}
\begin{point}[ncp-ceil]{Proposition}%
Let $f\colon \scrA\to\scrB$ be a np-map
between von Neumann algebras.
Then $\ceil{f(a)}=\ceil{f(\ceil{a})}$
for every $a\in\scrA_+$.
\begin{point}{Proof}%
By~\sref{ceil-functionals}
it suffices to show that
$\omega(f(a))=0$ iff $\omega(f(\ceil{a}))=0$
for every np-functional $\omega\colon \scrB\to\C$,
and this is indeed the case by~\sref{ceil-functionals-lemma}.\qed
\end{point}
\end{point}
\begin{point}[ceil-fundamental]{Exercise}%
Let~$a$ and~$b$ be elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Deduce from~\sref{ncp-ceil}
that
$\ceil{a^*ba} = \ceil{a^*\ceil{b}a}$
when~$b\geq 0$.
\item
Conclude that~$\ceill{ab}=\ceill{\ceill{a}b}$
and~$\ceilr{ab}=\ceilr{a\ceilr{b}}$.

\end{enumerate}
\end{point}
\begin{point}[mult-cancellation]{Exercise}%
Let~$a$ and~$b$ be elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Show that $cb=0$ iff $\ceill{c}\ceilr{b}=0$
iff $\ceill{c}\leq \ceilr{b}^\perp$
for~$c\in\scrA$.

(Hint: if $cb=0$,
then $\ceil{b^*c^*cb}\equiv \ceil{b^*\ceil{c^*c}b}=0$
by~\sref{ceil-fundamental}.)
\item
Show that~$c_1b=c_2b \implies c_1=c_2$
for all~$c_1,c_2\in\scrA$
with~$\ceill{c_i}\leq \ceilr{b}$.
\item
Show that $b^*c_1b=b^*c_2b\implies c_1=c_2$
for all~$c_1,c_2\in\ceilr{b}\scrA\ceilr{b}$
\end{enumerate}
\end{point}
\begin{point}[ncp-union]{Exercise}%
Let~$f\colon \scrA\to\scrB$ be an np-map
between von Neumann algebras.
\begin{enumerate}
\item
Show that
$\ceil{f(p\cup q)}
= \ceil{f(p)}\cup\ceil{f(q)}$
for all projections $p$ and~$q$ in~$\scrA$.

(Hint: recall from~\sref{ceil-floor-basic} 
that $p\cup q = \ceil{\frac{1}{2}p+\frac{1}{2}q}$.)

\item
Deduce from this and~\sref{ncp-ceil} that $\ceil{f(\bigcup A)}=\bigcup_{a\in A}\ceil{f(a)}$
for every set of projections~$A$ from~$\scrA$.

\item
Show that there is a greatest projection~$e$
in~$\scrA$ with~$f(e)=0$.
\end{enumerate}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}{Proposition}%
Let~$f\colon \scrA\to\scrB$ be a ncpsu-map
between von Neumann algebras.
Then~$\floor{f(a)}=\floor{f(\floor{a})}$
for every effect~$a$ from~$\scrA$.
\begin{point}{Proof}%
Since~$\floor{a}\leq a$,
we have~$\floor{f(\floor{a})}\leq \floor{f(a)}$.
Thus we only need to show that~$\floor{f(a)}\leq \floor{f(\floor{a})}$,
or equivalently, $\floor{f(a)}\leq f(\floor{a})$.
We have
\begin{equation*}
\floor{f(a)}
\ \overset{\sref{ceil-floor-basic}}{=\joinrel=\joinrel=}\ 
\floor{f(a)^2}
\ \stackrel{\sref{inner-product-basic}}{\leq}\  
\floor{f(a^2)} \ \leq\ \floor{f(a)},
\end{equation*}
and so~$\floor{f(a)}=\floor{f(a^2)}$.
By induction,
and similar reasoning,
we get~$\floor{f(a)}=\floor{f(a^{2^n})}\leq f(a^{2^n})$
for every~$n$,
and so
$\floor{f(a)}\leq \bigwedge_n f(a^{2^n})
= f(\bigwedge_n a^{2^n})=f(\floor{a})$,
where we used that~$f$ is normal,
and~$\floor{a}=\bigwedge_n a^{2^n}$ (see~\sref{vna-floor}).\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Carrier and commutant}
\begin{parsec}%
\begin{point}[carrier]{Definition}%
The \Define{carrier}
of an np-map $f\colon \scrA\to\scrB$
between von Neumann algebras
is the least projection~$\Define{\ceil{f}}$ in~$\scrA$
with~$f(\smash{\ceil{f}}^\perp)=0$
(which exists by~\sref{ncp-union}).
\end{point}
\begin{point}[carrier-basic]{Exercise}%
Let~$f,g\colon \scrA\to\scrB$
be np-maps between von Neumann algebras.
\begin{enumerate}
\item
Show that $\ceil{\lambda f}=\ceil{f}$
for all~$\lambda>0$.
\item
Show that~$\ceil{f+g}=\ceil{f}\cup\ceil{g}$.
\item
Show that~$\ceil{f}=1$ iff~$f$ is faithful.
\item
Assuming~$f$ is multiplicative
show that~$\ceil{f}=1$ iff~$f$ is injective.

(There is more to say about
the carrier of a miu-map, see~\sref{carrier-miu}.)
\end{enumerate}
\end{point}
\begin{point}{Exercise}%
\begin{enumerate}
\item
Given an element~$a$ of a von Neumann algebra~$\scrA$
show that 
\begin{equation*}
\ceil{a^*(\,\cdot\,)a}\ =\ \ceil{aa^*}\equiv \ceilr{a}
\end{equation*}
where~$a^*(\,\cdot\,)a$
is interpreted as an np-map~$\scrA\to\scrA$.
\item
Given a bounded operator~$T\colon \scrH\to\scrK$
between Hilbert spaces
show that~$\ceil{T^*(\,\cdot\,)T}$
is the projection onto~$\overline{\Ran(T)}$
when~$T^*(\,\cdot\,)T$
is interpreted 
as a map
$\scrB(\scrK)\to\scrB(\scrH)$.
\item
Show that~$\ceil{\left<x,(\,\cdot\,)x\right>}=\ketbra{x}{x}$
for any unit vector~$x$ from a Hilbert space~$\scrH$
when~$\left<x,(\,\cdot\,)x\right>$
is interpreted as a map~$\scrB(\scrH)\to\C$.

(But be warned: when~$\scrA$ is a von Neumann subalgebra of~$\scrB(\scrH)$
the carrier of the restriction 
$\left<x,(\,\cdot\,)x\right>\colon \scrA\to\C$
might differ from~$\ketbra{x}{x}$ because the former is in~$\scrA$
while the latter may not be, see~\sref{carrier-vector-state}.)
\end{enumerate}
\end{point}
\begin{point}[cp-comprehension]{Lemma}%
Let~$f\colon \scrA\to\scrB$ be a p-map between
$C^*$-algebras,
and let~$p$ be an effect of~$\scrA$ with~$f(p^\perp)=0$.
Then $f(a)=f(pa)=f(ap)=f(pap)$
for all~$a\in\scrA$.
\begin{point}{Proof}%
Assume~$\scrB=\C$ for now.
Since~$p^\perp \leq 1$,
we have $(p^\perp)^2=\sqrt{p^\perp}p^\perp \sqrt{p^\perp}
\leq p^\perp$,
and so~$0\leq f(\,(p^\perp)^2\,) \leq f(p^\perp) = 0$,
giving us $f(\,(p^\perp)^2\,)=0$.
Since
$\left|\smash{f(p^\perp a)}\right|^2
\leq f(\,(p^\perp)^2\,)\  f(a^*a)\,=\, 0$
by Kadison's inequality, \sref{omega-norm-basic}, 
we get~$f(p^\perp a)=0$, and so~$f(pa)=f(a)$ for all~$a\in\scrA$.
In particular,
$f(ap)=f(pa^*)^*=f(a^*)^*=f(a)$
for all~$a\in\scrA$,
and so~$f(pap)=f(pa)=f(a)$
for all~$a\in \scrA$.

Letting~$\scrB$ be again arbitrary,
and given~$a\in\scrA$,
note that
since the states on~$\scrB$ 
are separating (by~\sref{states-order-separating})
it suffices 
to show that $\omega(f(a))=\omega(f(ap))=\omega(f(pa))=
\omega(f(pap))$ for all
states $\omega \colon \scrB\to\C$.
But this follows from the previous paragraph
since~$\omega\circ f$
is a p-map into~$\C$.\qed
\end{point}
\end{point}
\begin{point}[carrier-fundamental]{Corollary}%
Given an np-map $f\colon \scrA\to\scrB$
between von Neumann algebras
we have $f(a)=f(\ceil{f}a) = f(a\ceil{f})=f(\ceil{f}a\ceil{f})$
for all~$a\in\scrA$.
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
We end our exposition on projections
by showing that every element in a von Neumann 
algebra is the norm limit of linear combinations
of projections in~\sref{projections-norm-dense}.
We'll deal with the  commutative case first
(see~\sref{abelian-projections-norm-dense}),
and for this we
need an interesting 
property of the spectrum of a commutative von Neumann algebra,
see~\sref{vn-spectrum-extremally-disconnected}.
\TODO{rewrite!!}
\end{point}
\begin{point}[abelian-projections-norm-dense]{Proposition}%
Every element~$a$ of a commutative von Neumann algebra~$\scrA$
is the norm limit
of linear combinations of projections.
\begin{point}{Proof}%
By~\sref{ngelfand}
it suffices to show that the linear span
of projections is norm dense
in~$C(\spec(\scrA))$.
For this, in turn, it suffices 
by Stone--Weierstra\ss{}' theorem
(see~\sref{stone-weierstrass})
to show that the projections in~$C(\spec(\scrA))$
separate the points of~$\spec(\scrA)$
in the sense
that given $x,y\in\spec(\scrA)$
with~$x\neq y$
there is a projection~$f$ in~$C(\spec(\scrA))$
with~$f(x)\neq f(y)$.
Since~$\spec(\scrA)$
is Hausdorff
there are for such~$x$ and~$y$
disjoint open subsets $U$ and~$V$
of~$\spec(\scrA)$
with~$x\in U$ and~$y\in V$.

Then
$f:=\mathbf{1}_{\overline{U}}$
is a projection in~$C(\spec(\scrA))$
(continuous
because~$\overline{U}$
is clopen by~\sref{vn-spectrum-extremally-disconnected})
with~$f(x)=0\neq 1=f(y)$
since $x\in \overline{U}\subseteq \spec(\scrA)\backslash V$,
and so~$y\notin \overline{U}$.\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}[commutant]{Definition}%
Given a subset~$S$ of a von Neumann algebra~$\scrA$
the \Define{commutant} of~$S$
is the set, denoted by~$\Define{\smash{S^\square}}$,
of all~$a\in\scrA$ with $as=sa$ for all~$s\in S$.

The commutant of~$\scrA$ itself
is denoted by~$\Define{Z(\scrA)}:=\scrA^\square$
and is called the \Define{centre} of~$\scrA$.
(Its elements, called \emph{central}, are the subject of the next section.)
\end{point}
\begin{point}[commutant-basic]{Exercise}%
Let~$S$ and~$T$ be subsets of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Show that $S \subseteq T^\square$ iff $T \subseteq S^\square$.

Show that $S\subseteq T$ entails $T^\square \subseteq S^\square$.

Show that $S\subseteq S^{\square\square}$,
and  $S^{\square\square\square}=S^\square$.
\item
Show that $S^\square$ is closed under addition,
(scalar) multiplication,
contains the unit of~$\scrA$,
and is ultraweakly closed.
\item
Show that the commutant $S^\square$ need not be closed under involution.\\
(Hint: compute 
$\{\bigl(\begin{smallmatrix}0&1\\0&0\end{smallmatrix}\bigr)\}^\square$
in $M_2$.)

Suppose~$S$ is closed under involution.

Show~$S^\square$ is closed under involution as well,
and conclude that in that case~$S^\square$
is a von Neumann subalgebra of~$\scrA$.

Show that~$Z(\scrA)$ is a von Neumann subalgebra of~$\scrA$.

Show that~$S^{\square\square}$
is a von Neumann subalgebra of~$\scrA$
with~$S\subseteq S^{\square\square}$.

Show that if~$S$ is commutative (i.e.~$S\subseteq S^\square$), 
then so is~$S^{\square\square}$.
\item
In particular,
if~$\scrB$ is a von Neumann subalgebra of~$\scrA$,
then~$\scrB^{\square\square}$
is a von Neumann subalgebra of~$\scrA$
with $\scrB\subseteq \scrB^{\square\square}$.

Show that~$(\,\scrA\cap \C\,)^\square=\scrA$,
and so~$(\,\scrA\cap\C\,)^{\square\square} = Z(\scrA)$.

Nevertheless,
we'll see in \sref{proto-double-commutant} that $\scrB^{\square\square}=\scrB$
when~$\scrA$ is of the form $\scrA=\scrB(\scrH)$
for some Hilbert space~$\scrH$.
\item
Given a von Neumann subalgebra~$\scrB$
of~$\scrA$
verify that $Z(\scrB)=\scrB\cap \scrB^{\square}$.
\end{enumerate}
\end{point}
\begin{point}[projections-norm-dense]{Proposition}%
Every self-adjoint element~$a$ of a von Neumann algebra~$\scrA$
is the norm limit
of linear combinations
of projections from~$\smash{\{a\}}^{\square\square}$.
\begin{point}{Proof}%
Since~$a$ is an element
of the by~\sref{commutant-basic}
commutative von Neumann subalgebra~$\smash{\{a\}}^{\square\square}$
of~$\scrA$,
$a$ is the norm limit of linear combinations
of projections from~$\smash{\{a\}}^{\square\square}$
by~\sref{abelian-projections-norm-dense}.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Central support and carrier}
\begin{parsec}%
\begin{point}{Definition}%
An element~$a$ of a von Neumann algebra~$\scrA$
is called~\Define{central}
when~$ab=ba$ for all~$b\in\scrA$
(that is, when~$a\in Z(\scrA)$, see~\sref{commutant-basic}).
\end{point}
\begin{point}{Examples}%
\begin{enumerate}
\item
In a commutative von Neumann algebra
every element is central.
\item
An element~$a$ of a direct sum~$\bigoplus_i \scrA_i$
of von Neumann algebras
is central iff~$a_i$ is central for each~$i$.
\item
In~$\scrB(\scrH)$,
where~$\scrH$ is a Hilbert space,
only the scalars are central.

Indeed,
given a positive central element~$A$ 
of~$\scrB(\scrH)$,
we have $\left<x, A\|y\|^2 x\right>
= \left<x,A \ketbra{x}{y} y\right>
= \left<x,\ketbra{x}{y}A y\right>
= \left<x,\smash{\|\sqrt{A}y\|^2 }x\right>$
for all~$x,y\in\scrH$,
and so~$A\|y\|^2= \|\sqrt{A}y\|^2$
for all~$y\in\scrH$.
Hence~$A$ is (zero or) a scalar.
\end{enumerate}
\end{point}
\begin{point}[cceil-fundamental]{Proposition}%
Given a projection~$e$ of a von Neumann algebra~$\scrA$
\begin{equation*}
	\Define{\cceil{e}}\ :=\ 
	\bigcup_{a\in\scrA} \ceil{a^* e a}
\end{equation*}
is the least central projection above~$e$.
\begin{point}{Proof}%
Let us first show that~$\cceil{e}$ is central.
Given~$b\in\scrA$
we have $\ceill{\cceil{e}b}=\ceil{b^*\cceil{e}b}
=\bigcup_{a\in\scrA} \ceil{b^*\ceil{a^*ea}b}
= \bigcup_{a\in \scrA} \ceil{(ab)^* eab}
\leq \cceil{e}$
by~\sref{ncp-union},
which implies that~$\cceil{e}b\cceil{e}=\cceil{e}b$.
Since similarly (or consequently)
$\cceil{e}b\cceil{e} = b\cceil{e}$
we get~$b\cceil{e}=\cceil{e}b\cceil{e}
=\cceil{e}b$,
and so~$\cceil{e}$ is central.

Clearly~$e\leq \cceil{e}$.
It remains to be shown that~$\cceil{e}\leq c$
given a central projection~$c$ with~$e\leq c$.
For this it suffices to show that $\ceill{ea}\equiv \ceil{a^*ea}\leq c$
given~$a\in\scrA$.
Now, since~$e\leq c$
we have $ec=e$
and so~$eac=eca=ea$
which implies that~$\ceill{ea}\leq c$.
Thus~$\cceil{e}\leq c$.\qed
\end{point}
\end{point}
\begin{point}[central support]{Definition}%
Let~$a$ be an element of a von Neumann algebra~$\scrA$.
Since given a central projection~$c$ of~$\scrA$
we have
$\cceil{\ceill{a}}\leq c$
iff $\ceill{a}\leq c$
iff $ac=a$ 
iff
$ca=a$ iff $\cceil{\ceilr{a}}\leq c$,
we see that~$\Define{\cceil{a}}:=
\cceil{\ceill{a}}=\cceil{\ceilr{a}}$
is the smallest central projection
with~$\cceil{a}a=a$,
which we'll call the
\Define{central support} of~$a$.
\end{point}
\begin{point}[cceil-basic]{Exercise}%
Let~$\scrA$ be a von Neumann algebra.
\begin{enumerate}
\item
Show that $\cceil{a}=\cceil{a^*}
=\cceil{a^*a}=\cceil{aa^*}$
for all~$a\in\scrA$.
\item
Show that~$\cceil{ \bigvee D } = \bigcup_{d\in D} \cceil{d}$
for any bounded directed subset of~$\scrA$.

Show that~$\cceil{\bigcup E} = \bigcup_{e\in E} \cceil{e}$
for any collection of projections from~$\scrA$.

Show that~$\cceil{a+b}=\cceil{\ceil{a}\cup \ceil{b}}
=\cceil{a}\cup\cceil{b}$
for all~$a,b\in \scrA$.
\item
Given~$a\in\scrA$
and a central projection~$c$ of~$\scrA$
show that~$\cceil{a}c=\cceil{ac}$.

Conclude that~$\cceil{ab}=\cceil{a}\cceil{b}
=\cceil{a}\cap\cceil{b}$
for all~$a,b\in\scrA$.
\end{enumerate}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}{Definition}%
Let $f\colon \scrA\to\scrB$
be an np-map
between von Neumann algebras.
Show that given a central effect~$c$
of~$\scrA$ we have
$f(c^\perp)=0$
iff $\ceil{f}\leq c$
iff $\cceil{\ceil{f}}\leq c$,
and so~$\Define{\cceil{f}}:=\cceil{\ceil{f}}$
is the least central effect
(and projection)
with~$f(\cceil{f}^\perp)=0$,
which we'll call the \Define{central carrier} of~$f$.
\end{point}
\begin{point}{Proposition}%
\label{prop:weakly-closed-ideal}
Every two-sided ideal~$\scrD$ of a von Neumann
algebra~$\scrA$
that is closed under bounded directed suprema of self-adjoint 
elements
is of the form~$c\scrA$
for some unique central projection~$c$ of~$\scrA$.

Moreover, $c$ is the greatest projection in~$\mathscr{D}$.
\begin{point}{Proof}%
We'll obtain~$c$ as the supremum over all effects in~$\scrD$,
and to this end we'll show first that~$\scrD\cap [0,1]_\scrA$
is directed.
Since $\ceil{a}\cup \ceil{b} \equiv \ceil{\frac{1}{2}a+\frac{1}{2}b}$
(see~\sref{ceil-floor-basic})
is an upper bound for~$a,b\in\scrD\cap [0,1]_\scrA$
it suffices to show that~$\ceil{a}\in \scrD$
for all~$a\in \scrD\cap[0,1]_\scrA$,
which, in turn,
follows from
$\ceil{a}=\bigvee_n a^{\nicefrac{1}{2^n}}$,
see~\sref{vna-ceil}.

Hence~$\scrD\cap [0,1]_\scrA$ is directed,
and so we may define~$c:=\bigvee \scrD\cap[0,1]_\scrA$.
Since~$\scrD$ is a von Neumann subalgebra of~$\scrA$,
we'll have~$c\in\scrD\cap[0,1]_\scrA$,
and so~$c$ is the greatest element of~$\scrD\cap[0,1]_\scrA$.
In particular,
$c$ will be above~$\ceil{c}$ implying~$\ceil{c}=c$
and making~$c$ a projection---the greatest projection in~$\scrD$.

Given~$a\in\scrA$ we claim that~$a\in \scrD$
iff~$ca=a$.
Surely, if~$a=ca$,
then~$a=ca\in \scrD$,
because~$\scrD$ is a two-sided ideal of~$\scrA$.
Concerning the other direction,
note that given~$a\in \scrD$
the equality~$ac=a$ holds
when~$a$ is an effect by~\sref{projection-above-effect} (because~$a\leq c$),
and thus when~$a$ is self-adjoint too
(by scaling),
and hence for arbitrary~$a\in\scrD$
by  writing~$a\equiv \Real{a}+i\Imag{a}$
where~$\Real{a}$ and~$\Imag{a}$ are self-adjoint.

Note that this claim entails that~$\scrD \subseteq c\scrA$.
Since $\scrD$ is an ideal
we also have~$c\scrA\subseteq \scrD$,
and so~$\scrD= c\scrA$.
The claim also entails that~$c$ is central.
Indeed,
given~$a\in\scrA$
we have $ac\in \scrD$ 
(because~$\scrD$ is an ideal)
and so~$c(ac)=ac$ by the claim.
Since similarly~$(ca)c=ca$,
we get~$ac=ca$.

The only thing that remains to be shown is that~$c$
is unique.
To this end let~$c$ and~$c'$ be central projections 
with~$c\scrA = \mathscr{D}=c'\scrA$.
As~$c'\in\mathscr{D}=c \scrA$,
there is~$a\in \scrA$
with~$c' = ca$.
Then~$c' = c'(c')^* = caa^*c^*\leq 
cc^*\|aa^*\|=c\|a\|^2$,
and so~$c'\leq c$.
Since similarly $c\leq c'$, we get~$c=c'$.\qed
\end{point}
\end{point}
\begin{point}[carrier-miu]{Corollary}%
Given a nmiu-map $f\colon \scrA\to\scrB$
between von Neumann algebras
we have~$\ceil{f}=\cceil{f}$
and $\ker(f)=\cceil{f}\!\scrA$.
\end{point}
\begin{point}[proto-gns-ceil]{Lemma}%
We have~$\cceil{\omega}=
\ceil{\varrho_\omega}$
for every np-functional $\omega\colon \scrA\to\C$
on a von Neumann algebra~$\scrA$,
where~$\varrho_\omega$
is as in~\sref{gns}.
\begin{point}{Proof}%
Let~$e$ be a projection in~$\scrA$.
Note that $0=\|\varrho_\omega(e)(\eta_\omega(a))\|^2
\equiv \omega(a^*ea)$
iff~$\ceil{a^*ea}\leq \smash{\ceil{\omega}}^\perp$
iff~$\ceil{a\ceil{\omega}a^*}\leq e^\perp$
for all~$a\in\scrA$.
So since the~$\eta_\omega(a)$'s lie dense in~$\scrH_\omega$,
we have~$\varrho_\omega(e)=0$
iff $\varrho_\omega(e)(\eta_\omega(a))=0$ for all~$a\in\scrA$
iff $\bigcup_{a\in\scrA} \ceil{a\ceil{\omega}a^*}\leq e^\perp$.
Hence $\ceil{\varrho_\omega}=
\bigcup_{a\in\scrA}
\ceil{a\ceil{\omega}a^*} \equiv
\bigcup_{a\in\scrA}
\ceil{a^*\ceil{\omega}a}
=\cceil{\ceil{\omega}}
=\cceil{\omega}$
by~\sref{cceil-fundamental}.\qed
\end{point}
\end{point}
\begin{point}[gns-ceil]{Proposition}%
Given a collection of np-functionals~$\Omega$
on a von Neumann algebra~$\scrA$
we have $\ceil{\varrho_\Omega}
=\bigcup_{\omega\in\Omega} \cceil{\omega}$
for~$\varrho_\Omega$
from~\sref{gns}.
\begin{point}{Proof}%
Let~$e$ be a projection of~$\scrA$.
Since
$\varrho_\Omega(e)(x)
= \sum_{\omega\in\Omega} \varrho_\omega(x_\omega)$
by~\sref{gns}
for all~$x\in\scrH_\Omega\equiv\bigoplus_{\omega\in\Omega}\scrH_\omega$,
we have~$\varrho_\Omega(e)=0$
iff~$\varrho_\omega(e)=0$ for all~$\omega\in\Omega$
iff~$e\leq \smash{\ceil{\varrho_\omega}^\perp \equiv 
\smash{\cceil{\omega}}^\perp}$
iff~$e\leq \bigcap_{\omega\in\Omega}\smash{\cceil{\omega}}^\perp 
\equiv (\bigcup_{\omega\in\Omega} \cceil{\omega})^\perp$.
Hence~$\ceil{\varrho_\Omega}=\bigcup_{\omega\in\Omega}\cceil{\omega}$.\qed
\end{point}
\end{point}
\begin{point}[vn-center-separating]{Corollary}%
For a collection~$\Omega$ of np-functionals
on a von Neumann algebra,
the following are equivalent.
\begin{enumerate}
\item
\label{vn-center-separating-1}
$\Omega$ is center separating (see~\sref{separating}).
\item
\label{vn-center-separating-2}
A central projection~$z$ of~$\scrA$ is zero
when~$\omega(z)=0$ for all~$\omega\in\Omega$.
\item
\label{vn-center-separating-3}
The map $\varrho_\Omega\colon\scrA\to\scrB(\scrH_\Omega)$
from~\sref{gns} 
is injective.
\end{enumerate}
\begin{point}{Proof}%
We've seen in~\sref{proto-gelfand-naimark}
that
\ref{vn-center-separating-1}$\iff$\ref{vn-center-separating-3},
and~\ref{vn-center-separating-1}$\Rightarrow$\ref{vn-center-separating-2}
is trivial,
which leaves us with 
\ref{vn-center-separating-2}$\Rightarrow$\ref{vn-center-separating-3}.
So assume that~$\omega(z)=0$ for every central projection~$z$
of~$\scrA$.
Then since~$\ceil{\varrho_\Omega}^\perp$
is a central projection
by~\sref{gns-ceil}
with
$\ceil{\varrho_\Omega}^\perp
=\smash{\bigl(\bigcup_{\omega\in\Omega} \smash{\cceil{\omega}\bigr)}}^\perp
=\bigcap_{\omega\in \Omega} \cceil{\omega}^\perp
\leq \smash{\cceil{\omega}}^\perp
\leq \smash{\ceil{\omega}}^\perp$
and thus
$\omega(\smash{\ceil{\varrho_\Omega}}^\perp)
\leq \omega(\ceil{\omega}^\perp)=0$
for all~$\omega\in\Omega$
we get~$\ceil{\varrho_\Omega}^\perp =0$,
and so~$\varrho_\Omega$ is injective
by~\sref{carrier-basic}.\qed
\end{point}
\end{point}
\end{parsec}
\section{Completeness}
\begin{parsec}%
\begin{point}%
We set to work on the ultrastrong and bounded ultraweak completeness
of von Neumann algebras (see~\sref{vn-complete}) and its precursors:
\begin{enumerate}
\item
A linear (not necessarily positive)
functional on a von Neumann algebra
is ultraweakly continuous iff it is ultrastrongly continuous
(see~\sref{luws}).
\item
A convex subset of a von Neumann algebra
is ultraweakly closed iff it is ultrastrongly closed
(see~\sref{ultraclosed}).
\item
\emph{(Kaplansky's density theorem)}\ 
The unit ball $(\scrA)_1$
of a $C^*$-subalgebra~$\scrA$
of a von Neumann algebra~$\scrB$
is ultrastrongly dense in~$(\bar{\scrA})_1$
where~$\bar{\scrA}$ is the ultrastrong (=ultraweak,
\sref{ultraclosed}) closure of~$\scrA$
(see~\sref{kaplansky}).
\item
Any von Neumann subalgebra~$\scrA$
of~$\scrB$ is ultraweakly and ultrastrongly
closed in~$\scrB$
(see~\sref{vnsac}).
\item
The von Neumann algebra~$\scrB(\scrH)$ 
of bounded operators on a Hilbert space~$\scrH$
is ultrastrongly 
(\sref{bh-us-complete})
and bounded ultraweakly complete
(\sref{bh-bounded-uw-complete}).
\end{enumerate}

\end{point}
\end{parsec}
\subsection{Closure of a convex subset}
\begin{parsec}%
\begin{point}%
We saw in~\sref{npuws}
that a \emph{positive} linear functional~$f$
on a von Neumann algebra 
is ultrastrongly continuous iff it is ultraweakly continuous.
In this section, we'll show that the same result holds
for an arbitrary linear functional~$f$.
Note that if~$f$ is ultraweakly continuous,
then~$f$ is automatically ultrastrongly continuous
(because ultrastrong convergence implies ultraweak convergence).
For the other direction,
we'll show that if~$f$ is ultrastrongly continuous,
then~$f$ can be written as a linear combination
$f\equiv \sum_{k=0}^3 i^k f_k$
of np-maps $f_0,\dotsc,f_3$,
and must therefore be ultraweakly continuous.
We'll need the following tool.
\end{point}
\begin{point}[bstaromega]{Definition}%
Let~$\scrA$ be a von Neumann algebra.
Given an np-map $\omega\colon \scrA\to\C$,
and~$b\in \scrA$,
define~$\Define{b*\omega}\colon \scrA\to \C$ by
$(b*\omega)(a)=\omega(b^*ab)$ for all~$a\in \scrA$.
\end{point}
\begin{point}[bstaromega-basic]{Exercise}%
Let~$\omega\colon \scrA\to \C$ be an np-map on a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Note that $b*\omega\colon \scrA\to\C$
is an np-map for all~$b\in \scrA$.

Show that $\left|\omega(a^*bc)\right| 
\,\leq\, \|\omega\|\,\|a\|_\omega\, \|b\|\, \|c\|_\omega$
for all~$a,b,c\in\scrA$.

Deduce that $\| b*\omega - b'*\omega\|
\,\leq\, \|\omega\| \,\|b-b'\|_\omega\, (\|b\|_\omega + \|b'\|_\omega)$
for all~$b,b'\in\scrA$.

\item
Let~$b_1,b_2,\dotsc$  a sequence in~$\scrA$,
which is Cauchy with respect to~$\|\,\cdot\,\|_\omega$.
Show that the sequence~$b_1*\omega,\,b_2*\omega,\,\dotsc$ 
is Cauchy (in the operator norm
on bounded linear functionals $\scrA\to\C$),
and converges to a bounded linear map~$f\colon \scrA\to\C$.
Show that~$f$ is an np-map.
\end{enumerate}
\end{point}
\begin{point}{Exercise}%
Let~$f\colon \scrA\to \C$ be an ultrastrongly continuous linear
functional on a von Neumann algebra~$\scrA$.
Show that there is an np-map
$\omega\colon \scrA\to \C$
and $\delta>0$
with $\left|f(a)\right|\leq 1$
for all~$a\in\scrA$ with $\|a\|_\omega \leq \delta$.

(Keep this in mind when reading the following lemma.)
\end{point}
\begin{point}[normal-functionals-lemma]{Lemma}%
Let~$\omega\colon \scrA\to\C$ be an np-map,
and let~$f\colon \scrA\to \C$ be a linear map.
The following are equivalent.
\begin{enumerate}
\item\label{normal-functionals-lemma-0}
$\left|f(a)\right|\leq B$ for all~$a\in \scrA$
with $\|a\|_\omega\leq \delta$, for some $\delta,B>0$;
\item\label{normal-functionals-lemma-1}
$\left|f(a)\right| \leq B \|a\|_\omega$ for all~$a\in\scrA$,
for some~$B>0$;
\item\label{normal-functionals-lemma-2}
$f(a)=[b,a]_\omega$ for all~$a\in\scrA$, 
for some~$b\in\scrH_\omega$
(where $\scrH_\omega$ is the Hilbert space completion of~$\scrA$
with respect to the inner-product
$[\,\cdot\,,\,\cdot\,]_\omega$).
\item\label{normal-functionals-lemma-3}
$f\equiv f_0+if_1-f_2-if_3$
where $f_0,\dotsc,f_3\colon \scrA\to \C$
are np-maps for which there is~$B>0$
such that~$f_k(a)\leq B \omega(a)$ for all~$a\in\pos{\scrA}$ 
and~$k$. 
\end{enumerate}
\begin{point}{Proof}%
We make a circle.
\begin{point}{%
\ref{normal-functionals-lemma-3}$\Longrightarrow$%
\ref{normal-functionals-lemma-0}}%
For $a\in \scrA$ and~$k$, we have
$\left|f_k(a)\right|^2 \leq
f_k(1)\,f_k(a^*a) \leq f_k(1)B \,\omega(a^*a)$,
giving~$\left|f_k(a)\right| \leq (f_k(1)B)^{\nicefrac{1}{2}} \|a\|_\omega$,
and so~$\left|f(a)\right|\leq \tilde{B} \|a\|_\omega$,
where $\tilde{B} = B^{\nicefrac{1}{2}}\sum_{k=0}^3f_k(1)^{\nicefrac{1}{2}}$.
Hence~$\left|f(a)\right|\leq \tilde{B}$
for all~$a\in\scrA$ with $\|a\|_\omega\leq 1$.
\end{point}
\begin{point}{\ref{normal-functionals-lemma-0}$\Longrightarrow$%
\ref{normal-functionals-lemma-1}}%
Let~$a\in\scrA$, and~$\varepsilon>0$ be given.
Then for~$\tilde{a}:=\delta(\varepsilon+\|a\|_\omega)^{-1}\,a$,
we have $\|\tilde{a}\|_\omega\leq \delta$,
and so~$\left|f(\tilde{a})\right|
\equiv \delta(\varepsilon +\|a\|_\omega)^{-1} \,\left|f(a)\right|
\leq B$,
which entails $\left|f(a)\right|\leq 
B\delta^{-1}(\varepsilon+\|a\|_\omega)$.
Since~$\varepsilon>0$ was arbitrary, we get~$\left|f(a)\right|\leq
B\delta^{-1}\|a\|_\omega$.
\end{point}
\begin{point}{%
\ref{normal-functionals-lemma-1}$\Longrightarrow$%
\ref{normal-functionals-lemma-2}}%
Since~$\left|f(a)\right|\leq B\|a\|_\omega$ for all~$a\in\scrA$,
the map~$f$ can be extended to a bounded linear map 
$\tilde{f}\colon \scrH_\omega\to \C$.
Then by Riesz' representation theorem, \sref{riesz-representation-theorem},
there is~$b\in \scrH_\omega$ with $\tilde{f}(x)=[b,x]_\omega$
for all~$x\in \scrH_\omega$.  
In particular,
$f(a)=[b,a]_\omega$ for all~$a\in \scrA$.
\end{point}
\begin{point}{\ref{normal-functionals-lemma-2}$\Longrightarrow$%
\ref{normal-functionals-lemma-3}}%
We know that~$f(a)\equiv [b,a]_\omega$ for all~$a\in \scrA$,
for some~$b\in\scrH_\omega$.
Then, by definition of~$\scrH_\omega$,
there is a sequence~$b_1,b_2,\dotsc$ in~$\scrA$
which converges to~$b$ in~$\scrH_\omega$.
Then the maps $[b_n,\,\cdot\,]_\omega\colon \scrA\to \C$
approximate~$f=[b,\,\cdot\,]_\omega$
in the sense that 
$\left|f(a)-[b_n,a]_\omega\right|=\left|[b-b_n,a]_\omega\right|
\leq \|b-b_n\|_\omega \|a\|_\omega
\leq \|b-b_n\|_\omega \|\omega\| \|a\|$
for all~$a\in \scrA$.
In particular, $[b_1,\,\cdot\,]_\omega,\,[b_2,\,\cdot\,]_\omega,\,\dotsc$
converges to~$f$ (in the operator norm).
By ``polarization'' (c.f.~\sref{mult-polarization}),
we have $[b_n,a]_\omega = \frac{1}{4}\sum_{k=0}^3 i^kf_{k,n}(a)$,
where $f_{k,n} := (i^kb_n+1)*\omega$ is an np-map.
Since~$(i^kb_n+1)_n$ is Cauchy with respect to~$\|\,\cdot\,\|_\omega$,
we see by~\sref{bstaromega-basic} that 
$(f_{k,n})_n$ converges to an np-map $f_k\colon \scrA\to\C$
(with respect to the operator norm).
It follows that~$f=\frac{1}{4}\sum_{k=0}^3 i^k f_k$.

It remains to be shown that there is~$B>0$ with $f_k(a)\leq B\omega(a)$
for all~$k$ and~$a\in\pos{\scrA}$.
Note that since $f_{k,n}(a) \leq \|i^kb_n+1\|_\omega \,\omega(a)
\leq (\|b_n\|_\omega+1) \,\omega(a)$,
for all~$n$, $k$, and~$a\in\pos{\scrA}$,
the number $B:=\lim_n \|b_n\|_\omega +1 $ will do.\qed
\end{point}
\end{point}
\end{point}
\begin{point}[luws]{Corollary}%
For a linear map~$f\colon \scrA\to \C$
on a von Neumann algebra~$\scrA$ the following are equivalent.
\begin{enumerate}
\item
$f$ is ultrastrongly continuous;
\item
$f$ is ultraweakly continuous;
\item
$f\equiv f_0+if_1-f_2-if_3$
for some~np-maps $f_0,\dotsc,f_3\colon \scrA\to\C$;
\item
``$f$ is bounded on some $\|\,\cdot\,\|_\omega$-ball,''
that is,
\begin{equation*}
	\sup\{\ \left|f(a)\right|\colon a\in \scrA\colon 
		\|a\|_\omega\leq \delta\ \}\ <\ \infty
\end{equation*}
for some $\delta>0$ and  np-map $\omega\colon \scrA\to\C$;
\item
$\left|f(a)\right|\leq \|a\|_\omega$
for all~$a\in \scrA$, for some np-map $\omega\colon \scrA\to\C$.
\end{enumerate}
\end{point}
\end{parsec}
%
%	ultrastrong and ultraweak closure of a convex subset
%
\begin{parsec}%
\begin{point}%
We'll show that the ultrastrong and ultraweak closure
of a convex set agree. 
For this we need the following proto-Hahn--Banach separation theorem,
which concerns the following notion of openness.
\end{point}
\begin{point}{Definition}%
A subset~$A$ of a real vector space~$V$ 
is called \Define{radially open}
if for all~$a\in A$ and~$v\in V$
there is $t\in (0,\infty)$
with $a+sv\in A$ for all~$s\in [0,t)$.
\end{point}
\begin{point}{Exercise}%
Let~$V$ be a vector space.
\begin{enumerate}
\item
Show that the radially open subsets of~$V$ form a topology.
\item
Show that with respect to this topology,
scalar multiplication and translations $x\mapsto x+a$
by a fixed vector~$a\in V$ are continuous.
\item
Show that $\{(0,0)\}\cup B_1(-1)\cup B_1(1)\cup B_2(-2)^c\cup B_2(2)^c$
is a radially open subset of~$\R^2$, 
which is not open
in the usual topology.

\REMARK{A picture of this will be added here.}

\item
Show that addition on~$\R^2$ is not jointly radially continuous.
\item
Show that nevertheless $\{s\in \R \colon sx+s^\perp y\in A\}$
is open for every radially open~$A\subseteq V$, and $x,y\in V$.
\item
Show that $A+B$ is radially open when~$A,B\subseteq V$ are radially open.

Show that $\{\lambda a\colon a\in A,\lambda>0\}$ is radially open
when~$A$ is radially open.
\end{enumerate}
\end{point}
\begin{point}[hahn-banach]{Theorem}%
For every radially open
convex subset~$K$ of a real vector space~$V$
with~$0\notin K$
there is a linear map $f\colon V\to\R$
with $f(x)>0$ for all~$x\in K$.
\begin{point}{Proof}%
(Based on Theorem~1.1.2 of~\cite{kr}.)

By Zorn's Lemma we may assume without loss of generality that~$K$ is maximal
among radially open convex subsets of~$V$ that do not contain~$0$.

We also assume that~$K$ is non-empty,
because if~$K=\varnothing$, the result is trivial.

We will show in a moment that~$H:=\{x\in V\colon -x,x\notin K\}$
is a linear subspace and~$V/H$ is one-dimensional.
From this we see that there is a linear map $f\colon V\to\R$
with~$\ker(f)=H$.
Since~$f(K)$ is a convex subset which does not contain~$0$
(because $H\cap K=\varnothing$)
we either have $f(K)\subseteq (0,\infty)$
or $f(K)\subseteq(-\infty,0)$.
Thus, by replacing $f$ by $-f$ if necessary,
we see that there is a linear map $f\colon V\to \R$
with $f(x)>0$ for all~$x\in K$.
\begin{point}{$H$ is a linear subspace}%
Note that~$x\in K,\,\lambda>0\implies \lambda x\in K$,
because the subset 
$\{\lambda x\colon x\in K,\lambda\in(0,\infty)\}\supseteq K$
is radially open, convex, doesn't contain~$0$,
and is thus~$K$ itself.
Furthermore,
$x,y\in K\implies x+y\in K$, because
$x+y=2(\frac{1}{2}x + \frac{1}{2}y)$, and~$K$ is convex.

Let~$\overline{K}$ be the set of all~$x\in V$
with $x+y\in K$ for all~$y\in K$.
Then it is not difficult to check that~$\overline{K}$ is a cone:
 $0\in\overline{K}$,
and
$x\in \overline{K},\lambda\geq 0\implies \lambda x\in \overline{K}$, and
$x,y\in\overline{K}\implies x+y\in \overline{K}$.

We claim that~$x\in \overline{K}$ iff $-x\notin K$.
Indeed, if~$x\in\overline{K}$, then $-x\notin K$, because otherwise
$-x\in K$ and so
$0=x+(-x)\in K$, which is absurd.
For the other direction, suppose that $-x\notin K$.
Then $x+y\in K$ for all~$y\in K$,
because
$\{\lambda x+y\colon y\in K,\lambda\geq0\}\supseteq K$
is radially open, convex, doesn't contain~$0$,
and is thus~$K$.

It follows that~$H=\overline{K}\cap -\overline{K}$.
Since~$\overline{K}$ is a cone, $-\overline{K}$ is a cone,
and thus~$H$ is a cone.  But then~$-H=H$ is a cone too,
and thus~$H$ is a linear subspace.
\end{point}
\begin{point}{$V/H$ is one-dimensional}%
Note that~$H\neq V$, because~$K\cap H=\varnothing$
and~$K$ is (assumed to be) non-empty.
So to show that~$V/H$ is one-dimensional,
it suffices to show that
any~$x,y\in V$ 
 are linearly dependent in~$V/H$.
We may assume that~$x\in K$ and~$y\in -K$.
It suffices to find~$s\in [0,1]$ with $0=sx+s^\perp y$.
The trick is to consider the sets
 $S_0 = \{s\in [0,1]\colon sx+s^\perp y \in -K\}$
and~$S_1 = \{s\in [0,1]\colon sx+s^\perp y \in K\}$,
which are open (because~$K$ and~$-K$ are radially open),
non-empty (because $0\in S_0$ and~$1\in S_1$),
and therefore cannot cover~$[0,1]$
(because~$[0,1]$ is connected).
So there must be~$s\in (0,1)$ 
such that
$sx+s^\perp y $ 
is neither in~$K$
nor in~$-K$,
and thus $sx+s^\perp y \in H$ (by definition of~$H$).
Whence~$x$ and~$y$ are linearly dependent in~$V/H$
(since~$s\neq 0$).\qed
\end{point}
\end{point}
\end{point}
\begin{point}[ultraclosed]{Exercise}%
We will use~\sref{hahn-banach}
to prove that 
an ultrastrongly closed convex subset~$K$ of a 
von Neumann algebra~$\scrA$
is ultraweakly closed as well.

Let us first simplify the problem a bit.
If~$K$ is empty, the result is trivial,
so we may as well assume that $K\neq \varnothing$.
Note that we must show that no net in~$K$ converges ultraweakly
to any element~$a_0\in\scrA$ outside~$K$,
but by considering~$K-a_0$ instead of~$K$,
we see that it suffices to show that
no net in~$K$ converges ultraweakly to~$0$
under the assumption that~$0\notin K$.
To this end we'll find an ultraweakly continuous linear map
$g\colon \scrA\to \C$ and~$\delta>0$ 
with~$\Real{g(k)}\geq \delta$ for all~$k\in K$---if
a net $(k_\alpha)_\alpha$ in~$K$ were to converge ultraweakly to~$0$,
then~$\Real{g(k_\alpha)}$ would converge to~$0$ as well,
which is impossible.
\begin{enumerate}
\item
	Show that 
	there is an np-map~$\omega \colon\scrA\to\C$
	and~$\varepsilon>0$ 
	with $\|k\|_\omega \geq \varepsilon$ for all~$k\in K$.
	(Hint: use that~$K$ is ultrastrongly closed).
\item
	Show that~$B:= \{ b\in \scrA\colon \|b\|_\omega < \varepsilon\}$
	 is convex, radially open, $B\cap K=\varnothing$.

	Show that $B-K$ is convex, radially open, and $0\notin B-K$.
\item
	Use~\sref{hahn-banach} to show that
	 there is an $\R$-linear map $f\colon \scrA\to \R$
	with $f(b)<f(k)$ for all~$b\in B$ and~$k\in K$.
	Show that~$f$
	can be extended to a $\C$-linear map
	$g \colon \scrA\to \C$
	by $g(a)= f(a)-if(ia)$ for all~$a\in\scrA$.
\item
	Show that $\left| f(b)\right| \leq f(k)$ 
	and $\left|g(b)\right|\leq 2f(k)$
	for all~$b\in B$ and $k\in K$.\\
	(Hint: $b\in B\implies -b\in B$.)

	Conclude that~$g$ is ultraweakly continuous
	(using~\sref{luws} and $K\neq \varnothing$).
\item
	It remains to be shown that
	there is $\delta>0$ with $f(k)\equiv \Real{g(k)}\geq \delta$
	for all~$k\in K$.
	Show that in fact there is $b_0\in B$
	with $f(b_0) >0$,
	and  that $f(k)\geq f(b_0)>0 $ for all~$k\in K$.
\end{enumerate}
\end{point}
\end{parsec}
\subsection{Kaplansky's density theorem}
\begin{parsec}%
\begin{point}[proto-kaplansky]{Proposition}%
Let~$\scrA$ be a von Neumann algebra,
and let~$f\colon \R\to\R$ be a continuous map 
with $f(t)=\mathcal{O}(t)$,
that is,
there are~$n\in \N$ and~$b\in [0,\infty)$
such that $\left|f(t)\right|\leq b\left|t\right|$
for all~$t\in \R$ with~$\left|t\right| \geq n$.

Then the map~$a\mapsto f(a),\,\sa{\scrA}\to\sa{\scrA}$,
see~\sref{functional-calculus},
is ultrastrongly continuous.
\begin{point}{Proof}%
(An adaptation of Lemma~44.2 from~\cite{conway2000}.)

Let~$S$ denote the set of all continuous $g\colon \R\to\R$
such that $a\mapsto g(a),\,\sa{\scrA}\to\sa{\scrA}$
is ultrastrongly continuous.
We must show that~$f\in S$.

Let us first make some general observations.
The identity map $t\mapsto t$ is in~$S$,
any constant function is in~$S$,
and~$S$ is closed under addition,
and scalar multiplication.
In particular, any affine transformation ($t\mapsto at+b$)
is in~$S$.
Moreover, we have~$g\circ h\in S$ when $g,h\in S$,
and also~$gh\in S$
provided that~$g$ is bounded.
Finally, $S$ is closed with respect to uniform convergence.

Now,
as $f(t)=f(t)\,\smash{\frac{1}{1+t^2}\,+\, f(t)\,\frac{t^2}{1+t^2}}$
 one can see from the remarks above
that it suffices
to show
that~$t\mapsto f(t)\,\smash{\frac{1}{1+t^2}}$ is in~$S$
--- here we use that $t\mapsto f(t) \,\smash{\frac{t}{1+t^2}}$ is bounded.
In other words,
we may assume without loss of generality,
that~$f$ vanishes at infinity, i.e.~$\lim_{t\to \infty}f(t)=0$.

Suppose for the moment
that there is $e\in S$, $e\neq 0$,
which vanishes at infinity.
Let~$a,b\in \R$.
Then $e_{a,b}\colon \R\to\R, t\mapsto e(at+b)$
--- an affine transformation followed by~$e$ ---
is also in~$S$,
vanishes at infinity,
and can be extended to a continuous real-valued
function on the one-point compactification $\R\cup \{ \infty\}$
of~$\R$
(by defining $e_{a,b}(\infty)=0$).
It is easy to see that the $C^*$-subalgebra
of~$C(\R\cup\{\infty\})$
generated by these extended~$e_{a,b}$'s 
separates the points of~$\R\cup\{\infty\}$,
and is thus~$C(\R\cup\{\infty\})$ itself
by the Stone--Weierstra\ss theorem (see~\sref{stone-weierstrass}).
Since~$f$ vanishes at infinity,
$f$ can be extended to an element of $C(\R\cup\{\infty\})$,
 and can thus be obtained
(by taking real parts if necessary)
from the extended $e_{a,b}$'s and real constants 
via uniform limits, addition and (real scalar)
multiplication. 
Since~$S$ contains the $e_{a,b}$'s and constants
and is closed under these operations (acting on bounded functions),
we see that~$f\in S$.

To complete the proof,
we show that such~$e$ indeed exists.
Let $e,s\colon \R\to\R$ 
be given by $e(t)=ts(t)$ and $s(t)=\smash{\frac{1}{1+t^2}}$.
Clearly~$e$ and~$s$
are continuous
and
vanish at infinity.
To see that~$e$ is ultrastrongly continuous,
let $(b_\alpha)_\alpha$ be a net of self-adjoint elements of~$\scrA$
which converges ultrastrongly to $a\in\sa{\scrA}$,
and let~$\omega\colon \scrA\to \C$
be an npu-map. 
Unfolding the definitions
of~$e$ and~$s$ yields
the following equality.
\begin{equation*}
e(b_\alpha)-e(a) \ =\ s(b_\alpha)\,(b_\alpha-a)\,s(a)
\,-\, e(b_\alpha)\,(b_\alpha-a)\,e(a).
\end{equation*}
Since $\|s(b_\alpha)\|\leq 1$,
we have $\|s(b_\alpha)(b_\alpha-a)s(a)\|_\omega 
\leq  \,\|(b_\alpha-a)s(a)\|_\omega
\equiv \|b_\alpha-a\|_{s(a)*\omega}$.
Similarly, since~$\|e(b_\alpha)\|\leq 1$,
we get
\begin{alignat*}{3}
\|e(b_\alpha)-e(a)\|_\omega
\ \leq\ \|b_\alpha-a\|_{s(a)*\omega}\,+\,\|b_\alpha-a\|_{e(a)*\omega}.
\end{alignat*}
Thus~$e(b_\alpha)$ converges ultrastrongly to~$e(a)$,
and so~$e$ is ultrastrongly continuous.\qed
\end{point}
\end{point}

\begin{point}[abs-us-cont]{Corollary}%
Given a von Neumann algebra~$\scrA$
the map $a\mapsto\left|a\right|\colon\,\Real{\scrA}\to\Real{\scrA}$
is ultrastrongly continuous.
\end{point}
\begin{point}[kaplansky]{Kaplansky Density Theorem}%
Let~$b$ be an element of a von Neumann algebra~$\scrB$
which is the ultrastrong limit of a net
of elements
from a $C^*$-subalgebra $\scrA$ of~$\scrB$.
Then
$b$ is the ultrastrong limit of a net~$(a_\alpha)_\alpha$
in~$\scrA$ with~$\|a_\alpha\|\leq\|b\|$ for all~$\alpha$.
Moverover,
\begin{enumerate}
\item
if~$b$ is self-adjoint,
then the~$a_\alpha$ can be chosen to be self-adjoint as well;
\item
if~$b$ is positive,
then the~$a_\alpha$ can be chosen to be positive as well, and
\item
if~$b$ is an effect,
then the~$a_\alpha$ can be chosen to be effects as well.
\end{enumerate}
\begin{point}{Proof}%
Let~$(a_\alpha)_\alpha$
be a net in~$\scrA$ that converges ultrastrongly
to~$b$.

Assume for the moment that~$b$ is self-adjoint.
Then~$\Real{(a_\alpha)}$
converges ultraweakly (but perhaps not ultrastrongly)
to~$\Real{b}=b$
as~$\alpha\to\infty$,
and so~$b$ is in the ultraweak
closure of the convex set~$\Real{\scrA}$.
Since the ultraweak and ultrastrong closure
of convex subsets of~$\scrA$
coincide (by~\sref{ultraclosed}),
we see that~$b$ is also the ultrastrong limit
of some net $(a_\alpha')_\alpha$ in~$\Real{\scrA}$.
Since the map~$-\|b\|\vee(\,\cdot\,)\wedge \|b\|\colon
\Real{\scrB}\to\Real{\scrB}$
is ultrastrongly continous by~\sref{proto-kaplansky}
we see that 
$a_\alpha'' := -\|b\|\vee a_\alpha'\wedge \|b\|$
gives a net $(a_\alpha'')_\alpha$
in~$[-\|b\|,\|b\|]_\scrA$
that
converges ultrastrongly
to~$b$.

If we assume in addition
that~$b$ is positive,
then~$a_\alpha''' := (a_\alpha'')_+$
gives a net~$(a_\alpha''')_\alpha$
in~$[0,\|b\|]_\scrA$
that converges ultrastrongly to $b_+=b$,
because the map $(\,\cdot\,)_+\colon \Real{\scrB}\to\Real{\scrB}$
is ultrastrongly continuous by~\sref{proto-kaplansky}.
Note that if~$b$ is an effect,
then so are the $a_\alpha'''$.

This takes care of all the special cases.
The general case
in which~$b$ is an arbitrary element of~$\scrB$ requires a trick:
since the element
$B:=\smash{\left(\begin{smallmatrix} 0 & b \\
b^* & 0 \end{smallmatrix}\right)}$
of the von Neumann algebra~$M_2(\scrB)$
is self-adjoint,
and the ultrastrong limit
of the net
$\smash{\bigl(\begin{smallmatrix} 0 & a_\alpha \\
a_\alpha^* & 0 \end{smallmatrix}\bigr)}$
from the  $C^*$-subalgebra $M_2(\scrA)$ of~$M_2(\scrB)$,
there is, as we've just seen, a net~$(A_\alpha)_\alpha$
in~$M_2(\scrA)$
that converges ultrastrongly to~$B$
with~$\|A_\alpha\|\leq \|B\|\equiv \|b\|$ for all~$\alpha$.
Since the upper-right entries
$ (A_\alpha)_{12}$ will then converge ultrastrongly 
to~$B_{12}\equiv b$ as~$\alpha\to\infty$,
and~$\|(A_\alpha)_{12}\|\leq \|A_\alpha\|\leq \|b\|$
for all~$\alpha$, we are done.\qed
\end{point}
\end{point}
\begin{point}[dense-subalgebra]{Corollary}%
Given~$\varepsilon>0$  and an ultraweakly dense $*$-subalgebra~$\scrS$
of a von Neumann algebra~$\scrA$
each element~$a$ of~$\scrA$
is the ultrastrong limit of a net~$(s_\alpha)_\alpha$
from~$\scrS$
with $\|s_\alpha\|\leq \|a\|(1+\varepsilon)$
for all~$\alpha$.
\begin{point}{Proof}%
As the norm closure~$\scrC$ of~$\scrS$ in~$\scrA$
is an ultraweakly
(and thus by~\sref{ultraclosed}
ultrastrongly) dense $C^*$-subalgebra of~$\scrA$,
the element $a$ of~$\scrA$ is by~\sref{kaplansky}
the ultrastrong limit
of net~$(c_\alpha)_{\alpha\in D}$
in~$\scrC$ 
with $\|c_\alpha\|\leq \|a\|$ for all~$\alpha$.
Each element~$c_\alpha$ 
is in its turn 
the norm (and thus ultrastrong)
limit of a sequence~$s_{\alpha1},\,s_{\alpha2},\,\dotsc$
in~$\scrS$,
and if we choose the~$s_{\alpha n}$
such that $\|c_\alpha - s_{\alpha n}\|\leq 2^{-n}$,
then~$s_{\alpha n}$
converge ultrastrongly to~$b$
as~$D\times \N\ni (\alpha,n)\to\infty$.
Finally, since~$\lim_n\|s_{\alpha n}\| = \|c_\alpha \|\leq \|c\| 
\leq (1+\varepsilon)\|c\|$
we have~$\|s_{\alpha n}\|\leq (1+\varepsilon)\|c\|$
for sufficiently large~$n$,
and thus for all~$n$
if we replace~$(s_{\alpha n})_n$ by the appropriate  subsequence.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Closedness of subalgebras}
\begin{parsec}%
\begin{point}%
Recall that according to our definition (\sref{von-neumann-examples})
a von Neumann subalgebra~$\scrB$ 
of a von Neumann algebra~$\scrA$
is a $C^*$-subalgebra of~$\scrA$
which is closed under suprema
of bounded directed sets of self-adjoint elements.
We will show that such~$\scrB$ is ultrastrongly closed in~$\scrA$.
\end{point}
\begin{point}[sequence-separation-lemma]{Lemma}%
Let~$\scrB$ be a von Neumann subalgebra
of a von Neumann algebra~$\scrA$.
Let~$\omega_0,\omega_1\colon \scrA\to\C$
be npu-maps,
which are separated
by a net $(b_\alpha)_\alpha$
of effects of~$\scrB$ 
in the sense that~$\lim_\alpha \omega_0(b_\alpha)=0$
and $\lim_\alpha \omega_1(b_\alpha^\perp)=0$.
Then~$\omega_0$ and~$\omega_1$ are separated by a 
projection~$q$ of~$\scrB$ 
in the sense that~$\omega_0(q)= 0 = \omega_1(q^\perp)$.
\begin{point}{Proof}%
(Based on Lemma~45.3 and Theorem~45.6 of~\cite{conway2000}.)

Note that it suffices to find an effect~$a$ in~$\scrB$
with $\omega_0(a) = 0 = \omega_1(a^\perp)$,
because then~$\omega_0(\ceil{a}) = 0 = \omega_1(\ceil{a}^\perp)$
by~\sref{ceil-functionals-lemma}
and~$\ceil{a}\in\scrB$.

Note that we may find a subsequence~$(b_n)_n$ of~$(b_\alpha)_\alpha$
such that $\omega_0( b_n ) 
\leq n2^{-n}$
and $\omega_1(b_n^\perp)\leq n^{-1}$
for all~$n$.
For~$n < m$, define
\begin{equation*}
\textstyle
a_{nm}\ = \ (1+\sum_{k=n}^m kb_k)^{-1} \,\sum_{k=n}^m kb_k.
\end{equation*}
Since we have seen in~\sref{astara-pos-basic-consequences}
that the map~$d\mapsto (1+d)^{-1}d$ is order preserving
(on~$\pos{\scrB}$),
we have $0\leq a_{nm}\leq \frac{1}{2}$
and we get the formation
\begin{equation*}
\renewcommand{\labelstyle}{\textstyle}
\xymatrix{
a_{12}\ar@{}|-{\leq}[r] & 
a_{13}\ar@{}|-{\leq}[r] & 
a_{14}\ar@{}|-{\leq}[r]  & 
\dotsb & \ar@{}|-{\leq}[r]& a_1 \\
&
a_{23} \ar@{}|-{\leq}[r] \ar@{}[u]|-{\uleq} &
a_{24} \ar@{}|-{\leq}[r]  \ar@{}[u]|-{\uleq} &
\dotsb &\ar@{}|-{\leq}[r]& a_2  \ar@{}[u]|-{\uleq} \\
&
&
a_{34} \ar@{}|-{\leq}[r]  \ar@{}[u]|-{\uleq} & 
\dotsb & \ar@{}|-{\leq}[r] & a_3  \ar@{}[u]|-{\uleq} 
\\
&&&\ddots&&\vdots \ar@{}[u]|-{\uleq}& \\
&&&&&a\ar@{}[u]|-{\uleq}
},
\end{equation*}
where~$a_n:= \bigvee_{m\geq n} a_{nm}$
and~$a := \bigwedge_n a_n$.
We'll prove that~$\omega_0(a)=0=\omega_1(a^\perp)$.
\begin{point}{$\omega_0(a)=0$}%
	Since~$\omega_0(b_n)\leq n2^{-n}$ 
and $a_{nm}\leq \sum_{k=n}^m k b_k$,
we get~$\omega_0(a_{nm})=\sum_{k=n}^m k\omega_0(b_k) \leq 2^{1-n}$,
and so $\omega_0(a)=\bigwedge_n\bigvee_{m\geq n} \omega_0(a_{nm})
\leq \bigwedge_n 2^{1-n} = 0$.
\end{point}
\begin{point}{$\omega_1(a^\perp )=0$}%
Let~$m> n$ be given.
Since~$\sum_{k=n}^m kb_k \geq mb_m$
and $d\mapsto (1+d)^{-1}d$
is monotone on~$\pos{\scrB}$
we get~$a_{nm} \geq (1+mb_m)^{-1} mb_m$,
and so~$a_{nm}^\perp \leq (1+mb_m)^{-1}$.

Observe that for a real number $t\in[0,1]$,
we have $tt^\perp \geq 0$,
and so $(1+mt)(1+mt^\perp) = 1+m+m^2tt^\perp \geq 1+m$.
This yields the inequality $(1+mt)^{-1}\leq (1+m)^{-1}(1+mt^\perp)$
for real numbers~$t\in[0,1]$.
The corresponding inequality for effects of a $C^*$-algebra
(obtained via Gelfand's representation theorem, \sref{gelfand})
gives us $\omega_1(a_{nm}^\perp)\leq \omega_1((1+mb_m)^{-1})
\leq (1+m)^{-1}(1+m\omega_1(b_m^\perp))\leq \frac{2}{1+m}$,
where we have used that~$\omega_1(b_m^\perp)\leq \frac{1}{m}$.
Hence~$\omega_1(a_n^\perp)=\bigwedge_{m\geq n} \omega_1(a_{nm}^\perp)
\leq \bigwedge_{m\geq n} \frac{2}{1+m}=0$ for all~$n$,
and so~$\omega_1(a^\perp)=\bigvee_1\omega_1(a_n^\perp)=0$.\qed
\end{point}
\end{point}


\end{point}
\begin{point}[kadisons-lemma]{Lemma}%
Let~$\scrB$ be a von Neumann subalgebra
of a von Neumann algebra~$\scrA$.
Let~$p$ be a projection of~$\scrA$,
which is the ultrastrong limit of a net in~$\scrB$.

For all npu-maps $\omega_0,\omega_1\colon \scrA\to\C$
with~$\omega_0(p)=0= \omega_1(p^\perp)$
there is a projection~$q$ of~$\scrB$
with~$\omega_0(q)=0=\omega_1(q^\perp)$.
\begin{point}{Proof}%
Let~$(b_\alpha)_\alpha$ be a net in~$\scrB$
which converges ultrastrongly to~$p$.
We may assume that all~$b_\alpha$
are effects
by Kaplansky's density theorem (\sref{kaplansky}).
% Since~$pp^\perp=0=p^\perp p$
%and multiplication by a fixed element is ultrastrongly 
%continuous (\sref{mult-us-cont}),
%we see that $(b_\alpha p^\perp)_\alpha$ and $(b_\alpha^\perp p)_\alpha$
%converge ultrastrongly to~$0$.
Note that~$(\omega_0(b_\alpha))_\alpha$ converges to~$\omega_0(p)\equiv 0$,
and $(\omega_1(b^\perp_\alpha))_\alpha$ converges 
to~$\omega_1(p^\perp)\equiv 0$.
Now apply~\sref{sequence-separation-lemma}.\qed
\end{point}
\end{point}
\begin{point}{Definition}%
We call a projection~$p$ of a von Neumann algebra~$\scrA$
\Define{ultracyclic} if~$p=\ceil{\omega}$
for some np-map $\omega\colon \scrA\to\C$.
\begin{point}{Remark}%
Some explanation of this terminology
is in order.
A projection~$E$
in a von Neumann subalgebra~$\scrR$
of~$\scrB(\scrH)$
is usually defined to be \Define{cyclic}
when~$E$ is the projection 
onto~$\smash{\overline{\scrR^\square x}}$
for some~$x\in \scrH$
(see Definition~5.5.8~\cite{kr}),
but with~\sref{carrier-vector-state} and~\sref{double-commutant}
we'll be able to see that
this amount to requiring that~$E$
be
the carrier of the vector functional
$\left<x,(\,\cdot\,)x\right>\colon \scrR\to\C$.
So, loosely speaking,
a cyclic projection
is the carrier of a vector functional
with respect to some fixed Hilbert space,
while an ultracyclic projection
is the carrier of a vector functional
with respect to some arbitrary Hilbert space.
\end{point}
\end{point}
\begin{point}[ultracyclic-basic]{Exercise}%
Let~$\scrA$ be a von Neumann algebra.
Verify the following facts.
\begin{enumerate}
\item
If~$p$ and~$q$ are ultracyclic projections in~$\scrA$,
then~$p\cup q$ is ultracyclic.
\item
If~$p \leq q$ are projections in~$\scrA$,
and~$q$ is ultracyclic,
then~$p$ is ultracyclic.
\item
Every projection~$p$ in~$\scrA$ is a directed supremum
of ultracyclic projections.
In fact, $p=\bigvee_\omega \ceil{\omega}$
where~$\omega$ ranges over the np-functionals on~$\scrA$
with $\omega(p^\perp)=0$.
(Hint: first consider~$p=1$.)
\end{enumerate}
\end{point}
\begin{point}[vnsac]{Theorem}%
A von Neumann subalgebra~$\scrB$ of a von Neumann algebra~$\scrA$
is ultrastrongly and ultraweakly closed.
\begin{point}{Proof}%
It suffices to show that~$\scrB$ is ultrastrongly closed,
because then, by~\sref{ultraclosed}, $\scrB$ will be ultraweakly closed
as well.

Let~$p$ be a projection of~$\scrA$ which is the ultrastrong limit
of a net from~$\scrB$. It suffices to show that~$p\in\scrB$,
because the ultrastrong closure of~$\scrB$
being a von Neumann subalgebra of~$\scrA$
is generated by its projections, see~\sref{projections-norm-dense}.
Note that given an np-map $\omega\colon \scrA\to\C$,
the carrier~$\ceil{\omega}$ of~$\omega$
need not be equal to the carrier
of~$\omega$ restricted to~$\scrB$,
which we'll therefore denote by~$\ceil{\omega}_\scrB$;
but we do have $\ceil{\omega}\leq \ceil{\omega}_\scrB$.
Then by~\sref{ultracyclic-basic}
\begin{equation}
\label{ultracyclic-proof}
\textstyle
\bigvee_{\omega_1}
\ceil{\omega_1}_\scrB \ \geq\ 
\bigvee_{\omega_1}
\ceil{\omega_1}\ =\ p\ =\ 
\bigwedge_{\omega_0} \ceil{\omega_0}^\perp
\ \geq\ \bigwedge_{\omega_0} \ceil{\omega_0}_{\scrB}^\perp,
\end{equation}
where~$\omega_0$ ranges over np-maps $\omega_0\colon \scrA\to\C$
with~$\omega_0(p)=0$,
 and $\omega_1$ ranges over
np-maps $\omega_1\colon \scrA\to\C$ with~$\omega_1(p^\perp)=0$.
Since for such~$\omega_0$ and~$\omega_1$
there is 
by~\sref{kadisons-lemma}
a projection~$q$ in~$\scrB$
with $\omega_0(q)=0=\omega_1(q^\perp)$,
we get 
$\ceil{\omega_1}_\scrB \leq q \leq 
\ceil{\omega_0}_\scrB^\perp$,
and so~$\bigvee_{\omega_1} \ceil{\omega_1}_\scrB
\leq 
\bigwedge_{\omega_0} \ceil{\omega_0}_\scrB^\perp$.
It follows that the inequalities in~\eqref{ultracyclic-proof}
are in fact equalities,
and so~$p=\bigvee_{\omega_1}\ceil{\omega_1}_\scrB \in \scrB$.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Completeness}
\begin{parsec}%
\begin{point}[bh-us-complete]{Proposition}%
The von Neumann algebra~$\scrB(\scrH)$
of bounded operators on a Hilbert space~$\scrH$
is ultrastrongly complete.
\begin{point}{Proof}
Let~$(T_\alpha)_\alpha$ be an ultrastrongly-Cauchy net
in~$\scrB(\scrH)$
(which must be shown to converge ultrastrongly to
some operator~$T$ in~$\scrB(\scrH)$).

Note that given~$x\in \scrH$,
the net~$(T_\alpha x)_\alpha$ in~$\scrH$
is norm Cauchy,
because $\|(T_\alpha-T_\beta) x\|
= \| T_\alpha-T_\beta \|_{\left<x,(\,\cdot\,)x\right>}$
vanishes for sufficiently large~$\alpha,\beta$,
and so we may define~$Tx :=\lim_\alpha T_\alpha x$,
giving a map~$T\colon \scrH\to\scrH$.

It is clear that~$T$ will be linear,
but the question is whether~$T$ is bounded,
and whether in that 
case~$(T_\alpha)_\alpha$ converges ultrastrongly to~$T$.

Suppose towards a contradiction that~$T$ is not bounded.
Then we can find~$x_1,x_2,\dotsc\in\scrH$
with $\|x_n\|^2\leq 2^{-n}$
and $\|Tx_n\|^2\geq 1$ for all~$n$.
Since~$\omega:=\sum_n \left<x_n,(\,\cdot\,)x_n\right>\colon 
\scrB(\scrH)\to\C$
is an np-map by~\sref{bh-functional-lemma}, 
it follows that~$\|T_\alpha\|_\omega^2\equiv \sum_{n=1}^\infty 
\|T_\alpha x_n\|^2$
converges to some positive number~$R$.
Since any partial sum $\sum_{n=1}^N \|T_\alpha x_n\|^2
\leq \|T_\alpha\|_\omega^2$
converges to~$\sum_{n=1}^N \|T x_n\|^2\geq N$,
we must conclude that~$R\geq N$,
for all natural numbers~$N$,
which is absurd.
Hence~$T$ is bounded.

It remains to be shown that~$(T_\alpha)_\alpha$
converges ultrastrongly to~$T$.
So let $\omega\colon \scrB(\scrH)\to\C$ be an arbitrary
np-map,
being of the form~$\omega\equiv \sum_n\left<x_n,(\,\cdot\,)x_n\right>$
for some $x_1,x_2,\dotsc\in\scrH$ with $\sum_n \|x_n\|^2 <\infty$
by~\sref{bh-np}.
We must show that~$\|T-T_\alpha\|_\omega
\equiv (\sum_n \|(T-T_\alpha)x_n\|^2)^{\nicefrac{1}{2}}$ 
converges to~$0$ as $\alpha\to 0$.

Let~$\varepsilon>0$ be given,
and pick~$\alpha_0$
such that $\|T_\alpha-T_\beta\|_\omega \leq 
\smash{\frac{1}{2\sqrt{2}}}\,\varepsilon$
for all~$\alpha,\beta\geq \alpha_0$
--- this is possible, because~$(T_\alpha)_\alpha$ is ultrastrongly Cauchy.
We claim that $\|T-T_\alpha\|_\omega \leq \varepsilon$
for any~$\alpha\geq \alpha_0$.
Since for such~$\alpha$
the sum
\begin{equation*}
	\sum_{n=1}^\infty \|(T-T_\alpha)x_n\|^2 
	\ = \ 
	\sum_{n=1}^{N-1} \|(T-T_\alpha)x_n\|^2
	\ +\ 
	\sum_{n=N}^\infty
	\|(T-T_\alpha)x_n\|^2
\end{equation*}
converges (to~$\|T-T_\alpha\|_\omega^2$),
we can find~$N$ such that the second term in the bound above
is below~$\frac{1}{2}\varepsilon^2$.
The first term will also be below~$\frac{1}{2}\varepsilon^2$,
because
\begin{equation*}
	\bigl(\sum_{n=1}^{N-1} \|(T - T_\alpha)x_n\|^2\,\bigr)^{\nicefrac{1}{2}}
	\ \leq\ 
\bigl(\,
\sum_{n=1}^{N-1} \|(T-T_{\beta})x_n\|^2
\,\bigr)^{\nicefrac{1}{2}}
\ +\ 
\bigl(\,
\sum_{n=1}^{N-1} \|(T_\beta-T_\alpha)x_n\|^2
\,\bigr)^{\nicefrac{1}{2}}
\end{equation*}
for any~$\beta$,
and in particular for~$\beta$
large enough that the first term on the right-hand side above
is below~$\smash{\frac{1}{2\sqrt{2}}}\,\varepsilon$.
If we choose $\beta\geq \alpha_0$
the second term will be below~$\smash{\frac{1}{2\sqrt{2}}}\,\varepsilon$ too,
and we get $\|T-T_\alpha\|_\omega^2 \leq \frac{1}{2}\varepsilon^2
+ (\smash{\frac{1}{2\sqrt{2}}\,\varepsilon 
+ \frac{1}{2\sqrt{2}}\,\varepsilon})^2
\equiv \varepsilon^2$ 
all in all.
(This reasoning is very similar to that in~\sref{hilb-sum}.)

Hence~$\scrB(\scrH)$ is ultrastrongly complete.\qed
\end{point}
\end{point}
\begin{point}[bh-bounded-uw-complete]{Proposition}%
The von Neumann algebra~$\scrB(\scrH)$
of bounded operators on a Hilbert space~$\scrH$
is bounded ultraweakly complete.
\begin{point}{Proof}%
Let~$(T_\alpha)_\alpha$ be a norm-bounded ultraweakly-Cauchy net
in~$\scrB(\scrH)$.
We must show that~$(T_\alpha)_\alpha$
converges ultraweakly
to some bounded operator~$T$ on~$\scrH$.

Note that given $x,y\in\scrH$
the net $(\,\left<x,T_\alpha y\right>\,)_\alpha$
is Cauchy
(because $\left<x,(\,\cdot\,)y\right>
\equiv \frac{1}{4}\sum_{k=0}^3 i^k\left<i^kx+y,(\,\cdot\,)(i^kx+y)\right>$
is ultraweakly continuous),
and so we may define $[x,y] = \lim_\alpha \left<x,T_\alpha y\right>$.
The resulting `form'
$[\,\cdot\,,\,\cdot\,]\colon \scrH\times\scrH\to \C$
(see~\sref{chilb-form})
is bounded, 
because~$\left\|[x,y]\right\| \leq (\sup_\alpha \|T_\alpha\|)\|x\|\|y\|$
for all~$x,y\in\scrH$
and $\sup_\alpha\|T_\alpha\|<\infty$
since $(T_\alpha)_\alpha$
is norm bounded.
By~\sref{chilb-form-representation},
there is a unique bounded operator~$T$
with $\left<x,Ty\right>=[x,y]$
for all~$x,y\in\scrH$.

By definition of~$T$ it is clear 
that~$\lim_\alpha \left<x,(T-T_\alpha)x\right>=0$
for any~$x\in\scrH$,
but it is not yet clear that~$(T_\alpha)_\alpha$ converges ultraweakly to~$T$.
For this we must show that $\lim_\alpha \omega(T-T_\alpha)=0$
for any np-map~$\omega\colon \scrB(\scrH)\to \C$.
By~\sref{bh-np},
we know that such~$\omega$ is of the form
$\omega=\sum_n \left<x_n,(\,\cdot\,)x_n\right>$
for some $x_1,x_2,\dotsc\in\scrH$ with $\sum_n\|x_n\|^2<\infty$.
Now, given~$N$ and~$\alpha$ we easily obtain the 
following bound.
\begin{equation*}
	|\,\omega(T-T_\alpha)| \ \leq\  
	\sum_{n=1}^{N-1} \left|\left<x_n(T-T_\alpha),x_n\right>\right|
\ +\ \bigl(\,\|T\|+\sup_\alpha\|T_\alpha\|\,\bigr)\,\sum_{n=N}^\infty \|x_n\|^2 
\end{equation*}
Since the first term of this bound converges to~$0$ as~$\alpha\to\infty$,
we get, for all~$N$,
\begin{equation*}
	\limsup_\alpha |\,\omega(T-T_\alpha)| \ \leq\ 
	\bigl(\,\|T\|+\sup_\alpha\|T_\alpha\|\,\bigr)\,\sum_{n=N}^\infty \|x_n\|^2.
\end{equation*}
Since the tail $\sum_{n=N}^\infty\|x_n\|^2$
converges to~$0$ as~$N\to \infty$,
$\limsup_\alpha \left|\omega(T-T_\alpha)\right|=0$.
Hence $\omega(T)=\lim_\alpha \omega(T_\alpha)$,
and so~$(T_\alpha)_\alpha$ converges ultraweakly to~$T$.\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}[vn-complete]{Theorem}%
A von Neumann algebra~$\scrA$ is ultrastrongly complete
and bounded ultraweakly complete.
\begin{point}{Proof}%
Let~$\Omega$ be the set of all np-functionals
on~$\scrA$.
Recall from~\sref{ngns-proof}
that $\varrho_\Omega$
gives a nmiu-isomorphism
onto the 
von Neumann algebra~$\scrR:=\varrho_\Omega(\scrA)$ of operators
on the Hilbert space~$\scrH_\Omega$.
Since~$\scrB(\scrH_\Omega)$ is ultrastrongly complete
(\sref{bh-us-complete}),
and~$\scrR$ is  ultrastrongly closed in~$\scrB(\scrH_\Omega)$
(see~\sref{vnsac}),
we see that $\scrR$
is complete with respect to the ultrastrong
topology of~$\scrB(\scrH_\Omega)$,
but since any np-functional~$\omega\colon \scrR\to\C$
is of the form~$\omega\equiv \left<x,(\,\cdot\,)x\right>$
for some~$x\in\scrH_\Omega$,
and therefore  the ultrastrong topology on~$\scrB(\scrH_\Omega)$
coincides on~$\scrR$ with the ultrastrong topology of~$\scrR$,
we see that~$\scrR$ (and therefore~$\scrA$)
is complete with respect to its own ultrastrong topology.
Since similarly~$\scrB(\scrH_\Omega)$
is bounded ultraweakly complete (\sref{bh-bounded-uw-complete}),
the ultraweak topology on~$\scrB(\scrH_\Omega)$
coincides on~$\scrR$ with the ultraweak topology on~$\scrR$,
and~$\scrR$ is ultraweakly closed
in~$\scrB(\scrH_\Omega)$
(by~\sref{vnsac}),
we see that~$\scrR$ is bounded ultraweakly complete.\qed
\end{point}
\end{point}
\begin{point}[vn-ball-compact]{Theorem}%
The ball $(\scrA)_1$
of a von Neumann algebra~$\scrA$ is ultraweakly compact.
\begin{point}{Proof}%
Writing~$\Omega$ for
the set of npu-maps $\omega\colon \scrA\to\C$,
the map~$\kappa\colon \scrA\to \C^\Omega$
given by~$\kappa(a)=(\omega(a))_\omega$ for all~$a\in\scrA$
is clearly a linear homeomorphism from~$\scrA$ with the  ultraweak topology 
onto~$\kappa(\scrA)\,\subseteq \C^\Omega$ endowed
with the product topology.
Since~$\kappa$ restricts
to an isomorphism of uniform spaces
$(\scrA)_1\to \kappa(\,(\scrA)_1\,)$,
and $(\scrA)_1$ is ultraweakly complete 
(being a norm-bounded ultraweakly-closed
subset of the bounded ultraweakly complete space~$\scrA$,
see~\sref{vn-complete}),
we see that $\kappa(\,(\scrA)_1\,)$
is complete,
and thus closed in~$\C^\Omega$.
Now note that~$\kappa(\,(\scrA)_1\,)$ is a closed subset 
of the (by Tychonoff's theorem) compact
space~$((\C)_1)^\Omega$, 
because $\left|\omega(a)\right|\leq 1$ for all~$a\in(\scrA)_1$
and $\omega\in\Omega$.
But then~$\kappa(\,(\scrA)_1\,)$,
being a closed subset of a compact Hausdorff space,
is compact,
and so $(\scrA)_1$ (being isomorphic to it) is compact too.\qed
\end{point}
\end{point}
\begin{point}[vn-extension]{Proposition}%
Given an ultraweakly dense $*$-subalgebra~$\scrS$
of a von Neumann algebra~$\scrA$,
any ultraweakly continuous and bounded linear map~$f\colon \scrS\to\scrB$
can be extended uniquely
to an ultraweakly continuous map~$g\colon \scrA\to\scrB$.

Moreover, $g$ is bounded,
and in fact,  $\|g\|=\|f\|$.
\begin{point}{Proof}%
As the uniqueness of~$g$ is rather obvious
we concern ourselves only with its existence.
Let~$a\in\scrA$ be given
in order to define~$g(a)$.
Let also~$\varepsilon>0$ be given.
Note that by~\sref{dense-subalgebra} 
there is a net~$(s_\alpha)_\alpha$
in~$\scrS$
that converges ultrastrongly (and so ultraweakly too)
to~$a$
with~$\|s_\alpha \|\leq(1+\varepsilon)\|a\|$
for all~$\alpha$.
Now,
since the net~$(s_\alpha)_\alpha$
is bounded an ultraweakly Cauchy,
and~$f$ is bounded and (uniformly) ultraweakly continuous,
the net
$(f(s_\alpha))_\alpha$
is bounded and ultraweakly Cauchy too,
and thus converges (by~\sref{vn-complete})
to some element
$\uwlim_\alpha f(s_\alpha)$
of~$\scrB$.

\begin{point}%
Of course we'd like to define $g(a):=\uwlim_\alpha
f(s_\alpha)$,
but must first check
that $\uwlim_\alpha f(s_\alpha')
=\uwlim_\alpha f(s_\alpha)$
when~$(s_\alpha')_\alpha$ is a second net with the same properties
as~$(s_\alpha)_\alpha$.
Let us for simplicity's sake
assume that $(s_\alpha')_\alpha$ and~$(s_\alpha)_\alpha$
have the same index set
--- matters can always be arranged this way.
Then as the difference $s_\alpha-s_\alpha'$
converges ultraweakly to~$0$ in~$\scrA$ as~$\alpha\to\infty$,
$\uwlim_\alpha f(s_\alpha-s_\alpha')=0$,
implying that $\uwlim_\alpha f(s_\alpha)
= \uwlim_\alpha f(s_\alpha')$.
\end{point}
\begin{point}%
In this way
we obtain a map $g \colon \scrA\to\scrB$
--- which is clearly linear.
The map~$g$ is also bounded,
because since~$\|s_\alpha\|\leq (1+\varepsilon)\|a\|$
for all~$\alpha$,
where $(s_\alpha)_\alpha$ and~$t$ are as before,
we have $\|f (s_\alpha)\|\leq (1+\varepsilon) \|f\|\|a\|$
for all~$\alpha$,
and so~$\|g(a)\|=\|\uwlim_\alpha f(s_\alpha)\|
\leq (1+\varepsilon) \|f \|\|a\|$.
More precisely, $\|g\|\leq (1+\varepsilon)\|f\|$,
and---as~$\varepsilon>0$ was arbitrary---in 
fact~$\|g\|\leq \|f\|$, and so~$\|g\|=\|f\|$.

That, finally, $g$ is ultraweakly continuous
follows by a standard but abstract argument from the fact
that $f$ is \emph{uniformly} ultraweakly continuous.
We'll give a concrete version of this argument here.
To begin, note that it suffices to show that~$\omega\circ g$
is ultraweakly continuous
at~$0$
where~$\omega\colon \scrB\to\C$
is an np-functional.
Let~$\varepsilon>0$ be given.
Since~$f$ 
is ultraweakly continuous,
and 
thus $\omega\circ f$ is too,
there is~$\delta>0$ and an np-functional~$\nu\colon \scrA\to\C$
such that $\left|\nu(s)\right|\leq \delta \implies 
\left|\omega(f(s))\right|\leq \varepsilon$
for all~$s\in\scrS$.
We claim that $\left|\nu(a)\right|\leq \delta/2 \implies
\left|\omega(g(a))\right|\leq 2\varepsilon$
for all~$a\in\scrA$,
which implies, of course,
that $\omega\circ g$ is ultraweakly continuous on~$0$.
So let~$a\in\scrA$ with $\left|\nu(a)\right|\leq \delta/2$
be given.
Pick (as before) a bounded net~$(s_\alpha)_\alpha$
in~$\scrS$
such that $f(s_\alpha)$
converges to~$a$ as~$\alpha\to\infty$, and observe that,
for all~$\alpha$,
\begin{equation*}
\left|\omega(g (a))\right|
\ \leq\ 
\left|\omega(g(a)-f(s_\alpha))\right|
\,+\,\left|\omega(f(s_\alpha))\right|.
\end{equation*}
The first term on the right-hand side above will 
vanish as~$\alpha\to\infty$ (since 
$g (a)=\uwlim_\alpha f (s_\alpha)$),
and will thus be smaller than~$\varepsilon$ 
for sufficiently large~$\alpha$.
Since~$\lim_\alpha \left|\nu(s_\alpha)\right|=\left|\nu(a)\right|
\leq \delta/2<\delta$
we see 
that for sufficiently large~$\alpha$
we'll have~$\left|\nu(s_\alpha)\right|\leq \delta$ 
and with it~$\left|\omega(f (s))\right|\leq \varepsilon$.
Combined,
we get $\left|\omega(g (a))\right|\leq 2\varepsilon$,
and so~$g$ is ultraweakly continuous.\qed
\end{point}

\end{point}
\end{point}
\end{parsec}
\section{Division}
\label{S:division}
\subsection{(Approximate) pseudoinverses}
\begin{parsec}%
\begin{point}[dfn-pseudoinverse]{Definition}%
Let~$a$ be an element of a von Neumann algebra~$\scrA$.
We'll say that~$a$ is \Define{pseudoinvertible}
if it has a \Define{pseudoinverse},
that is,
an element~$t$ of~$\scrA$
with 
$ta=\ceill{a}=\ceilr{t}$
and $at=\ceill{t}=\ceilr{a}$.
When such~$t$ exists,
it is unique (by~\sref{mult-cancellation}),
and we'll denote it by~\Define{$a^{\sim 1}$}.
If~$a^{\sim1}=a^*$,
we say that~$a$ is a \Define{partial isometry}
(see~\sref{partial-isometry-equivalents}).
\end{point}
\begin{point}[pseudoinverse-equivalents]{Lemma}%
For elements $a,t$ of a von Neumann algebra
the following are equivalent.
\begin{enumerate}
\item
\label{pseudoinverse-1}
$ta$ is a projection, and~$\ceill{t}=\ceilr{a}$.
\item
\label{pseudoinverse-2}
$ata=a$, and $\ceill{t}\leq \ceilr{a}$ and~$\ceilr{t}\leq \ceill{a}$.
\item
\label{pseudoinverse-3}
$at$ is a projection, and $\ceill{a}=\ceilr{t}$.
\item
\label{pseudoinverse-4}
$tat=t$, and~$\ceill{a}\leq \ceilr{t}$ and~$\ceilr{a}\leq \ceill{t}$.
\item
\label{pseudoinverse-5}
$t$ is a pseudoinverse of~$a$.
\item
\label{pseudoinverse-6}
$a$ is a pseudoinverse of~$t$.
\end{enumerate}
\begin{point}{Proof}%
\grayed{(\ref{pseudoinverse-5}$\iff$%
\ref{pseudoinverse-6})}\ 
is clear.
For the remainder we  make two loops.
\grayed{(\ref{pseudoinverse-1}$\Longrightarrow$\ref{pseudoinverse-2})}\ 
We have $\ceill{t}\leq \ceilr{a}$ by assumption,
and $\ceilr{t}=\ceilr{t\ceill{t}}
=\ceilr{t\ceilr{a}}
=\ceilr{ta}=ta=\ceill{ta}\leq\ceill{a}$.
Further, $ata=a$
by~\sref{mult-cancellation},
because $tata=ta$ (since~$ta$ is a projection)
and~$\ceilr{ata}\leq \ceilr{a}\leq\ceill{t}$.
\grayed{(\ref{pseudoinverse-3}$\Longrightarrow$\ref{pseudoinverse-4})} 
follows along the same lines.
\grayed{(\ref{pseudoinverse-2}$
	\Longrightarrow$%
\ref{pseudoinverse-5})}\ 
We have $ta=\ceill{a}$ by~\sref{mult-cancellation},
because $ata=a=a\ceill{a}$
and $\ceill{at}\leq\ceill{t}\leq\ceilr{a}$.
Also, $at=\ceilr{a}$,
(because~$ata=a=\ceilr{a}a$,
and~$\ceill{at}\leq\ceill{t}\leq \ceilr{a}$).
Further, $\ceill{t}=\ceilr{a}$,
because $\ceill{a}=ta=\ceilr{ta}\leq \ceilr{t}\leq \ceill{a}$,
and, similarly, $\ceill{a}=\ceilr{t}$.
\grayed{(\ref{pseudoinverse-4}$
	\Longrightarrow$%
\ref{pseudoinverse-5})}
is proven by the same principles, and
\grayed{(\ref{pseudoinverse-5}$
	\Longrightarrow$%
\ref{pseudoinverse-1},\ref{pseudoinverse-3})}
is rather obvious.\qed
\end{point}
\end{point}
\begin{point}[partial-isometry-equivalents]{Exercise}%
Show that an element~$u$ of a von Neumann algebra
is a partial isometry iff
$u^*u$ is a projection
iff $uu^*u=u$
iff $uu^*$ is a projection
iff $u^*uu^*=u^*$
iff~$u^*$ is the pseudoinverse of~$u$.
(Hint: use~\sref{pseudoinverse-equivalents},
or give a direct proof.)
\end{point}
\begin{point}[pseudoinverse-basic]{Exercise}%
Let~$a$ and~$b$ be a elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Show that~$a$ is pseudoinvertible
iff~$a^*$ is pseudoinvertible,
and, in that case, $(a^*)^{\sim1}=(a^{\sim1})^*$.
\item
Assuming that~$a$ and~$b$ are pseudoinvertible,
and~$\ceilr{b}=\ceill{a}$,
show that $ab$ is pseudoinvertible,
and~$(ab)^{\sim1}=b^{\sim1}a^{\sim1}$.


\item
Show that~$a$ is pseudoinvertible
iff~$a^*a$ is pseudoinvertible,
and, in that case, $a^{\sim 1} = (a^*a)^{\sim1}a$
and~$(a^*a)^{\sim1}=a^{\sim1}(a^{\sim1})^*$.
\end{enumerate}
\end{point}
\begin{point}{Exercise}%
Let~$a$ be a positive element of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Show that~$a$ is pseudoinvertible iff~$a$
is invertible in~$\ceil{a}\!\scrA\!\ceil{a}$
iff $at=\ceil{a}$ for some~$t\in\scrA_+$.
Show, moreover, that $at=ta$ for such~$t$.
\item
Show that~$a$ is pseudoinvertible iff
there is~$\lambda>0$ with $\lambda \ceil{a}\leq a$.
\item
Assume that~$a$ is pseudoinvertible.

Show that~$\ceil{a^{\sim1}}=\ceil{a}$.

Show that if~$b\in \scrA$ commutes with~$a$,
then $b$ commutes with~$a^{\sim 1}$.

(In other words, $a^{\sim1}\in\{a\}^{\square\square}$.)
\item
Show that~$c^{\sim1}\leq b^{\sim1}$
when~$b\leq c$ are pseudoinvertible positive \emph{commuting}
elements of~$\scrA$.
(The statement is still true without
the requirement that~$b$ and~$c$ commute,
but also much harder to prove.)


\item
Show that $(0,0,1,\frac{1}{2}, \frac{1}{3},\dotsc)$
is not pseudoinvertible in~$\ell_\infty$.
\end{enumerate}
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}{Remark}%
Note that the obvious candidate
for the pseudoinverse of~$(0,0,1,\frac{1}{2},\frac{1}{3},\dotsc)$
being~$(0,0,1,2,3,\dotsc)$
is not bounded,
and therefore not an element of~$\ell^\infty$.
We can nevertheless approximate~$(0,0,1,2,3,\dotsc)$
by the elements~$(0,0,1,0,0,\dotsc)$,
$(0,0,1,2,0,\dotsc)$, \dots of~$\ell^\infty$
forming what we will call ``approximate pseudoinverse'' for 
$(0,0,1,\frac{1}{2},\frac{1}{3},\dotsc)$.
That this can also be done for an arbitrary element
of a von Neumann algebra
is what we'll see next.
\end{point}
\begin{point}[approximate-pseudoinverse-def]{Definition}%
An \Define{approximate pseudoinverse}
of an element~$a$ a von Neumann algebra~$\scrA$
is a sequence~$t_1,t_2,\dotsc$
of elements of~$\scrA$
such that~$t_1a,\ t_2a,\ \dotsc, at_1,\ at_2,\ \dotsc$
are projections with $\sum_n t_na = \ceill{a}=\sum_n \ceilr{t_n}$
and~$\sum_n at_n =\ceilr{a}=\sum_n \ceill{t_n}$.
\end{point}
\begin{point}[approximate-pseudoinverse-reduction]{Exercise}%
Let~$b$ be an element of a von Neumann algebra~$\scrA$,
and let~$t_1,t_2,\dotsc$
be an approximate pseudoinverse
of~$b^*b$.
Show that $t_1b^*,\ t_2b^*,\ \dotsc$
is an approximate pseudoinverse of~$b$.
\end{point}
\begin{point}[approximate-pseudoinverse]{Theorem}%
Every element~$a$ of a von Neumann algebra~$\scrA$
has an approximate pseudoinverse.
\begin{point}{Proof}%
By~\sref{approximate-pseudoinverse-reduction},
it suffices to consider the case that~$a$ is positive.
When~$a=0$ the sequence~$0,0,0,\dotsc$
clearly yields an approximate pseudoinverse for~$a$,
so let us disregard this case,
and assume that~$a$ is positive and non-zero.

Note that $a-1 \,\leq\, a-\frac{1}{2}\,\leq\, a - \frac{1}{3}\,\leq\, \dotsb$
converges in the norm to~$a\equiv a_+$,
and so does $(a-1)_+\,\leq\,(a-\frac{1}{2})_+\,\leq\,\dotsc$,
which converges also ultraweakly to~$\bigvee_n(a-\frac{1}{n})$,
so that~$a=\bigvee_n (a-\frac{1}{n})_+$,
and thus $\ceil{a}=\bigcup_n \ceil{(a-\frac{1}{n})_+}$
by~\sref{ceil-supremum}.

Writing $q_n=
\ceil{\smash{(a-\frac{1}{n})_+}}$
--- and picturing it as the places where~$a\geq \frac{1}{n}$ ---
we have $(a-\frac{1}{n})q_n = (a-\frac{1}{n})_+\geq 0$
(because~$b\ceil{b_+}=b_+$
for a positive element~$b$ of a von Neumann algebra,
by~\sref{ceil-pos-part}),
and so $\frac{1}{n}q_n \leq  aq_n$ for all~$n>0$.

Writing $e_{n}=q_{n+1}-q_n$
for all~$n$ (taking~$q_0:=0$)
--- and thinking of it as the places
where $\frac{1}{n+1}\leq a\leq \frac{1}{n}$ --- 
we get a sequence of (orthogonal) projections
$e_1,e_2,\dotsc$ in~$\{a\}^{\square\square}$
with $\sum_n e_n = \ceil{a}$.
By an easy computation
involving the facts that $\frac{1}{n+1}\leq \frac{1}{n}$
and~$aq_n\leq aq_{n+1}$,
we get $\frac{1}{n+1}e_n \leq ae_n \leq  \frac{1}{n}e_n$.

Now, note that~$\ceil{ae_n}=\ceil{e_n}$ for any~$n$.
Indeed, on the one hand~$ae_n=e_nae_n\leq \|a\|e_n$
(as~$e_n\in\{a\}^{\square\square}$)
and so~$\ceil{ae_n}\leq \ceil{\|a\|e_n}=e_n$
(using here that $\|a\|\neq 0$),
while on the other hand, $\frac{1}{n+1}e_n\leq ae_n$
gives $e_n\equiv \ceil{\smash{\frac{1}{n+1}e_n}}\leq \ceil{ae_n}$.
In particular, $\frac{1}{n+1}\ceil{ae_n}=\frac{1}{n+1}e_n \leq ae_n$,
so that~$ae_n$ is pseudoinvertible (by~\sref{pseudoinverse-basic}).

Writing~$t_n := (ae_n)^{\sim1}$,
we have~$\ceil{t_n}=e_n$
(since~$\ceil{ae_n}=e_n)$.
Then $t_na=t_n\ceil{t_n}a=t_ne_na=\ceil{ae_n}=e_n$,
and similarly, $at_n = e_n$,
so that $\sum_n at_n = \sum_n t_n a 
=\sum_n e_n =\ceil{a}
= \sum_n \ceil{t_n}$,
making $t_1,t_2,\dotsc$ an approximate pseudoinverse of~$a$.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Division}
\TODO{add narative}
\begin{parsec}%
\begin{point}[division]{Definition}%
Let~$b$ be an element of a von Neumann algebra~$\scrA$,
and let~$a$ be an element of~$\scrA b$
--- so~$a\equiv cb$ for some~$c\in\scrA$.
We denote by~\Define{$a/b$} 
the (by~\sref{mult-cancellation}) unique
element of~$\scrA\!\ceilr{b}$
with~$a=(a/b)\, b$,
and, dually,
given an element~$a$ of~$b\scrA$ 
we denote by~\Define{$b\backslash a$} 
the unique
element of~$\ceill{b}\!\scrA$
with~$a=b\,(b\backslash a)$.
\end{point}
\begin{point}{Exercise}%
Let~$a$ and~$b$
be elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Show that $c/b$ is an element of~$\ceilr{c}\!\scrA\!\ceilr{b}$
for every element~$c$ of~$b\scrA$.
\item
Show that $(ab)/b = a\ceilr{b}$
and~$b\backslash (ba)=\ceill{b}a$.
\item
Let~$c$ be an element of $a\scrA b$.
Show that
$a \backslash c \,\in\, \scrA b$,
and
$c/b\,\in\,a\scrA$, and
\begin{equation*}
(a\backslash c)/b\ =\  a\backslash(c/b)
\quad \text{ --- which we'll therefore denote by}\  \Define{a\backslash c/b}.
\end{equation*}
Show that~$a\backslash c/b$
is the unique element of~$\ceill{a}\scrA\ceilr{b}$
with~$c=a\,(a\backslash c / b)\, b$. 
\item
Let~$c$ be an element of~$\scrA b$
and let~$d$ be an element of~$a\scrA$.

Show that~$a\in a\scrA b$,
and~$a\backslash (dc) / b  = (a\backslash d)\,(c/b)$.
\item
Let~$c$ be an element of~$\scrA b$.
Show that~$c^* \,\in\, b^* \scrA$
and $b^*\backslash c^* = (c/b)^*$.
\end{enumerate}
\end{point}
\begin{point}[proto-douglas]{Lemma}%
Given elements $a$ and~$b$ of a von Neumann algebra~$\scrA$
with~$a^*a \leq b^*b$
we have $a\,\in\, \scrA b$.
Moreover,
given an approximate pseudoinverse $t_1,t_2,\dotsc$
of~$b$,
the series $\sum_nat_n$ converges ultrastrongly to~$a/b$,
and uniformly so in~$a$.
\begin{point}{Proof}%
To show that~$\sum_{n=0}^N at_n$
converges ultrastrongly as~$N\to \infty$
it suffices
to show that~$(\,\sum_{n=0}^N at_n\,)_N$
is ultrastrongly Cauchy
(because~$\scrA$ is ultrastrongly complete, by~\sref{vn-complete}).
To this end, note that
\begin{alignat*}{3}
\textstyle 
(\, \sum_{n=M}^N at_n\,)^*\ \,\sum_{n=M}^N\,at_n
\ &= \textstyle\ (\sum_{n=M}^Nt_n) \,a^*a\, (\sum_{n=M}^N t_n)
\\
\ &\leq\ \textstyle 
 (\sum_{n=M}^N t_n) \,b^*b\, (\sum_{n=M}^Nt_n)
\\
\ &= \ \textstyle 
\sum_{n,m=M}^N
t_nb^*bt_m 
\\
\ &=\ \textstyle 
\sum_{m=M}^N
bt_m,
\end{alignat*}
where we've used that
$bt_1,\ bt_2,\ \dotsc$
are orthogonal projections
--- but then the series~$\sum_{n=0}^\infty bt_m$
converges ultraweakly by~\sref{sum-of-orthogonal-projections}.
This, coupled with the
inequality above,
gives us that~$\sum_{n=0}^N at_n$
is ultrastrongly Cauchy,
and therefore converges ultrastrongly --- 
and even uniformly so in~$a$,
because~``$a$'' does not appear in
the expression
``$\sum_{m=M}^N bt_m$'' that gave the bound.

Define~$c:=\sum_{n=0}^\infty at_n$.
Since~$a^*a \leq b^*b$,
we have $\ceill{a}\leq \ceill{b}$,
and so~$a=a\ceill{b} = a\sum_n t_n b = \sum_n at_n b = cb$. 
So to get~$c=a/b$
we only need to prove that~$\ceill{c}\leq \ceilr{b}$,
that is, $c\ceilr{b}=c$.
To this end,
recall that~$\sum_n \ceill{t_n}=\ceilr{b}$,
so that~$\ceill{t_n}\leq \ceilr{b}$,
and~$t_n\ceilr{b}=t_n$,
which implies
that~$at_n\ceilr{b}=at_n$,
and so~$c\ceilr{b}=\sum_n at_n\ceilr{b}
= \sum_n at_n=c$.\qed

\end{point}
\end{point}
\begin{point}[douglas]{Exercise}%
Let~$a$ and~$b$ be elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Let~$\lambda\geq 0$ be given,
and recall that $(\scrA)_\lambda 
= \{c\in\scrA\colon \|c\|\leq\lambda\}$.

Show that $a$ is in $(\scrA)_\lambda b$ iff $a^*a\leq \lambda^2 b^*b$,
and then~$\|a/b\|\leq \lambda$.

(Compare this with ``Douglas'~Lemma'' from~\cite{douglas}.)
\item
Show that $a \in \scrA\!\ceilr{b}$
need not entail that~$a\in \scrA b$.
\end{enumerate}
\end{point}
\begin{point}[sequential-douglas]{Exercise}%
Let~$b$ be an element of a von Neumann algebra.
\begin{enumerate}
\item
Let~$a$ be a positive element of~$\scrA$,
and let~$\lambda\geq 0$.

Show that
 $a\in b^*(\scrA)_\lambda b$
iff~$a\leq \lambda b^*b$,
and then~$\|b^*\backslash a / b \| \leq\lambda$.
\item
Show that~$b^*\backslash a / b$ is positive
for every positive element~$a$ of $ b^* \scrA b$.

(Hint: prove that $(b^*\backslash \sqrt{a})\,(\sqrt{a}/b)
= b^*\backslash a/b$.)
\end{enumerate}
\end{point}
\begin{point}[div-approx]{Exercise}%
Given elements~$b$ and~$c$ of a von Neumann algebra~$\scrA$,
an approximate pseudoinverse $t_1,t_2,\dotsc$
of~$b$,
and an approximate pseudoinverse of~$s_1,s_2,\dotsc$
of~$c$,
show that
$(\sum_{n=1}^N s_n) \,a\, (\sum_{m=1}^Nt_m)$,
converges ultrastrongly to~$c\backslash a /b$
as~$N\to\infty$
(and uniformly so) for~$a\in c(\scrA)_1 b$.
\end{point}
\begin{point}[div-usc]{Lemma}%
Given elements~$b$ and~$c$  of a von Neumann algebra~$\scrA$
the maps 
\begin{equation*}
	a\mapsto a/b\colon \  (\scrA)_1b \to \scrA
\qquad\text{and}\qquad
a\mapsto c\backslash a/b\colon\  c(\scrA)_1b\to \scrA
\end{equation*}
are ultrastrongly continuous
(where $(\scrA)_1$ is the unit ball).
\begin{point}{Proof}%
By~\sref{proto-douglas}
the series~$\sum_n at_n$ converges ultraweakly to~$a/b$,
where~$t_1,t_2,\dotsc$
is an approximate pseudoinverse of~$b$,
and in fact uniformly so for~$a\in(\scrA)_1 b$
(because $a^*a\leq b^*b$ for such~$a$).
Since~$a\mapsto \sum_{n=1}^N at_n,\ (\scrA)_1b\to\scrA$
is ultrastrongly continuous (by~\sref{mult-uws-cont})
--- and the uniform limit of continuous functions is continuous ---
we see that~$a\mapsto a/b,
\ (\scrA)_1b\to\scrA$ is ultrastrongly continuous.
It follows that
$(\,\cdot\,)/b\colon\,c(\scrA)_1b\to c(\scrA)_1$
and~$c\backslash(\,\cdot\,)\colon\, c(\scrA)_1\to\scrA$
are ultrastrongly continuous;
as must be their composition $c\backslash\,\cdot\,/b\colon\,
c(\scrA)_1b\to\scrA$.\qed
\end{point}
\begin{point}{Remark}%
The map $a\mapsto a/b$ might not give
an ultrastrongly
continuous map on the larger domain~$\scrA b$,
because, for example, 
upon applying $(\,\cdot\,)/(1,\frac{1}{2},\frac{1}{3},\dotsc)$
to the ultrastrongly Cauchy 
sequence  $(1,0,0,\dotsc),\ (1,1,0,\dotsc),\ \dotsc$
in~$\ell^\infty$
we get the 
sequence $(1,0,0,\dotsc),\ (1,2,0,\dotsc),\ \dotsc$,
which is not ultrastrongly Cauchy.
\end{point}
\end{point}
\end{parsec}
\subsection{Polar decomposition}
\begin{parsec}%
\begin{point}[polar-decomposition]{Proposition (Polar Decomposition)}%
Any element~$a$ of a von Neumann
algebra~$\scrA$
can be uniquely written as~$a=\Define{[a]}\sqrt{a^*a}$,
where~$[a]$
is an element of~$\scrA\!\ceill{a}$.
Moreover,
\begin{enumerate}
\item
$[a]$ is partial isometry
with $[a]^*[a] = \ceil{a^*a} \equiv \ceill{a}$
and $[a][a]^*=\ceil{aa^*} \equiv \ceilr{a}$,
\item
and $[a^*]=[a]^*$, so that~$\sqrt{aa^*}[a]=a=[a]\sqrt{a^*a}$.
\end{enumerate}
\begin{point}{Proof}%
Since $a^*a\leq \sqrt{a^*a}\sqrt{a^*a}$,
the existence and uniqueness
of an element~$[a]$ of~$\scrA$
with $a=[a]\sqrt{a^*a}$
and~$\ceill{\,[a]\,}\leq
\ceill{a}\equiv \ceilr{\,\sqrt{a^*a}\,}$
is provided by~\sref{douglas},
and we get~$\ceilr{\,[a]\,}\leq \ceilr{a}$
to boot!
Note that~$[a]^*[a]=\ceil{a^*a}$,
by~\sref{mult-cancellation},
because 
\begin{equation*}
	\sqrt{a^*a}\,[a]^*[a]\,\sqrt{a^*a}
\ =\ 
a^*a
\ =\ 
\sqrt{a^*a}\,\ceil{a^*a}\,\sqrt{a^*a},
\end{equation*}
and $\ceil{\,[a]^*[a]\,}\leq \ceill{a}=\ceil{\,\sqrt{a^*a}\,}$.
In particular, $[a]$ is a partial isometry
(by~\sref{partial-isometry-equivalents}).

Let us prove that $[a][a]^*=\ceilr{a}$.
Note that~$[a][a]^*$
is a projection (because $[a]$ is a partial isometry, 
by~\sref{partial-isometry-equivalents}).
We already know that $[a][a]^* = \ceilr{\,[a]\,}\leq \ceilr{a}$.
Concerning the other direction,
$aa^*=[a]\sqrt{a^*a}\,\sqrt{a^*a}[a]^*=[a]\,a^*a\,[a]^*$,
so that
$\ceilr{a}=\ceil{aa^*}
= \ceil{\,[a]a^*a[a]^*\,}
\leq \ceil{\,\|a\|^2[a][a]^*\,}
\leq [a][a]^*$.

To prove that~$a=\sqrt{aa^*}[a]$,
we'll first show that~$\sqrt{aa^*} = [a] \sqrt{a^*a} [a]^*$.
Indeed, since~$[a]^*[a]=\ceil{\,\sqrt{a^*a}\,}$,
we have
$[a]\sqrt{a^*a}[a]^*[a]\sqrt{a^*a}[a]^*
= [a] \sqrt{a^*a} \,\sqrt{a^*a} [a]^* 
= aa^*$ --- now take the square root.
It follows that~$\sqrt{aa^*}[a]
= [a]\sqrt{a^*a}[a]^*[a]
= [a]\sqrt{a^*a}=a$;
and, upon applying~$(\,\cdot\,)^*$,
we see that
$a^*=[a]^*\sqrt{aa^*}$,
and thus~$[a^*]=[a]^*$,
by uniqueness of~$[a^*]$,
because $\ceill{\,[a]^*\,}=\ceilr{\,[a]\,}=  \ceilr{a}
=\ceill{a^*}$.\qed
\end{point}
\end{point}
\begin{point}[sequential-quotient]{Exercise}%
Show that for positive elements~$a$ and~$b$ of a von Neumann
algebra~$\scrA$,
the following are equivalent.
\begin{enumerate}
\item
$a\leq \lambda b$ for some~$\lambda\geq 0$;
\item
$a=\sqrt{b}c\sqrt{b}$
for some positive~$c\in\scrA$,
\end{enumerate}
and, 
in that case, there is a unique~$c\in\scrA_+$
with $a=\sqrt{b}c\sqrt{b}$
and~$\ceil{c}\leq \ceil{b}$,
and if~$t_1,t_2,\dotsc$
is an approximate pseudoinverse of~$\sqrt{b}$,
then~$\sum_{m,n} t_m a t_n$
converges ultraweakly to this~$c$.
\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
Recall from~\sref{cceil-fundamental}
that the least central projection~$\cceil{e}$
above a projection~$e$ of a von Neumann algebra~$\scrA$
is given by~$\cceil{e}=\bigcup_{a\in \scrA}\ceil{a^* e a}$.
Using the polar decomposition
we can give a more economical
description of~$\cceil{e}$,
see~\sref{cceil-sum}.
\end{point}
\begin{point}[vmleq]{Proposition}%
Given projections $e'$ and~$e$
of a von Neumann algebra~$\scrA$,
the following are equivalent.
\begin{enumerate}
\item
\label{vmleq-1}
$e'= \ceil{a^*e a}$ for some~$a\in\scrA$;
\item
\label{vmleq-2}
$e' = \ceill{a}$ and~$\ceilr{a}\leq e$
for some~$a\in\scrA$;
\item
\label{vmleq-3}
$e' = u^*u$ and~$uu^*\leq e$
for some partial isometry~$u$.
\end{enumerate}
In that case
we write~$\Define{e'\vmleq e}$
(and say~$e'$ is \Define{von Neumann--Murray below}~$e$).
\begin{point}{Proof}%
That~\ref{vmleq-3}
implies~\ref{vmleq-2} is clear.
(\ref{vmleq-2}$\Rightarrow$\ref{vmleq-1})\ 
Since~$\ceilr{a}\leq e$,
we have $ea=a$,
and so~$\ceil{a^*ea}=\ceil{a^*a}=\ceill{a}=e'$.
(\ref{vmleq-1}$\Rightarrow$\ref{vmleq-3})\ 
By the polar decomposition (see~\sref{polar-decomposition})
we get a partial isometry~$u:=[ea]$
for which $u^*u = [ea]^*[ea]=\ceil{(ea)^*ea}=e'$
and~$uu^*=\ceil{eaa^*e}\leq e$.\qed
\end{point}
\end{point}
\begin{point}{Exercise}%
Show that~$\vmleq$ gives a preorder
on the set of projections of a von Neumann algebra.
\end{point}
\begin{point}[cceil-sum]{Lemma}%
Given a projection~$e$
of a von Neumann algebra~$\scrA$
there is a family
$(e_i)_i$ of non-zero projections with $\cceil{e}=\sum_i e_i$,
and $e_i\vmleq e$ for all~$i$.
\begin{point}{Proof}%
Let~$(e_i)_i$
be a maximal set of non-zero orthogonal projections
in~$\scrA$ with
$e_i\vmleq e$ for all~$i$.
Our goal is to show that $\sum_i e_i \equiv \bigcup_i e_i=\cceil{e}$.

Let~$u_i$ be a partial isometry
with $u_i^*u_i=e_i$ and $u_iu_i^* \leq e$.
Since $e_i=u_i^* u_i = u_i^* u_i u_i^* u_i
\leq u_i^* e u_i 
\leq \bigcup_{a\in \scrA} \ceil{a^* e a}=\cceil{e}$,
we have
$\bigcup_i e_i \leq \cceil{e}$.

Suppose that~$\bigcup_i e_i < \cceil{e}$
(towards a contradiction).
Then since $p:=\cceil{e}-\bigcup_i e_i $ 
is a non-zero projection,
and~$p=p\cceil{e} p
=\bigcup_{a\in\scrA} \ceil{p\ceil{a^*ea}p}
= \bigcup_{a\in\scrA} \ceil{(ap)^*eap}$,
there must be~$a\in\scrA$ with $(eap)^*eap\neq 0$.
The polar decomposition (see~\sref{polar-decomposition})
of~$eap$
gives us a partial isometry $u:=[eap]$
with $uu^* = \ceil{eap(eap)^*}=\ceil{eapa^*e}\leq e$
and $u^*u= \ceil{(eap)^*eap}\leq p$,
so that $u^*u$ is a non-zero projection,
orthogonal to all~$e_i$ with $u^*u \vmleq e$.
In other words,
$e$ could have been added to~$(e_i)_i$,
contradicting its maximality.
Hence $\bigcup_i e_i = \cceil{e}$.
\qed
\end{point}
\end{point}
\end{parsec}

\section{Normal functionals}
\subsection{Ultraweak boundedness}
\begin{parsec}%
\begin{point}%
To get a better handle on the normal positive functionals
on a von Neumann algebra,
we first analyse the the not-necessarily-positive normal functionals
in greater detail.
\end{point}
\begin{point}[positive-functional-criterion]{Lemma}%
A linear map $f\colon \scrA\to \C$
on a $C^*$-algebra~$\scrA$
is positive iff $\|f\|\leq f(1)$.
\begin{point}{Proof}%
(Based on Theorem 4.3.2 of~\cite{kr}.)

If~$f(1)=0$, then~$f=0$ in both cases 
(viz.~$f$ is positive, and~$\|f\|\leq f(1)$),
so
we may assume that~$f(1)\neq 0$.
The problem is easily reduced farther to the case 
that~$f(1)=1$
by replacing~$f$ by~$f(1)^{-1}f$
(noting that~$f(1)\geq 0$ in both cases),
so we'll assume that~$f(1)=1$.

\begin{point}{$f$ positive $\implies$ $\|f\|\leq 1$}%
This follows
immediately from~\sref{cp-russo-dye} and~\sref{cp-commutative},
but here's a concrete proof:
Let~$a\in \scrA$ be given.
Pick~$\lambda\in \C$ with $\left|\lambda\right|=1$
and~$\lambda f(a)\geq 0$.
Then $\left|f(a)\right|=f(\lambda a) 
= \Real{f(\lambda a)}
= f(\Real{(\lambda a)})
\leq f(\|a\|)=\|a\|$,
because $\Real{(\lambda a)}
\leq \|\Real{(\lambda a)}\|
\leq \|\lambda a\|=\|a\|$,
and $f$ is positive.
Hence~$\|f\|\leq 1$.
\end{point}
\begin{point}{$\|f\|\leq 1$ $\implies$ $f$ is positive}%
Let~$a\in [0,1]_\scrA$ be given.
To prove that~$f$ is positive, it suffices to show that $f(a)\geq 0$.
Since $(\Real{f(a)})^\perp
=\Real{(f(a)^\perp)}
\leq \left|f(a)^\perp \right|
=\left|f(a^\perp)\right|\leq 1$,
and therefore $\Real{f(a)}\geq 0$,
we just need to show that~$\Imag{f(a)}=0$.

The trick is to consider $b_n := (a - \Real{f(a)})+in\Imag{f(a)}$.
Indeed, since $(n+1)^2(\Imag{f(a)})^2
= \|f(b_n)\|^2 \leq \|b_n\|^2 = 
\|b_n^*b_n\| \leq \|a-\Real{f(a)}\|^2 + n^2(\Imag{f(a)})^2$,
one sees that $(2n+1)(\Imag{f(a)})^2\leq \|a-\Real{f(a)}\|^2$
for all~$n$,
which is impossible unless~$(\Imag{f(a)})^2=0$,
that is, $\Imag{f(a)}=0$.\qed
\end{point}
\end{point}
\end{point}
\begin{point}[vn-ball-extreme-point]{Lemma}%
An extreme point~$u$ of the unit ball~$(\scrA)_1$
of a $C^*$-algebra~$\scrA$
is a partial isometry with $(uu^*)^\perp\scrA(u^*u)^\perp = \{0\}$.
\begin{point}{Remark}%
The converse (viz.~every such partial isometry
is extreme in~$(\scrA)_1$)
also holds, but we won't need it.
\end{point}
\begin{point}{Proof}%
(Based on Theorem~7.3.1 of~\cite{kr}.)

To show~$u$ is a partial isometry
it suffices to prove that~$u^*u$ is a projection.
Suppose towards a contradiction that~$u^*u$ is not a projection.
Then $u^*u$,
represented
as continuous function (on~$\spec(u^*u)$ cf.~\sref{functional-calculus}),
takes neither the value~$0$ nor~$1$ on a neighbourhood
of some point,
and so by considering a
positive continuous function,
which is sufficiently small but non-zero on this neighbourhood
and zero elsewhere, 
we can find a non-zero element~$a$ 
of the (commutative) $C^*$-subalgebra generated by~$u^*u$
with $0\leq a\leq u^*u$
and $\|u^*u (1\pm a)^2\|\leq 1$,
so that~$\|u(1\pm a)\|\leq 1$.
Since~$u$ is extreme in~$(\scrA)_1$,
and~$u=\frac{1}{2}u(1+a)\,+\,\frac{1}{2}u(1-a)$,
we get~$ua=0$,
and so $0\leq a^2\leq \sqrt{a}u^*u\sqrt{a}=u^*ua=0$,
which contradicts $a\neq 0$.

Let~$a\in (uu^*)^\perp \scrA (u^*u)^\perp$
be given; we must show that $a=0$.
Assume (without loss of generality)
that~$\|a\|\leq 1$.
We'll show that $\|u\pm a\|\leq 1$,
because,
since~$u$ is extreme in~$(\scrA)_1$,
$u\equiv \frac{1}{2}(u+a)+(u-a)$
implies that~$u=u+a$, and so $a=0$.
Note that $a^*a \leq (u^*u)^\perp$ (because $a(u^*u)^\perp=a$)
and $u^*a = 0$ (because $(uu^*)^\perp a=a$).
Thus $(u\pm a)^*(u\pm a)
=u^*u \pm u^* a \pm a^* u + a^*a
= u^*u + a^*a \leq u^*u + (u^*u)^\perp = 1$,
so $\|u\pm a\|\leq 1$. \qed
\end{point}
\end{point}
\begin{point}[polar-decomposition-of-functional]%
	{Theorem (Polar decomposition of functionals)}%
Every functional $f\colon \scrA\to \C$ on a von Neumann algebra~$\scrA$
which is ultraweakly continuous on
the unit ball~$(\scrA)_1$
is of the form $f\equiv f(uu^*(\,\cdot\,)) = f((\,\cdot\,)u^*u)$
for some partial isometry~$u$ on~$\scrA$
such that $f(u(\,\cdot\,))$
and $f((\,\cdot\,)u)\colon \scrA\to\C$
are positive.
\begin{point}{Proof}%
(Based on Theorem~7.3.2 of~\cite{kr}.) 
\begin{point}%
We'll first show that~$f$ takes the value~$\|f\|$
on some extreme point~$u$ of~$(\scrA)_1$.
To begin, since~$(\scrA)_1$ is ultraweakly compact (\sref{vn-ball-compact}),
and~$f$ is ultraweakly continuous
the subset $\{\,f(a)\colon\,a\in(\scrA)_1\,\}$
of~$\R$ is compact,
and therefore has a largest element, 
which must be~$\|f\|$.
Thus the convex
set~$F:=\{\,a\in(\scrA)_1\colon\, f(a)=\|f\|\,\}$
is non-empty.
Since~$F$ is ultraweakly compact (being an ultraweakly closed
subset of the ultraweakly compact~$(\scrA)_1$),
$F$ has at least one extreme point
by the Krein--Milman Theorem
(see e.g.~Theorem~V7.4 of~\cite{conway2013}), say~$u$.
Note that~$F$ is a face of~$(\scrA)_1$:
if~$\frac{1}{2}a+\frac{1}{2}b\in F$ for some~$a,b\in(\scrA)_1$,
then $\frac{1}{2}f(a)+\frac{1}{2}f(b) = \|f\|$,
so~$f(a)=f(b)=\|f\|$
(since~$\|f\|$ is extreme in $(\C)_{\|f\|}$)
and thus~$a,b\in F$.
It follows that~$u$ is not only extreme in~$F$, but also in~$(\scrA)_1$,
so that~$u$ is an partial isometry with $(uu^*)^\perp\scrA(u^*u)^\perp=\{0\}$
by~\sref{vn-ball-extreme-point}.

Note that $f(u(\,\cdot\,))$
is positive by~\sref{positive-functional-criterion}, because
$\|f(u(\,\cdot\,))\||\leq\|f\|\|u\|\leq\|f\|=f(u)=f(u(1))$,
and by a similar argument~$f((\,\cdot\,)u)$
is positive.

Let~$a\in\scrA$ be given.
It remains to be shown that $f=f(uu^*a)=f(au^*u)$.
First note that  $u(u^*u)^\perp = 0$ (since~$u$ is an isometry)
and so $f(u(u^*u)^\perp)=0$,
that is,  $u^*u\geq \ceil{f(u(\,\cdot\,))}$.
This entails that $f(ubu^*u)=f(ub)$ for all~$b\in\scrA$
by~\sref{carrier-fundamental}, and in particular $f(uu^*au^*u)=f(uu^*a)$.

Now, since~$(uu^*)^\perp\scrA(u^*u)^\perp = \{0\}$,
we have $uu^* a u^*u + a = uu^*a + au^*u$,
and thus $f(a)+f(uu^*a)=f(a)+f(uu^*au^*u)=f(uu^*a)+f(au^*u)$,
which yields $f(a)=f(au^*u)$.
By a similar reasoning we get $f(uu^*a)=f(a)$.\qed
\end{point}
\end{point}
\end{point}
\begin{point}[uwcont-on-ball]{Corollary}%
A functional $f\colon \scrA\to\C$
on a von Neumann algebra~$\scrA$
is ultraweakly continuous
when it is ultraweakly continuous
on the unit ball~$(\scrA)_1$.
\begin{point}{Proof}%
By~\sref{polar-decomposition-of-functional}
there is a partial isometry~$u$
such that $f(uu^*(\,\cdot\,))=f$
and~$f(u(\,\cdot\,))$ is positive.
Recall from~\sref{p-uwcont} that such a positive functional~$f(u(\,\cdot\,))$
is normal when it is ultraweakly continuous
on~$[0,1]_{\scrA}$;
which it is, 
because $a\mapsto ua$ is ultraweakly continuous (see \sref{mult-uws-cont}),
maps~$[0,1]_{\scrA}$ into~$(\scrA)_1$,
and $f$ is ultraweakly continuous on~$(\scrA)_1$.
But then~$f\equiv f(uu^*(\,\cdot\,))$
being the composition of the ultraweakly continuous maps
$f(u(\,\cdot\,))$ and $a\mapsto u^*a$ 
is ultraweakly continuous on~$\scrA$ too.\qed
\end{point}
\end{point}
\begin{point}[functional-norm]{Lemma}%
Let~$f\colon \scrA\to\C$
be a normal functional
on a von Neumann algebra~$\scrA$,
and let~$u$ be a partial isometry in~$\scrA$
such that~$f(u(\,\cdot\,))$ is positive,
and $f=f(uu^*(\,\cdot\,))$.
Then~$\|f\|=f(u)$.\qed
\begin{point}{Proof}%
Since~$f(u(\,\cdot\,))$ is positive,
we have $\|f(u(\,\cdot\,))\|=f(u)$
by~\sref{cp-russo-dye};
hence $\|f\|=\|f(uu^*(\,\cdot\,))\|
\leq \|f(u(\,\cdot\,))\|\|u^*\|
\equiv f(u) \leq \|f\|$,
and thus~$\|f\|=f(u)$.


\end{point}
\end{point}
\end{parsec}

\begin{parsec}%
\begin{point}{Definition}%
Given a von Neumann algebra~$\scrA$,
the vector space of ultraweakly continuous 
linear maps $f\colon \scrA\to \C$
endowed with the operator norm
is denoted by~$\Define{\scrA_*}$,
and called the \Define{predual} of~$\scrA$.
\begin{point}{Remark}%
The reason
that the space~$\scrA_*$ is called the \emph{predual}
of~$\scrA$
is the non-trivial fact due to Sakai~\cite{sakai} (which we 
don't need and therefore won't prove),
that the obvious 
map $\scrA\to(\scrA_*)^*$,
where $(\scrA_*)^*$ is the \emph{dual} of~$\scrA_*$ --- the
vector space of bounded linear maps $\scrA_*\to\C$
endowed with the operator norm ---,
is a surjective isometry,
and so $\scrA$ ``is'' the dual of~$\scrA_*$,
(albeit only as normed space,
because~$(\scrA_*)^*$ doesn't come equipped with a multiplication.)

We'll do need this:
\end{point}
\end{point}
\begin{point}[predual-complete]{Proposition}%
The predual~$\scrA_*$ of a von Neumann algebra~$\scrA$
is complete (with respect to the operator norm).
\begin{point}{Proof}%
Let $f_1,f_2,\dotsc$ be a sequence in~$\scrA_*$
which is Cauchy with respect to the operator norm.
We already know (from~\sref{operator-norm-complete})
that $f_1,f_2,\dotsc$ converges to a bounded linear 
functional~$f\colon \scrA\to\C$;
so we only need to prove that~$f$ is ultraweakly continuous
to see that~$\scrA_*$ is complete,
and for this,
we only need to show 
(by~\sref{uwcont-on-ball})
that~$f$
is ultraweakly continuous
on the unit ball~$(\scrA)_1$ of~$\scrA$.
So let~$(b_\alpha)_\alpha$ be 
a net in~$(\scrA)_1$
which converges ultraweakly to~$0$;
we must show that~$\lim_\alpha f(b_\alpha)=0$.
Now, note that for every~$n$ and~$\alpha$
we have the bound
\begin{equation*}
	\left|f(b_\alpha)\right|
	\ \leq\ \left|(f-f_n)(b_\alpha)\right|
	\,+\,\left|f_n(b_\alpha)\right|
	\ \leq\ 
	\|f-f_n\|\,+\,\left|f_n(b_\alpha)\right|.
\end{equation*}
From this,
and $\lim_n\|f-f_n\|=0$,
and $\lim_\alpha f_n(b_\alpha)=0$
for all~$n$,
one easily deduces that~$\lim_\alpha f(b_\alpha)=0$.
Thus~$f$ is ultraweakly continuous,
and so~$\scrA_*$ is complete.\qed
\end{point}
\end{point}
\begin{point}[norm-predual]{Lemma}%
We have $\|a\|=\sup_{f\in(\scrA_*)_1}\left|f(a)\right|$
for every element~$a$ of a von Neumann algebra~$\scrA$.
\begin{point}{Proof}%
It's clear that $\sup_{f\in(\scrA_*)_1}\left|f(a)\right|\leq \|a\|$.

For the other direction,
write $a\equiv [a] \sqrt{a^*a}$ (see~\sref{polar-decomposition})
and note that $\|a\|=\|\sqrt{a^*a}\|=\sup_{\omega\in \Omega} 
\left|\omega (\,\sqrt{a^*a}\,)\right|$,
where $\Omega$ is the set of  npu-maps $\scrA\to \C$
(which is order separating).
Let~$\omega\in \Omega$ be given.
Since~$[a]^*a=\sqrt{a^*a}$ 
we have $\omega(\,\sqrt{a^*a}\,)=\omega([a]^*a)=f(a)$,
where $f:=\omega([a]^*(\,\cdot\,))\in (\scrA_*)_1$,
and so $\|a\|=\sup_{\omega\in\Omega} 
\omega(\,\sqrt{a^*a}\,) \leq \sup_{f\in (\scrA_*)_1}
\left|f(a)\right|$.\qed
\end{point}
\end{point}
\begin{point}[ultraweakly-bounded-implies-bounded]{Theorem}%
A net  $(b_\alpha)_\alpha$
 in a von Neumann algebra~$\scrA$
is norm bounded
(that is,~$\sup_\alpha \|b_\alpha\|<\infty$)
provided it is \Define{ultraweakly bounded}, i.e.,
$\sup_\alpha \left|\omega(b_\alpha)\right|<\infty$
for every npu-map $\omega\colon \scrA\to \C$.
\begin{point}{Proof}%
Note that $f\mapsto f(b_\alpha)$
gives a linear map $(\,\cdot\,)(b_\alpha)\colon \scrA_*\to\C$
with $\|(\,\cdot\,)(b_\alpha)\|=\|b_\alpha\|$ 
by~\sref{norm-predual}
for each~$\alpha$.
So to prove that~$(b_\alpha)_\alpha$
is norm bounded, viz.~%
$\sup_\alpha \|b_\alpha\|\equiv \sup_\alpha \|(\,\cdot\,)(b_\alpha)\|<\infty$,
it suffices to show
(by the principle of uniform boundedness, \sref{pub},
using that~$\scrA_*$ is complete, \sref{predual-complete}),
that $\sup_\alpha \left|f(b_\alpha)\right|<\infty$ for all~$f\in\scrA_*$.

Since such~$f\in\scrA_*$
can be written as $f\equiv \sum_{k=0}^3 i^k f_k$
where $f_k\colon \scrA\to\C$ are np-maps
(by~\sref{normal-functionals-lemma}),
we see that $\sup_\alpha\left|f(b_\alpha)\right|
\leq \sum_{k=0}^3\sup_\alpha \left|\omega_k(b_\alpha)\right|
<\infty$, because~$(b_\alpha)_\alpha$
is ultraweakly bounded.
Thus~$(b_\alpha)_\alpha$
is norm bounded.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Ultraweak permanence}
\begin{parsec}%
\begin{point}%
We turn to 
subtle, but suprisingly difficult matter:
it is not immediately clear
that the ultraweak topology on a von Neumann
subalgebra~$\scrA$ of a von Neumann algebra~$\scrB$,
coincides (on~$\scrA$) with the ultraweak topology on~$\scrB$.
While it is easily seen that the former is finer
(that is, a net in~$\scrA$ which converges ultraweakly in~$\scrA$,
converges ultraweakly in~$\scrB$ too, because any np-map 
$\omega\colon \scrB\to\C$ is also an np-map restricted to~$\scrA$),
it is not obvious that an np-map $\omega\colon \scrA\to\C$
can be extended to an np-map on~$\scrB$
--- but it can, as we'll see~\sref{functional-permanence}.
I'll call this independence of the ultraweak topology
from the surrounding space
\emph{ultraweak permanence}
being not unlike the independence
of the spectrum of an operator from the surrounding space
known as spectral permanence (\sref{spectral-permanence}).


It is tempting to think that the extension of an np-map~$\omega\colon \scrA
\to\C$
on a von Neumann
subalgebra~$\scrA$ of a von Neumann algebra~$\scrB$
to~$\scrB$ is simply a matter of applying Hahn--Banach to~$\omega$,
but this approach presents two problems:
it yields a normal but not necessarily positive extension
of~$\omega$;
and it not clear that~$\omega$ is ultraweakly continuous
on~$\scrA$ (that is, whether Hahn--Banach applies).

Instead of applying general techniques we feel forced
to delve deeper
into the particular structure 
provided to us by von Neumann algebras
(namely the commutant, \sref{commutant})
to show that any np-map
$\omega\colon \scrA\to\C$
on a von Neumann algebra~$\scrA$
of bounded operators on a Hilbert space~$\scrH$
can be extended to an np-map on~$\scrB(\scrH)$,
and in fact, is of the form
$\omega\equiv \sum_n \left<x_n,(\,\cdot\,)x_n\right>$
for some $x_1,x_2,\dotsc \in\scrH$, see~\sref{normal-functional}.
\end{point}
\begin{point}[commutant-ceil]{Proposition}%
Let~$S$ be a subset of a von Neumann algebra~$\scrA$
that is closed under multiplication, involution, and contains~$1$.
Let~$e$ be a projection in~$\scrA$.
Then $\Define{\ceil{e}_{S^\square}}= 
\bigcup_{a\in S} \ceil{a^* e a}$
is the least projection in~$S^\square$
above~$e$.

(Compare this with the paragraph ``Subspaces'' of \S2.6 of~\cite{kr}.)
\begin{point}{Proof}%
Let us first show that~$p:= \ceil{e}_{S^\square}$
is in~$S^\square$.
Let $b\in S$ be given.
Since~$b^*(\,\cdot\,)b\colon \scrA\to\scrA$
is normal and completely positive,
and $p=\bigcup_{a\in S} \ceil{a^*ea}$,
we have $b^*pb\leq \ceil{b^*pb} = 
\bigcup_{a\in S} \ceil{ b^* \ceil{a^* e a} b }
= \bigcup_{a\in S} \ceil{(ab)^* \,e\, ab} \leq p$
by~\sref{ncp-union} and~\sref{ncp-ceil}.
Applying $p^\perp(\,\cdot\,)p^\perp$,
we get $p^\perp b^*pb p^\perp 
\leq p^\perp p p^\perp = 0$,
so that $pbp^\perp=0$,
and thus $pbp=pb$.
Since similarly $pb^* =pb^*p$,
we get  $bp=pbp=pb$
(upon applying~$(\,\cdot\,)^*$) and so~$p\in S^\square$.

Note that~$e\leq \ceil{1^* e 1}\leq p$, because $1\in S$.
It remains to be shown that~$p$ is the least projection in~$S^\square$
above~$e$, so let~$q$ be a projection in~$S^\square$ above~$e$.
Since for~$a\in S$,
we have~$aq^\perp a^*=  q^\perp aa^* q^\perp 
\leq \|a\|^2q^\perp \leq \|a\|^2e^\perp$,
and so $a^*ea\leq \|a\|^2q$ 
we get~$\ceil{a^*ea}\leq q$
for all~$a\in S$,
and thus~$p=\bigcup_{a\in S}\ceil{a^*ea} \leq q$.\qed
\end{point}
\end{point}

\begin{point}[carrier-vector-state]{Exercise}%
Show that given a vector~$x$ of Hilbert space~$\scrH$,
and a collection~$S$ of bounded operators on~$\scrH$
that is closed under addition, (scalar) multiplication,
involution, and contains the identity operator
the following coincide.
\begin{enumerate}
\item
$\ceil{\,\ketbra{x}{x}\,}_{S^\square}$,
the least projection in~$S^\square$
above $\ceil{\,\ketbra{x}{x}\,}$;
\item
$\ceil{\,\left<x,(\,\cdot\,)x\right>|S^\square\,}$,
the carrier of the vector functional of~$S^\square$
given by~$x$;
\item
$\bigcup_{a\in S} \ceil{\,\ketbra{ax}{ax}\,}$; and 
\item
the projection on~$\overline{S x}$.
\end{enumerate}
Conclude that $\overline{S^{\square\square}x}
=\overline{S x}$.
(Hint: $S^{\square\square\square}=S^\square$.)
\begin{point}[proto-double-commutant]%
Now consider
(instead of~$x$)
an np-map $\omega\colon \scrB(\scrH)\to \C$,
which we know must be of the form
$\omega\equiv \sum_n \left<x_n,(\,\cdot\,)x_n\right>$
(by~\sref{bh-np})
and is therefore given by 
an element $x'\equiv (x_1,x_2,\dotsc)$ of the $\N$-fold
product~$\scrH':=\bigoplus_n\scrH$ of~$\scrH$.
\begin{enumerate}
\item
Show that  $\omega(t)=\left<x',\varrho'(t)x'\right>$,
where $\varrho'\colon \scrB(\scrH)\to\scrB(\scrH')$
is the nmiu-map given by 
$\varrho'(t)y=(ty_n)_n$
for all~$t\in\scrB(\scrH)$ and~$y\in\scrH'$.

\item
Let~$t\in S^{\square\square}$ be given.
Show that $\varrho'(t)\in \varrho'(S)^{\square\square}$.
\TODO{Check the difficulty of this}

Prove that  $\varrho'(t)x\,\in\,\overline{\varrho'(S)^{\square\square}x}
\equiv \overline{\varrho'(S)x}$.

Deduce
that for every~$\varepsilon>0$
one can find~$a\in S$ with $\|t-a\|_\omega \leq \varepsilon$.

\item
Deduce that $S^{\square\square}$
is contained in the ultrastrong closure of~$S$.
\end{enumerate}
\end{point}
\end{point}
\begin{point}[double-commutant]{Double Commutant Theorem}%
For a collection~$S$ of bounded operators
on a Hilbert space~$\scrH$
that is closed under addition, (scalar) multiplication,
involution, and contains the identity operator
the following are the same.
\begin{enumerate}
\item
$S^{\square\square}$, the ``double commutant'' of~$S$
in~$\scrB(\scrH)$;
\item
$\mathrm{us}\text{-}\mathrm{cl}(S)$,
the ultrastrong closure of~$S$ in~$\scrB(\scrH)$;
\item
$\mathrm{uw}\text{-}\mathrm{cl}(S)$,
the ultraweak closure of~$S$ in~$\scrB(\scrH)$;
\item
$W^*(S)$,
the least von Neumann subalgebra of~$\scrB(\scrH)$
that contains~$S$.
\end{enumerate}
\begin{point}{Proof}%
(Based on Theorem~5.3.1 of~\cite{kr}.) 

Note that: $\mathrm{us}\text{-}\mathrm{cl}(S)
\subseteq  \mathrm{uw}\text{-}\mathrm{cl}(S)$,
because ultrastrong convergence implies ultraweak convergence;
and
$\mathrm{uw}\text{-}\mathrm{cl}(S)
\subseteq W^*(S)$,
because~$W^*(S)$ 
is ultraweakly closed in~$\scrB(\scrH)$ by~\sref{vnsac};
and
$W^*(S)\subseteq S^{\square\square}$,
because 
$S^{\square\square}$ is a von Neumann subalgebra
of~$\scrB(\scrH)$ by~\sref{commutant-basic};
and, finally, $S^{\square\square}\subseteq \mathrm{us}\text{-}\mathrm{cl}(S)$
by~\sref{proto-double-commutant}.\qed
\end{point}
\end{point}
\begin{point}[centre-commutant]{Exercise}
Show that central elements of
a von Neumann algebra~$\scrA$
of bounded operators on a Hilbert space~$\scrH$
coincide with the central elements of the commutant~$\scrA^\square$,
that is, $Z(\scrA)=Z(\scrA^\square)$.
(Hint: $\scrA^{\square\square}=\scrA$ by~\sref{double-commutant}.)
\begin{point}[commutant-cceil]%
Deduce that~$\cceil{f|\scrA}=\cceil{f|\scrA^\square}$
for every np-map~$f\colon \scrB(\scrH)\to\scrB$ 
into a von Neumann algebra~$\scrB$.
\end{point}
\end{point}
\end{parsec}%
\begin{parsec}%
\begin{point}[gns-mapping-property]{Lemma}%
Let~$\omega\colon \scrA\to\C$
be an np-map on a von Neumann algebra~$\scrA$,
which is represented by nmiu-maps
$\varrho\colon \scrA\to\scrB(\scrH)$
and $\pi\colon \scrA\to\scrB(\scrK)$
on Hilbert spaces~$\scrH$ and~$\scrK$.
If $\left<x,\varrho(\,\cdot\,)x\right>
=\omega=\left<y,\pi(\,\cdot\,)y\right>$
for some  $x\in\scrH$ and~$y\in\scrK$,
then there is a bounded operator $U\colon \scrK\to\scrH$
for which~$UU^*$ is the projection
on~$\overline{\varrho(\scrA)x}$,
$U^*U$ is the projection
on~$\overline{\pi(\scrA)y}$,
and~$U\pi(a)=\varrho(a)U$
for all~$a\in\scrA$.
\begin{point}{Proof}%
(Compare this with Proposition 4.5.3 of~\cite{kr}.)

Since $\|\varrho(a)x\|^2
= \left<x,\varrho(a^*a)x\right>
=\omega(a^*a)=\left<y,\pi(a^*a)y\right>
= \|\pi(a)y\|^2$ for all~$a\in\scrA$,
there is a unique bounded operator $V\colon \overline{\pi(\scrA)y}
\to \overline{\varrho(\scrA)x}$
with $V\pi(a)y = \varrho(a)x$ for all~$a\in\scrA$.
A moment's thought reveals
that $V$ is a unitary (and so~$V^*V=1=VV^*$).
Now, define $U:=EVF^*$
where $E\colon \overline{\varrho(\scrA)x}\to\scrH$
and $F\colon \overline{\pi(\scrA)y}\to\scrK$
are the inclusions
(and so~$E^*E=1$ and~$F^*F=1$).
Then $UU^*= EVF^*FV^*E^*=EVV^*E^*=EE^*$
is the projection onto~$\overline{\varrho(\scrA)x}$,
and $UU^*=FF^*$
is the projection onto~$\overline{\pi(\scrA)y}$.

Let~$a\in\scrA$ be given.
It remains to be shown that
$U\pi(a)=\varrho(a)U$.
To this end,
observe that
$V F^* \pi(a) F = E^* \varrho(a) E V$
(because 
these two bounded linear maps
are easily seen to
agree on the dense subset $\pi(\scrA)y$
of $\overline{\pi(\scrA)y}$);
and $\varrho(a)E = EE^*\varrho(a)E$
(because $\varrho(a)$ maps $\varrho(\scrA)x$ into~$\varrho(\scrA)x$);
and similarly $\varrho(a^*)F=FF^*\varrho(a^*) F$,
so that $F^*\varrho(a) = F^* \varrho(a) FF^*$
(upon application of the~$(\,\cdot\,)^*$).
By these observations,  $U\pi(a)=
EVF^*\pi(a)=EVF^*\pi(a) FF^*
= EE^*\varrho(a)EVF^*
= \varrho(a)EVF^*
= \varrho(a)U$.\qed
\end{point}
\end{point}
\begin{point}[summing-partial-isometries]{Exercise}%
It is not too difficult 
to see that the (ultraweak) sum~$\sum_i u_i$
of a collection $(u_i)_i$ 
of partial isometries from some von Neumann algebra
is again a partial isometry, 
provided that the initial projections $u_i^*u_i$
are orthogonal,
and the final projections~$u_iu_i^*$ are orthogonal.
In this exercise, you'll establish a similar result,
but for partial isometries between two different Hilbert spaces,
and avoiding the use of an analogue of 
the ultraweak topology for such operators.

\begin{point}%
Let~$\scrH$ and~$\scrK$ be Hilbert spaces,
and 
let $U_i\colon \scrH\to\scrK$
be a bounded operator
for every element~$i$ from some set~$I$.
Assume that the operators~$U_i^*U_i$
are pairwise orthogonal projections in~$\scrB(\scrK)$,
and that~$U_iU_i^*$ are pairwise orthogonal projections in~$\scrB(\scrH)$.
\begin{enumerate}
\item
Let~$x\in\scrH$ and~$y\in\scrK$ be given.

Show that
$\left|\left<x,U_iy\right>\right|
\leq \|U_i^*x\| \|U_i y \|$
for each~$i$
(perhaps by first proving that  $U_i = U_i U_i^* U_i$).

Show that~$\sum_i \|U_i y\|^2 \leq \|y\|^2$
and $\sum_i \|U_i^* x\|^2\leq \|x\|^2$,
and deduce from this
that $\sum_i \left|\left<x,U_i y\right>\right| \leq \|x\|\|y\|$.

Now use~\sref{chilb-form-representation}
to show that there is a bounded operator~$U\colon \scrK\to\scrH$
with $\left<x,Uy\right>
= \sum_i \left<x,U_iy\right>$
for all~$x\in\scrH$ and~$y\in \scrK$.
\item
Show that~$U_i^*U_j = 0$ when~$i\neq j$.
Deduce from this that~$U^*U = \sum_i U_i^* U_i$.

Prove that $UU^* = \sum_i U_iU_i^*$.
\end{enumerate}
\end{point}
\end{point}
\begin{point}[sigma-weak-lemma-2]{Lemma}%
Let~$\Omega$ be a collection of np-maps $\omega\colon \scrA\to\C$
on a von Neumann algebra~$\scrA$ 
whose central carriers,  $\cceil{\omega}$, are orthogonal to one another,
and let~$\scrH$ and~$\scrK$ be Hilbert spaces
on which~$\scrA$ is represented such
that each~$\omega\in\Omega$ 
is given by vectors $x_\omega\in\scrH$ and $y_\omega\in\scrK$,
that is,
$\left<x_\omega,\varrho(\,\cdot\,)x_\omega\right>
=\omega = \left<y_\omega,\pi(\,\cdot\,)y_\omega\right>$,
where $\varrho\colon \scrA\to\scrB(\scrH)$
and $\pi\colon \scrA\to\scrB(\scrK)$
are nmiu-maps.

Then there is a bounded operator $U\colon \scrK\to\scrH$
which intertwines~$\pi$ and~$\varrho$
in the sense that $U \pi(a)=\varrho(a) U$
for all~$a\in \scrA$
such that~$U^*U$
is a projection in
$\pi(\scrA)^\square$
with
$\cceil{U^*U}_{\pi(\scrA)^\square}=\pi(\sum_\omega \cceil{\omega})$,
and 
$UU^*$
is projection in
$\varrho(\scrA)^\square$
with
$\cceil{UU^*}_{\varrho(\scrA)^\square}=\varrho(\sum_\omega \cceil{\omega})$.
\begin{point}{Proof}%
Given~$\omega\in\Omega$,
let $\sigma_\omega\colon \varrho(\scrA)\to \C$
and $\sigma_\omega'\colon \varrho(\scrA)^\square\to\C$
denote the restrictions
of the vector functional $\left<x_\omega,(\,\cdot\,)x_\omega\right>
\colon \scrB(\scrH)\to\C$,
and let  $\tau_\omega\colon \pi(\scrA)\to \C$
and $\tau_\omega'\colon \pi(\scrA)^\square\to\C$
be similar restrictions
of $\left<y_\omega,(\,\cdot\,)y_\omega\right>$.
We already know (by~\sref{gns-mapping-property}
and~\sref{carrier-vector-state})
that
there is
a bounded operator $U_\omega\colon \scrK\to\scrH$
with $U_\omega^*U_\omega = \ceil{\tau_\omega'}$,
$U_\omega U_\omega^* = \ceil{\sigma_\omega'}$,
and $U_\omega \pi(a) = \varrho(a) U_\omega$
for all~$a\in\scrA$.

We'll combine these $U_\omega$s into one operator~$U$
using~\sref{summing-partial-isometries} but for this must
verify that the projections $U_\omega^* U_\omega=\ceil{\sigma_\omega'}$
are orthogonal,
and that the projections $U_\omega U_\omega^*$
are orthogonal too.
To this end note that
$\cceil{\sigma_\omega}=\cceil{\sigma_\omega'}$
by~\sref{commutant-cceil}.
Thus, since the projections~$\cceil{\omega}$
are orthogonal to one another,
and $\ceil{\sigma_\omega'}\leq \cceil{\sigma_\omega'}
= \cceil{\sigma_\omega} =\varrho(\cceil{\omega})$,
we see that the projections~$U^*_\omega U_\omega \equiv 
\ceil{\sigma_\omega'}$
are indeed orthogonal.
Since for a similar reason
the projections $U_\omega U_\omega^*
\equiv \ceil{\tau_\omega'}$ are orthogonal too,
there is by~\sref{summing-partial-isometries}
a bounded operator $U\colon \scrK\to\scrH$
with 
$U^*U = \sum_\omega U_\omega^* U_\omega$,
$UU^* = \sum_\omega U_\omega U_\omega^*$,
and $\left<x,Uy\right>=\sum_\omega \left<x,U_\omega y\right>$
for all~$x\in\scrH$ and~$y\in \scrK$.

Let us check that~$U$ has the desired properties.
To begin, since the projections
$\cceil{U_\omega^*U_\omega}=\cceil{\sigma_\omega'}=\varrho(\cceil{\omega})$
are orthogonal,
we have $\cceil{U^*U}=\sum_\omega \cceil{U_\omega^* U_\omega}
=  \varrho(\sum_\omega \cceil{\omega})$
by~\sref{cceil-basic} and
\sref{sum-of-orthogonal-projections}.
Similarly, $\cceil{UU^*}= \pi(\sum_\omega \cceil{\omega})$.

Finally,
given~$a\in\scrA$
we have $U\pi(a)=\varrho(a)U$,
because $\left<x,U\pi(a)y\right>
= \sum_\omega \left<x,U_\omega \pi(a)y\right>
= \sum_\omega \left<x,\varrho(a) U_\omega y\right>
= \sum_\omega \left<\varrho(a)^* x, U_\omega y\right>
= \left<\varrho(a)^* x, U y\right>
= \left<x, \varrho(a) U y\right>$
for all~$x\in\scrH$ and~$y\in\scrK$.\qed
\end{point}
\end{point}
\begin{point}[sigma-weak-lemma]{Corollary}%
Let~$\scrA$ be a von Neumann 
of bounded operators on some Hilbert space~$\scrH$,
and let~$\varrho\colon \scrA\to\scrB(\scrH)$
denote the inclusion.
Let~$\Omega$ be the collection of all np-maps $\scrA\to\C$,
and let $\varrho_\Omega\colon \scrA\to\scrB(\scrH_\Omega)$
be as in~\sref{gelfand-naimark-representation}.

There is a bounded operator $U\colon \scrH_\Omega\to\scrH$
such that $U^*U$ is a projection
in~$\varrho_\Omega(\scrA)^\square$
with 
$\cceil{U^*U}_{\varrho_\Omega(\scrA)^\square}=1$
and
$U\varrho_\Omega(a)= \varrho(a) U$
for all~$a\in\scrA$.
\begin{point}{Proof}%
Let $\{x_i\}_i$ be a maximal set of vectors
in~$\scrH$ 
such that the 
central carriers~$\cceil{\omega_i}$
of the corresponding vector functionals
$\omega_i :=\left<x_i,\varrho(\,\cdot\,)x_i\right>$
on~$\scrA$
are orthogonal;
so that we'll 
have $\sum_i \cceil{\omega_i}=1$.
Now, the point of~$\scrH_\Omega$ 
is that there are vectors $y_i\in\scrH_\Omega$
with $\omega_i=\left<y_i,\varrho_\Omega(\,\cdot\,)y_i\right>$
for each~$i$.
Now apply~\sref{sigma-weak-lemma-2}
to get a map~$U\colon \scrH_\Omega\to \scrH$
with the desired properties.\qed
\end{point}
\end{point}
\begin{point}[normal-functional]{Theorem}%
Every np-map $\omega\colon \scrA\to\C$
on a von Neumann subalgebra~$\scrA$
of~$\scrB(\scrH)$,
where~$\scrH$ is some Hilbert space,
is of the 
form~$\omega \equiv \sum_n \left<x_n,(\,\cdot\,)x_n\right>$
for some $x_1,x_2,\dotsc \in\scrH$
(with $\sum_n\|x_n\|^2<\infty$).
\begin{point}{Proof}%
(Based on Theorem~7.1.8 of~\cite{kr}.)

Let~$\varrho\colon \scrA\to\scrB(\scrH)$
denote the inclusion,
and let~$U\colon \scrH_\Omega\to\scrH$
be as in~\sref{sigma-weak-lemma}.
Since~$\omega\in\Omega$,
there is~$y\in\scrH_\Omega$
with $\omega = \left<y,\varrho_\Omega(\,\cdot\,)y\right>$.
We're going to `transfer'~$y$ from~$\scrH_\Omega$ to~$\scrH$
using the following device.
Since~$1=\cceil{U^*U}_{\varrho_\Omega(\scrA)^\square}$,
we can 
(by~\sref{cceil-sum})
find partial isometries $(v_i)_i$ in
$\varrho_\Omega(\scrA)^\square$
with $1=\sum_i v_i^*v_i$
and $v_iv_i^*\leq U^*U$
for all~$i$.
Then for every~$a\in\scrA$,
\begin{alignat*}{3}
	\textstyle
\omega(a)\  &=\
	\textstyle
	\left<\,y, \,\varrho_\Omega(a)y\,\right> 
	\\
&= 
	\textstyle
	\ \sum_i \left<\,y,\,  v_i^*v_i\, \varrho_\Omega(a) y \,\right>
	&&\qquad 
	\textstyle
	\text{since $1=\sum_i v_i^*v_i$}
	\\
&= 
	\textstyle
	\ \sum_i \left<\,y,\,  v_i^* U^*Uv_i \,\varrho_\Omega(a)y\, \right>
	&&\qquad\text{since $v_iv_i^*\leq U^*U$}
	\\
	&= 
	\textstyle
	\ \sum_i \left<\,Uv_i y,\, U \varrho_\Omega(a)v_i y\, \right>
	&&\qquad\text{since $v_i \in \varrho(\scrA)^\square$}
	\\
	&= 
	\textstyle
	\ \sum_i \left<\,Uv_i y,\, \varrho(a) \, Uv_i y\, \right>
	&&\qquad\text{since $U\varrho_\Omega(a)=\varrho(a) U$}.
\end{alignat*}
In particular, $\omega(1)=\sum_i \|Uv_i y\|^2$,
so at most countably many $Uv_iy$'s are non-zero;
and denoting those by~$x_1,x_2,\dotsc$,
we get $\omega = \sum_n \left<x_n,(\,\cdot\,)x_n\right>$.\qed
\end{point}
\end{point}
\begin{point}[functional-permanence]{Corollary}%
Let~$\scrA$ be a von Neumann subalgebra
of a von Neumann algebra~$\scrB$.
\begin{enumerate}
\item
For every np-map $\omega\colon \scrA\to\C$
there is an np-map $\xi\colon \scrB\to\C$
with $\xi|\scrA=\omega$.
\item
\Define{Ultraweak permanence:}\ 
the restriction of the ultraweak topology on~$\scrB$
to~$\scrA$ coincides with the ultraweak topology on~$\scrA$.
\item
\Define{Ultrastrong permanence:}\ 
the restriction of the ultrastrong topology on~$\scrB$
to~$\scrA$ coincides with the ultrastrong topology on~$\scrA$.
\end{enumerate}
\end{point}
\begin{point}[functional-extension]{Exercise}%
Let $\varrho\colon \scrA\to\scrB$
be an injective nmiu-map.

Show 
using~\sref{injective-nmiu-iso-on-image}
that any np-functional
$\omega\colon \scrA\to\C$
can be extended along~$\varrho$,
that is,
there is an np-functional
$\omega'\colon \scrB\to\C$
with $\varrho\circ \omega' = \omega$.

\end{point}
\end{parsec}
\begin{parsec}%
\begin{point}%
We end the chapter 
with another corollary to~\sref{normal-functional}:
 that  the np-functionals
on a von Neumann algebra
are generated (in a certain sense)
by any centre separating collection
of functionals. This fact plays
an important role
in the next chapter
for our definition of the tensor product
of von Neumann algebras
(on which the product functionals are to be centre separating,
\sref{tensor}).
\end{point}
\begin{point}[vn-center-separating-fundamental]{Proposition}%
Given a center separating collection~$\Omega$ of np-maps
on a von Neumann algebra~$\scrA$,
and an ultrastrongly dense subset~$S$ of~$\scrA$
\begin{enumerate}
\item
	\label{vn-center-separating-fundamental-1}
$\Omega':= \{\,\omega(s^*(\,\cdot\,)s)\colon\,
\omega\in\Omega,\,s\in S\,\}$
is order separating, and
\item
	\label{vn-center-separating-fundamental-2}
$\Omega'':=\{\,\sum_n\omega_n\colon\, \omega_1,\dotsc,\omega_N\in\Omega'\,\}$ is operator norm dense in $(\scrA_*)_+$.
	\end{enumerate}
\begin{point}[vn-center-separating-fundamental-i]{Proof}%
We tackle~\ref{vn-center-separating-fundamental-1}
first. We already know from~\sref{proto-gelfand-naimark}
that the collection $\Xi:=\{\, \omega(a^*(\,\cdot\,)a)\colon\, 
\omega\in\Omega,\, a\in\scrA\,\}$,
which contains~$\Omega'$, is order separating;
so to prove that~$\Omega'$ is itself order separating
it suffices by~\sref{order-separating-dense-subset} to show that~$\Omega'$
is norm dense in~$\Xi$.
This is indeed the case
since given~$a\in\scrA$
and~$\omega\in\Omega$,
and a net~$(s_\alpha)_\alpha$ in~$S$
that converges ultrastrongly to~$a$,
the functionals~$s_\alpha \ast\omega
\equiv \omega(s_\alpha^*(\,\cdot\,)s_\alpha)$
converge in norm to~$a\ast \omega$
as $\alpha\to\infty$
by~\sref{bstaromega-basic}.

\begin{point}{Concerning~\ref{vn-center-separating-fundamental-2}}%
Let~$f\colon \scrA\to\C$ be an np-map;
we must show that~$f$ is in 
the norm closure~$\overline{\Omega''}$ of~$\Omega''$.
Note that since~$\Omega$ is center separating,
the map $\varrho_\Omega\colon \scrA\to\scrB(\scrH_\Omega)$
from~\sref{proto-gelfand-naimark}
is injective,
and in fact restricts
to a nmiu-isomorphism
from~$\scrA$ onto $\varrho_\Omega(\scrA)$
(cf.~\sref{ngns}).
So by~\sref{normal-functional}
$f$ is of the form $f\equiv 
\sum_n \left<x_n,\varrho_\Omega(\,\cdot\,)x_n\right>$
for some $x_1,x_2,\dotsc \in\scrH_\Omega$
with $\sum_n \|x_n\|^2<\infty$,
so that the partial sums
$\sum_{n=1}^N \left<x_n,\varrho_\Omega(\,\cdot\,)x_n\right>$
converge with respect to the operator norm to~$f$
(by~\sref{vector-functional-convergence}).
Thus to show that~$f$ is in~$\overline{\Omega''}$
it suffices to show that each~$\left<x_n,\varrho_\Omega(\,\cdot\,)x_n\right>$
is in~$\overline{\Omega''}$
(since~$\overline{\Omega''}$ is clearly closed
under finite sums and norm limits).
In effect
we may assume 
without loss of generality
that~$f\equiv \left<x,\varrho_\Omega(\,\cdot\,)x\right>$
for some~$x\in \scrH_\Omega$.
We reduce the problem some more.
By definition 
of $\scrH_\omega\equiv \bigoplus_{\omega\in\Omega}\scrH_\omega$
and~$\varrho_\Omega$,
we have $f=\left<x,\varrho_\Omega(\,\cdot\,)x\right>
= \sum_{\omega\in \Omega} 
\left<x_\omega,\varrho_\omega(\,\cdot\,)x_\omega\right>$;
and so we may, by the same token, assume without loss of generality
that $f=\left<x,\varrho_\omega(\,\cdot\,)x\right>$
for some~$\omega\in \Omega$
and~$x\in \scrH_\omega$.
Since such~$x$ (by definition of~$\scrH_\omega$, 
\sref{gns})
is the norm limit of
a sequence $\eta_\omega(a_1),\,\eta_\omega(a_2),\,
\dotsb$,
where~$a_1,a_2,\dotsc\in\scrA$,
the np-maps $a_n\ast \omega\equiv 
\left<\eta_\omega(a_n),\varrho_\omega(\,\cdot\,)\eta_\omega(a_n)\right>$
converge to~$\left<x,\varrho_\omega(\,\cdot\,) x\right>=f$
in the operator norm as $n\to\infty$ by~\sref{vector-functional-convergence};
and so we may assume without loss of generality
that~$f=a\ast \omega$ for some~$a\in\scrA$ and~$\omega\in \Omega$.
Since~$S$ is ultrastrongly dense in~$\scrA$
we can find a net~$(s_\alpha)_\alpha$
in~$S$ that converges ultrastrongly to~$a$.
As the np-functionals~$s_\alpha \ast \omega$
in $\Omega'\subseteq \Omega''$
will then
operator-norm converge
to~$f= a\ast \omega$
as $\alpha\to\infty$
by~\sref{bstaromega-basic},
we conclude that~$f\in \overline{\Omega''}$.\qed
\end{point}
\end{point}
\end{point}
\end{parsec}
\end{document}

